const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/nhz5hxqmqr8u25rj.js","assets/juy90og0wtbp77qa.js","assets/ckp56qklot786ulr.js","assets/dc2xxjkicf2pz0mj.js","assets/root-fv49dn40.css","assets/conversation-small-j9iamy23.css","assets/hsfhk4xuzx0zkaif.js","assets/g1vc33t5rrn1qckw.js","assets/j819y7nh8ckpmr8l.js","assets/jsgl3b1bt1ozctr5.js","assets/o6wb3ptvu0bk81yq.js","assets/dmfmxszxfbs8gsbx.js"])))=>i.map(i=>d[i]);
import{e as ft,r as p,h as ae,j as e,M as N,A as qt,m as he,f as Fe,d as Nr,q as Lr,L as Fr,c as Dr,p as Ur,P as Or}from"./juy90og0wtbp77qa.js";import{e as se,bd as gt,dA as Hr,i as et,e2 as tt,f as Ce,bf as Ro,c7 as Io,S as F,P as M,C as zr,aq as Gr,B as ut,al as Ht,ak as ee,a5 as st,bg as Xe,m$ as Wr,n0 as Vr,n1 as qr,eE as Yr,n2 as uo,eB as $r,dG as Gs,bv as Ws,n3 as J,fQ as Le,b2 as W,bK as Bo,fq as Kr,hA as No,aF as re,n4 as Yt,b6 as Vs,ag as $t,eG as qs,f9 as Ys,eI as dt,ap as Xr,aC as Lo,n5 as $s,n6 as Ks,n7 as Fo,eH as Ne,ae as nt,fd as ht,gN as Ns,hw as Ls,gK as Xs,gR as Do,gO as Fs,kK as Uo,lM as Oo,kL as Ho,b3 as Te,bL as Jr,bA as je,hz as Qr,n8 as we,dV as mo,n9 as Zr,k as Ae,f_ as ei,bC as ti,dZ as si,bj as zo,l as Je,na as Go,gY as Wo,nb as Vo,fO as Ms,e6 as po,a7 as ni,fD as qo,ar as te,hl as oi,as as Js,at as Qs,L as ws,b as js,g8 as ai,bk as Yo,$ as Qe,cf as ri,cl as ii,R as li,A as ci,D as $o,lH as ui,kG as Zs,nc as Ko,lq as Ds,be as di,aG as mi,a$ as pi,fa as Xo,f4 as fi,ec as Us,nd as gi,fj as zt,bX as Jo,cm as hi,aZ as Qo,dX as Zo,fG as xi,cW as ea,dS as Si,gr as yi,b0 as ta,aY as bi,c8 as Ci,di as Ai,dl as _i,ne as ki,hb as fo,hm as sa,dY as Pi,bi as vi,aV as mt,aS as Ft,aU as go,kX as Mi,fb as ho,nf as wi,eJ as ji,gc as Gt,ng as Ti,fc as Ei,i7 as Ri,nh as Ii,ni as Bi,nj as Ni,nk as Li,nl as Fi,ff as Di,km as Ui,ga as Oi,s as Hi,N as zi,dW as na,gM as Gi,fM as Wi,kt as Vi,g5 as oa,fV as qi,nm as Yi,cx as $i,cy as Ki,my as Xi,du as Ji,fn as Qi,jC as Zi,nn as el,ji as tl}from"./dc2xxjkicf2pz0mj.js";import{u as De,b as sl,s as nl,e as ol}from"./o6wb3ptvu0bk81yq.js";import{mH as Dt,kg as ue,n as Ee,A as ke,s9 as al,c5 as rl,U as Os,e6 as il,sa as ll,sb as cl,sc as ul,k4 as dl,fh as ml,fi as pl,lZ as fl,sd as gl,d9 as aa,se as _e,ag as Kt,d8 as en,sf as hl,sg as xl,j$ as tn,sh as Sl,lw as yl,si as ra,sj as Hs,ab as bl,sk as Cl,sl as ia,dd as Al,nj as xo,dA as sn,nl as _l,sm as kl,sn as Pl,bu as vl,rB as Ml,bp as la,ou as nn,so as ca,fc as Xt,sp as ua,sq as wl,sr as jl,ss as Tl,rK as Ut,fS as Jt,st as El,su as Rl,sv as Il,sw as Bl,sx as Nl,sy as So,sz as Ll,sA as Fl,sB as Dl,sC as Ul,sD as Ol,sE as Hl,pH as Ts,B as da,F as ma,G as pa,p2 as zl,fR as de,rh as Ze,sF as A,sG as Gl,sH as Wl,hr as Vl,sI as ql,sJ as Yl,sK as $l,sL as Kl,sM as Xl,sN as Jl,sO as Ql,sP as Zl,sQ as ec,sR as tc,sS as sc,sT as nc,sU as oc,sV as ac,sW as rc,sX as ic,sY as lc,sZ as cc,s_ as uc,s$ as fa,t0 as dc,t1 as mc,t2 as pc,t3 as fc,t4 as gc,nV as hc,ak as ga,t5 as xc,cO as Ke,e as ha,t6 as Sc,t7 as yc,mK as zs,fW as bc,iQ as xa,t8 as Cc,hp as Sa,hq as Ac,t9 as _c,ta as kc,jP as Pc,bz as Qt,hf as vc,tb as Mc,o2 as wc,e9 as ya,a3 as jc,ep as Tc,M as ba,eK as Ca,tc as Ec,td as Rc,te as Ic,f5 as Bc,tf as Nc,hI as Lc,tg as Fc,th as Dc,ti as Uc,tj as Oc,tk as Hc,tl as zc,tm as Gc,tn as Wc,to as Vc,tp as qc,tq as Yc,tr as $c,ts as Kc,tt as Xc,tu as Jc,tv as Qc,tw as Zc,tx as eu,ty as tu,tz as Aa,tA as su,tB as nu,tC as _a,tD as ou,tE as ka,tF as Pa,tG as au,tH as ru,tI as va,tJ as iu,tK as lu,et as cu,tL as Ma,tM as wa,g$ as uu,h0 as du,ev as mu,tN as pu,h2 as Es,tO as fu,tP as gu,tQ as hu,tR as Rs,h4 as xu,tS as Su,tT as yu,tU as bu,tV as Cu,h7 as Au,tW as _u,tX as ku,tY as Pu,eM as vu,fT as Mu,tZ as wu,t_ as ju,d0 as Tu,t$ as Eu,qW as Ru,u0 as Iu,u1 as Bu,u2 as Nu,u3 as Lu,u4 as Fu,u5 as Du,u6 as Uu,u7 as Ou,u8 as Hu,u9 as zu,eX as Gu,jF as Wu,ua as Vu,ub as yo,ie as qu,ig as Yu,dL as $u,lA as Ku,uc as Xu,lx as Ju,ud as Qu,ue as Zu,uf as ed,fX as bo,ug as td,uh as sd,ui as Z,eC as nd,uj as od,o as ad,uk as rd,ul as id,um as ld,un as cd,uo as ud,up as dd,uq as md,d as pd,ur as fd,us as gd,ut as hd,er as xd,uu as Co,uv as Ao,uw as _o,ux as Sd,uy as yd,hV as bd,uz as Cd,hY as Ad,hZ as _d,uA as ko,uB as kd,uC as Pd,uD as vd,uE as Md,uF as wd,uG as jd,eR as Td,cc as Ed,uH as Rd,cu as Id,kP as Bd,eW as Nd,mE as Ld,es as Fd,uI as Dd,X as Ud,qU as Od,uJ as Hd,uK as zd,mB as Is,mC as Bs,uL as Gd,Y as Wd,uM as Vd}from"./ckp56qklot786ulr.js";import{d as ja,m as pt,a as Ta,u as qd}from"./o7zrzew6ugefv8n2.js";import{P as Yd,u as $d}from"./abebcwj1m9mup3z6.js";import{A as Kd,C as Xd,g as Jd}from"./hort3ndd4wla0a2j.js";import{u as Qd}from"./nqj34k5dky4x5suq.js";import{a as Ea,u as Zd,I as em,R as tm}from"./jsgl3b1bt1ozctr5.js";import{P as sm,v as nm,w as Ot,x as om}from"./dmfmxszxfbs8gsbx.js";import{u as am,c as rm}from"./ck00y48d3yzt8bq3.js";import{u as Ra}from"./hczymk9ojq2shlcf.js";const im="https://persistent.oaistatic.com/image-gen/nux.222e584e.mp4",lm="https://help.openai.com/en/articles/8932459",Fp=()=>{const t=se(),{isLoading:s,eligible:n}=Ee(ke.hasSeenShibaHomeNux),{isUnauthenticated:o}=gt(),[r]=al(),i=Hr(t),c=et(tt),a=Ce(t,"2781425969");return o||!a||r||i||c?"hide":s?"loading":n?"show":"hide"};function Ia(t){return[{title:t.formatMessage({id:"er580q",defaultMessage:"Create an image of a magazine cover of cute animals with headlines and text"}),body:"",type:ue.Autocomplete,prompt:t.formatMessage({id:"SKZKBN",defaultMessage:"Create an image of a photorealistic magazine cover for 'CUTE ANIMALS,' featuring three impossibly cute and stylishly accessorized pets, with realistic, catchy headlines and teaser text"}),theme:Dt.Image},{title:t.formatMessage({id:"ukPFbH",defaultMessage:"Create an image for a garden-themed birthday party invitation"}),body:"",type:ue.Autocomplete,prompt:t.formatMessage({id:"uYg5kL",defaultMessage:"Create an image of a colorful invitation for a garden-themed birthday party, including whimsical typography"}),theme:Dt.Image},{title:t.formatMessage({id:"mMiJxP",defaultMessage:"Create an image of an astronaut with an inflatable duck on Mars"}),body:"",type:ue.Autocomplete,prompt:t.formatMessage({id:"5nFWh4",defaultMessage:"Create a photorealistic image of an international astronaut on Mars, wearing a giant duck inflatable toy around its waist"}),theme:Dt.Image},{title:t.formatMessage({id:"+T7POI",defaultMessage:"Create an image of a tutorial for cooking pasta"}),body:"",type:ue.Autocomplete,prompt:t.formatMessage({id:"9N2bJ0",defaultMessage:"Create an image of a comic-book style tutorial for cooking pasta"}),theme:Dt.Image}]}const Dp=({onClose:t,clientThreadId:s})=>{const{markAsViewed:n}=Ee(ke.hasSeenShibaHomeNux),o=De(),r=ft(),i=se(),c=Ro(i,"2604379743").value,a=typeof c.nux_video_url=="string"?c.nux_video_url:im,l=typeof c.nux_image_url=="string"?c.nux_image_url:"",[d,h]=p.useState(!1),g=Io(),u=rl(F.PictureV2,s);p.useEffect(()=>{M.logEventWithStatsig("chatgpt_imagegen_nux_modal_shown","chatgpt_imagegen_nux_modal_shown")},[]);const f=ae(),S=Ia(f),C=()=>{n(),t(),M.logEventWithStatsig("chatgpt_imagegen_nux_modal_dismissed","chatgpt_imagegen_nux_modal_dismissed")},k=()=>{n(),t(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{u&&g(F.PictureV2,{analyticsMetadata:{clientThreadId:s}}),o.focus()})}),o.setAutocompletions(S)};return e.jsx(e.Fragment,{children:e.jsxs(zr,{testId:"modal-imagegen-nux",isOpen:!0,noPadding:!0,onClose:Gr,shouldIgnoreClickOutside:!0,showCloseButton:!1,size:"custom",type:"success",className:"max-w-lg",children:[e.jsxs("div",{className:"relative aspect-3/2 w-full",children:[!d&&e.jsx("img",{src:l,alt:"",className:"absolute inset-0 h-full w-full object-cover object-bottom transition-opacity duration-300"}),e.jsx("video",{src:a,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"h-full w-full object-cover object-bottom",onLoadedData:()=>h(!0)})]}),e.jsxs("div",{className:"flex flex-col gap-2 px-8 pt-6 pb-6 text-center",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(N,{id:"KgZP2O",defaultMessage:"Image creation just got better"})}),e.jsx("div",{className:"text-token-text-secondary w-full",children:e.jsx(N,{id:"/oguus",defaultMessage:"ChatGPT now thinks a little longer to make more accurate and detailed images. <link>Learn more</link>",values:{link:_=>e.jsx("a",{href:lm,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 no-underline",children:_})}})}),e.jsx("div",{className:"mt-2 w-full text-xs text-[#8F8F8F] dark:text-[#C4C4C4]",children:e.jsx(N,{id:"6pIXUv",defaultMessage:"You must have permission to edit images you upload, including consent from any people in them."})}),e.jsxs("div",{className:"mt-4 flex w-full gap-3",children:[e.jsx(ut,{color:"secondary",onClick:C,className:"flex-1",children:e.jsx(N,{id:"6nf9tD",defaultMessage:"Not now"})}),e.jsx(ut,{color:"primary",onClick:()=>{k(),r("/?model=gpt-4o"),M.logEventWithStatsig("chatgpt_imagegen_nux_modal_continued","chatgpt_imagegen_nux_modal_continued")},className:"flex-1",children:e.jsx(N,{id:"ms5BU0",defaultMessage:"Try it"})})]})]})]})})};function cm({usage:t}){const s={work:{icon:gl,color:"#35AE47"},school:{icon:fl,color:"#E937D1"},personalTasks:{icon:pl,color:"#EA8444"},funAndEntertainment:{icon:ml,color:"#6C71FF"},justCurious:{icon:dl,color:"#FFCC00"}},n=s[t].icon,o=s[t].color;return e.jsx(n,{className:"icon",style:{color:o}})}function Up({clientThreadId:t}){const s=ae(),n=Ta({clientThreadId:t});return p.useEffect(()=>{Ht.logEvent("chatgpt_convo_onboarding_usage_chips_shown")},[]),e.jsx(qt,{mode:"wait",children:e.jsx(he.div,{className:"-mx-6 mt-2 flex flex-wrap gap-2 px-6",initial:{opacity:0},animate:{opacity:1,transition:{delay:.2,ease:"easeInOut"}},exit:{opacity:0,transition:{ease:"easeInOut"}},children:["school","work","personalTasks","funAndEntertainment","justCurious"].map(o=>e.jsxs("button",{className:"border-token-border-default bg-token-main-surface-primary hover:bg-token-main-surface-secondary inline-flex h-[42px] items-center justify-start gap-2 rounded-[25px] border px-4 py-3",onClick:r=>{n({sourceEvent:r,stepPrompt:s.formatMessage(pt[`${o}Prompt`]),messageMetadata:{onboarding:{main_usages:[{usage:o}]},is_starter_prompt:!0,suggestion_type:ue.Starter}}),Ht.logEvent("chatgpt_convo_onboarding_usage_chip_clicked",null,{usage:o})},children:[e.jsx("div",{"data-svg-wrapper":!0,className:"relative",children:e.jsx(cm,{usage:o})}),e.jsx("div",{className:"font-['SF Pro'] text-token-text-primary text-[13px] leading-[18px] font-normal opacity-90",children:s.formatMessage(pt[o])})]},o))})})}function Op({clientThreadId:t,examples:s}){const n=Ta({clientThreadId:t}),o=[ll,cl,ul],r=ae();return p.useEffect(()=>{Ht.logEvent("chatgpt_convo_onboarding_examples_shown")},[]),e.jsx(qt,{mode:"wait",children:e.jsxs("div",{children:[e.jsx(he.p,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,ease:"easeInOut"},className:"text-token-text-primary text-base",children:r.formatMessage(pt.tryAnExample)}),e.jsx("ul",{className:"-mx-6 flex list-none flex-nowrap gap-6 overflow-auto px-6 py-4",children:s.map((i,c)=>e.jsx(he.li,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:(c+1)*.2,duration:.3},children:e.jsxs("button",{className:"bg-token-main-surface-primary outline-token-border-xlight hover:shadow-token-border-default inline-flex h-60 w-[222px] flex-col items-center justify-start overflow-hidden rounded-2xl outline transition-all duration-300 hover:shadow-lg",onClick:a=>{n({sourceEvent:a,stepPrompt:i.example,messageMetadata:{onboarding:{triggered_tools:[i.feature]},is_starter_prompt:!0,suggestion_type:ue.Starter}}),Ht.logEvent("chatgpt_convo_onboarding_example_clicked",null,{tool:i.feature})},children:[e.jsx("img",{src:o[c%o.length].src,className:"h-[160px] w-full object-cover",alt:r.formatMessage({id:"chatgpt.new-onboarding.example-prompt",defaultMessage:"Example prompt"})}),e.jsx("div",{className:"inline-flex h-20 w-full gap-1 p-4",children:e.jsx("div",{className:"text-token-text-primary line-clamp-2 shrink grow basis-0 text-start text-base leading-normal",title:i.title,children:i.title})})]})},i.feature))})]})})}function um({clientThreadId:t,children:s}){const{isEligible:n,markAsViewed:o}=ja(t),r=ae();return p.useEffect(()=>{n&&Os.showAnnouncementTooltipExclusively(ke.hasSeenFilePickerNuxTooltip,!0)},[n]),n?e.jsx(il,{announcementKey:ke.hasSeenFilePickerNuxTooltip,show:!0,side:"top",align:"start",theme:"bright",dismissOnOutsideClick:!0,badge:"none",title:r.formatMessage(pt.tryUploadingAFile),description:r.formatMessage(pt.uploadFileExample),onDismiss:o,sideOffset:0,children:s}):s}const Wt=({clientThreadId:t,rateLimitPopup:s,children:n,disabled:o,highlightTooltip:r=!1,disabledReason:i,currentModelName:c,label:a,secondaryLabel:l})=>{const d=ae(),h=ee(t,W.getIsNewConversation),g=st(),u=k=>{s!=null&&k&&M.logPopoverHover({type:"rate_limit",location:"file_upload",plan_type:g?.planType??"unknown"})},f=aa(Xe.signUpButtonText),{isEligible:S}=ja(t),C=!!s;return e.jsx(e.Fragment,{children:C?e.jsxs(Wr,{delayDuration:150,onOpenChange:u,children:[e.jsx(Vr,{asChild:!0,children:n}),e.jsx(qr,{children:e.jsx(Yr,{children:e.jsx(uo,{children:e.jsx($r,{$as:uo,side:"left",sideOffset:0,align:"start",alignOffset:-12,className:"max-w-[320px]",children:e.jsx(dm,{isNewConversation:h,rateLimitPopup:s,signUpButtonText:f})})})})})]}):!o&&S?e.jsx(um,{clientThreadId:t,children:n}):e.jsx(Gs,{label:!o&&a?a:Zt(d,o,i,c),secondaryLabel:l,labelOrientation:"horizontal",className:"flex",contentClassName:r?void 0:"touch:hidden",open:r?!0:void 0,side:"bottom",children:n})})};function Zt(t,s,n,o){return s?n===_e.ModelNotSupported&&o!=null?t.formatMessage({id:"xPEzDr",defaultMessage:"Add files disabled for {modelName}"},{modelName:o}):n===_e.HasReachedMaxFiles?t.formatMessage({id:"TEBczg",defaultMessage:"Cannot add more files"}):n===_e.RateLimitReached?t.formatMessage({id:"DpMzvo",defaultMessage:"Reached daily upload limit"}):t.formatMessage({id:"MeW0HZ",defaultMessage:"Add files is unavailable"}):t.formatMessage({id:"composer.add.label",defaultMessage:"Add photos & files"})}const dm=({isNewConversation:t=!1,rateLimitPopup:s,signUpButtonText:n})=>{const o=st(),r=ft(),i=Kt(),c=en(),a=Ws();if(s==null)return null;const{call_to_action:l,description:d}=s,h=d||e.jsx(N,{...Po.defaultDescription}),g=l?.includes(J.GET_PLUS),u=l?.includes(J.AUTHENTICATE),f=u&&a;return e.jsxs("div",{className:"text-token-text-primary p-2 text-sm",children:[e.jsx("div",{className:"mb-3",children:h}),g?e.jsx(ut,{size:"small",color:"secondary",onClick:()=>{Le(r,"Rate limited file upload popover"),M.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"popover",plan_type:o?.planType??"unknown",is_hard_block:!1,is_new_conversation:t,hard_block_reason:""})},children:e.jsx(N,{...Po.getPlus})}):null,u?e.jsx(ut,{size:"small",color:"primary",onClick:()=>{i({authType:c?"login":"signup",callback:S=>{c?M.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:S}):M.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:S})}})},children:c?e.jsx(N,{...Xe.logInButtonText}):e.jsx(N,{...n})}):null,f?e.jsx(ut,{size:"small",color:"secondary",className:"ms-2",onClick:()=>{i({authType:c?"signup":"login",callback:S=>{c?M.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:S}):M.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:S})}})},children:c?e.jsx(N,{...n}):e.jsx(N,{...Xe.logInButtonText})}):null]})},Po=Fe({defaultDescription:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlus:{id:"TeyLcp",defaultMessage:"Get Plus"}}),Ba=({modelSupportsImages:t,isDisabled:s})=>{const n=t&&!s&&No(),{addFileIcon:o}=tn(),r=mm(o,n);return e.jsx(r,{"aria-label":"",className:"icon"})};function on({openFileDialog:t,showMenuForNoAuth:s,modelSupportsImages:n,isDisabled:o,disabledReason:r,currentModelName:i}){const c=se(),a=ae(),l=Kt(),d=ft(),h=Bo(c),g=n&&!o&&Kr(),u=n&&!o&&No();return s?e.jsx(pm,{onClickUploadImages:t,redirectToAuth:()=>l({authType:"login"})}):e.jsxs(e.Fragment,{children:[u&&e.jsx(hl,{}),g&&e.jsx(xl,{}),e.jsx(re.Item,{onClick:r===_e.RateLimitReached?()=>{Le(d,"Rate limited file upload menu-item"),M.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"menu-item",plan_type:h?.planType??"unknown",is_hard_block:!1,hard_block_reason:""})}:t,icon:e.jsx(Ba,{modelSupportsImages:n,isDisabled:o}),disabled:o&&r!==_e.RateLimitReached,label:u?a.formatMessage({id:"LocalFileDropdownItem.uploadFilesOnly",defaultMessage:"Add files"}):Zt(a,o,r,i),secondary:r===_e.RateLimitReached&&a.formatMessage({id:"kYTJoS",defaultMessage:"Get ChatGPT Plus to unlock more"})},"upload")]})}function mm(t,s){return t==="photo"?s?Hs:ra:t==="paperclip"?Hs:bl}function pm({onClickUploadImages:t,redirectToAuth:s}){return e.jsxs(e.Fragment,{children:[e.jsx(re.Item,{icon:Sl,onClick:s,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(N,{...ct.connectApps}),e.jsx("span",{className:"text-token-text-secondary text-[13px]",children:e.jsx(N,{...ct.loginRequired})})]})},"connect-apps-no-auth"),e.jsx(re.Item,{icon:yl,onClick:s,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(N,{...ct.uploadDocuments}),e.jsx("span",{className:"text-token-text-secondary text-[13px]",children:e.jsx(N,{...ct.loginRequired})})]})},"upload-documents-no-auth"),e.jsx(re.Item,{icon:ra,onClick:t,children:e.jsx(N,{...ct.uploadImages})},"upload-images-no-auth")]})}const ct=Fe({connectApps:{id:"Rna6u2",defaultMessage:"Connect apps"},uploadDocuments:{id:"0BxpM7",defaultMessage:"Documents"},uploadImages:{id:"rdMuNJ",defaultMessage:"Images"},loginRequired:{id:"/1XNys",defaultMessage:"Login required"}});function fm({clientThreadId:t,openFileDialog:s,icon:n,isDisabled:o=!1,isSmall:r=!1,showLabel:i=!1,showUpsell:c=!1,hideBorder:a=!1,highlightTooltip:l=!1,disabledReason:d,currentModelName:h,visualTreatment:g,showMenuForNoAuth:u,modelSupportsImages:f}){const S=ae(),C=Yt();o=(o||!!C)&&!c;const k=e.jsxs(Cl,{disabled:o,$showLabel:i,$hideBorder:a,$isSmall:r,$visualTreatment:g,onClick:I=>{if(I.preventDefault(),u||c){M.logNoAuthAttachButtonClicked({location:u?"No auth file upload":"No auth upsell"});return}s()},"aria-label":Zt(S,o,d,h),children:[n,i&&e.jsx(ia,{})]}),_=e.jsx("div",{className:"flex",children:k});if(u||c){const I=u?e.jsx(on,{openFileDialog:s,showMenuForNoAuth:!0,modelSupportsImages:f}):e.jsx(Al,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"}),E=e.jsx(re.BasicTrigger,{asChild:!0,children:_});return e.jsxs(re.Root,{children:[u?e.jsx(Wt,{clientThreadId:t,rateLimitPopup:C,highlightTooltip:l,disabled:o,children:E}):e.jsx(Gs,{label:e.jsx(N,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:l||void 0,children:E}),e.jsx(re.Portal,{children:e.jsx(re.Content,{alignOffset:-8,side:"bottom",size:"small",className:"radix-side-bottom:flex-col-reverse flex flex-col",children:I})})]})}return e.jsx(Wt,{disabled:o,clientThreadId:t,rateLimitPopup:C,highlightTooltip:l,children:_})}function gm({code:t,message:s}){switch(t){case xo.FileTooLarge:return vo.errorFileTooLarge;case xo.TooManyFiles:return M.logEvent("Uploaded Max Files Error"),vo.errorTooManyFiles;default:return s}}const vo=Fe({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),Mo=Fe({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function hm(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(n=>s.push(...n)),s.sort()}function Hp(t){const{className:s,children:n,clientThreadId:o,currentModelConfig:r,noKeyboard:i}=t,c=ae(),a=$t(),l=se(),d=nt(l),g=Vs(l).flags?.includes(Ys.NoAuthEnableFileUploads),u=sn(o),f=ht(),S=Ns(r,u,f),C=S!==Ne.None,k=Ls(b=>b.files),_=(S===Ne.Multimodal?$s:Ks)-k.length,I=_<=0,{getGizmoId:E}=Xs(),{handleFileAccepted:R}=La(c,S,Fs(r,u),"drag",E,Do(r,u)?.attachments),v=Yt(),P=Uo(!d&&g?Fs(r,u):Oo(r,u)),{getRootProps:y,isDragActive:w}=Ra({maxFiles:_,disabled:!C||I||v!=null,noClick:!0,noKeyboard:i,onDropAccepted:R,onDropRejected:b=>Na(b,c,a,S),multiple:!0,maxSize:Ho,...P}),j=hm(P);return e.jsxs("div",{...y({className:s}),children:[n,w&&e.jsxs(xm,{children:[e.jsx(_l,{}),e.jsx("h3",{children:e.jsx(N,{...Mo.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:j.length>0?j.join(", "):e.jsx(N,{...Mo.dragAllAccepted})})]})]})}function Na(t,s,n,o){const{errors:r}=t[0];r.forEach(i=>{const c=gm(i);typeof c=="string"?n.danger(c,{hasCloseButton:!0,loggingTitle:"File upload error",loggingDescription:c,toastId:"file_upload_error"}):n.danger(s.formatMessage(c,{size:Fo,maxNum:o===Ne.Multimodal?$s:Ks}),{hasCloseButton:!0,loggingTitle:c.defaultMessage||"File upload error",loggingDescription:c.defaultMessage||"File upload error",toastId:"file_upload_error"})})}function La(t,s,n,o,r,i){const c=se(),a=Vs(c).flags,l=$t(),d=qs(),{isUnauthenticated:h}=gt(),g=a?.includes(Ys.NoAuthEnableFileUploads);return{handleFileAccepted:p.useCallback(async(f,S)=>{M.logEvent("Upload File",{client:"web",eventSource:o,intent:s.toString()});const C=r!=null?await r():void 0;f.length>0&&f.forEach(k=>{dt.uploadFile(d,Xr(k),k,s,n,t,l,{gizmoId:C,...g&&{isUnauthenticated:h}},i)})},[o,s,r,d,n,t,l,i,g,h])}}const xm=Lo.div`absolute z-50 inset-0 flex gap-2 flex-col justify-center items-center after:contents-[""] after:absolute after:opacity-80 after:z-[-1] after:bg-token-main-surface-primary after:inset-0`,Sm=({clientThreadId:t,currentModelId:s,isCompletionInProgress:n,composerController:o})=>{const r=se(),i=ht(),c=Te(t),a=Jr(k=>k.threads[t]?.prepareRequestBlocked??!1),{isOpen:l}=qd();kl({clientThreadId:t,composerController:o});const d=p.useRef(n);p.useEffect(()=>{d.current=n},[n]);const h=p.useCallback(k=>{d.current?je(t,_=>{_.conduitToken=null,_.prepareState=null}):je(t,_=>{_.conduitToken=k,_.prepareState="success"})},[t]),g=p.useRef(null);g.current=()=>Pl(t,s,i?[i]:void 0,h,!1,l);const u=p.useCallback(()=>g.current?.(),[]),f=p.useCallback(vl(()=>u(),5e3,{leading:!0,trailing:!0}),[]),S=p.useRef(!1),C=Qr();return p.useEffect(()=>{if(C){if(!S.current){S.current=!0;return}d.current||a||u()}},[C,t,s,i,c?.effortMode,a]),p.useEffect(()=>{f.cancel()},[n,f]),p.useEffect(()=>o.subscribe("change",()=>{n||Ml(r,!0)&&f()}),[n,o,f,r]),null},ym=({clientThreadId:t,beaconInfo:s,onPrimaryCTAClick:n,onSecondaryCTAClick:o,onDismiss:r,onMount:i})=>{const{title:c,description:a,action_items:l,composer_text:d}=s,h="Prompt TextareaBeacons Banner",g=la({clientThreadId:t}),u=De(),f=Kt(),S=se(),C=!nt(S),k=ft(),_=v=>{switch(v?.action){case we.REGENERATE_MESSAGE_GPT45:{const P=W.getCurrentLeafId(Te(t)),y=()=>{g({sourceEvent:new Event("beacon CTA click"),nodeId:P,requestedModelId:"gpt-4-5"})};return{text:v.action_copy,onClick:y}}case we.FILE_UPLOAD:{const P=()=>{u.openFileDialog(),d&&(u.focus(),u.setText(d))};return{text:v.action_copy,onClick:P}}case we.AUTHENTICATE_LOGIN:{const P=()=>{f({authType:"login"})};return{text:v.action_copy,onClick:P}}case we.AUTHENTICATE_SIGNUP:{const P=()=>{f({authType:"signup"})};return{text:v.action_copy,onClick:P}}case we.GET_PLUS:{const P=()=>{C?f({authType:"login",shouldOpenPaymentModalOnAuth:!0}):Le(k,h)};return{text:v.action_copy,onClick:P}}case we.GET_PRO:{const P=()=>{C?f({authType:"login",shouldOpenPaymentModalOnAuth:!0}):Le(k,h)};return{text:v.action_copy,onClick:P}}case we.REGENERATE_MESSAGE_O3:{const P=W.getCurrentLeafId(Te(t)),y=()=>{g({sourceEvent:new Event("beacon CTA click"),nodeId:P,requestedModelId:"o3"})};return{text:v.action_copy,onClick:y}}default:return}};nn(()=>{i?.()});const[I,E]=l??[],R={primaryAction:(()=>{const v=_(I);if(v)return{...v,onClick:()=>{n?.(),v.onClick?.()}}})(),secondaryAction:(()=>{const v=_(E);if(v)return{...v,onClick:()=>{o?.(),v.onClick?.()}}})()};return e.jsx(ca,{onDismiss:r,title:c,description:a,actions:R})},bm=({clientThreadId:t})=>{const s=ua(),n=ee(t,W.getRequestId),o=Xt(n),r=wl(),i=jl(),c=Tl();p.useEffect(()=>{o&&(M.logEventWithStatsig("Beacon UI Banner Ignored","chatgpt_beacon_ui_banner_ignored",{...s}),Ut.dismissBanner())},[o,s]);const a=p.useRef(!1),l=()=>{a.current||s&&(M.logEventWithStatsig("Beacon UI Banner Shown","chatgpt_beacon_ui_banner_shown",{...s}),r.mutate(s.beacon_id),a.current=!0)},d=()=>{s&&(M.logEventWithStatsig("Beacon UI Banner Primary CTA Clicked","chatgpt_beacon_ui_banner_primary_cta_clicked",{...s}),i.mutate(s.beacon_id)),Ut.dismissBanner()},h=()=>{s&&(M.logEventWithStatsig("Beacon UI Banner Secondary CTA Clicked","chatgpt_beacon_ui_banner_secondary_cta_clicked",{...s}),i.mutate(s.beacon_id)),Ut.dismissBanner()},g=()=>{s&&(M.logEventWithStatsig("Beacon UI Banner Dismissed","chatgpt_beacon_ui_banner_dismissed",{...s}),c.mutate(s.beacon_id)),Ut.dismissBanner()};return e.jsx(qt,{children:s&&e.jsx(he.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(ym,{clientThreadId:t,beaconInfo:s,onPrimaryCTAClick:d,onSecondaryCTAClick:h,onDismiss:g,onMount:l})})})};function Cm(t){const s=ee(t,W.getRequestId),n=Xt(s),o=ua(),r=o!=null&&o.action_items.every(i=>Object.values(we).includes(i.action));return!n&&r}const Fa=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:o,onMount:r})=>{const{name:i,title:c,call_to_action:a,description:l}=s,d=st(),h=mo(!0),{updateSystemHint:g}=Jt(),u=De(),f=mo(!1),S=Zr(),C=ee(t,W.getIsNewConversation),k=d?.planType??"unknown",_=Ws(),I=S&&"block_reason"in S?S.block_reason:null,E="banner_description",R=p.useMemo(()=>({type:i||"unknown",location:E,plan_type:k,is_new_conversation:C,is_hard_block:!!S,hard_block_reason:I??"",call_to_action:a}),[i,E,k,C,S,I,a]),v=ft(),P=Kt(),y=se(),w=!nt(y),j=en(),b=aa(Xe.signUpButtonText),{eligible:D,isLoading:U}=Ee(ke.hasSeenTatertotNux),X=la({clientThreadId:t}),x=Ae(y,"1368081792"),q=xe=>{switch(xe){case J.AUTHENTICATE:return{text:j?Xe.logInButtonText:b,onClick:()=>{P({authType:j?"login":"signup",callback:B=>{j?M.logLogInButtonClicked({location:`Rate limit banner - ${i}`,provider:B}):M.logSignUpButtonClicked({location:`Rate limit banner - ${i}`,provider:B})}})}};case J.AUTHENTICATE_SECONDARY:return{text:j?b:Xe.logInButtonText,onClick:()=>{P({authType:j?"signup":"login",callback:B=>{j?M.logSignUpButtonClicked({location:`Rate limit banner - ${i}`,provider:B}):M.logLogInButtonClicked({location:`Rate limit banner - ${i}`,provider:B})}})}};case J.GET_PLUS:return{text:Me.getPlusButton,onClick:()=>{M.logRateLimitGetPlusButtonClicked(R),w?P({authType:j?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:B=>{j?M.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:B}):M.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:B})}}):Le(v,"Prompt textarea rate limit banner")}};case J.NEW_CHAT:return{text:Me.newChatButton,onClick:()=>{h({modelId:"",location:E})}};case J.PAID_USER_O3_MINI_HIGH:{const B=W.getCurrentLeafId(Te(t)),$=()=>{M.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:x.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:R}),x.get("should_change_model_picker",!0)&&f({modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}),X({sourceEvent:new Event("click"),nodeId:B,requestedModelId:"o4-mini-high"})};return{text:Me.tryItButton,onClick:$}}case J.FREE_USER_O3_MINI_HIGH:return{text:Me.getPlusButton,onClick:()=>{M.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:R}),Le(v,"Prompt textarea in-context upsell banner")}};case J.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const B=W.findNode(Te(t),oe=>ei(oe.message)),$=B?ti(B.message):void 0;return{text:Me.tryItButton,onClick:()=>{M.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:R}),g(F.Research,{clientThreadId:t}),u.focus(),u.setText($??"")}}}case J.GET_PRO:return{text:Me.getProButton,onClick:()=>{M.logRateLimitUpgradePlanButtonClicked({...R,upgrade_plan_tye:"pro"}),w?P({authType:j?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:B=>{j?M.logLogInButtonClicked({location:"Rate limit banner Get Pro upsell",provider:B}):M.logSignUpButtonClicked({location:"Rate limit banner Get Pro upsell",provider:B})}}):Le(v,"Prompt textarea rate limit banner")}};case J.TRY_CODEX:return{text:Me.tryCodexButton,onClick:()=>{M.logEventWithStatsig("In Context Upsell Banner Codex CTA Clicked","chatgpt_in_context_upsell_banner_codex_cta_clicked",{location:"In-context upsell codex - Try Codex button",eventProperties:R}),v("/codex")}};case J.TRY_TATERTOT:return{text:Me.tryItButton,onClick:()=>{M.logEventWithStatsig("In Context Upsell Banner Tatertot CTA Clicked","chatgpt_in_context_upsell_banner_tatertot_cta_clicked",{location:"In-context upsell tatertot - Try it button",eventProperties:R}),g(F.Tatertot,{clientThreadId:t})}};default:return}};nn(()=>{!x.get("should_change_model_picker",!0)&&R.type==="o3-mini-high-in-context-upsell-plus"&&(R.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),M.logRateLimitBannerShown(R),r?.()});const[z,Y]=a??[];let O=Y;z===J.AUTHENTICATE&&_&&(O=J.AUTHENTICATE_SECONDARY);const ne=Ce(y,"2861925050");let V={};return ne&&(z===J.NOTIFY_ADMIN_FOR_CREDITS||z===J.ADD_CREDITS)?z===J.ADD_CREDITS?V={customActions:e.jsx(Kd,{trigger:"prompt-textarea-rate-limit-banner"})}:z===J.NOTIFY_ADMIN_FOR_CREDITS&&(V={customActions:e.jsx(Xd,{creditConsumingProduct:Jd(i),trigger:"prompt-textarea-rate-limit-banner"})}):V={primaryAction:q(z),secondaryAction:q(O)},e.jsx(ca,{onDismiss:n,title:c,description:l,actions:V,onInteract:o})},Me=Fe({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},getProButton:{id:"Pl8/Vk",defaultMessage:"Get Pro"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"},tryCodexButton:{id:"KcWniZ",defaultMessage:"Try Codex"}}),Am=({clientThreadId:t,composerController:s})=>{const n=Go(),o=Je(s.store,k=>k.rateLimitBannerFeature),r=Wo(),i=n??Da(o,r),c=ee(t,W.getRequestId),a=ee(t,W.getCurrentLeafId),l=Xt(c),{markSeen:d}=Vo(a),h=se(),g=Ae(h,"1368081792"),u=i?.name?()=>{switch(i.name){case"tatertot-in-context-upsell":d(!1);break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":case"codex-in-context-upsell-plus":Dl(a);break}}:void 0,f=Ce(h,"3612584454");p.useEffect(()=>{l&&!(i?.name==="gpt-4l"&&f)&&(po.dismissBanner(),s.setRateLimitBannerFeature(null))},[l,i?.name,f,s]);const S=i?.is_dismissible?()=>{M.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",{type:!g.get("should_change_model_picker",!0)&&i?.name==="o3-mini-high-in-context-upsell-plus"?"o3-mini-high-in-context-upsell-plus-no-model-switch":i?.name}),po.dismissBanner(),s.setRateLimitBannerFeature(null)}:void 0,C=()=>{switch(i?.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":case"codex-in-context-upsell-plus":Ul({interactedInPeriod:!0});break;case"tatertot-in-context-upsell":d(!0);break}};return e.jsx(qt,{children:i&&e.jsx(he.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Fa,{clientThreadId:t,rateLimitInfo:i,onDismiss:S,onInteract:C,onMount:u})})})};function Da(t,s){const n=s.find(o=>o.name===t);return n?{name:n.name,title:n.title,description:n.description,is_dismissible:!0,call_to_action:n.call_to_action,resets_after:n.resets_after}:null}function _m(t,s,n,o,r,i,c,a,l,d,h,g,u){if(l||(t.name==="o3-mini-high-in-context-upsell-free"||t.name==="o3-mini-high-in-context-upsell-plus")&&(s.some(R=>R.model_slug==="o4-mini-high")||n.id==="o4-mini-high")||a&&c&&Ms(Date.now(),c)<So)return!1;const S=o==null||Ms(Date.now(),o)>=Ll,C=r===d,k=c==null||i==null||Ms(Date.now(),c)>=So||i<Fl;if(!(S&&k||C))return!1;switch(t.name){case"deep-research-in-context-upsell":return h("should_show_deep_research_upsell_banner",!1);case"deep-research-in-context-upsell-free":return h("should_show_deep_research_upsell_banner_free",!1);case"o3-mini-high-in-context-upsell-free":return h("should_show_o3_mini_high_upsell_banner_free_user_to_plus",!1);case"o3-mini-high-in-context-upsell-plus":return h("should_show_o3_mini_high_upsell_banner_plus_user",!1);case"codex-in-context-upsell":return g("should_show_codex_upsell_banner",!1);case"codex-in-context-upsell-plus":return u("should_show_codex_upsell_banner",!1);default:return!1}}function km(t,s){const n=se(),o=si(),r=zo(t),i=ee(t,W.getRequestId),c=ee(t,W.getCurrentLeafId),a=Xt(i),l=El(y=>y.lastSeenInContextUpsellBannerAt),d=Rl(y=>y.inContextUpsellBannerPeriodExposureCount),h=Il(y=>y.inContextUpsellBannerPeriodStartAt),g=Bl(y=>y.inContextUpsellBannerLastSeenId),u=Nl(y=>y.inContextUpsellBannerInteractedInPeriod),f=Ae(n,"1368081792"),S=Ae(n,"1738106734"),C=Ae(n,"3861158060"),k=Je(s.store,y=>y.rateLimitBannerFeature),_=Ce(n,"2861925050"),I=Go(),E=Wo(),{canBeSeen:R}=Vo(c),v=_?I:I??Da(k,E);let P=!1;switch(v?.name){case null:case void 0:P=k!=null;break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":case"codex-in-context-upsell-plus":P=_m(v,o,r,l,g,d,h,u,a,c,f.get,S.get,C.get);break;case"tatertot-in-context-upsell":P=R&&f.get("should_show_tatertot_in_context_upsell_banner",!1);break;default:P=!0}return!a&&P}const Vt="month",Ua="year";function Pm(){const t=ni(),s=ae(),{markAsViewed:n}=Ee(Ol),{initialBillingDetails:o}=Qd(t,!0),r=p.useMemo(()=>({...t?.subscriptionAnalyticsParams,referrer:document.referrer}),[t]);async function i(){try{await zl(o,r)}catch{}}const{shouldShowBanner:c,discountValue:a,discountDuration:l}=Hl();if(p.useEffect(()=>{c&&a&&l&&Ts.logShowReferrerRedemptionBanner()},[c,a,l]),!c||!a||!l)return null;const d=vm(s,o,a,l),h=Mm(s,o,a,l),g=e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:d}),e.jsx("span",{className:"text-token-text-secondary",children:h})]});return e.jsx(da,{onPrimaryCtaClick:()=>{n(),Ts.logClickReferrerRedeemButton(),i()},primaryCtaText:e.jsx(N,{id:"referrerRedemptionBannerPrimaryCta",defaultMessage:"Get Plus"}),onDismiss:()=>{n(),Ts.logCloseReferrerRedemptionBanner()},content:g})}function vm(t,s,n,o){const{currencySymbol:r}=ma(pa(),s.currency),i=o?o.period:Vt,c=o?o.num_periods:1,a=r.code.defaultMessage?.toString()??qo,l=t.formatNumber(n.value,{style:"currency",currency:a,minimumFractionDigits:0,maximumFractionDigits:2});let d;return i===Vt?d=c===1?e.jsx(N,{id:"referrerRedemptionBannerTitleForSingleMonth",defaultMessage:"Your {discount} credit is ready",values:{discount:l}}):e.jsx(N,{id:"referrerRedemptionBannerTitleForPluralMonths",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):i===Ua&&(d=c===1?e.jsx(N,{id:"referrerRedemptionBannerTitleForSingleYear",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):e.jsx(N,{id:"referrerRedemptionBannerTitleForPluralYears",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}})),d}function Mm(t,s,n,o){const{currencySymbol:r}=ma(pa(),s.currency),i=o?o.period:Vt,c=o?o.num_periods:1,a=r.code.defaultMessage?.toString()??qo,l=t.formatNumber(n.value,{style:"currency",currency:a,minimumFractionDigits:0,maximumFractionDigits:2});let d;return i===Vt?d=c===1?e.jsx(N,{id:"referrerRedemptionBannerContentForSingleMonth",defaultMessage:"Your referral link was used — claim your free month of Plus."}):e.jsx(N,{id:"referrerRedemptionBannerContentForPluralMonths",defaultMessage:"Your referral link earned you {discount} off {num_months} months of Plus.",values:{discount:l,num_months:c}}):i===Ua&&(d=c===1?e.jsx(N,{id:"referrerRedemptionBannerContentForSingleYear",defaultMessage:"Your referral link earned you {discount} off a year of Plus.",values:{discount:l}}):e.jsx(N,{id:"referrerRedemptionBannerContentForPluralYears",defaultMessage:"Your referral link earned you {discount} off {num_years} years of Plus.",values:{discount:l,num_years:c}})),d}const wm=Js(()=>Qs(()=>import("./nhz5hxqmqr8u25rj.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),Oa=p.memo(function({className:s}){const{store:n}=de(),o=n.useIsHeaderContentAreaPopulated(),i=n.useContentAreaId(Ze.HeaderTop)===A.AgentModeAnnouncementBanner?"z-0":Gl.PromptTextareaHeader;return e.jsx("div",{className:te(s??"absolute start-0 end-0 bottom-full",i),children:e.jsx(Wl,{shouldRender:o,contentArea:Ze.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(jm,{}),e.jsx(Tm,{})]})})})});function jm(){const{store:t}=de(),s=t.useSharedProps(d=>d?.clientThreadId),n=t.useContentAreaId(Ze.HeaderTop),o=Vl(),r=ee(s,d=>d?.modelId),i=ql.useStore(),c=oi(),a=et(tt);let l;switch(n){case A.ProjectConversationTaskNoFileAccess:l=e.jsx(Bm,{});break;case A.AdvancedVoiceOnMobileAnnouncement:l=e.jsx(uc,{clientThreadId:s});break;case A.S09KM1:l=null;break;case A.BannerSignup:l=e.jsx(Im,{});break;case A.AudioParagenPrompt:l=e.jsx(cc,{clientThreadId:s});break;case A.BannerTermsDisclaimer:l=e.jsx(Nm,{});break;case A.PromptTextareaAction:l=e.jsx(Lm,{});break;case A.BannersRateLimit:l=e.jsx(Fm,{});break;case A.BannersBeaconUI:l=e.jsx(Dm,{});break;case A.BannerSidekickAnnouncement:l=e.jsx(lc,{});break;case A.SearchBrowserExtensionAnnouncement:l=e.jsx(ic,{});break;case A.MoonshineAnnouncement:l=e.jsx(rc,{});break;case A.CustomizeChatGPTAnnouncement:l=e.jsx(ac,{});break;case A.SearchBrowserExtensionReactiveAnnouncement:l=e.jsx(oc,{});break;case A.BannerMemoryFull:l=e.jsx(nc,{});break;case A.Box:l=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case A.JawboneAnnouncement:o?l=e.jsx(wm,{}):l=null;break;case A.JawboneMaxActiveAnnouncement:o?l=e.jsx(sc,{}):l=null;break;case A.PromoRedemptionAnnouncement:l=e.jsx(Yd,{});break;case A.OperatorAnnouncement:l=e.jsx(tc,{});break;case A.BannerPlusUpsell:l=e.jsx(ec,{});break;case A.ReferrerRedemptionAvailableAnnouncement:l=e.jsx(Pm,{});break;case A.RefereeRedemptionAvailableAnnouncement:l=e.jsx(Zl,{});break;case A.ReferralProgramUpsellAnnouncement:l=e.jsx(Ql,{});break;case A.TatertotIntakeFormAnnouncement:l=!1;break;case A.StudentsUpsellAnnouncement:l=e.jsx(Jl,{});break;case A.ModelDeprecationBanner:l=Xl(r);break;case A.TeamsContextualAnswersUpsell:l=e.jsx(Kl,{});break;case A.KanziConfig:l=!1;break;case A.AgentModeAnnouncementBanner:l=c&&!a&&e.jsx($l,{});break;case A.LanguageUpsellBanner:l=e.jsx(Yl,{onDismissSideEffect:()=>{M.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),i.closeBanner()},onPrimaryCtaClickSideEffect:()=>{M.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),i.closeBanner()}});break;default:l=null;break}return l}function Tm(){const{store:t}=de(),s=t.useContentAreaId(Ze.HeaderBottom);let n;switch(s){case fa.DallePromptControls:n=e.jsx(Rm,{});break;default:n=null;break}return n}const Em=Js(()=>Qs(()=>import("./g1vc33t5rrn1qckw.js"),__vite__mapDeps([7,1,3,4,2,5])).then(t=>t.default));function Rm(){const{store:t}=de(),s=t.useSharedProps(n=>n?.composerController);return s?e.jsx(Em,{composerController:s}):null}function Im(){const{store:t}=de(),s=t.useSharedProps(r=>r?.clientThreadId),n=en(),o=dc();return s?n?e.jsx(mc,{threadId:s,showSignUp:o}):e.jsx(pc,{threadId:s,showLogin:o}):null}function Bm(){return p.useEffect(()=>()=>{ws.getItem(js.TasksHasSeenProjectDisclaimerBanner)||ws.setItem(js.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(da,{icon:e.jsx(ai,{}),title:e.jsx(N,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(N,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{ws.setItem(js.TasksHasSeenProjectDisclaimerBanner,!0)}})}function Nm(){const{store:t}=de(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(fc,{threadId:s}):null}function Lm(){const{store:t}=de(),s=t.useSharedProps();return s?e.jsx(gc,{...s}):null}function Fm(){const{store:t}=de(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useSharedProps(o=>o?.composerController);return!s||!n?null:e.jsx(Am,{clientThreadId:s,composerController:n})}function Dm(){const{store:t}=de(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useSharedProps(o=>o?.composerController);return!s||!n?null:e.jsx(bm,{clientThreadId:s})}function Um({suggestions:t,composerController:s,onSelect:n,onChange:o}){const r=Ea(),i=p.useCallback((u,f,S,C)=>{if(f.onSelectOverride)return f.onSelectOverride(u,f,S,C);n?.(f,S,C),r(u,f,S,C)},[n,r]),[c,a]=p.useState(()=>t.length>0),[l,d]=p.useState(-1),[h,g]=p.useState(!1);return p.useEffect(()=>{const u=f=>{if(!f.isComposing)if(f.key==="ArrowDown"){const S=l===t.length-1?0:l+1;d(S),o?.(S,!0,t[S])}else if(f.key==="ArrowUp"){f.preventDefault();const S=l<=0?t.length-1:l-1;d(S),o?.(S,!0,t[S])}else f.key==="Enter"&&!f.shiftKey&&t[l]&&i(f,t[l],t,l)};return s.subscribe("keydown",u)},[t,l,o,i,s]),p.useEffect(()=>s.subscribe("blur",()=>{d(-1),a(!1),o?.(-1,!1)}),[s,o]),p.useEffect(()=>s.subscribe("focus",()=>a(!0)),[s]),p.useEffect(()=>{if(!h){const u=()=>{g(!0),window.removeEventListener("mousemove",u)};return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)}}},[h]),p.useEffect(()=>{d(-1),o?.(-1,!1),g(!1)},[t,o]),e.jsx(he.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:te("w-full flex-col p-2.5 max-sm:px-0",c?"flex":"hidden"),children:t.map((u,f)=>e.jsxs(he.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:f*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[f>0&&e.jsx("div",{className:te("h-[1px] opacity-60 max-lg:hidden",l===f||l===f-1?"bg-token-main-surface-secondary mx-2":"bg-token-border-default")}),e.jsxs("button",{className:te("flex w-full cursor-pointer items-center justify-start rounded-lg px-2.5 py-3 text-start whitespace-pre-wrap",l===f?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:S=>{S.preventDefault(),i(S,u,t,f)},onMouseDown:S=>{S.preventDefault()},onMouseEnter:()=>{h&&(d(f),o?.(f,!1,u))},onMouseLeave:()=>{d(-1),o?.(-1,!1,u)},children:[u.icon?e.jsx("span",{className:"text-token-text-secondary icon me-2 flex-none",children:u.icon}):null,e.jsx("span",{className:"text-sm whitespace-pre-wrap",children:u.autocompletionChunks&&u.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:u.autocompletionChunks.map((S,C)=>e.jsx("span",{className:te(S.className??(S.isMatched?"text-token-text-tertiary":"text-token-text-primary")),children:S.text},C))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:te(u.type===ue.Starter||u.type===ue.Trending?"text-token-text-secondary":"text-token-text-tertiary"),children:u.title}),e.jsx("span",{className:"text-token-text-primary",children:u.body})]})})]}),f>0&&e.jsx("div",{className:te("h-[1px] opacity-60 lg:hidden",l===f||l===f-1?"bg-token-main-surface-secondary mx-2":"bg-token-border-default")})]},u.id??f))})}function Om(t,s){t=t.toLocaleLowerCase();const n=s;s=s.toLocaleLowerCase();const o=[];let r=0;for(let a=0;a<s.length&&(r<t.length&&t[r]===s[a]&&(o.push(a),r++),r!==t.length);a++);const i=[];let c=0;if(o.forEach(a=>{if(a>c){const l=n.slice(c,a);l&&i.push({text:l,isMatched:!1})}i.push({text:n[a],isMatched:!0}),c=a+1}),c<s.length){const a=n.slice(c);a&&i.push({text:a,isMatched:!1})}return Hm(i)}function Hm(t){if(t.length===0)return t;const s=[t[0]];for(let o=1;o<t.length;o++){const r=s[s.length-1],i=t[o];r.isMatched===i.isMatched?r.text+=i.text:s.push(i)}const n=s.filter(o=>o.isMatched).reduce((o,r)=>o+r.text.trim().length,0);return s.length<=4&&n>=2?s:[{text:s.map(o=>o.text).join(""),isMatched:!1}]}async function zm(t=8,s=null){const n=await li.safeGet("/prompt_library/",{parameters:{query:{limit:t,use_v2:!0,model_slug:s}},authOption:ci.SendIfAvailable});return $o.addFirstTiming("load.promptStarters"),n}function Gm(t=8,s=null){return Lr({queryKey:["promptStarters",t,s],queryFn:()=>zm(t,s)})}function wo(t){return(hc(t)?t.promptStarters:t.gizmo.display.prompt_starters)?.map(s=>({type:ue.Starter,title:"",body:s,prompt:s}))}const Wm=()=>{const t=se(),s=ri(t),n=ha(),o=Sc(yc),r=nt(t),i=r?s.getLayer("4031588851"):s.getLayer("3533083032"),c=r?s.getLayer("4031588851",{disableExposureLog:!0}):s.getLayer("3533083032",{disableExposureLog:!0});return r?n==null?!1:Date.now()/1e3-n.created<c.get("new-user-age-seconds",14*24*60*60)&&i.get("web-enable-for-new-users",!1):o<c.get("new-user-message-count",20)&&i.get("web-enable-for-new-users",!1)},Ha=({clientThreadId:t,limit:s,shouldBeEnabledForDefaultAssistant:n,isModelLoaded:o,modelSlug:r})=>{const i=De(),c=Yo(),a=ae(),{clearAllSystemHintModeTriggers:l,setThreadSystemHintMode:d}=Jt(),h=ee(t,b=>b?.mode),g=ga(h?.kind===Qe.GizmoInteraction?h.gizmo_id:void 0).data,{gizmoEditorData:u,mode:f}=Xs(),S=Wm(),C=xc(h),k=st(),_=S&&n&&!C&&!k?.isEnterprisey(),{data:I,isSuccess:E}=Nr({...Gm(s,r),enabled:_});if(c==null)return{promptStarters:[],isLoading:!0,isSuccess:!1};if(f==="test"&&u)return{promptStarters:wo(u)??[],isLoading:!1,isSuccess:!0};if(g!=null)return{promptStarters:wo(g),isLoading:!1,isSuccess:!0};if(!_)return{promptStarters:[],isLoading:!1,isSuccess:!0};const R=I?.items.map(b=>({type:ue.Starter,id:b.id,title:b.title,body:b.description,prompt:b.prompt,category:b.category,oneliner:b.oneliner,theme:b.theme,requires_file_upload:b.requires_file_upload}))??[],v=(b,D,U,X)=>{if(D.type===ue.Starter&&D.category==="dalle"){requestAnimationFrame(()=>{l(),d(F.PictureV2,!0,{}),i.focus()}),i.setAutocompletions(Ia(a));return}const x=D.title;i.setAutocompletions([]),i.focus(),i.setText(x),requestAnimationFrame(()=>{const q=R.filter(z=>z.theme===D.theme).map(z=>{const Y=ii(z.oneliner),O=Y.startsWith(z.title);return{...z,title:O?`${z.title} `:"",body:O?z.body:Y,autocompletionChunks:Om(x,Y),type:ue.Autocomplete}});i.setAutocompletions(q),q.length>0&&zs(q,t),bc(D,X,t)})},P=R?.reduce((b,D)=>(D.theme&&!b[D.theme]&&(b[D.theme]=D),b),{}),y=[];if(P)for(const b in P)b!=="For you"&&y.push(P[b]);const w=y.length>0,j=!!(E&&w&&o);return Ke.markStart("StarterPromptChips",Ke.NS_COMPOSER),j&&Ke.markRendered("StarterPromptChips",Ke.NS_COMPOSER),{onSelectStarterPrompt:v,shouldShowStarterPrompts:j,promptStarters:y}};function jo({clientThreadId:t,onClick:s}){p.useEffect(()=>{_c(t)},[t]);const n=ae();return e.jsx(he.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(Sa,{onClick:()=>{kc(t),s()},label:n.formatMessage(Km.moreStarterPrompts)})})}function Vm({starterPrompt:t,starterPrompts:s,index:n,disabled:o,onSelectStarterPrompt:r}){const i=t.theme??t.title,c=Ea(),{mutate:a}=Cc(),l=t.category==="onboarding"?d=>{a({key:ke.hasUsedConversationalOnboardingStarterPrompt}),c(d,t,s,n)}:d=>r?.(d,t,s,n);return e.jsx(Sa,{disabled:o,onClick:l,icon:e.jsx(Ac,{category:t.category,useV2Colors:!0}),label:i})}const qm=5,Ym=3;function za({starterPrompts:t,onSelectStarterPrompt:s,disabled:n,clientThreadId:o,onExpand:r,mobileLayout:i=!1}){const c=i?Ym:qm,[a,l]=p.useState(c),[d,h]=p.useState(!1),g=p.useRef(null),u=t.length<=a;p.useEffect(()=>{zs(t.slice(0,c),o)},[o]),p.useEffect(()=>{if(!d&&!u&&g.current){const S=g.current,C=S.getBoundingClientRect(),k=C.width,_=Array.from(S.children);let I=0;for(let E=0;E<_.length&&_[E].getBoundingClientRect().right-C.left<=k;E++)I++;l(I),h(!0)}},[t,u,d]);const f=()=>{const S=t.slice(a,t.length).map(C=>({...C,isAdditional:!0}));S.length>0&&zs(S,o),l(t.length),r()};return e.jsxs("div",{"data-testid":"starter-prompt-chips",className:te("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",d&&t.length>0?"opacity-100":"opacity-[0.01]",i?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:te("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",u||i?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:g,children:[t.slice(0,a).map((S,C)=>e.jsx(he.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(Vm,{starterPrompt:S,starterPrompts:t,index:C,disabled:n,onSelectStarterPrompt:s})},S.id??C)),i&&t.length>a&&e.jsx(jo,{clientThreadId:o,onClick:f})]}),!i&&t.length>a&&e.jsx(jo,{clientThreadId:o,onClick:f})]})}const zp=({clientThreadId:t,currentModelId:s,isModelLoaded:n})=>{const[o,r]=p.useState(!1),i=Zs(),{prospectiveModelId:c}=xa(t),a=n?s:c??"auto",{promptStarters:l,shouldShowStarterPrompts:d,onSelectStarterPrompt:h}=Ha({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:t,limit:8,modelSlug:a});return e.jsx(he.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:te(!o&&"h-[116px]"),children:d&&l&&e.jsx(za,{starterPrompts:l,onSelectStarterPrompt:h,disabled:i,clientThreadId:t,onExpand:()=>r(!0),mobileLayout:!0})})},$m=({currentModelId:t,clientThreadId:s,isModelLoaded:n})=>{const{isUnauthenticated:o}=gt(),[r,i]=p.useState(!1),c=ui(),a=Zs(),{prospectiveModelId:l}=xa(s),d=n?t:l??"auto",{promptStarters:h,shouldShowStarterPrompts:g,onSelectStarterPrompt:u}=Ha({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:s,limit:8,modelSlug:d});return e.jsx(he.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:te("hidden min-h-[108px] max-w-full",c?"@lg/thread:block":"lg:block",o&&r?"":"h-[70px]"),children:g&&h&&e.jsx(za,{starterPrompts:h,onSelectStarterPrompt:u,disabled:a,clientThreadId:s,onExpand:()=>i(!0)})})},Km=Fe({moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Ga=Lo.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function Xm(){const{data:t,isLoading:s}=vc({cutId:"recent",limit:8}),{data:n,isLoading:o}=Mc();return{isLoading:s||o,recent:t,pinned:n}}function Jm({query:t,onSelectGizmo:s,selectedIdx:n,currentModelId:o},r){const i=di(),c=p.useRef([]),{isLoading:a,recent:l,pinned:d}=Xm();p.useImperativeHandle(r,()=>({handleEnterOnIndex:u=>{if(!g[u])return u<h.length?h[u].resource:"create"},getResultsLength:()=>h.length+1,scrollToItem:u=>{const f=c.current[u];f&&f.scrollIntoView({behavior:"instant",block:"nearest"})}}));let h=[];if(a)return e.jsx("div",{className:"absolute end-4 top-0 flex h-full items-center justify-center",children:e.jsx(mi,{})});l&&h.push(...l.pages.flatMap(u=>u.list.items).map(u=>({resource:u.resource,from:"recent"}))),d&&h.push(...d.items.map(u=>({resource:u,from:"pinned"}))),h=Pc(h,u=>u.resource.gizmo.id);const g=h.map(u=>u.resource.gizmo.tags?.includes(Qt.WorkspaceDisabled));return t&&t!==""&&(h=h.filter(u=>(u.resource.gizmo.display.name.toLowerCase()+u.resource.gizmo.display.description?.toLowerCase()+u.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[h.map((u,f)=>e.jsx("div",{ref:S=>{c.current[f]=S},tabIndex:f,onClick:()=>{g[f]||s(u.resource)},children:e.jsx(tp,{gizmoResource:u.resource,from:u.from,showDescription:i,isSelected:n===f,grayedOut:g[f],currentModelId:o})},u.resource.gizmo.id)),e.jsx("div",{ref:u=>{c.current[h.length]=u},tabIndex:h.length,onClick:()=>{s("create")},children:e.jsx(Zm,{isSelected:n===h.length})},"create")]})}const Qm=p.forwardRef(Jm),Zm=({isSelected:t})=>e.jsx(Ga,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(Fr,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(ba,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(N,{...an.dropdownCreateLabel})})]})}),ep=({onClick:t,onClose:s,currentModelId:n})=>{const[o,r]=p.useState(null),i=p.useRef(null),c=p.useRef(null),[a,l]=p.useState(0),d=ae(),h=g=>{M.logEvent("Mentions Click Gizmo",{gizmo_id:g==="create"?"create":g.gizmo.id}),g!=="create"&&t(g)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:d.formatMessage(an.searchPlaceholder),ref:i,onKeyDown:g=>{if(g.nativeEvent.isComposing)return;const u=c.current?.getResultsLength()??0;if((g.key==="Escape"||g.key==="Backspace"&&!o)&&(g.preventDefault(),s()),g.key==="Enter"||g.key==="Tab"){g.preventDefault();const f=c.current?.handleEnterOnIndex(a);if(!f)return;f==="create"?(window.open("/gpts/editor","_blank"),s()):h(f)}if(g.key==="ArrowDown"&&a<u-1){g.preventDefault();const f=a+1;c.current?.scrollToItem(f),l(f)}if(g.key==="ArrowUp"&&a>0){g.preventDefault();const f=a-1;c.current?.scrollToItem(f),l(f)}},onChange:g=>{r(g.target.value),l(0)},className:"bg-token-main-surface-primary w-full border-0 p-2 text-sm focus:outline-hidden"}),e.jsx(Qm,{ref:c,query:o,selectedIdx:a,onSelectGizmo:h,currentModelId:n})]})},To=({onClick:t,onClose:s,currentModelId:n})=>{const o=Ko(),r=!!o;return nn(()=>{M.logEvent("Mentions Opened",{gizmo_selector_disabled:r})}),r?e.jsx(Fa,{clientThreadId:Ds,rateLimitInfo:o}):e.jsx("div",{onBlur:i=>{i.currentTarget.contains(i.relatedTarget)||s()},className:"popover border-token-border-default bg-token-main-surface-primary rounded-2xl border p-2 shadow-lg",children:e.jsx(ep,{onClick:t,onClose:s,currentModelId:n})})};function tp({gizmoResource:t,from:s,showDescription:n,isSelected:o,grayedOut:r,currentModelId:i}){const c=!!t.gizmo.tags?.includes(Qt.FirstParty),a=wc(t.tools)&&!i.startsWith("gpt-4o")&&!i.startsWith("gpt-4-1");return e.jsxs(Ga,{className:te(o?"bg-token-main-surface-secondary":"",r&&"opacity-50"),children:[e.jsx(ya,{isFirstParty:c,src:t.gizmo.display.profile_picture_url,className:te("icon-xl",r&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),a&&e.jsx("span",{className:"text-token-text-tertiary shrink-0",children:e.jsx(N,{...an.customActionsModelNote})}),n&&e.jsx("span",{className:"text-token-text-tertiary grow truncate text-sm sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(jc,{className:"icon-sm"}):e.jsx(Tc,{className:"icon-sm"})})]})]})}const an=Fe({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"},customActionsModelNote:{id:"TaggingDropdown.customActionsModelNote",defaultMessage:"[GPT-4o or GPT-4.1]"}});function sp(t){if(t.length!==1)return!1;const{file:s,fileId:n}=t[0],o=Nc(s)&&!!s?.type&&s.type.startsWith("image/"),r=n!=null&&!!s&&fi(s.name);return o||r}function Wa({files:t,selectedApps:s=[],className:n,activeSystemHintType:o}){const r=pi(),i=qs(),c=Ca.useStore(),{updateSystemHint:a}=Jt(),{clientThreadId:l}=sl(),d=sp(t),h=d&&o!==F.PictureV2,g=Ec();return e.jsxs("div",{className:n,children:[g.map(u=>e.jsx(Rc,{textdocId:u.tempTextdocId,userCreatedTextdoc:u},u.tempTextdocId)),s.map(u=>e.jsx(Ic,{selectedApp:u},u.id)),t.map(u=>e.jsx(Bc,{borderRadius:"2xl",width:r?"normal":"wide",onRemoveFileClick:()=>{dt.remove(i,u.tempId,"none"),c.removeFile(u.tempId)},useLargeImageThumbnailStyle:d,onImageEditClick:h?()=>{a(F.PictureV2,{clientThreadId:l})}:void 0,file:u.file,fileId:u.fileId??void 0,contextConnectorInfo:u.contextConnectorInfo,loadingPercentage:u.status===Xo.Uploading?u.progress:void 0},u.tempId))]})}const np=5,op=p.memo(function(s){return ap(s),rp(s),ip(),null});function ap(t){const{store:s}=de(),n=s.useSetSharedProps();Us(()=>{n(t)},[t,n])}function rp(t){const{clientThreadId:s,canContinue:n}=t,{store:o}=de(),r=p.useRef({top:o.useContentAreaApi(Ze.HeaderTop),bottom:o.useContentAreaApi(Ze.HeaderBottom)}).current,i=Lc(s),{shouldShowBannerSignup:c,shouldShowBannerTermsDisclaimer:a}=lp(s),l=km(s,t.composerController),d=Cm(s),h=Fc(t);Dc(t);const g=Uc(),u=Oc(),f=Hc(t),S=zc(s),C=Gc(t),k=Wc(s),_=Vc(s),I=$d(),{eligible:E}=Ee(qc),R=Yc(),v=$c(),P=Kc(),y=Xc(),w=Jc(s),j=Qc(s),b=Zc(),D=eu(s),U=tu(ne=>ne.shouldShowAudioParagenPrompt),X=ee(s,ne=>ne?.modelId),x=sn(s),q=ht(),z=Aa(),{eligible:Y}=Ee(ke.hasSeenAgentModeAnnouncementBanner),O=Y&&z&&q!==zt;Us(()=>{U?r.top.set(A.AudioParagenPrompt):X&&x?.kind===Qe.GizmoInteraction&&x.gizmo&&gi(X,x.gizmo)?r.top.set(A.ProjectConversationTaskNoFileAccess):C.eligible?r.top.set(A.AdvancedVoiceOnMobileAnnouncement):a?r.top.set(A.BannerTermsDisclaimer):l?r.top.set(A.BannersRateLimit):d?r.top.set(A.BannersBeaconUI):b?r.top.set(A.BannerPlusUpsell):k?r.top.set(A.JawboneAnnouncement):_?r.top.set(A.JawboneMaxActiveAnnouncement):h.eligible?r.top.set(A.BannerSidekickAnnouncement):g?r.top.set(A.MoonshineAnnouncement):u?r.top.set(A.CustomizeChatGPTAnnouncement):f?r.top.set(A.SearchBrowserExtensionReactiveAnnouncement):I?r.top.set(A.PromoRedemptionAnnouncement):E?r.top.set(A.OperatorAnnouncement):P?r.top.set(A.ReferralProgramUpsellAnnouncement):n?r.top.set(A.PromptTextareaAction):c?r.top.set(A.BannerSignup):S?r.top.set(A.BannerMemoryFull):R?r.top.set(A.ReferrerRedemptionAvailableAnnouncement):v?r.top.set(A.RefereeRedemptionAvailableAnnouncement):y?r.top.set(A.StudentsUpsellAnnouncement):w?r.top.set(A.ModelDeprecationBanner):j?r.top.set(A.TeamsContextualAnswersUpsell):D?r.top.set(A.LanguageUpsellBanner):O?r.top.set(A.AgentModeAnnouncementBanner):r.top.set(null)},[r,q,n,a,c,l,h,S,C,O]),Us(()=>{i&&r.bottom.set(fa.DallePromptControls)},[r,i])}function ip(){const{store:t}=de();p.useEffect(()=>()=>{t.reset()},[t])}function lp(t){const s=se(),{isUnauthenticated:n}=gt(),o=Ae(s,"3637408529",{disableExposureLog:!0}),i=Ae(s,"3637408529").get("no_auth_banner_signup_rate_limit",np),c=o.get("should_show_no_auth_signup_banner",!0),a=su(u=>u.bannerDisclaimerClientThreadId),l=nu(),d={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[h,g]=ee(t,u=>[W.getConversationTurns(u).filter(f=>f.role===Jo.User).length,cp(W.getCurrentNode(u)?.message)]);return t&&(d.shouldShowBannerTermsDisclaimer=g&&n&&h===1&&!l&&(a==null||a===t),d.shouldShowBannerSignup=c&&g&&n&&h>0&&h%i===0),d}function cp(t){return t?.author.role===Jo.Assistant&&hi(t)}function up({clientThreadId:t,icon:s,modelSupportedImageMimeTypes:n,isLoadingConnectors:o,connectorConfig:r,onSelectConnector:i,onConnectorOauthRedirect:c,openFileDialog:a,isDisabled:l=!1,highlightTooltip:d=!1,showLabel:h,disabledReason:g,currentModelName:u}){const f=ae(),S=Yt(),[C,k]=p.useState(!1),_=p.useRef(!1),I=et(tt),E=b=>{k(b),b&&(M.logEventWithStatsig("Composer: Open Plus Menu","chatgpt_web_composer_plus_menu_open"),_.current=!0,setTimeout(()=>{_.current=!1},250))},{desktopConnectors:R}=_a(n),v=n.length>0,P=e.jsxs(e.Fragment,{children:[I&&e.jsx(ka,{}),e.jsx(Pa,{isLoadingConnectors:o,connectorConfig:r,onConnectorClick:i,onOauthRedirect:c}),e.jsx(Va,{modelSupportedImageMimeTypes:n}),e.jsx(on,{openFileDialog:a,showMenuForNoAuth:!1,modelSupportsImages:v})]}),y=l||S!=null,w=p.useRef(!1),j=e.jsxs(re.Root,{open:C,onOpenChange:E,children:[e.jsx(Wt,{clientThreadId:t,rateLimitPopup:S,highlightTooltip:d,disabled:y,disabledReason:g,currentModelName:u,children:e.jsxs(re.BasicTrigger,{className:"composer-btn",disabled:y,id:"upload-file-btn","aria-label":Zt(f,y,g,u),children:[s,h&&e.jsx(ia,{})]})}),e.jsx(re.Portal,{children:e.jsx(re.Content,{alignOffset:-8,onEscapeKeyDown:()=>{w.current=!0},side:"bottom",size:"small",onCloseAutoFocus:b=>{w.current||b.preventDefault()},className:"radix-side-bottom:flex-col-reverse flex flex-col",children:P})})]});return e.jsx("div",{className:"flex flex-col",children:j})}const Va=({modelSupportedImageMimeTypes:t})=>Qo()?e.jsx(dp,{modelSupportedImageMimeTypes:t}):null,dp=({modelSupportedImageMimeTypes:t})=>{const{desktopConnectors:s}=_a(t);return e.jsx(e.Fragment,{children:s.map(n=>e.jsx(ou,{entry:n},n.key))})},mp=({command:t,isHighlighted:s,onHighlight:n,onClick:o})=>e.jsx(ea,{as:"div",hasManagedFocus:!0,disabled:t.disabled,highlighted:s,icon:t.icon,label:t.title,onPointerMove:n,onClick:o}),pp=t=>{"use forget";const s=Dr.c(15),{hint:n,isHighlighted:o,onHighlight:r,onClick:i}=t,c=va(n.systemHint);let a;s[0]!==n?(a=e.jsx(iu,{hint:n,isNextToLabel:!0}),s[0]=n,s[1]=a):a=s[1];let l;s[2]!==n.name||s[3]!==o||s[4]!==i||s[5]!==r||s[6]!==c.blockedLabel||s[7]!==c.isBlocked||s[8]!==a?(l=e.jsx(ea,{as:"div",hasManagedFocus:!0,disabled:c.isBlocked,highlighted:o,icon:a,label:n.name,secondary:c.blockedLabel,onPointerMove:r,onClick:i}),s[2]=n.name,s[3]=o,s[4]=i,s[5]=r,s[6]=c.blockedLabel,s[7]=c.isBlocked,s[8]=a,s[9]=l):l=s[9];const d=l;if(c.remainingLabel){const h=c.isBlocked?"left":"center";let g;return s[10]!==d||s[11]!==c.remainingLabel||s[12]!==c.remainingLabelSecondary||s[13]!==h?(g=e.jsx(Gs,{side:"right",labelTextAlign:h,label:c.remainingLabel,secondaryLabel:c.remainingLabelSecondary,contentClassName:"cant-hover:hidden",triggerAs:null,children:d}),s[10]=d,s[11]=c.remainingLabel,s[12]=c.remainingLabelSecondary,s[13]=h,s[14]=g):g=s[14],g}return d},fp=({slashCommands:t,systemHints:s,composerController:n,clientThreadId:o})=>{const r=p.useMemo(()=>[...t,...s],[t,s]),i=au(),c=Zo(o),{setThreadSystemHintMode:a,clearAllSystemHintModeTriggers:l}=Jt(),[d,h]=p.useState(void 0),[g,u]=p.useState(0),f=p.useMemo(()=>d?r.filter(y=>!!("systemHint"in y&&$e(y.systemHint,d.text)||"command"in y&&$e(y.command,d.text)||y.aliases?.some(w=>$e(w,d.text))||y.regexMatches?.some(w=>$e(w.replace(/[\^$()]/g,""),d.text))||"name"in y&&$e(y.name,d.text)||"title"in y&&$e(y.title,d.text))):[],[r,d]);p.useEffect(()=>{n.view.dispatch(nl(n.view.state.tr,{onHintMatch(y){h(w=>Si(w,y)?w:y)}}))},[n]);const S=p.useCallback(y=>{u(w=>{const j=f.length;for(let b=0;b<j;b++){const D=(w+j+(b+1)*y)%j,U=f[D];if(!("systemHint"in U?i.includes(U.systemHint):U.disabled))return D}return-1})},[f,i]),C=p.useRef(S);C.current=S;const k=f.length===0;p.useEffect(()=>{u(-1),C.current(1)},[f]);const _=f[g],I=p.useCallback(()=>{d?.range&&n.delete(d.range.from,d.range.to)},[d,n]),E=({hintToSave:y=_,expectPerfectMatch:w})=>{if(!d||!_)return!1;const j=d.text.toLocaleLowerCase();if(w&&("command"in y?y.command.toLocaleLowerCase()!==j:y.name.toLocaleLowerCase()!==j)&&y.aliases?.every(U=>U.toLocaleLowerCase()!==j))return!1;if(I(),Ot(n.view),"command"in y)return y.onSelect(),!0;M.logEvent("System Hint Selected",{system_hint:y.systemHint,conversation_id:c??Ds});const b={clientThreadId:o};l();const D=y.systemHint===F.Search;return a(y.systemHint,!0,b,D?ru.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),!0},R=p.useRef(E);R.current=E;const v=p.useRef(d);v.current=d;const P=n.view;return p.useEffect(()=>(k||nm(P,y=>{if(y==="up")C.current(-1);else if(y==="down")C.current(1);else if(y==="cancel")Ot(P),ol(P);else{if(y==="submit")return Ot(P),R.current({expectPerfectMatch:!1});if(y==="checkMatch")return R.current({expectPerfectMatch:!0})}}),()=>Ot(P)),[k,P,_,I]),p.useEffect(()=>{k||M.logEvent("System Hint List Opened",{conversation_id:c??Ds})},[k]),k?null:e.jsx(xi,{className:"max-w-60",onPointerDown:y=>{y.preventDefault()},children:f.map((y,w)=>"command"in y?e.jsx(mp,{command:y,isHighlighted:w===g,onHighlight:()=>u(w),onClick:()=>{E({hintToSave:y,expectPerfectMatch:!1}),n.focus()}},y.command):e.jsx(pp,{hint:y,isHighlighted:w===g,onHighlight:()=>u(w),onClick:()=>{E({hintToSave:y,expectPerfectMatch:!1}),n.focus()}},y.systemHint))})};function Eo({slashCommands:t,systemHints:s,composerController:n,clientThreadId:o}){return n instanceof sm?e.jsx(fp,{slashCommands:t,systemHints:s,composerController:n,clientThreadId:o}):null}function $e(t,s){return t.toLocaleLowerCase().startsWith(s.toLocaleLowerCase())}function gp({clientThreadId:t,modelSupportedImageMimeTypes:s,openFileDialog:n,historyDisabled:o,isDisabled:r,highlightTooltip:i,disabledReason:c,currentModelName:a,isLoadingConnectors:l,connectorConfig:d,onSelectConnector:h,onConnectorOauthRedirect:g,showLabel:u,showUpsell:f,hideBorder:S,isSmall:C,showMenuForNoAuth:k,visualTreatment:_}){const I=Qo(),{gdriveStatus:E,o365Status:R}=yi(),{isUnauthenticated:v}=gt(),P=o?"text-white":i?"text-brand-blue-800":"",y=!f&&(E!=="false"||R!=="false"||I),w=v?Hs:ba,j=e.jsx(w,{"aria-label":"",className:te("icon",P)}),b=s.length>0,D=y?e.jsx(up,{clientThreadId:t,icon:j,showLabel:v&&u,modelSupportedImageMimeTypes:s,isLoadingConnectors:l,connectorConfig:d,onSelectConnector:h,onConnectorOauthRedirect:g,openFileDialog:n,isDisabled:r,highlightTooltip:i,disabledReason:c,currentModelName:a}):e.jsx(fm,{isSmall:C,hideBorder:S,clientThreadId:t,openFileDialog:n,showLabel:u,showUpsell:f,icon:j,isDisabled:r,highlightTooltip:i,disabledReason:c,currentModelName:a,visualTreatment:_,showMenuForNoAuth:k,modelSupportsImages:b});return e.jsx(lu,{showBackground:i,className:"bg-brand-blue-800/20",children:D})}const hp=({layoutMode:t,clientThreadId:s,composerController:n,pendingFiles:o,hasFiles:r,placeholder:i,isTemporaryChat:c,state:a,inputState:l,disableReason:d,gizmoId:h,replyRegions:g,includeSidebarContextTray:u,onSubmit:f,leadingAction:S,legacyFooterActions:C,legacySuggestionsPopoverContent:k,activeSystemHint:_,hideSystemHint:I=!1,onRemoveSystemHint:E,contextualAnswerUserConnectionData:R,fileInput:v,expanded:P,expandOnMultilineInput:y})=>{const w=et(tt),j=zo(s),b=p.useCallback(V=>e.jsx(cu,{inputState:l,state:a,onSubmit:f,composerController:n,clientThreadId:s,gizmoId:h,disableReason:d,disableTooltip:V}),[l,a,f,n,s,h,d]),{whisperControls:D,waveContainerRef:U}=Zd({composerController:n,renderInComposer:b,composerType:"composer-btn",isBridgedDesktopSidebar:w}),{controlsDisabled:X,waveformData:x,waveWidth:q}=Je(n.store),z=Ma(V=>V.selectedApps),Y=wa()&&z.length>0,O=r||Y,{fontSize:ne}=tn();return e.jsxs(uu,{isTemporaryChat:c,composerController:n,expanded:P,expandOnMultilineInput:y,onSubmit:f,layoutMode:t,backgroundClassName:w?"text-sm px-2 shadow-none! dark:border-token-border-heavy border-t border-gray-100 rounded-none":void 0,children:[e.jsx(du,{children:X?x?e.jsx("div",{className:"max-w-full min-w-0 flex-1",ref:U,children:e.jsx(mu,{className:"h-14",waveform:x,containerWidth:q,scaleFactor:10,initialValue:em})}):null:e.jsx(tm,{composerController:n,placeholder:i,fontSize:ne})}),v&&e.jsx(pu,{children:v}),g&&g.length>0&&e.jsx(Es,{children:e.jsx(fu,{replyRegions:g})}),O&&e.jsx(Es,{children:e.jsx(Wa,{files:o,selectedApps:z,activeSystemHintType:_?.systemHint,className:"no-scrollbar horizontal-scroll-fade-mask flex flex-nowrap gap-2 overflow-x-auto px-2.5 pt-2.5 pb-1.5 [--edge-fade-distance:1rem]"})}),u&&e.jsx(Es,{children:e.jsx(gu,{})}),S&&e.jsx(hu,{children:S}),C?.map((V,xe)=>e.jsx(Rs,{children:V},`legacy-footer-action-${xe}`)),_&&!I&&e.jsx(xu,{children:e.jsx(Su,{activeSystemHint:_,onRemoveSystemHint:E})},"active-hint-tag"),_&&j&&e.jsx(Rs,{children:e.jsx(yu,{activeSystemHint:_??void 0,clientThreadId:s,connectionStatuses:R?.connection_statuses,currentModelConfig:j})},"sources-tag"),_?.systemHint===F.PictureV2&&e.jsx(Rs,{children:e.jsx(bu,{composerController:n})},"image-style-picker"),!1,e.jsx(Cu,{children:k},"legacy-suggestions-popover"),e.jsx(Au,{children:D})]})},xp=Js(()=>Qs(()=>import("./j819y7nh8ckpmr8l.js"),__vite__mapDeps([8,1,3,4,2,5,9,10,11])).then(t=>t.ImageGenComposer)),Sp=1,yp=3e3;function bp({onCreateNewCompletion:t,onContinueGenerating:s,account:n,currentModelId:o,currentModelConfig:r,disableDraftPersistence:i=!1,areModelsLoading:c,clientThreadId:a,isNewThread:l,isCompletionInProgress:d,className:h,disabled:g=!1,disabledReason:u,canPause:f=!1,canContinue:S=!1,isInteractableSharedThread:C,onComposerInput:k,onComposerChange:_,onAutocompleteSelect:I,headerClassName:E,hideHeader:R,onTaggingDropdownOpen:v,onTaggingDropdownClose:P,onlyAllowImageUploads:y,layoutMode:w}){"use forget";Ke.markStart("PromptTextarea"),Ke.markRendered("PromptTextarea");const j=et(tt),b=se(),D=p.useRef(null),[U,X]=Ur();p.useEffect(()=>{U.has("show_github_repo_modal")&&(ta(b,_u),X(m=>(m.delete("show_github_repo_modal"),m)))},[U,X,b]);const x=De();ku(x),Pu();const q=ha(),z=n?.isTeam(),Y=nt(b),O=ae(),ne=$t(),V=qs(),xe=Ca.useStore(),[B,$,oe,Ue,Re,xt]=ee(a,m=>[W.getCurrentLeafId(m),W.getRequestId(m),W.findNode(m,T=>!!T.message.metadata?.b1de6e2_s),W.getIsNewConversation(m),W.lastUserMessage(m)?.metadata?.system_hints?.includes(F.Agent),!!m?.interruptionInProgress&&!!W.getCurrentNode(m)?.message.metadata?.n7jupd_message]),{gizmoEditorData:Se,mode:Oe,getGizmoId:He}=Xs(),ye=Yo(),ot=bi(),qa=vu(),be=Zo(a),es=!!Ko(),Ya=Mu.useIsEnabled(a),St=!!Zs(),H=ht(),me=Io(),$a=Aa(),Ka=Ee(ke.hasSeenAgentModeAnnouncementBanner),rn=Ci.useState(({locked:m})=>m),Xa=Ai(),{connectionInstanceData:ts,isLoading:Ja}=_i({skip:!Xa}),{selectedSources:ln,selectedMCPSources:yt,addSource:bt}=wu(a);p.useEffect(()=>{const m=U.get("add_source");m&&H&&(bt(m),U.delete("add_source"),X(U))},[H,bt,U,X]);const cn=ju(b);ki({skip:!cn,productSku:fo.PROMPT_TEXT_AREA});const{platformConnectors:un}=sa(cn&&(yt?.size??0)>0,fo.PROMPT_TEXT_AREA),Qa=p.useMemo(()=>Array.from(yt??[]).map(m=>un.get(m)).filter(m=>m!==void 0),[un,yt]),ss=p.useRef(0),ns=p.useRef(!1);let G=sn(a),Ct=G&&"gizmo"in G?G.gizmo:void 0;const Za=Pi(),At=Ct?.gizmo.id??Za,os=Tu(At),er=Eu(),dn=Ru(a),[pe,_t]=p.useState(null);pe!==null&&(G={gizmo:pe,gizmo_id:pe.gizmo.id,kind:Qe.GizmoInteraction},Ct=pe);const ze=Ns(r,G,H),as=Yt(),mn=Vs(b).flags,kt=mn?.includes(Ys.NoAuthEnableFileUploads),rs=ee(a,m=>m?.effortMode??null),pn=!!rs&&rs!=="default",{systemHints:fn}=vi(),gn=Ue||Re,Q=p.useMemo(()=>fn?.filter(m=>Iu({systemHint:m,modelConfig:r,conversationMode:G,isTemporaryChat:ot}))?.filter(m=>m.systemHint!==F.Agent?!0:gn),[fn,r,G,ot,gn]),tr=Q==null||Q.length>0,Pe=p.useMemo(()=>(H&&Q?.find(m=>m.systemHint===H))??null,[Q,H]),is=p.useCallback(()=>{me(null,{analyticsMetadata:{clientThreadId:a}})},[me,a]),ls=Bu(o,Pe?.systemHint??null);Nu(p.useCallback(()=>{pn&&je(a,m=>{m.effortMode="default"})},[pn,a])),om({serverThreadId:be,clientThreadId:a,composerController:x,currentModelId:o,account:n,getIsDisabled:p.useCallback(()=>!1,[]),onReset:()=>{je(a,m=>{m.effortMode="default"})},onInfer:m=>{je(a,T=>{T.effortMode=m})},isInferEnabledForModel:r?.enableInfer});const sr=!g&&(ze!==Ne.None||c)&&(Y||kt),fe=Fs(r,G),cs=Oo(r,G);let ie=Ls(m=>m.files);const[Pt]=p.useState(()=>Lu());Oe==="magic"?ie=ie.filter(m=>m.gizmoId!=null):ie=ie.filter(m=>m.gizmoId==null);const nr=Fu(),Ge=ie.length>0||nr,hn=Ls(Gi.hasUploadInProgress),xn=Ma(m=>m.selectedApps),or=wa()&&xn.length>0,ar=Du(a),us=x.useState(m=>Uu({currentModelConfig:r,composerController:m})),Sn=mt(x.isEmpty$),yn=!Sn,vt=!us&&!hn&&(yn||Ge),bn=(ze===Ne.Multimodal?$s:Ks)-ie.length,Cn=bn<=0,rr=Pe?.systemHint===F.Research,ir=Ce(b,"3544641259"),{selectedRepos:ds}=Ou(a),An=(rr||ls)&&ir&&ln?.size===0&&yt?.size===0,ms=Ce(b,"2007855518"),_n=oe?.message.metadata?.async_task_id,ps=Hu(m=>_n?m.tasks[_n]:null),fs=ps?.status===zu.RUNNING,kn=Gu(Ft(a)||a)?.value,lr=kn===go.STREAMING,cr=kn===go.REALTIME,Mt=d&&f||lr||cr||fs&&ms,We=vt&&!g&&!St&&(!Mt||dn)&&!An,[Pn,ur]=p.useState(!1),{targetedContent:vn,setTargetedContent:wt}=Wu(),le=vn?.isFocusedViewContent&&!qa?void 0:vn;p.useEffect(()=>{!le||bs.composer.autofocusDisabled$()||requestAnimationFrame(()=>requestAnimationFrame(()=>x.focus()))},[le]);const{getUpsellLabelType:dr,getUpsellShowsAttach:mr}=Vu(),{isToolsInPlusMenu:Mn,showConnectedApps:gs,isSingleLine:wn,hasAddFileSlashCommand:jn,supportsCollapsedMoreMenu:Tn}=tn(),at=tr&&!rn&&(G==null||G?.kind===Qe.PrimaryAssistant||G?.kind===Qe.GizmoInteraction&&os),pr=at&&Y&&(!z||!Ja)&&!ho(H)&&!Mn,jt=Je(x.store,m=>m.controlsDisabled);p.useEffect(()=>{if(!q?.id)return;const m=yo.getAndReset(q.id,be);m&&x.setText(m.inputText)},[q?.id,be,x]),p.useEffect(()=>{const m=U.get("prompt")??"";x.getCurrentText().length===0&&m.length>0&&x.setText(m)},[x,U]),p.useEffect(()=>{if(H!==F.Slurm)return;const m=U.getAll("sources");if(!m.length)return;const T=U.get("redirect_source"),L=m.map(K=>K.trim()).filter(wi);for(const K of L)bt(K);T==="suggested_ca_prompts"&&M.logEventWithStatsig("chatgpt_contextual_answers_connector_activated","chatgpt_contextual_answers_connector_activated",{source:"suggested_ca_prompts"})},[a,bt,U,me,X,H]),p.useEffect(()=>{Pn!==We&&(ur(We),We&&qu(!0).then(m=>{Yu.startEnforcement(m),$u.startEnforcement(m)}))},[We,Pn,G?.kind,ye]);const Tt=Do(r,G),{handleFileAccepted:En}=La(O,Ns(r,G,H),fe,"mouse",He,Tt?.attachments),fr=p.useCallback((m,T)=>(requestAnimationFrame(()=>{requestAnimationFrame(()=>{x.focus()})}),En(m,T)),[x,En]),ge=!g&&!Cn&&sr&&as==null,{getInputProps:Rn,open:In,inputRef:Bn}=Ra({disabled:!ge,noClick:!0,onDropAccepted:fr,onDropRejected:m=>Na(m,O,ne,ze),multiple:!0,maxSize:Ho,maxFiles:bn,...Uo(!Y||y?fe:cs)}),Ie=p.useCallback(()=>{ge&&(M.logEventWithStatsig("Open File Viewer","chatgpt_web_file_viewer_opened",{intent:ze.toString()}),In())},[ge,In,ze]),Nn=Je(Pt),Ln=p.useCallback(()=>{x.eraseContent(),Nn.clearMessages(),x.resize(Sp),x.usedDictation=!1,x.dictationEdited=!1,x.dictationAssetPointer=null,x.dictationAssetTTL=null;for(const T of ie)dt.remove(V,T.tempId,"none");if(Ku.markAllAsSent(),Bo(b)){const T=ji(b,"269676899"),L=T.get("skip_search",!1);if(T.get("clear_all",!1)){const ce=[F.Slurm,F.Tatertot];L&&ce.push(F.Search),ce.push(zt),H&&!ce.includes(H)&&me(null)}}},[x,Nn,b,ie,V,H,me]),Fn=mt(Gt.sidebarUrlTrayOpen$)&&j,gr=mt(Gt.context$),Dn=(m,T)=>{if(m.preventDefault(),g||!vt&&!T||!G||xt)return;const L=x.getContentToSend(),K=wd(L.content),{content:ce,attachments:lt}=jd(V,K,r,G,H);je(a,Ye=>{Ye.hasModifiedSources=!1}),er(),t({sourceEvent:m,attachments:lt,content:ce,contentToSend:L,conversationMode:G,hasSelectedApps:or,isMessageFollowupsEnabled:Ya,selectedApps:xn,isBridgedDesktopSidebar:j,shouldCollectSidebarContext:Fn,desktopSidebarContext:gr,selectedGizmoTag:pe,selectedRepos:{selectedAllRepos:ds.selectedAllRepos,selectedRepos:ds.selectedRepos?[...ds.selectedRepos]:null},selectedSources:ln,selectedMCPConnectors:Qa,systemHints:H?[H]:[],usedDictation:x.usedDictation,dictationEdited:x.dictationEdited,dictationAssetPointer:x.dictationAssetPointer,dictationAssetTTL:x.dictationAssetTTL,effortMode:rs,isN7jupdActive:ls}),le?.onCreateCompletion?.({serverThreadId:be,currentLeafId:B}),le?.shouldPersistAcrossMessages!==!0&&wt(void 0),Os.hideThreadHeader();for(const Ye of ie)Ye.status===Xo.Ready&&xe.addFile(Ye);Ln(),$a&&H===zt&&Ka.markAsViewed()},hr=m=>{wt(m.targetedReply),m.targetedReply&&M.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:be,sourceMessageId:m.messageId})},{maybeSetWaitingForRealtimeOnAbort:Un,isWatingForRealtimeStatusChange:xr}=Xu(a),hs=p.useCallback(m=>{Un(),Ju(m,void 0,!0)},[Un]),On=p.useCallback(()=>{le?.onCleared?.({serverThreadId:be,currentLeafId:B}),wt(void 0),x.focus()},[B,be,le,wt,x]),Et=Qu(r?.tags,G?.kind),{showTaggingDropdown:xs,isFocused:Sr,autocompletions:ve}=Je(x.store),Rt=Sr&&ve.length>0,Ve=Et&&xs&&!os&&!j,Hn=am(a),zn=x.isReady();p.useEffect(()=>x.subscribe("keydown",m=>{Hn&&rm(a);const T=x.getCurrentText();if(m.key==="@"&&!j){const L=x.getSelectionStart(),K=T.substring(0,L);(!K||/\s$/.test(K)||L===0)&&setTimeout(()=>x.setShowTaggingDropdown(!0),10)}else xs&&x.setShowTaggingDropdown(!1);m.key==="Escape"&&_t(null)}),[x,zn,xs,Hn,a,j]);const Gn=Zu({toaster:ne,canSubmit:We,isTextContentTooLong:us,canAbortCompletion:f&&d,clientThreadId:a,isAutocompletionActive:()=>Rt&&ns.current,clearAutocompletions:()=>x.setAutocompletions([]),abortCompletion:()=>hs(a),requestCompletion:Dn,isEmpty:Sn,hasTargetedContent:le!=null,clearTargetedContent:On,hasSystemHint:Pe!=null,removeSystemHint:is}),Ss=p.useRef(Gn);Ss.current=Gn,p.useEffect(()=>{const m=Object.fromEntries(Object.keys(Ss.current).map(T=>[T,K=>{const ce=Ss.current[T];return ce?ce(K):!1}]));x.registerKeyHandlers(m),x.registerFileInput({openFileDialog:Ie,inputRef:Bn})},[x,Ie,Bn,zn]),p.useEffect(()=>x.subscribe("paste",m=>{ed({filePickerStore:V,event:m,intl:O,toaster:ne,clientThreadId:a,conversationMode:G,currentModelConfig:r,getEditorGizmoId:He,modelSupportedImageMimeTypes:fe,activeSystemHintType:H,setActiveSystemHintType:me,ctx:b})}),[O,a,G,r,He,fe,x,ne,V,H,me,b]);const Wn=m=>{es||_t(m),x.trimLeadingText("@"),bo(),x.setShowTaggingDropdown(!1)},yr=Ti(a,Pt,fe,Tt?.attachments),br=p.useCallback(m=>{m.preventDefault(),hs(a),M.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:Ft(a),currentLeafId:W.getCurrentNode(Te(a)).message.id,eventSource:"mouse"}),bo()},[a,hs]),ys=p.useCallback(()=>{yo.set(q?.id,be,x.getCurrentText())},[be,q?.id,x]),bs=Mi(b);p.useEffect(()=>{Se||bs.composer.autofocusDisabled$()||x.focus()},[x]),p.useEffect(()=>{if(fe.length>0)for(const T of ie)td(T.fileSpec?.mimeType,cs)||dt.remove(V,T.tempId,"none");else dt.reset(V)},[o,V]),p.useEffect(()=>{(!Et&&pe||es)&&_t(null)},[Et,pe,es]);const Cr=Ae(b,"4031588851"),Vn=Ae(b,"3637408529"),Ar=Vn.get("is_in_composer_text_exp",!1),_r=Vn.get("composer_text","MESSAGE_CHATGPT"),kr=Cr.get("composer_text","MESSAGE_CHATGPT"),Pr=Ar?_r:kr,[It,vr]=(()=>{const m=u?sd(u):void 0;if(m)return[m.placeholder,m.isLastingDisabledStyle];if(C)return[Z.placeholderWithName,!1];if(le?.placeholderTextOverride!=null)return[le.placeholderTextOverride,!1];if(r?.id===Ei)return[Z.n7jupdSystemHintPlaceholder,!1];if(Pe){if(ho(Pe.systemHint))return Mt?[Z.n7jupdActivePlaceholder,!1]:[Z.n7jupdSystemHintPlaceholder,!1];switch(Pe.systemHint){case F.Search:return[Z.searchPlaceholder,!1];case F.Think:return[Z.thinkPlaceholder,!1];case F.Slurm:return[Z.connectorPlaceholder,!1];case F.Research:return[Z.researchPlaceholder,!1];case F.Canvas:return[Z.canvasPlaceholder,!1];case F.Picture:return[Z.picturePlaceholder,!1];case F.PictureV2:return[Z.pictureV2Placeholder,!1];case F.ContextualAnswers:return[Z.contextualAnswersPlaceholder,!1];case F.Tatertot:return[Z.tatertotPlaceholder,!1]}}switch(Pr){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[Z.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[Z.placeholderAskNameAnythingVariant,!1];default:return[Z.placeholderWithName,!1]}})(),qn=os?l?O.formatMessage(nd.newChatInProject,{projectName:Ct?.gizmo.display.name??"this project"}):It?O.formatMessage(It,{name:"ChatGPT"}):"​":It?O.formatMessage(It,{name:Se!=null?Oe==="magic"?od:Se.name||"GPT":Ct?.gizmo.display.name??"ChatGPT"}):"​";p.useEffect(()=>x.subscribe("input",()=>{ad.getState().isThreadHeaderVisible&&Os.hideThreadHeader()}),[x]),p.useEffect(()=>x.subscribe("input",()=>{ss.current=performance.now(),k?.()}),[x,k]),p.useEffect(()=>{if(_)return x.subscribe("change",()=>{_()})},[x,_]);const Cs=Ri()&&!!ve.find(m=>!!m.requires_file_upload),{connectorConfig:Be,isLoading:Yn}=Ii(),{onSelectConnector:Bt,onConnectorOauthRedirect:As}=rd({connectorConfig:Be,modelSupportedImageMimeTypes:fe,modelAcceptedMimeTypes:cs,attachmentsProductFeature:Tt?.attachments,onOauthRedirect:ys});id(Be,Bt);let $n=null;const Nt=[],Kn=[],Xn=mr(),Mr=Y||Xn||kt,_s=ze===Ne.None&&!c?_e.ModelNotSupported:Cn?_e.HasReachedMaxFiles:as!=null?_e.RateLimitReached:void 0,wr=Bi("(width <= 510px)",Ni);w||(w=l&&!wr?"center":"bottom");const Lt=fe.length>0;if(Y&&Mn){const m=[e.jsx(on,{openFileDialog:Ie,modelSupportsImages:Lt,showMenuForNoAuth:!1,isDisabled:!ge,disabledReason:_s,currentModelName:r?.title},"file-upload-items"),ge&&Lt&&e.jsx(Va,{modelSupportedImageMimeTypes:fe},"desktop-connector-items"),ge&&(gs?e.jsx(ld,{includeAction:!0,shortName:!0,connectorConfig:Be,onConnectorClick:Bt},"context-connectors"):e.jsx(Pa,{isLoadingConnectors:Yn,connectorConfig:Be,onConnectorClick:Bt,onOauthRedirect:As},"context-connectors")),e.jsx(ka,{},"add-tab")],T=4,L=Tn&&(gs&&cd(Be)||Q&&Q.length>T+1),K=[];if(at){const ce=Q&&(L?Q.slice(0,T):Q);if(m.push(e.jsx(re.Separator,{},"tools-separator"),e.jsx(ko,{systemHints:ce,selectedHintType:H,onSelectHintType:lt=>{me(lt,{analyticsMetadata:{clientThreadId:a}})}},"system-hints")),L){const lt=Q?.slice(T);K.push(e.jsx(ko,{systemHints:lt,selectedHintType:H,onSelectHintType:Ye=>{me(Ye,{analyticsMetadata:{clientThreadId:a}})}},"more-system-hints"))}}gs&&(L?K:m).push(e.jsx(kd,{includeSeparator:!0,includeAction:!0,shortName:!0,connectorConfig:Be,onConnectorClick:As},"connect-apps")),L&&m.push(e.jsx(ud,{layoutMode:w,items:K})),w==="bottom"&&!Tn&&m.reverse(),$n=e.jsx(dd,{onCloseAutoFocus:ce=>{bs.composer.autofocusDisabled$()||(ce.preventDefault(),x.focus())},items:m,children:e.jsx(Wt,{disabled:g,clientThreadId:a,rateLimitPopup:as,highlightTooltip:Cs&&!Ge,label:O.formatMessage({id:"composer.plusMenu.label",defaultMessage:"Add files and more"}),secondaryLabel:e.jsx("kbd",{className:"bg-token-bg-tertiary -me-1 inline-grid aspect-square w-4 items-center justify-center rounded-sm text-[11px]",children:e.jsx("span",{children:"/"})}),children:e.jsx(md,{onDoubleClick:ge?Ie:void 0,disabled:jt})})})}else if(Mr){const m=e.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(gp,{clientThreadId:a,modelSupportedImageMimeTypes:fe,openFileDialog:Ie,historyDisabled:ot,highlightTooltip:Cs&&!Ge,isLoadingConnectors:Yn,connectorConfig:Be,onSelectConnector:Bt,onConnectorOauthRedirect:As,showLabel:dr()==="all",showUpsell:Xn&&!kt,showMenuForNoAuth:kt,isDisabled:!ge||jt,disabledReason:_s,currentModelName:r?.title??"",visualTreatment:Y?"composer-btn":"legacy"})},"file-upload-button");Nt.push(m),Kn.push(m)}Y?pr&&Nt.push(e.jsx(vd,{activeSystemHintType:H,systemHints:Q,composerController:x,clientThreadId:a,disabled:jt})):Nt.push(e.jsx(Pd,{account:n,clientBootstrapFlags:mn,features:ye,currentModelConfig:r,isDisabled:!!jt,clientThreadId:a,composerController:x,gizmoId:At}));const[jr,Jn]=p.useState(!1),Qn=vr||xr?"disabled":"default",Tr=!We,Zn=yd({promptDisabledReason:u,hasPendingFiles:hn,hasTextContent:yn,isTextContentTooLong:us,hasAsyncTaskPending:ar,noSourceSelectedDr:!An,isDeepResearchTaskStreaming:fs,canCancelDeepResearch:ms,isThreadHardBlocked:St}),rt=Mt?"streaming":Tr?"disabled":"idle",it=p.useRef(null),qe=p.useRef(null),Er=Ce(b,"222560275")||o&&!o.startsWith("o1")&&!o.startsWith("o3");p.useEffect(()=>{const m=()=>{it.current!=null&&$o.addAction("composer_state_disabled",{threadId:Ft(a),disabledReason:it.current})};if(vt&&rt==="disabled"){let T="unknown";g?T=u??"component_disabled_unknown":d?T="completion_in_progress":St&&(T="thread_hard_blocked"),it.current!==T&&(qe.current&&clearTimeout(qe.current),qe.current=setTimeout(m,yp)),it.current=T}else it.current=null;return()=>{qe.current&&(clearTimeout(qe.current),qe.current=null)}},[a,vt,rt,g,u,d,St]);const ks=[];if(le?.label&&ks.push({type:le.type,value:le.label,onRemoveRegion:On}),pe!==null){const m=!!pe.gizmo.tags?.includes(Qt.FirstParty);ks.push({type:"mention",value:pe.gizmo.display.name,icon:e.jsx(ya,{isFirstParty:m,src:pe.gizmo.display.profile_picture_url,className:"icon"}),onRemoveRegion:()=>{_t(null),x.focus()}})}p.useEffect(()=>{(!ve||ve.length===0||!Rt)&&(ns.current=!1)},[ve,Rt]);const Rr=p.useCallback((m,T,L)=>{ns.current=m>=0,T&&x.setText(L?`${L.title}${L.body}`:"")},[x]),eo=Rt&&ve&&ve.length>0&&!Ve&&Pe?.systemHint!==F.Research&&!ls&&!x.hasMultipleLines()&&x.canShowAutocompletion();p.useEffect(()=>{Ve?v?.():P?.()},[Ve,v,P]);const Ps=m=>{if(m.preventDefault(),m.stopPropagation(),ss.current>0){const T=performance.now()-ss.current;Hi.hist(zi.DEFAULT,"final_user_input_to_submit_ms",[],T)}rt==="streaming"&&(!dn||x.isEmpty())?fs&&ms?Jn(!0):br(m):Dn(m)};p.useEffect(()=>{const m=Ft(a),T=n?.normalizedAccountUserId;if(!T||i)return;const L=pd(()=>{const K=x.getContentToSend().content;K===""?Li(m):Fi(m,K,T)},1e3);return x.subscribe("change",L)},[n,a,x,i,be]);const{connectedTypes:vs}=Di(),to=q&&Ui(q),so=p.useMemo(()=>{const m=[];ge&&jn&&m.push({command:"upload",aliases:["file","attach"],title:O.formatMessage({id:"composer.add.label",defaultMessage:"Add photos & files"}),icon:e.jsx(Ba,{modelSupportsImages:Lt}),onSelect:Ie});const T=ts?.connection_statuses.filter(L=>L.user_connection_details.activation_status==="activated"&&["google_drive_oauth","google_drive_dwd"].includes(L.user_connection_details.knowledge_connector_type)).map(L=>L.user_connection_details.connection_type)??[];return to&&(vs.size>0||T.length>0)&&m.push({command:"all-connectors",aliases:["find","connectors","use"],title:O.formatMessage({id:"6YT2cp",defaultMessage:"Use all connectors"}),icon:e.jsx(Oi,{}),onSelect:()=>{me(F.Slurm,{analyticsMetadata:{clientThreadId:a}}),je(a,L=>{const K=L.selectedSources?.get(F.Slurm)??new Set;L.selectedSources??=new Map,L.selectedSources.set(F.Slurm,new Set([...K,...vs,...T]))})}}),m},[ge,jn,ts?.connection_statuses,to,vs,O,Lt,Ie,me,a]),no=e.jsx(op,{canUseInlineTagging:Et,isDisabled:g,clientThreadId:a,currentLeafId:B,currentRequestId:$,canContinue:S,composerController:x,isNewThread:l,onContinueGenerating:m=>s({event:m,conversationMode:Te(a)?.mode,systemHints:H?[H]:[]}),onResetState:Ln,conversationMode:G,isShowingAutocomplete:!!eo}),oo=!Mt&&G!=null&&Er&&fd.includes(G.kind)&&e.jsx(gd,{clientThreadId:a,onTargetedReply:hr}),ao=eo&&e.jsx("div",{className:te("bg-token-bg-primary absolute start-0 z-[-1] box-border w-full ps-0",w==="center"?"top-full":"bottom-full"),children:e.jsx(Um,{suggestions:ve,composerController:x,onSelect:I,onChange:Rr})}),ro=e.jsx(Md,{composerController:x,parsedDocumentHandler:yr}),io=!R&&e.jsx(Oa,{className:E}),lo=e.jsx(hd,{modelSupportedImageMimeTypes:fe,uploadType:Ne.Multimodal,attachmentsProductFeature:Tt?.attachments}),Ir=e.jsxs(e.Fragment,{children:[Ve&&e.jsx(To,{onClick:m=>Wn(m),onClose:()=>{x.setShowTaggingDropdown(!1),x.focus()},currentModelId:o}),at&&Q&&e.jsx(Eo,{slashCommands:so,systemHints:Q,composerController:x,clientThreadId:a})]}),{isImageGenEditor:Br}=xd(),co=Ce(b,"3760395675");return Br?e.jsxs(Co.Provider,{value:Pt,children:[e.jsx(Ao,{defaultOpen:co,children:e.jsxs("form",{id:"prompt",className:h,onSubmit:Ps,children:[e.jsxs("div",{className:"relative z-1 flex h-full max-w-full flex-1 flex-col",children:[e.jsx(_o,{onOauthRedirect:ys}),io,e.jsxs("div",{className:"group relative z-1 flex w-full items-center",children:[e.jsxs(bd,{open:Ve||at,children:[e.jsx(Cd,{className:"w-full",children:e.jsx(xp,{type:ot?"temporary":"default",ref:D,placeholder:qn,inputState:Qn,composerController:x,leftSideActions:Kn,state:rt,onSubmit:Ps,renderFiles:Ge&&e.jsxs(e.Fragment,{children:[Oe==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(N,{...Z.gizmoKnowledgeWarning})}),e.jsx(Wa,{files:ie,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:a,gizmoId:At,disableReason:Zn,modelId:o})}),e.jsx(Ad,{children:e.jsxs(_d,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:m=>m.preventDefault(),children:[Ve&&e.jsx(To,{onClick:m=>Wn(m),onClose:()=>{x.setShowTaggingDropdown(!1),x.focus()},currentModelId:o}),at&&Q&&e.jsx(Eo,{slashCommands:so,systemHints:Q,composerController:x,clientThreadId:a})]})})]}),ao]}),ro,lo]}),e.jsx("input",{...Rn({className:"hidden"})})]})}),no,oo]}):e.jsx(Co.Provider,{value:Pt,children:e.jsxs(Ao,{defaultOpen:co,children:[e.jsxs("div",{className:"max-xs:[--force-hide-label:none] relative z-1 flex h-full max-w-full flex-1 flex-col",children:[e.jsx(_o,{onOauthRedirect:ys}),io,ps&&jr&&e.jsx(Sd,{taskId:ps.taskId,clientThreadId:a,onClose:()=>Jn(!1)}),e.jsx(hp,{layoutMode:w,hasFiles:Ge,pendingFiles:ie,isUploadDisabled:!ge,clientThreadId:a,highlightUploadTooltip:Cs&&!Ge,disableReason:Zn,uploadButtonDisabledReason:_s,currentModel:r,conversationMode:G,state:rt,inputState:Qn,gizmoId:At,includeSidebarContextTray:Fn,isTemporaryChat:ot,placeholder:qn,composerController:x,onSubmit:Ps,replyRegions:ks,leadingAction:$n,legacyFooterActions:Nt,legacySuggestionsPopoverContent:Ir,activeSystemHint:Pe,hideSystemHint:rn,onRemoveSystemHint:is,contextualAnswerUserConnectionData:ts,fileInput:e.jsx("input",{...Rn()}),expanded:wn?void 0:!0,expandOnMultilineInput:wn}),!1,ao]}),ro,no,oo,lo,H&&Q&&e.jsx(Cp,{availableSystemHints:Q,systemHintType:H,onRemoveSystemHint:is})]})})}const Cp=({availableSystemHints:t,systemHintType:s,onRemoveSystemHint:n})=>{const o=t!=null&&t.every(l=>l.systemHint!==s),{isLoading:r}=na(),{isBlocked:i}=va(s),c=se(),a=!nt(c);return p.useEffect(()=>{r||(o||i)&&!a&&n()},[o,i,a,n,s,r]),null},Gp=({clientThreadId:t,isNewThread:s,isGizmoThread:n,isProjectThread:o,isModelLoaded:r,currentModelId:i,onRequestCompletion:c,shouldUseUnifiedComposer:a,onlyAllowImageUploads:l})=>{const d=De(),{pageType:h}=Bd(),g=h?.type==="landing-page",u=Yi(h?.type),f=Nd(t).isOdysseyMode,S=p.useContext($i),C=Ki(S),k=Ws(),_=$t(),I=ae(),E=se(),R=st();Ld(d);const v=et(tt),P=mt(Gt.sidebarUrlTrayOpen$)&&v,y=mt(Gt.context$),{platformConnectors:w}=sa(),j=Ee(ke.hasSeenOdysseyConnectorsModal),b=ht(),D=ee(t,B=>W.getConversationTurns(B).some($=>$.messages.some(oe=>oe.metadata?.n7jupd_message))),U=oa(),X=Fd(),x=(U||X)&&D;Dd(async()=>{if(P)return await el(y)});const q=async B=>{if(Te(t)?.isLoading!==!1)return;const $=()=>{d.delete(0,d.getContentLength()),d.appendText(B.contentToSend.content),d.focus()},oe=await Wd(B),Ue=oe.completionMetadata?.systemHints?.includes(zt),Re=Array.from(B.selectedSources??[]).filter(Se=>Se!=="web")[0];if(Ue&&Re&&j.eligible){const Se=Ji[Re]??Re,Oe=w.get(Se);if(Oe){let He=!1;ta(E,Vd,{connector:Oe,onConfirm:()=>{j.markAsViewed(),He=!0,c(oe)},onTurnOffConnectors:()=>{je(t,ye=>{ye.selectedSources??=new Map,ye.selectedSources.set(b,new Set(["web"])),ye.selectedMCPSources??=new Map,ye.selectedMCPSources.set(b,new Set),ye.mentionedSources=new Set,Qi({selectedSourcesMap:ye.selectedSources,selectedMCPSourcesMap:ye.selectedMCPSources,scope:{userId:R?.authUserId,workspaceId:R?.id}})})},onClose:()=>{He||$()}});return}}if(v){const Se=Zi(y?.url??"")?.hostname;M.logEvent("kaur1br5.messageSent",Se?{host:Se}:void 0)}z(oe.promptMessage?.metadata?.attachments??[])&&c(oe)},z=p.useCallback(B=>{let $=Fo;const oe=B.reduce((Re,xt)=>Re+(xt.size??0),0);f&&($=Ro(E,"1504865540").get("max_file_size_mb",25));const Ue=oe<=$*1024*1024;return Ue||_.danger(I.formatMessage({id:"odyssey.fileTooLarge",defaultMessage:"The attached files are too large. The maximum size is {maxFileSizeMB}MB."},{maxFileSizeMB:$})),Ue},[E,I,f,_]),Y=p.useCallback(B=>{M.logEvent("Continue Completion"),c(Ud(B))},[c]),O=Od.useState(B=>B.isReplayEnabled);if(Xi({clientThreadId:t}))return e.jsx(Hd,{});const V=e.jsxs(e.Fragment,{children:[e.jsx(zd,{clientThreadId:t}),e.jsx(Is,{verticalMargin:"none",verticalPadding:C?"last-standard":"none",horizontalPadding:v?"none":"standard",children:e.jsx(Bs,{children:O?e.jsx(Gd,{clientThreadId:t},t):x?null:e.jsx(Ap,{clientThreadId:t,currentModelId:i,isNewThread:s,hideHeader:s,onRequestCompletion:q,onContinueGenerating:Y,onAutocompleteSelect:d.onAutocompleteSelect,onlyAllowImageUploads:l})})})]}),xe=s&&e.jsx("div",{className:te("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:e.jsx(Is,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(Bs,{children:e.jsx(Oa,{className:"block flex-1"})})})});return a?e.jsxs(e.Fragment,{children:[!k&&xe,e.jsx("div",{id:"thread-bottom",children:V}),k&&xe,s&&!g&&!n&&!u&&!f&&!o&&e.jsx(Is,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsxs(Bs,{children:[!1,e.jsx($m,{clientThreadId:t,currentModelId:i,isModelLoaded:r})]})})]}):V};function Ap({clientThreadId:t,currentModelId:s,disableDraftPersistence:n=!1,isNewThread:o,onRequestCompletion:r,onContinueGenerating:i,onComposerInput:c,onComposerChange:a,onAutocompleteSelect:l,headerClassName:d,hideHeader:h,onTaggingDropdownClose:g,onTaggingDropdownOpen:u,onlyAllowImageUploads:f,layoutMode:S}){const{data:C,isLoading:k}=na(),[_,I,E,R,v]=ee(t,$=>{const oe=W.getCurrentNode($);return[oe.message.clientMetadata?.errType!=null&&oe.message.clientMetadata.errType!=="info",tl(W.getCurrentNode($).message),$?.mode,$?.continuingFromSharedConversationId!=null,!!$?.continuingFromSharedPostId]}),P=st(),y=De(),w=Td({clientThreadId:t}),{isOpen:j,onClose:b}=Ed({type:"just-hit-rate-limit"}),D=p.useMemo(()=>w?!1:!_&&I,[_,I,w]),U=w,X=Wi(t),x=ee(t,W.hasRecentPIMWarning),q=ga(X).data,z=Vi(),Y=x?"pimBlock":q?.gizmo.tags?.includes(Qt.WorkspaceDisabled)&&!z?"workspaceDisallowsGizmo":C?.models.size===0?"noModelsAvailable":E?.kind===Qe.GizmoTest&&E.gizmo_id==null?"noTestGizmoId":null,O=Or(),ne=oa(),V=O.action==="moderate",xe=se(),B=Ce(xe,"1860647109");return e.jsxs(e.Fragment,{children:[e.jsx(Sm,{composerController:y,clientThreadId:t,currentModelId:s,isCompletionInProgress:w}),e.jsx("div",{className:"flex justify-center empty:hidden",children:ne&&V&&B?e.jsx(Rd,{}):null}),j?e.jsx(Id,{onClose:b}):null,e.jsx(bp,{clientThreadId:t,disableDraftPersistence:n,onCreateNewCompletion:r,onContinueGenerating:i,currentModelId:s,account:P,currentModelConfig:qi(C?.models,s),areModelsLoading:k,isNewThread:o,isCompletionInProgress:w,className:"w-full",canContinue:D,disabled:!!Y,disabledReason:Y??void 0,canPause:U,isInteractableSharedThread:R||v,onComposerInput:c,onComposerChange:a,onAutocompleteSelect:l,headerClassName:d,hideHeader:h,onTaggingDropdownClose:g,onTaggingDropdownOpen:u,onlyAllowImageUploads:f,layoutMode:S},t)]})}export{xm as D,Hp as F,Dp as I,zp as M,Op as O,Ap as P,Gp as T,hm as a,wo as b,Up as c,Ia as g,Na as h,Fp as u};
//# sourceMappingURL=iacposgqe14fuloa.js.map
