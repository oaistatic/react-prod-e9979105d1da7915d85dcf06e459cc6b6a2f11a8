import{j as e,h as L,n as W,e as H,r,M as w,A as B,m as O,L as D,ah as C,u as U}from"./juy90og0wtbp77qa.js";import{B as z}from"./hibpneehm1q4hc2e.js";import{c as Q,d as V}from"./o6wb3ptvu0bk81yq.js";import{P as $}from"./dmfmxszxfbs8gsbx.js";import{b$ as x,c0 as q,i2 as G,k1 as K,jc as R,k2 as _,bU as J,fw as X,fu as Y,k3 as Z}from"./ckp56qklot786ulr.js";import{e as E,f as M,aG as ee,B as se,a$ as te,hB as ae,f0 as ne,lf as re,ar as oe,j5 as ie,bK as ce,j0 as le,hz as de,l as P,ec as me}from"./dc2xxjkicf2pz0mj.js";import{b as he}from"./icu9d2zdwlcy45kn.js";import{W as ue}from"./dq2hdjj12gdqq0p1.js";import{b as xe,a as fe,c as ge,h as pe}from"./fwb02vgq072qdb93.js";import{W as ke}from"./lsldnobv7eet27pa.js";import{T as ve}from"./l3xu29fndg9f5mv3.js";import{S as je}from"./nvghkpv0zy449sx8.js";import{a as be,b as we,S as Te}from"./o46eutw3gegbydjq.js";import{u as Se}from"./mwysfro98kbgaaol.js";function Ne({disabled:n,children:o}){return n?e.jsx("div",{className:"pointer-events-none opacity-50 select-none","aria-hidden":"true",tabIndex:-1,inert:!0,children:o}):o}function ye(){const n=L(),o=x(({tasksFilter:h})=>h),f=x(({setTasksFilter:h})=>h),g=E(),d=W(),l=H(),c=M(g,"2665240312"),m=r.useCallback(h=>{f(h);const p=new URLSearchParams(d.search);p.set("tab",h==="archived"?"archived":"all"),l({pathname:d.pathname,search:p.toString()},{replace:!0})},[f,d,l]);return e.jsx("div",{className:"border-token-border-primary mt-4 flex w-full items-center border-b align-middle md:mt-6",children:c&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ve,{currentTab:o,onChange:m,withUnderline:!0,tabs:[{label:n.formatMessage({id:"wham.whamTasksHeader.all",defaultMessage:"Tasks"}),ariaLabel:n.formatMessage({id:"wham.whamTasksHeader.allAriaLabel",defaultMessage:"Tab selector to view all tasks"}),key:"current"},{label:n.formatMessage({id:"wham.whamTasksHeader.archived",defaultMessage:"Archive"}),ariaLabel:n.formatMessage({id:"wham.whamTasksHeader.archivedAriaLabel",defaultMessage:"Tab selector to view archived tasks"}),key:"archived"}]})})})}function Ce(){const n=L(),o=x(({tasksFilter:i})=>i),{data:f,isLoading:g,error:d,fetchNextPage:l,hasNextPage:c,isFetchingNextPage:m,refetch:h,isPending:p}=q({refetchOnMount:!0,refetchOnWindowFocus:!0}),k=f?.pages.flatMap(i=>i.items??[])??[],N=x(i=>i.pendingTaskIds),v=k.length>0,[j,T]=r.useState(null),s=o==="archived"?[]:Array.from(Object.entries(N)).filter(([i,a])=>!k.some(b=>b.id===a)).map(([i])=>i).reverse(),y=k.length===0&&s.length===0;return e.jsx("div",{className:"flex flex-col justify-center",children:g&&!v?e.jsx("div",{className:"mt-4 flex h-full w-full items-center justify-center",children:e.jsx(ee,{})}):e.jsxs(e.Fragment,{children:[y&&e.jsx(e.Fragment,{children:d?e.jsxs("div",{className:"mt-6 flex w-full flex-col items-center justify-center gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(w,{id:"wham.whamTasksSection.errorLoadingTasks",defaultMessage:"Error loading tasks"})}),e.jsx(se,{color:"secondary",onClick:()=>h(),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{id:"wham.whamTasksSection.retry",defaultMessage:"Retry"}),e.jsx(je,{className:"icon-xs"})]})})]}):e.jsx("div",{className:"mt-6 flex h-full w-full items-center justify-center",children:e.jsx("div",{className:"text-token-text-secondary text-sm",children:o==="current"?n.formatMessage({id:"wham.whamTasksSection.noActiveTasks",defaultMessage:"No active tasks"}):n.formatMessage({id:"wham.whamTasksSection.noArchivedTasks",defaultMessage:"No archived tasks"})})})}),o!=="archived"&&s.map(i=>e.jsx(be,{},i)),k.map((i,a)=>e.jsx(we,{index:a,taskListItem:i,hoveredIndex:j,onMouseEnter:()=>{T(a)},onMouseLeave:()=>T(null)},i.id)),e.jsx(G,{isFetchingNextPage:m||p,hasNextPage:c??!1,fetchNextPage:l})]})})}const Ee=r.memo(Ce);function Me(){const n=E();return M(n,"3984934927")}function Pe(){const{eligible:n,markAsViewed:o}=K(),f=x().environmentId,{data:g,isLoading:d}=R(),l=g?.find(s=>s.id===f),c=g?.some(s=>s.setup.length>0)??!1,{data:m,isLoading:h}=_(),p=m??!1,k=te(),N=ae(),v=r.useMemo(()=>[{id:"step-1",link:"/codex/settings/environment/create",checked:!0,label:e.jsx(w,{id:"codex.onboarding.step-1",defaultMessage:"Set up your first environment"})},{id:"step-2",checked:p,label:e.jsx(w,{id:"codex.onboarding.step-2",defaultMessage:"Create your first task"})},{id:"step-3",checked:c,link:`/codex/settings/environment/${l?.id}/edit#setup-script`,label:e.jsx(w,{id:"codex.onboarding.step-3",defaultMessage:"Install dependencies for the ‘{environmentName}’ environment",values:{environmentName:l?.label}})}],[c,l,p]),j=v.every(s=>s.checked);r.useEffect(()=>{j&&o()},[j,o]);const T=k||!n||d||h||!l||j;return e.jsx(B,{children:T?null:e.jsx(O.div,{className:"fixed end-6 bottom-6 z-50",initial:{opacity:0},animate:{opacity:1},transition:{duration:N?1e-5:.5},children:e.jsxs("div",{className:"bg-token-bg-primary border-token-border-default flex w-[272px] flex-col gap-4 rounded-xl border p-4 shadow-xl",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(w,{id:"k3HHpd",defaultMessage:"Finish setting up Codex"})})}),e.jsx("div",{className:"flex flex-col gap-3",children:v.map((s,y)=>{const i=!s.checked&&v.filter(b=>!b.checked).length===1&&v.findIndex(b=>!b.checked)===y,a=e.jsxs("div",{className:"flex items-start gap-3 select-none",children:[e.jsx("div",{className:"mt-0.5",children:s.checked?e.jsx(ne,{className:"icon text-token-text-tertiary"}):e.jsx(re,{className:"icon text-token-text-tertiary"})}),e.jsx("span",{className:oe("text-sm",s.checked?"text-token-text-tertiary line-through":"text-token-text-primary"),children:s.label}),s.link&&!s.checked&&e.jsx(Te,{className:"icon text-token-text-primary"})]},s.id);return s.link&&!s.checked?e.jsx(D,{to:s.link,onClick:()=>{i&&o()},children:a},s.id):a})})]})})})}function qe(){const n=E(),o=ie(),f=Me(),g=ce(n),{eligible:d}=J(),l=X();Se();const c=M(n,"547652119");return x(m=>m.showReactQueryDevtools),o?c?e.jsx(C,{to:"/codex/failwhale"}):l==="DISABLED"?e.jsx(C,{to:"/",replace:!0}):d?e.jsx(C,{to:"/codex/onboarding"}):e.jsxs(e.Fragment,{children:[e.jsx(z,{page:"codex"},g?.getWorkspaceId()),!1,e.jsx(he,{mobileHeaderRightContent:null,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(fe,{children:e.jsx(ge,{hideNotificationBell:!0})}),e.jsx(le,{children:e.jsx(Le,{})})]})})]}):f?e.jsx(xe,{}):e.jsx(C,{to:"/"})}const Le=()=>{const n=x(({setPromptDraft:t})=>t),o=x(({setTasksFilter:t})=>t),f=x(t=>t.setEnvironmentId),g=x(t=>t.setBranch),d=U(),{data:l}=R(),c=W(),m=x(t=>t.lastViewedTaskId),[h,p]=r.useState(m?!1:void 0),[k]=r.useState(!!m),[N,v]=r.useState(!1),j=r.useRef(null),T=E(),s=M(T,"1406552515"),y=x(({promptDraft:t})=>t),i=de(),a=r.useMemo(()=>i?new $(Q(),{isExpanded:!m}):new Y,[i,m]),b=r.useRef(!1);r.useEffect(()=>{d.prefetchInfiniteQuery(Z("archived"))},[d]),r.useEffect(()=>{c.state?.focusComposer&&!b.current&&!s&&(a.focus(),b.current=!0)},[c.state?.focusComposer,a,s]),r.useEffect(()=>{a.setText(s?"":y)},[a,s]);const I=r.useRef(null),A=P(a.store,({isFocused:t})=>t),F=P(a.store,({isExpanded:t})=>t);return me(()=>{const t=j.current;if(!t)return;const u=()=>{const S=t.scrollTop>0;v(S),p(void 0)};return t.addEventListener("scroll",u),()=>t.removeEventListener("scroll",u)},[F,A,a]),r.useEffect(()=>a.subscribe("change",()=>{n(a.getContentToSend().content)}),[a,n]),r.useEffect(()=>a.subscribe("focus",()=>{p(void 0)}),[a]),r.useEffect(()=>{const t=new URLSearchParams(c.search),u=t.get("prompt");u&&a.setText(u);const S=t.get("tab");S==="archived"?o("archived"):S==="all"&&o("current")},[c.search,a,o]),r.useEffect(()=>{const u=new URLSearchParams(c.search).get("environment");u&&l?.some(S=>S.id===u)&&f(u)},[c.search,l,f]),r.useEffect(()=>{const u=new URLSearchParams(c.search).get("branch");u&&g(u)},[c.search,g]),e.jsxs(V.Provider,{value:a,children:[e.jsx("div",{className:"h-full w-full overflow-y-auto",ref:j,style:{scrollbarGutter:"stable"},children:e.jsxs("div",{className:"z-0 mx-auto flex w-full flex-col md:w-3xl",children:[e.jsx(ke,{}),e.jsxs("div",{className:"bg-token-bg-primary sticky top-0 z-50 flex flex-col items-center",children:[e.jsx("h1",{className:"mb-4 pt-4 text-2xl 2xl:mb-8 2xl:pt-8 2xl:text-3xl [@media(max-height:550px)]:hidden",children:e.jsx(w,{id:"wham.home.title",defaultMessage:"What are we coding next?"})}),e.jsx("div",{ref:I,className:"w-full pt-px max-md:px-3",children:e.jsx(Ne,{disabled:s,children:e.jsx(ue,{disableAutoFocus:k||s,expanded:h??(N?void 0:!0),isBigBoxMode:!s,onSubmit:()=>{a.eraseContent(),n("")},onSuccess:()=>{pe.set(t=>t+1)}})})}),e.jsx(ye,{})]}),e.jsx(Ee,{})]})}),e.jsx(Pe,{})]})};export{qe as W};
//# sourceMappingURL=ms6owh3g5mmw3rij.js.map
