import{h as G,r as u,j as e,M as n,f as U,af as V,u as Q,e as F,ak as X}from"./juy90og0wtbp77qa.js";import{ag as D,C as E,B as y,a5 as R,aq as I,R as H,aG as T,cD as $,D as K,a7 as Z,ar as J}from"./dc2xxjkicf2pz0mj.js";import{ff as Y,e5 as ee,iH as A,dl as L,a5 as a,M as O,iF as q,iG as se,dm as ae}from"./ckp56qklot786ulr.js";import{a as te,c as re}from"./nun3xvf89dudjv6n.js";import{V as ne}from"./d3y72ugnrmac5z1v.js";import{G as oe}from"./ldijey3djvgs6gk2.js";import{e as le,f as ie,M as _}from"./hsbk15o0no5hta6n.js";function de({defaultName:s,placeholder:t,onSave:i,onClose:c}){const d=G(),g=s==null,[p,m]=u.useState(s||""),[w,j]=u.useState(!1),[x,o]=u.useState(null),M=D(),h=async()=>{if(p.trim()===""){o(d.formatMessage({id:"workspaceSettings.groups.emptyName",defaultMessage:"Group name cannot be empty"}));return}j(!0);try{await i(p),M.success(g?d.formatMessage({id:"workspaceSettings.groups.createdGroup",defaultMessage:"Group created successfully"}):d.formatMessage({id:"workspaceSettings.groups.nameChanged",defaultMessage:"Group name changed successfully"})),c()}catch{o(d.formatMessage({id:"workspaceSettings.groups.duplicateName",defaultMessage:"Group with this name already exists"}))}finally{j(!1)}};return e.jsx(E,{isOpen:!0,type:"success",onClose:c,title:g?d.formatMessage(P.newGroupTitle):d.formatMessage(P.updateNameTitle),testId:"modal-change-group-name",showCloseButton:!0,primaryButton:e.jsx(y,{color:"primary",onClick:()=>h(),loading:w,children:e.jsx(n,{id:"workspaceSettings.groups.save",defaultMessage:"Save"})}),secondaryButton:e.jsx(y,{onClick:c,color:"secondary",children:e.jsx(n,{id:"workspaceSettings.groups.cancel",defaultMessage:"Cancel"})}),children:e.jsxs("div",{className:"mb-3 flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:e.jsx(n,{id:"workspaceSettings.groups.groupNameLabel",defaultMessage:"Group Name"})}),e.jsx("input",{autoFocus:!0,type:"text",value:p,placeholder:t,onChange:f=>{m(f.target.value),o(null)},className:"border-token-border-secondary focus:border-token-accent w-full rounded border px-3 py-2 text-sm focus:outline-none",onKeyDown:f=>{f.key==="Enter"&&h()}}),x&&e.jsx("p",{className:"text-xs text-red-500",children:x})]})})}const P=U({newGroupTitle:{id:"workspaceSettings.groups.newGroup",defaultMessage:"New group"},updateNameTitle:{id:"workspaceSettings.groups.updateNameTitle",defaultMessage:"Update group name"}}),v=1e3;function ce({group:s,isOpen:t,onClose:i}){const c=G(),d=D(),g=c.formatMessage({id:"workspaceSettings.groups.addMember",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),p=R(),[m,w]=u.useState([]),[j,x]=u.useState(!1);async function o(){const M=p?.getWorkspaceId();if(!M)throw new Error("No workspace ID found");x(!0);const h=[],f=50;for(let r=0;r<m.length;r+=f)h.push(m.slice(r,r+f));const N=async r=>H.safePost("/accounts/{account_id}/group/{group_id}/users",{parameters:{path:{account_id:M,group_id:s.id}},requestBody:{email_addresses:r}}),k=(await Promise.all(h.map(r=>N(r)))).reduce((r,b)=>r+b.added_group_users.length,0);d.success(c.formatMessage({id:"yU4Zf0",defaultMessage:"Added {numUsers} users to the group"},{numUsers:k})),i?.(),x(!1)}return e.jsxs(E,{testId:"modal-bulk-add-group-members",isOpen:t,onClose:i??I,title:g,type:"success",showCloseButton:!0,primaryButton:e.jsx(y,{onClick:o,disabled:m.length===0||m.length>v,loading:j,children:e.jsx(n,{id:"EpbOzA",defaultMessage:"Add users to group"})}),children:[e.jsx(ue,{onChange:w}),m.length>v&&e.jsx("div",{className:"text-token-text-error mt-2 text-sm",children:e.jsx(n,{id:"9lp0Tc",defaultMessage:"Email list is limited to {maxEmails} users at once",values:{maxEmails:v}})})]})}function ue({onChange:s}){const[t,i]=u.useState("");return e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("label",{htmlFor:"group-email-paste",children:[e.jsx(n,{id:"qvGcSC",defaultMessage:"Emails"}),e.jsx("br",{}),e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(n,{id:"Fhd+5h",defaultMessage:"Paste email addresses here, one per line:"})})]}),e.jsx(Y,{id:"group-email-paste",className:"h-[250px] text-sm",value:t,onChange:c=>{i(c.target.value),s(me(c.target.value))},placeholder:`jean@example.com
joohyun@example.com
muhammed@example.com
susan@example.com`})]})}function me(s){return s.split(`
`).map(t=>t.trim()).filter(t=>t.length>0).filter(t=>ne.test(t))}function ge({group:s,isOpen:t,onClose:i}){const d=G().formatMessage({id:"workspaceSettings.addGroupsMembersModal.title",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),p=R()?.getWorkspaceId(),[m,w]=u.useState(""),[j,x]=u.useState(0),{data:o,isLoading:M}=ee(p,j*A,m,A,V),[h,f]=u.useState([]),[N,C]=u.useState([]),[k,r]=u.useState("interactive"),b=o?Math.ceil((o.total??0)/A):0;async function z(l){C(S=>[...S,l]);try{await pe(p,s.id,l),f(S=>[...S,l])}catch(S){K.addError(S)}finally{C(S=>S.filter(W=>W!==l))}}return k==="batch"?e.jsx(ce,{group:s,isOpen:t,onClose:i}):e.jsx(E,{testId:"modal-add-group-member",type:"warning",isOpen:t,onClose:i??I,title:d,size:"custom",className:"max-w-(--breakpoint-md)",showCloseButton:!0,primaryButton:e.jsx(y,{onClick:i,children:e.jsx(n,{id:"0NAzDq",defaultMessage:"Done"})}),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx("p",{children:d}),e.jsx(y,{onClick:()=>{r("batch")},color:"secondary",children:e.jsx(n,{id:"5GPldp",defaultMessage:"Bulk add users"})})]}),e.jsx(L,{value:m,inputClassName:"w-full",onChange:l=>{w(l.target.value)}}),e.jsxs(a.Root,{className:"min-w-full",children:[e.jsxs(a.Header,{children:[e.jsx(a.HeaderCell,{children:e.jsx(n,{id:"workspaceSettings.groups.addMember.name",defaultMessage:"Name"})}),e.jsx(a.HeaderCell,{children:e.jsx(n,{id:"workspaceSettings.groups.addMember.email",defaultMessage:"Email"})}),e.jsx(a.HeaderCell,{})]}),e.jsxs(a.Body,{children:[!o&&M&&e.jsx(a.Row,{children:e.jsx(a.Cell,{colSpan:3,children:e.jsx(T,{})})}),o?.items.map(l=>e.jsxs(a.Row,{children:[e.jsx(a.Cell,{children:l.name}),e.jsx(a.Cell,{children:l.email}),e.jsx(a.Cell,{textAlign:"right",className:"pe-1",children:e.jsx(y,{size:"small",color:"secondary",disabled:N.includes(l.id),onClick:()=>{h.includes(l.id)||z(l.id)},icon:h.includes(l.id)?$:O,children:h.includes(l.id)?e.jsx(n,{id:"workspaceSettings.groups.addMember.addButton",defaultMessage:"Added"}):e.jsx(n,{id:"workspaceSettings.groups.addMember.addedButton",defaultMessage:"Add"})})})]},l.id))]})]}),e.jsx("div",{className:"flex flex-row justify-center",children:e.jsx(q,{currentPage:j,onChangeIndex:l=>{x(l)},length:b})})]})})}async function pe(s,t,i){await H.safePatch("/accounts/{account_id}/group/{group_id}",{parameters:{path:{account_id:s,group_id:t}},requestBody:{user_id:i}})}function xe({workspaceId:s}){const t=G(),i=Q(),c=Z(),d=!(c?.isAdminOfAccount()||c?.isOwnerOfAccount()),[g,p]=u.useState(""),m=ae(g,300),w=F(),[j,x]=u.useState(0),{groups:o,isLoading:M,isPlaceholderData:h}=le({workspaceId:s,currPage:j,groupFilter:m}),[f,N]=u.useState(!1),C=r=>{r&&(x(0),p("")),N(r)},{createGroup:k}=ie({workspaceId:s,currentGroups:o});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 mb-3 flex flex-row justify-between gap-2",children:[e.jsx(L,{inputClassName:"w-[250px] rounded-full! text-sm",value:g,onChange:r=>{p(r.target.value),x(0)},placeholder:t.formatMessage({id:"workspaceSettings.groups.search",defaultMessage:"Search group name"})}),!d&&e.jsx(y,{onClick:()=>C(!0),icon:O,children:e.jsx(n,{id:"workspaceSettings.groups.create",defaultMessage:"Create group"})})]}),e.jsxs("div",{children:[e.jsxs(a.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[60%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-16"})]}),e.jsxs(a.Header,{children:[e.jsx(a.HeaderCell,{children:e.jsx(n,{id:"workspaceSettings.groups.groupName",defaultMessage:"Group name"})}),e.jsx(a.HeaderCell,{children:e.jsx(n,{id:"workspaceSettings.groups.members",defaultMessage:"Members"})}),e.jsx(a.HeaderCell,{children:e.jsx(n,{id:"workspaceSettings.groups.created",defaultMessage:"Created"})}),e.jsx(a.HeaderCell,{})]}),e.jsx(a.Body,{className:J((M||h)&&"opacity-50"),children:o==null?e.jsx(a.Row,{children:e.jsx(a.Cell,{colSpan:5,textAlign:"center",children:e.jsx(T,{})})}):o.items.length===0?e.jsx(a.Row,{children:e.jsx(a.Cell,{colSpan:5,textAlign:"center",children:g===""?e.jsx(n,{id:"workspaceSettings.groups.noGroups",defaultMessage:"No groups found."}):e.jsx(n,{id:"workspaceSettings.groups.noGroupsWithFIlter",defaultMessage:"No groups found. Try changing the search query."})})}):o.items.map(r=>e.jsx(he,{group:r,workspaceId:s,onAddMember:()=>{i.invalidateQueries({queryKey:[s,"groups"]})},readOnly:d},r.id))})]}),o&&e.jsx("div",{className:"text-center",children:e.jsx(q,{length:Math.ceil(o.total/_),currentPage:Math.min(j,Math.ceil(o.total/_)),onChangeIndex:r=>x(r)})})]}),f&&e.jsx(de,{onClose:()=>C(!1),onSave:async r=>{const{id:b}=await k({name:r,workspaceId:s});w(`/admin/groups/${b}`)},placeholder:t.formatMessage({id:"workspaceSettings.groups.placeholder",defaultMessage:"E.g. marketing team"})})]})}function Ne({currentWorkspaceId:s}){const t=G();return e.jsxs(e.Fragment,{children:[e.jsx(se,{children:e.jsx("title",{children:t.formatMessage(B.title)})}),e.jsx(te,{title:t.formatMessage(B.title),subtitle:e.jsx(n,{id:"NDDzzF",defaultMessage:"Only workspace admins can edit these settings."})}),e.jsx(re,{showSpinner:!1,children:e.jsx(xe,{workspaceId:s})})]})}function he({group:s,onAddMember:t,readOnly:i}){const[c,d]=u.useState(!1),g=F();return e.jsxs(e.Fragment,{children:[e.jsxs(a.Row,{className:"[&>td]:py-2",onClick:()=>g(`/admin/groups/${s.id}`),children:[e.jsxs(a.Cell,{children:[e.jsx(oe,{group:s}),s.name]}),e.jsx(a.Cell,{children:e.jsx(n,{id:"workspaceSettings.groups.memberCount",defaultMessage:"{count} members",values:{count:s.num_members}})}),e.jsx(a.Cell,{children:s.created_time&&e.jsx(X,{value:s.created_time,year:"numeric",month:"short",day:"numeric"})})]}),c&&!i&&!s.is_scim_managed&&e.jsx(ge,{isOpen:!0,onClose:()=>{t(s.id),d(!1)},group:s})]})}const B=U({title:{id:"admin.groupsSettings.title",defaultMessage:"Groups"}});export{ge as A,de as U,Ne as W,B as m};
//# sourceMappingURL=n8vvz4vq9itqdipl.js.map
