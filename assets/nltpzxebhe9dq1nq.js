const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/bie0ehl1jeraz0cg.js","assets/juy90og0wtbp77qa.js","assets/dc2xxjkicf2pz0mj.js","assets/root-fv49dn40.css","assets/ckp56qklot786ulr.js","assets/conversation-small-j9iamy23.css","assets/cjopf864irjs51s2.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{ar as P,dX as V,bv as z,ak as q,as as Y,iq as $,aQ as K,at as Q}from"./dc2xxjkicf2pz0mj.js";import{j as t,m as S,r as n}from"./juy90og0wtbp77qa.js";import{P as X,u as Z}from"./dmfmxszxfbs8gsbx.js";import{c as B,d as J}from"./o6wb3ptvu0bk81yq.js";import{hP as U,bD as ee,bG as te,fY as ne,V as se,hQ as ae,bF as D,hR as oe,hS as ie,hJ as b,eA as re,$ as ce,Y as le,X as ue}from"./ckp56qklot786ulr.js";import{P as de}from"./iacposgqe14fuloa.js";import"./o7zrzew6ugefv8n2.js";import"./abebcwj1m9mup3z6.js";import"./nqj34k5dky4x5suq.js";import"./hort3ndd4wla0a2j.js";import"./jsgl3b1bt1ozctr5.js";import"./ck00y48d3yzt8bq3.js";import"./hczymk9ojq2shlcf.js";const me=0,he=48;function fe({imageAsset:e,children:a,containerDimensions:s,isLoadingNewImage:i}){return t.jsxs(S.div,{className:"absolute",style:pe(e,s),...U,children:[a,t.jsx("div",{className:P("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",i?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function pe(e,a){const{width:s,height:i}=e,{width:u,height:d}=a,m=u-2*me,h=d-2*he,l=s/i,r=m/h,c=l>r,g=c?m:h*l,x=c?m/l:h;return{top:"50%",left:"50%",width:g,height:x,transform:"translate(-50%, -50%)"}}const ge=({onEscape:e})=>{n.useEffect(()=>{function a(s){s.key==="Escape"&&e()}return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[e])},xe=Y(()=>Q(()=>import("./bie0ehl1jeraz0cg.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>e.DynamicDrawingCanvas)),N=126,we=63,Ie=136,ve=50;function Ce({width:e,height:a,delay:s=ve}){const[i,u]=n.useState(!1);return n.useEffect(()=>{const d=setTimeout(()=>{u(!0)},s);return()=>{clearTimeout(d)}},[s]),i?t.jsx("div",{className:"flex max-h-full max-w-full items-center justify-center",style:{width:e,height:a,aspectRatio:`${e} / ${a}`},children:t.jsx("div",{className:"bg-token-border-default h-full w-full animate-pulse"})}):null}function Te({image:e,isLoadingNewImage:a,clientThreadId:s,onClose:i,messageId:u,onRequestCompletion:d,editorControls:m,footer:h}){const l=V(s),[r,c]=n.useState("default"),[g,x]=n.useState({width:window.innerWidth,height:window.innerHeight-N}),M=z(),[_,L]=n.useState(!1),I=ee(),{currentDrawnShape:w,onNewDrawnShape:T,clearAllDrawings:G}=I,v=n.useRef(null),k=n.useMemo(()=>new X(B()),[]),C=n.useRef(void 0),f=n.useMemo(()=>te({pointer:e,conversationId:l,messageId:u,source:"editor"}),[e,u,l]),O=ne(o=>{const{width:p,height:R}=o.contentRect;x({width:p,height:M?R-N:R-we})});ge(n.useMemo(()=>({onEscape:()=>{r==="inpaint"?c("default"):i()}}),[r,i])),se(n.useMemo(()=>({image:e,currentDrawnShape:w,onCleared:()=>c("default"),getImageData:()=>v.current?.getImageData()}),[e,w])),n.useEffect(()=>{r!=="inpaint"&&G()},[r]),n.useEffect(()=>{c("default")},[e]);const A=Z(s),E=n.useCallback(o=>{c("default"),A(o),i()},[A,i]),j=n.useMemo(()=>d||E,[d,E]),[W]=q(s,o=>[o?.modelId]),y=ae({imageAssetPointer:e,serverThreadId:l}),H=n.useCallback(()=>{c("inpaint"),D.inpaintClick({analyticsContext:f})},[f]),F=n.useCallback(o=>{const p=o.deltaY<0?"in":"out";o.ctrlKey&&C.current!==p&&(D.zoom({zoomType:p,analyticsContext:f}),C.current=p)},[f]);return t.jsx(oe.Provider,{value:f,children:t.jsxs("div",{ref:O,className:"flex h-full w-full flex-col items-center justify-between",onWheel:F,children:[m??t.jsx(ie,{clientThreadId:s,imageAsset:e,mode:r,setMode:c,inpaintingDrawingState:I,isLoadingNewImage:a,onClose:i,onInpaintClick:H,messageId:u,serverThreadId:l}),t.jsx("div",{className:"relative flex w-full grow items-center justify-center",children:t.jsxs(fe,{imageAsset:e,containerDimensions:g,isLoadingNewImage:a,children:[y&&r!=="inpaint"&&t.jsx("img",{alt:b(e),className:"absolute inset-0 z-1 opacity-0",src:y}),!_&&t.jsx(Ce,{width:e.width,height:e.height}),t.jsx(re,{className:"h-full w-full",alt:b(e),onLoad:()=>{L(!0)},src:e.url,width:e.width,height:e.height,fadeIn:!1}),t.jsx("div",{className:P("absolute inset-0",r==="inpaint"?"":"hidden"),children:t.jsx(xe,{drawingCanvasRef:v,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:Ie,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:w,onNewDrawnShape:T})})]})}),t.jsx("div",{className:"flex min-h-[132px] w-full flex-col items-center justify-end max-sm:min-h-[84px]",children:t.jsx(S.div,{className:"mb-6 flex w-[90%] items-center justify-center lg:w-[53%]",layout:!0,transition:{duration:.2,ease:"easeInOut"},children:h??t.jsx(ce,{value:{isImageGenEditor:!0,isInpainting:r==="inpaint",onCancelInpaint:()=>c("default")},children:t.jsx(J.Provider,{value:k,children:t.jsx(de,{clientThreadId:s,isNewThread:K(s),currentModelId:W??$(void 0).id,onContinueGenerating:o=>j(ue(o)),onRequestCompletion:async o=>j(await le(o)),hideHeader:!0})})})})})]})})}export{Te as ImageGenNewEditor,Ce as ShimmerLoader};
//# sourceMappingURL=nltpzxebhe9dq1nq.js.map
