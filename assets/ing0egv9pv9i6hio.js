import{r as m,j as o,A as w,M as b}from"./juy90og0wtbp77qa.js";import{ak as I,bj as E,jH as T,bX as D,bW as N,g5 as A,ga as $,P as C,ar as S,b2 as k}from"./dc2xxjkicf2pz0mj.js";import{bk as U,bl as F,bm as W,bn as O,bo as P}from"./ckp56qklot786ulr.js";import{F as z}from"./ezqsz68yx4uzdtqb.js";import"./dmfmxszxfbs8gsbx.js";function g(t,e){const l=new RegExp(`<\\s*${e}\\s*>([\\s\\S]*?)<\\s*/\\s*${e}\\s*>`,"i"),c=t.match(l);return c&&c[1]?c[1].trim():t}function B(t){if(t===void 0)return;const e="Content Snippet:",l=t.indexOf(e);return l===-1?t:t.substring(l+e.length).trim()}function L(t,e){e.text=B(t.contents),t.documentId?.includes("ks--slack")?(e.text=void 0,e.name=`#${e.name}`):e.cloud_doc_url?.startsWith("https://docs.google.com/spreadsheets/")&&e.text!==void 0?e.text=g(e.text,"sheet_summary"):e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/commit\//)&&e.text!==void 0?e.text=g(e.text,"git_summary"):e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/blob\//)&&e.text!==void 0&&(e.text=g(e.text,"code_summary")),e.text&&(e.text=e.text.slice(0,250))}function J({turnIndex:t,clientThreadId:e}){const[l,c]=I(e,i=>[k.getTurnContentReferences(i,t),k.getConversationTurnAtIndex(i,t).messages]),f=E(e),r=m.useMemo(()=>({turnIndex:t,clientThreadId:e}),[e,t]),p=m.useMemo(()=>{const i=[],n=new Set;return l.forEach(s=>{s.type==="file"&&!n.has(s.id)?(i.push({id:s.id,name:s.name,cloud_doc_url:s.cloud_doc_url??s.extra?.cloud_doc_url,text:s.text}),n.add(s.id)):s.type==="file_navlist"&&s.items.forEach(u=>{n.has(u.id)||(i.push({name:u.name,cloud_doc_url:u.cloud_doc_url,text:u.description,id:u.id,lastModifiedTime:u.last_modified_time}),n.add(u.id))})}),i},[l]),d=T(f),x=m.useMemo(()=>{if(!d)return[];const i=[],n=new Set;for(const s of c)if(s.author.role===D.Tool&&s.author.name==="file_search"&&s.content.content_type===N.TetherBrowsingDisplay){const u=U(s.content.result),h=s.metadata?.cloud_doc_urls??[];u.chunks.forEach((a,v)=>{if(!a.documentId||n.has(a.documentId))return;n.add(a.documentId);let _;a.metadata.cloud_doc_url?_=a.metadata.cloud_doc_url.toString():v<h.length?_=h[v]:a.documentId.endsWith("--google")&&(_=`https://drive.google.com/file/d/${a.documentId.split("--")[1]}`);const y=a.metadata["File last modified at"]??a.metadata["File created at"],j={id:a.documentId,name:a.title,cloud_doc_url:_,text:a.contents,lastModifiedTime:y?y.toString():void 0};L(a,j),i.push(j)})}return i},[d,c]);return o.jsx(w,{children:o.jsxs("div",{className:"bg-token-main-surface-primary mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)] flex w-full flex-col",children:[o.jsx(M,{title:o.jsx(b,{id:"dlVlo6",defaultMessage:"Citations"}),items:p,clientThreadId:e,sectionId:"citations",analyticsMetadata:r}),o.jsx(M,{title:o.jsx(b,{id:"njZblE",defaultMessage:"Search Results"}),items:x,clientThreadId:e,sectionId:"search-results",analyticsMetadata:r})]})})}function M({title:t,items:e,scrollToHeader:l,shouldAnimateScroll:c,clientThreadId:f,analyticsMetadata:r,sectionId:p}){const d=m.useRef(null),x=m.useMemo(()=>r?{...r,sectionId:p,numResultsInSection:e.length}:void 0,[r,e.length,p]);return m.useEffect(()=>{d.current&&l&&setTimeout(()=>{d.current&&d.current.scrollIntoView({behavior:c?"smooth":"instant"})},300)},[l,c]),!e||e.length===0?null:o.jsxs("div",{ref:d,children:[o.jsx(F,{className:"border-token-border-sharp bg-token-main-surface-primary text-token-text-primary sticky top-0 z-1 flex h-[calc(var(--header-height,3.5rem)+1px)] items-center border-b px-6 pt-4 pb-4 text-sm font-medium",children:t}),o.jsx("div",{className:"flex list-none flex-col px-3 py-2",children:e.map((i,n)=>o.jsx(F,{index:n,children:o.jsx(V,{positionInSection:n,item:i,analyticsMetadata:x,clientThreadId:f},n)},`${t}-${n}`))})]})}function V({item:t,analyticsMetadata:e,positionInSection:l,clientThreadId:c}){const f=A(),r=W(t.cloud_doc_url??""),p=r?.type??o.jsx(b,{id:"bqY3sN",defaultMessage:"File"}),d=r?.Icon??(t.cloud_doc_url?$:O),[x,i]=m.useState(!1),n=m.useCallback(()=>{e&&C.logEventWithStatsig("File Sources Sidebar Item Clicked","file_sources_sidebar_link_clicked",{...e,positionInSection:l,sourceType:r?.type,hasUrl:!!t.cloud_doc_url})},[e,t.cloud_doc_url,r?.type,l]),s=m.useCallback(()=>{e&&C.logEventWithStatsig("File Source Sidebar Item Followup Clicked","file_sources_sidebar_item_followup_clicked",{...e,positionInSection:l,sourceType:r?.type,hasUrl:!!t.cloud_doc_url})},[e,t.cloud_doc_url,r?.type,l]);return o.jsx(o.Fragment,{children:o.jsxs("a",{href:t.cloud_doc_url,target:"_blank",rel:"noreferrer",onClick:n,className:S("group relative flex flex-col gap-0.5 rounded-xl px-3 py-2.5","hover:bg-token-main-surface-secondary",x&&"bg-token-main-surface-secondary"),children:[o.jsxs("div",{className:"line-clamp-1 flex h-6 items-center gap-2 text-xs",children:[d&&o.jsx(d,{className:"icon-sm bg-token-main-surface-primary rounded-full object-cover"}),p]}),o.jsx("div",{className:"line-clamp-2 text-sm font-semibold break-words",children:t.name}),(t.text??t.lastModifiedTime)&&o.jsxs("div",{className:"text-token-text-secondary line-clamp-2 text-sm leading-snug font-normal",children:[t.lastModifiedTime&&o.jsxs("span",{children:[o.jsx(P,{date:new Date(t.lastModifiedTime)}),t.text&&" â€” "]}),t.text]}),f?null:o.jsx(z,{className:S("absolute end-2 top-2 flex h-7 w-7 items-center justify-center rounded-sm p-1 transition","text-token-text-secondary group-hover:text-token-text-primary","invisible group-hover:visible","bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary",x&&"bg-token-main-surface-tertiary text-token-text-primary visible"),clientThreadId:c,fileId:t.id,fileName:t.name,fileCloudDocUrl:t.cloud_doc_url,isFollowupMenuOpen:x,setIsFollowupMenuOpen:i,trackFileSourceFollowup:s})]})})}export{J as ChatScreenRetrievalResultsFlyoutContent,M as SourcesListGroup};
//# sourceMappingURL=ing0egv9pv9i6hio.js.map
