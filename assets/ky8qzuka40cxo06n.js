import{e as I,f as S,B as C,eW as D,a$ as V,a7 as _,dG as Y,g8 as G,ar as L,f0 as H,aG as q,j6 as U}from"./dc2xxjkicf2pz0mj.js";import{h as E,r as g,j as e,M as v,e as $,ah as Z}from"./juy90og0wtbp77qa.js";import{a2 as O,ja as M,jb as J,jc as K,jd as W,b$ as A,eF as Q,i2 as X,L as ee,bU as te}from"./ckp56qklot786ulr.js";import{u as se,A as ne,R as ae,N as oe,a as ie}from"./dbwyrqqzg9g7f2ct.js";import{h as re}from"./jla4ypiufxg3g5ib.js";import{F as R}from"./g9y1jm4dp5lewf3d.js";import{C as B}from"./euro055hg704dfil.js";import{b as le}from"./lptwpbjabrvjmhsj.js";import{u as ce}from"./fqrjovuqgfjtn2di.js";import{u as de}from"./na95db8kfrfbx9l9.js";import{T as me}from"./l3xu29fndg9f5mv3.js";import{W as xe}from"./fwb02vgq072qdb93.js";import"./fkdark0ezkwwm12s.js";import"./hibpneehm1q4hc2e.js";import"./iacposgqe14fuloa.js";import"./o6wb3ptvu0bk81yq.js";import"./dmfmxszxfbs8gsbx.js";import"./o7zrzew6ugefv8n2.js";import"./abebcwj1m9mup3z6.js";import"./nqj34k5dky4x5suq.js";import"./hort3ndd4wla0a2j.js";import"./jsgl3b1bt1ozctr5.js";import"./ck00y48d3yzt8bq3.js";import"./hczymk9ojq2shlcf.js";import"./dta0gs41e2vxh1q9.js";import"./g8shiwm7jpd74xmd.js";import"./btouzu0b6h5eiejj.js";import"./hisrfv493df9w8hp.js";import"./iiyyoj0wgh5vo89i.js";import"./mwysfro98kbgaaol.js";import"./o46eutw3gegbydjq.js";import"./jbze7lwlszm657iq.js";import"./h0zoartyn6ddtvom.js";function ue({handleGoBack:s,handleSelectEnvironment:n,goToNextPage:o,lockPageView:l}){const r=E();return g.useEffect(()=>{O.recordEnvironmentsView()},[]),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(B,{title:r.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment",defaultMessage:"Create your starting environment"}),description:r.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment.description",defaultMessage:"Pick a repo to set up the basics. You can customize your environment later."})}),e.jsx(T,{handleGoBack:s,handleSelectEnvironment:n,goToNextPage:o,lockPageView:l})]})}function T({handleGoBack:s,handleSelectEnvironment:n,goToNextPage:o,lockPageView:l,shouldDisableRow:r,disablePill:f}){const m=E(),x=I(),[c,b]=g.useState(""),[j,w]=g.useState(null),{mutate:k,isPending:d}=ce({onSuccess:t=>{O.recordCreateEnvSuccess(),n(t.id,M(t)),o()}}),{data:h,isLoading:p}=J(),u=S(x,"2134057841"),i=de({defaultValues:{repositoryId:"",agentNetworkAccess:u?{mode:"off"}:null},validators:{onSubmit:({value:t})=>{const y={};return(!t.repositoryId||t.repositoryId==="")&&(y.repositoryId=m.formatMessage({id:"wham.codexOnboardingEnvironments.repositoryIsRequired",defaultMessage:"Repository is required"})),u&&t.agentNetworkAccess?.mode==="on"&&t.agentNetworkAccess.preset_allowlist===le&&(!t.agentNetworkAccess.allowlist_domains||t.agentNetworkAccess.allowlist_domains.length===0)&&(y.agentNetworkAccess=m.formatMessage({id:"wham.environmentsForm.agentNetworkAccessAllowlistRequired",defaultMessage:"At least one domain is required"})),{fields:y}}},onSubmit:({value:t})=>{O.recordEnvironmentsSubmit(),l(),k({...t,label:c,description:"",machine:"wham-public/wham-universal",workspaceDirectory:"/workspace",share_settings:"workspace",setupCommands:"",envVars:[],secrets:[]})}}),P=t=>{t.preventDefault(),t.stopPropagation(),i.handleSubmit()};g.useEffect(()=>{p||h?.installations.length===0&&re()},[p,h,x]);const F=se();return e.jsx("form",{onSubmit:P,className:"flex flex-col gap-6",children:e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(ne,{selectedInstallationId:j,setSelectedInstallationId:w}),e.jsx(i.Field,{name:"repositoryId",children:t=>e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(ae,{installationId:j,selectedRepository:t.state.value,onSelect:(y,z)=>{t.handleChange(y),b(z)},shouldDisableRow:r,disablePill:f}),e.jsx(R,{field:t})]})}),u&&e.jsx(i.Field,{name:"agentNetworkAccess",children:t=>e.jsxs("div",{className:"flex flex-col gap-4",children:[F!=null&&e.jsx(oe,{disabledByWorkspaceSettings:F,agentNetworkAccess:t.state.value,onChange:t.handleChange}),e.jsx(R,{field:t}),t.state.value?.mode==="on"&&e.jsx(ie,{})]})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(C,{color:"secondary",size:"medium",type:"button",onClick:s,children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.back",defaultMessage:"Back"})}),e.jsx(i.Subscribe,{selector:t=>t.values,children:t=>e.jsx(C,{color:"primary",size:"medium",loading:d,disabled:!c||u&&!t.agentNetworkAccess,onClick:()=>i.handleSubmit(),children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.createEnvironment",defaultMessage:"Create environment"})})})]})]})})}function ge({selectedTab:s,onChange:n}){const o=E(),l=I(),r=S(l,"2665240312"),f=g.useCallback(m=>{n(m)},[n]);return e.jsx("div",{className:"border-token-border-primary flex w-full items-center border-b align-middle",children:r&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(me,{currentTab:s,onChange:f,withUnderline:!0,tabs:[{label:o.formatMessage({id:"wham.selectEnvironmentHeader.create",defaultMessage:"Existing environments"}),key:"select"},{label:o.formatMessage({id:"wham.selectEnvironmentHeader.select",defaultMessage:"New environment"}),key:"create"}]})})})}function fe({environment:s,isSelected:n,className:o}){return e.jsxs("div",{className:L("flex items-center justify-between gap-2",o),children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-start text-sm font-medium",children:s.label}),s.creator.email&&e.jsx("p",{className:"text-token-text-tertiary text-start text-xs leading-tight font-normal",children:e.jsx(v,{id:"wham.createEnvironments.environmentSection.createdBy",defaultMessage:"{email}",values:{email:s.creator.name}})})]}),e.jsx("div",{className:"text-token-text-secondary text-start text-sm leading-tight font-normal",children:s.description})]}),n?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(H,{className:"h-5 w-5"})}):e.jsx("div",{className:"w-4"})]})}function he({environment:s,isSelected:n,onClick:o}){return e.jsx("button",{className:L("group flex w-full items-center justify-between gap-2 py-4","hover:bg-token-bg-tertiary cursor-pointer p-2"),onClick:o,type:"button",children:e.jsx(fe,{environment:s,isSelected:n,className:"w-full"})})}function N(){return e.jsx("div",{className:"flex w-full items-center justify-between gap-2 rounded-md",children:e.jsx(ee,{className:"h-14 w-full"})})}const pe=10;function ve({handleGoBack:s,handleSelectEnvironment:n,goToNextPage:o}){const l=E(),[r,f]=g.useState(""),m=I(),x=S(m,"2673860158"),{data:c,isLoading:b,fetchNextPage:j,hasNextPage:w,isFetchingNextPage:k}=W({pageSize:pe,enforceRepoAccess:x}),d=g.useMemo(()=>c?.pages.flatMap(a=>a.items??[])??[],[c]),h=d.filter(a=>a.label.toLowerCase().includes(r.toLowerCase())),p=A(a=>a.environmentId),u=A(a=>a.setEnvironmentId);return g.useEffect(()=>{if(p){const a=d.find(i=>i.id===p);a?n(a.id,M(a)):u(null)}else d.length===1&&(u(d[0].id),n(d[0].id,M(d[0])))},[p,d,n,u]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between",children:e.jsx(D,{color:"search",iconPosition:"left",icon:Q,className:"text-token-text-tertiary flex h-10 w-full items-center rounded-lg! p-3!",inputClassName:"text-token-text-primary w-full",containerInputClassName:"w-full",name:"search-envs",type:"text",value:r,onChange:a=>f(a.target.value),placeholder:l.formatMessage({id:"wham.environmentSection.searchPlaceholder",defaultMessage:"Search"}),ariaLabel:l.formatMessage({id:"wham.environmentSection.searchAria",defaultMessage:"Search"})})}),e.jsx("div",{className:"border-token-border-heavy flex flex-col gap-2 rounded-lg border p-2",children:e.jsx("div",{className:"flex h-96 flex-col overflow-y-auto",children:b?e.jsxs("div",{className:"flex h-full flex-col gap-2",children:[e.jsx(N,{}),e.jsx(N,{}),e.jsx(N,{}),e.jsx(N,{}),e.jsx(N,{}),e.jsx(N,{}),e.jsx(N,{})]}):e.jsxs(e.Fragment,{children:[h.length===0&&!w?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.noEnvironments",defaultMessage:"No environments found"})}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.noEnvironmentsDescription",defaultMessage:"You will be able to create more environments in settings later"})})]}):h.map((a,i)=>e.jsxs("div",{children:[e.jsx(he,{environment:a,isSelected:p===a.id,onClick:()=>n(a.id,M(a))}),i!==h.length-1&&e.jsx("div",{className:"border-token-border-light border-t"})]},a.id)),e.jsx(X,{isFetchingNextPage:k,hasNextPage:w??!1,fetchNextPage:j,bgColor:"dark:bg-token-bg-secondary"})]})})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(C,{color:"secondary",size:"medium",type:"button",onClick:s,children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.back",defaultMessage:"Back"})}),e.jsx(C,{color:"primary",size:"medium",disabled:!p,onClick:o,children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.useEnvironment",defaultMessage:"Use environment"})})]})]})}function be(){const s=E(),n=V(),r=_()?.name??s.formatMessage({id:"wham.codexOnboardingEnvironments.workspaceName",defaultMessage:"Workspace"});return e.jsx(Y,{label:s.formatMessage({id:"wham.codexOnboardingEnvironments.environmentExistsTooltip",defaultMessage:"An environment has already been created for {workspaceName}. You’ll be able to create a new environment later for this repo in settings."},{workspaceName:r}),children:e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-tertiary inline-flex items-center justify-center gap-1 rounded-3xl py-1.5 ps-1.5 pe-1.5",children:[e.jsx(G,{className:"icon-sm"}),!n&&e.jsx("div",{className:"justify-start pe-1 text-xs leading-3 font-medium",children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.environmentExists",defaultMessage:"Environment already exists"})})]})})}function je({handleGoBack:s,handleSelectEnvironment:n,goToNextPage:o}){const l=E(),[r,f]=g.useState("select"),{data:m}=K(),x=c=>m?.some(b=>b.repos.includes(c.id))??!1;return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(B,{title:l.formatMessage({id:"wham.codexOnboardingEnvironments.selectEnvironment",defaultMessage:"Select an environment"}),description:l.formatMessage({id:"wham.codexOnboardingEnvironments.selectEnvironment.description",defaultMessage:"Environments configure the container for the agent to run. Not seeing your repo? You can create new environments in settings later."})}),e.jsx("div",{className:"pb-4",children:e.jsx(ge,{selectedTab:r,onChange:c=>{f(c)}})}),r==="select"?e.jsx(ve,{handleGoBack:s,handleSelectEnvironment:n,goToNextPage:o}):e.jsx(T,{lockPageView:()=>{},handleGoBack:s,handleSelectEnvironment:n,goToNextPage:o,shouldDisableRow:x,disablePill:e.jsx(be,{})})]})}function we(){return e.jsx("div",{className:"mx-auto flex h-full max-w-4xl flex-col p-8 md:p-24",children:e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-2",children:[e.jsx(v,{id:"wham.codexOnboardingEnvironments.loading",defaultMessage:"Almost there…"}),e.jsx(q,{})]})})}function Ne(){const{eligible:s,isLoading:n}=te(),o=I(),l=S(o,"2673860158"),r=S(o,"2395384117"),{data:f,isLoading:m}=W({pageSize:1,enforceRepoAccess:l}),x=$(),[c,b]=g.useState(!1),j=()=>{x("/codex/onboarding/connections")},w=()=>{x(r?"/codex/onboarding/starter-tasks":"/codex/onboarding/data-check")},k=A(i=>i.setEnvironmentId),d=A(i=>i.setBranch),h=(i,P)=>{k(i),d(P)},u=(f?.pages.flatMap(i=>i.items).length??0)>0;if(n||m)return e.jsx(we,{});if(!s)return e.jsx(Z,{to:"/codex"});const a=!c&&u&&!0;return e.jsx(xe,{showSidebar:!1,canShowAlert:!1,hideExtraHeaderInfo:!0,children:e.jsx("div",{className:"mx-auto flex max-w-3xl flex-col gap-2 p-12",children:a?e.jsx(je,{handleGoBack:j,handleSelectEnvironment:h,goToNextPage:w}):e.jsx(ue,{handleGoBack:j,handleSelectEnvironment:h,goToNextPage:w,lockPageView:()=>b(!0)})})})}const st=()=>[{title:"Codex"}],nt=U(function(){return e.jsx(Ne,{})});export{nt as default,st as meta};
//# sourceMappingURL=ky8qzuka40cxo06n.js.map
