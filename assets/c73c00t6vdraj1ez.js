const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/orl5qr6pdfh8qbcx.js","assets/juy90og0wtbp77qa.js","assets/ckp56qklot786ulr.js","assets/dc2xxjkicf2pz0mj.js","assets/root-fv49dn40.css","assets/conversation-small-j9iamy23.css","assets/du2o33bqvziie5hn.js","assets/jy1u8exw8iz2slve.js","assets/l7m4sdxmp3n9y1x8.js","assets/9k8yv4dhh02fqujo.js","assets/f5uxfkqdhg7743lt.js","assets/e2fyqefjfccaah4p.js","assets/hz1pk536k4y9lgd9.js","assets/mohn9bb09oz621dz.js","assets/h52yy5f95o7r9b4p.js","assets/l7ivca7g8ik3mk13.js","assets/f76gy0b8ieo4s693.js","assets/gy64pge8qevmvg7e.js","assets/mia7txooqhkpbw7w.js","assets/dmfmxszxfbs8gsbx.js","assets/gr34ca5bfgzamfz1.js","assets/nmh9rh1es9yfc7rh.js","assets/gn1kkezdsm9hi3t4.js","assets/m1q7suu3m36z180t.js","assets/koc3vass6n6349vp.js","assets/ejiu40t686c7js51.js","assets/n6h2c0196v3vnzav.js","assets/pbd6thieshvvjfa0.js","assets/nc631yunytu8n0fx.js","assets/kd37t55r0pqrdrzh.js","assets/f5x7owcyj5iwmbsb.js","assets/llrie03z1kvfi4vu.js","assets/o6wb3ptvu0bk81yq.js","assets/jsgl3b1bt1ozctr5.js","assets/pc2givv05uuq8g6l.js","assets/dq2hdjj12gdqq0p1.js","assets/ezqsz68yx4uzdtqb.js","assets/mre9dehcylnm0d4q.js","assets/ck00y48d3yzt8bq3.js","assets/cwcmrfhs9uzogy8q.js","assets/mq5kqcvga15eqze5.js","assets/bk8slwxjkdlmxjxm.js","assets/lzfgwrifvgqibt3v.js","assets/m36qabefvxegdn1g.js","assets/g8shiwm7jpd74xmd.js","assets/btouzu0b6h5eiejj.js","assets/iacposgqe14fuloa.js","assets/o7zrzew6ugefv8n2.js","assets/abebcwj1m9mup3z6.js","assets/nqj34k5dky4x5suq.js","assets/hort3ndd4wla0a2j.js","assets/hczymk9ojq2shlcf.js","assets/hisrfv493df9w8hp.js","assets/iiyyoj0wgh5vo89i.js","assets/fj1zlpb3ugj147t8.js","assets/btagl6w1gub4aw61.js","assets/o6k40xfr6c7g0stx.js","assets/hb0ai1ylx8l5gu8u.js","assets/mzkxlhrlmxhntkvn.js","assets/ol0j0ogvgt70u6w3.js","assets/clbhua3y9f3awxpf.js","assets/gxo2ppc4wrdtmw6p.js","assets/cpgn1czk8eq48vzk.js","assets/cir7oqlbi88or9cr.js","assets/d034xbm9q6zngtej.js","assets/debx62351e4myexq.js","assets/msbqa8wiqwcgiook.js","assets/icu9d2zdwlcy45kn.js"])))=>i.map(i=>d[i]);
import{hX as re,dS as We,b2 as le,b3 as me,q as De,F as He,D as Re,bJ as it,dg as at,aT as nt,$ as ae,b4 as ot,n as rt,hw as lt,fa as D,hp as $e,gS as vs,cd as ct,lW as js,au as ys,dW as Ve,lL as Ms,ad as Le,bA as qe,ce as dt,f_ as ut,bX as mt,bW as gt,bD as pt,eb as ft,e as ne,ag as oe,dN as W,bk as bs,f as J,C as Qe,B as ve,dG as Ke,f0 as ht,aC as Ye,ar as ce,hJ as Xe,aF as te,en as xt,a7 as vt,cF as jt,kK as ws,kM as yt,kL as Ps,eH as Mt,kN as bt,ap as Ue,kO as wt,ao as Ts,aG as Ze,lM as Pt,lN as _e,lO as Ce,P as ks,an as Tt,a5 as Je,bl as je,e$ as kt,al as St,d as _t,g8 as Ct,eV as Ss,as as _s,at as Cs,ed as Nt,e9 as ye,aS as It,ek as Ns,eR as Gt,bT as At,L as ns,b as os,iR as zt,cJ as Rt,cK as Lt,j6 as Ut,k1 as Et,af as rs,k2 as Ft}from"./dc2xxjkicf2pz0mj.js";import{R as Is,r as d,j as e,h as V,u as Gs,f as de,M as c,e as ge,ak as Ot,A as Bt,m as As,P as Wt,p as Dt}from"./juy90og0wtbp77qa.js";import{a4 as zs,ni as Rs,b as Ls,a0 as we,a1 as Us,l5 as es,e0 as Ht,e8 as $t,dS as Vt,bu as qt,dQ as Ee,aC as G,dT as Pe,dU as $,aS as Es,e2 as ss,eb as Me,dZ as be,p6 as Qt,hN as Fs,jg as Os,p7 as Kt,fd as Yt,oe as Xt,e9 as Bs,l4 as Zt,ld as Jt,N as Ws,aF as ei,a6 as si,jm as ie,p8 as Fe,dV as ti,e3 as ii,e4 as ai,p9 as ni,dN as oi,M as ri,pa as ls,f5 as cs,pb as Ds,pc as li,ef as Hs,o2 as $s,jn as Q,jo as K,jp as Ne,pd as ci,pe as di,jq as ui,k8 as mi,nk as gi,pf as pi,eg as fi,js as hi,oG as xi,pg as ds,ph as vi,T as ji,h_ as yi,pi as Mi,j4 as bi,bA as wi,U as us,he as Pi,jr as Ti,pj as ki,e as Si,l3 as _i,lq as ms,ak as Ci,pk as Ni,pl as Ii,d as Gi,pm as Ai,pn as gs,po as ps,pp as zi,r as Ri,ie as Li,ig as Ui,dL as Ei}from"./ckp56qklot786ulr.js";import{G as Fi,A as ue,M as Vs,a as Oi,b as fs,s as Bi,S as Wi,c as Di,g as Hi,d as $i}from"./ol0j0ogvgt70u6w3.js";import{M as qs}from"./clbhua3y9f3awxpf.js";import{u as Qs}from"./dmfmxszxfbs8gsbx.js";import{i as Oe}from"./d034xbm9q6zngtej.js";import{S as Vi}from"./mq5kqcvga15eqze5.js";import{G as qi}from"./debx62351e4myexq.js";import{u as Ks}from"./hczymk9ojq2shlcf.js";import{h as Qi}from"./iacposgqe14fuloa.js";import{a as Ki,G as Yi}from"./msbqa8wiqwcgiook.js";import{b as Xi}from"./icu9d2zdwlcy45kn.js";import{T as Zi}from"./hisrfv493df9w8hp.js";import{d as Ji,g as ea}from"./btouzu0b6h5eiejj.js";function sa(s,t){const i=me(s),a=le.getTree(i),n=[];let o=le.getCurrentNode(i);for(;o!=null&&(t==null||o.id!==t);)n.unshift(o.message),o=o.parentId!==""?a.getNodeByIdOrMessageId(o.parentId):void 0;return n}function ta(s){return s.filter(a=>a.recipient==="gizmo_editor.update_behavior").flatMap(a=>a.content.content_type==="text"?a.content.parts:a.content.content_type==="code"?[a.content.text]:[]).map(a=>JSON.parse(a)).reduce((a,n)=>({...a,...n}),{})}async function ia(s){let t;for(const i of s)if(i.author.name==="gizmo_editor.generate_profile_pic"){const a=ot.getImageAssetPointers(i);a.length>0&&(t=a.at(-1))}if(t!=null){const i=rt(t.asset_pointer),a=await De(i);if(a.status===He.Success)return{id:i,permalink:a.download_url}}}async function aa(s,t,i,a){const n=sa(t,a),o=ta(n);let r=await ia(n);if(Oe(o)&&r==null)return;const{name:u,context:m,description:p,profile_pic_file_id:h,prompt_starters:l}=o;if(h!=null)try{const f=await De(h,s.id);f.status===He.Success&&(r={id:h,permalink:f.download_url})}catch(f){Re.addError(new Error("Error while retrieving profile pic in update",{cause:f})),i.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const y={name:typeof u=="string"?u:void 0,description:typeof p=="string"?p:void 0,instructions:typeof m=="string"?m:void 0,promptStarters:Array.isArray(l)?l:void 0,profilePictureId:r?.id,profilePictureUrl:r?.permalink};return it(y,f=>f!=null)}function na(s){const t=new Set;for(const m of s.tools)t.add(m.type);const i=s.name??"",a=s.description??"",n=s.instructions??"",o=Array.from(t).join(","),r=i===""&&a===""&&n==="",u=s.profilePictureUrl!=null;return r?`The GPT you are about to has the following abilities: ${o}.`:`This is the GPT's current set of fields:

name: ${i}

description: ${a}

context: ${n}

abilities: ${o}

${u?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}const oa=10;function Ys(s,t){const i=s.current,a=t.current;if(We(i,a))return;const n={};i.name!==a?.name&&(n.name=i.name),(i.description??"")!==(a?.description??"")&&(n.description=i.description??""),i.instructions!==(a?.instructions??"")&&(n.context=i.instructions??"");const o=new Set(a?.files?.map(h=>h.file_id)??[]),r=new Set(i.files?.map(h=>h.file_id)??[]),u=(i.files??[]).filter(h=>!o.has(h.file_id)),m=(a?.files??[]).filter(h=>!r.has(h.file_id));if(Oe(n)&&u.length===0&&m.length===0)return;const p=[];if(!Oe(n)){const h=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(n,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;p.push(re(h))}if(m.length>0&&p.push(re(`The user has removed the following files from the GPT. You can no longer reference these files: ${m.map(h=>h.file_id).join(", ")}`)),u.length>0){const h=u.slice(0,oa);p.push(re(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${h.map(l=>l.file_id).join(", ")}`,{attachments:h.map(l=>({id:l.file_id,name:l.name,size:l.size}))}))}return p}function ra(s){if(s.length===0)return;const t=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${s.map(i=>`"${i.fileId}"`).join(", ")}`;return[re(t)]}function la(s){const t="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.";if(!le.findNode(me(s),a=>a.message.content.content_type==="text"&&a.message.content.parts[0]===t))return[re(t)]}function ca(s,t){const{session:i}=at();nt.initThread({clientThreadId:s,conversationMode:{kind:ae.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:t},userId:i?.user?.id,accountId:i?.account?.id});const a=Qs(s);return async(o,r,u,m)=>{a({sourceEvent:o,promptMessage:re(m),prependMessages:Ys(r,u),completionMetadata:{conversationMode:{kind:ae.GizmoMagicCreate,gizmo_id:r.current.id,behavior_overrides:t}}})}}const da="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.";function ua(s,t){d.useEffect(()=>{le.findNode(me(s),a=>ut(a.message)||a.message.author.role===mt.System&&a.message.content.content_type===gt.Text)||qe(s,a=>{pt.updateTree(a,(n,o)=>{const r=n.findNode(u=>u.message.clientMetadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0,o);return r&&(r.id===o&&(o=n.rootId),n.deleteNode(r.id)),t?n.addMessageNode(o,ft(t,void 0,{isPlaceholderTemplateAssistantWelcomeMessage:!0})):o})})},[s,t])}function ma(s,t,i){const{data:a}=Ve(),n=a?.models.get(Ms)??(a&&Rs(a.models.values(),r=>r.tags.includes(Le.GPT_4o)));Ls(s,{kind:ae.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:i},{forcedModelId:n?.id}),d.useEffect(()=>{qe(s,r=>{r.mode={kind:ae.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:dt(i)},r.modelId=n?.id??r.modelId})},[s,t.id,i,n,a]);const[o]=d.useState(()=>{const r=t.id==null,u=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return r?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:u?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});ua(s,o)}function ga({gizmoEditorData:s,updateGizmo:t,clientThreadId:i,gizmoEditorDataRef:a,magicMakerBehaviorOverrides:n,magicMakerConversationGizmoEditorDataRef:o,requireGizmoId:r}){const u=d.useRef(r);u.current=r;const m=d.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:n,getGizmoId:u.current}),[s,n]),p=lt(l=>l.files.filter(y=>y.status===D.Ready&&y.gizmoId!=null)),h=d.useCallback(l=>{if(t(y=>({...y,files:[...y.files??[],...$e(p.map(f=>f.fileId!=null&&{file_id:f.fileId,name:f.file.name,size:f.file.size,type:vs(f.file),last_modified:f.file.lastModified,file_size_tokens:f.fileSpec?.fileTokenSize}))]})),o.current=zs(a.current),!l.completionType||l.completionType===ct.Next){const y=le.getCurrentNode(me(i)),f=y.message.clientMetadata?.isPlaceholderTemplateAssistantWelcomeMessage?y.message:void 0;f&&(l.existingMessages=[f]),l.prependMessages=[...ra(p)??[],...Ys(a,o)??[],...la(i)??[],...l.prependMessages??[]]}return l},[i,p,a,o,t]);return e.jsx(js.Provider,{value:m,children:e.jsx("div",{className:"relative flex h-full grow overflow-auto",children:e.jsx("div",{className:"grow",children:e.jsx(ys,{clientThreadId:i,children:e.jsx(qs,{clientThreadId:i,getGizmosCompletionParams:h,hideHeader:!0})})})})})}const pa=Is.memo(ga);function fa({gizmo:s,updateGizmo:t,publishedGizmo:i,promoteGizmo:a,appealGizmo:n,setAppealState:o,showActionsModal:r,shareOnly:u,onClose:m}){const[p,h]=d.useState({type:"privacy"});return p.type==="privacy"?e.jsx(xa,{gizmo:s,updateGizmo:t,publishedGizmo:i,promoteGizmo:a,appealGizmo:n,setAppealState:o,setStep:h,showActionsModal:r,shareOnly:u,onClose:m}):e.jsx(va,{publishedGizmo:p.publishedGizmo,onClose:m})}function ha(s){return s?G.Workspace:G.Link}function xa({gizmo:s,publishedGizmo:t,updateGizmo:i,promoteGizmo:a,appealGizmo:n,setAppealState:o,setStep:r,showActionsModal:u,shareOnly:m,onClose:p}){const h=ne(),[l,y]=d.useState(!1),f=we(Us.isBusinessWorkspace),x=V(),P=oe(),[M,_]=d.useState(es(s)?ha(!!f):s.sharingRecipient),C=Gs(),w=Ht(M,s.sharingTargets),{data:I,isLoading:R}=$t(),b=Vt(),[T,A]=d.useState(t!=null&&t.gizmo.display.categories.length>0?b.data?.categories.find(j=>j.id===t.gizmo.display.categories[0])?.id:void 0);d.useEffect(()=>{A(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[g,S]=d.useState(void 0),U=d.useRef(qt((j,B)=>Ee.generateCategory(j,B),1e3)),z=I?.is_verified?void 0:x.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});M===G.Marketplace&&z!=null&&!R&&_(G.Link);const E=f&&!s.sharingTargets?.some(j=>j.recipient===G.Link),O=Pe(s,M,T),F=O.includes($.MissingPublicActionPrivacyPolicyURL),pe=s.tools.find(j=>j.type===W.JIT_PLUGIN&&!j.metadata.privacy_policy_url),fe=we(j=>j.currentWorkspace),X=bs();d.useEffect(()=>{let j=!0;return(async()=>{try{if(T!=null)return;const B=await U.current(s.name,s.instructions);j&&T==null&&(B?A(B.id):S(!0))}catch{j&&T==null&&S(!0)}})(),()=>{j=!1}},[s.instructions,s.name,X,T]);const q=J(h,"4226692983");return e.jsx(Qe,{testId:"modal-simple-share-gizmo",type:"success",isOpen:!0,onClose:p,title:e.jsx(c,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:w?e.jsx(ve,{color:"primary",disabled:O.length>0,loading:l,onClick:async()=>{try{if(y(!0),m){if(!t?.gizmo.id){P.danger(x.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}),{toastId:"simple_share_gizmo_modal",loggingTitle:"Error sharing GPT",loggingDescription:"Error message when GPT ID is missing (shouldn't happen)"});return}const j=await Ee.shareGizmo(t.gizmo.id,T?{sharing:Me(M,[],be),categories:[T]}:{sharing:Me(M,[],be)});j.error?(P.warning(x.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),i({sharingTargets:j.sharing_targets}),o({gizmoId:t.gizmo.id,sharingRecipient:M,categories:t.gizmo.display.categories,moderationType:Vs.PublishBlocked,sharingTargets:j.sharing_targets,showModal:ue.AppealAvailable})):(C.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],B=>j.resource),i(B=>({...B,sharingRecipient:M})),P.success(x.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),p())}else{const j=await a({recipient:M,subjects:Me(M,[],be)},T);j?(r({type:"published",publishedGizmo:j}),i(B=>({...B,id:j.gizmo.id,sharingRecipient:M})),j.gizmo.live_version!=null&&i({liveVersion:j.gizmo.live_version}),P.success(x.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(P.warning(x.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),p())}}finally{y(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(c,{id:"SW4DG4",defaultMessage:"Save"})}):q?e.jsx(e.Fragment,{children:e.jsx(ve,{color:"primary",onClick:async()=>{await n(M,T)},children:e.jsx(c,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(ve,{color:"secondary",onClick:j=>ss(h,t,P,j,x.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(c,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(Es,{value:M,onValueChange:j=>_(j),children:[s.sharingTargets&&s.sharingTargets.map((j,B)=>e.jsx(Ie,{value:j.recipient,disabled:j.recipient===G.Marketplace&&z!=null,tooltipText:j.recipient===G.Marketplace?z??x.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:j.recipient},B)),E&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{value:G.Link,disabled:!0,tooltipText:x.formatMessage(hs.workspaceDisabledHint),shareLevel:G.Link,workspaceName:fe?.name}),e.jsx(Ie,{value:G.Link,disabled:!0,tooltipText:x.formatMessage(hs.workspaceDisabledHint),shareLevel:G.Marketplace,workspaceName:fe?.name})]})]})}),F&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(c,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:j=>e.jsx("button",{onClick:()=>{u(pe?.metadata.action_id)},className:"underline",children:j})}})}),M!==G.Private&&e.jsx(Fi,{gizmo:s,category:T,categories:M===G.Marketplace?b.data?.categories??[]:void 0,onCategoryChange:M===G.Marketplace?j=>A(j.id):void 0}),M===G.Marketplace&&(g?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(c,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!w&&q&&e.jsx("div",{className:"text-token-text-secondary flex items-center justify-between text-sm",children:e.jsx(c,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function va({publishedGizmo:s,onClose:t}){const i=ne(),a=Qt(i,s),n=V(),o=oe();return e.jsx(Qe,{testId:"modal-simple-share-published",type:"success",isOpen:!0,onClose:t,title:e.jsx(c,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(ve,{color:"primary",as:"link",to:a,children:e.jsx(c,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"bg-token-main-surface-secondary flex gap-1 rounded-sm px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 break-all text-ellipsis",children:a}),e.jsx("button",{onClick:r=>{ss(i,s,o,r,n.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary hover:text-token-text-primary transition","data-testid":"copy-saved-gpt-url-button",children:e.jsx(Fs,{className:"icon-sm"})})]})})})}const hs=de({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function Ie({shareLevel:s,workspaceName:t,value:i,disabled:a=!1,tooltipText:n}){const o=d.useId();return e.jsx(Ke,{disabled:n==null,label:n,side:"top",triggerAs:null,children:e.jsxs(Os,{id:o,value:i,disabled:a,className:"hover:bg-token-main-surface-secondary flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold",children:[e.jsx("label",{htmlFor:o,className:"flex cursor-pointer items-center gap-1",children:e.jsx(Oi,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(Kt,{children:e.jsx(ht,{className:"icon-lg me-1"})})]})})}function Be(s){return!!(s&&typeof s=="object"&&"gizmo"in s)}function Xs(s){window.history.length>1?s(-1):s(Xt())}function ja({gizmo:s,publishedGizmo:t,isUpsertLoading:i,isPromoteLoading:a,isUploadingProfilePic:n,isGeneratingProfilePic:o,updateGizmo:r,promoteGizmo:u,appealGizmo:m,setAppealState:p,showActionsModal:h}){const l=vt(),y=s!=null?Pe(s):[];(s==null||a||i)&&y.push($.Loading),n&&y.push($.UploadingProfilePic),o&&y.push($.GeneratingProfilePic);const f=es(s),[x,P]=d.useState(!1),[M,_]=d.useState(!1),C=s.sharingRecipient?fs[s.sharingRecipient]:fs.private,w=a||i;return e.jsxs(e.Fragment,{children:[f?e.jsx(ie,{color:"primary",onClick:()=>P("promote"),loading:y.length>0&&y.every(I=>[$.Loading,$.UploadingProfilePic,$.GeneratingProfilePic].includes(I)),disabled:w||s.id===void 0||y.length>0,tooltip:y.length>0?y.map(Fe).join(`
`):void 0,"data-testid":"gizmo-editor-create-gpt-button",children:e.jsx(c,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{color:"secondary",loading:a||!t,disabled:w,icon:C,onClick:()=>P("share"),children:e.jsx(c,{id:"aXKW4G",defaultMessage:"Share"})}),e.jsx(ie,{color:"primary",onClick:async()=>{let I=s.sharing.subjects.map(Bi);const R=ti(s.sharing.subjects);I=Me(s.sharing.recipient,I,R?.capabilities??be);const b=t&&Be(t)?t.gizmo.display.categories[0]:void 0;await u({recipient:s.sharing.recipient,subjects:I},b)&&_(!0)},loading:i||!t,disabled:w||y.length>0,tooltip:y.length>0?y.map(Fe).join(`
`):void 0,children:e.jsx(c,{id:"84QVoj",defaultMessage:"Update"})})]}),x&&(l?.getWorkspaceId()==null?e.jsx(fa,{gizmo:s,publishedGizmo:t,promoteGizmo:u,appealGizmo:m,setAppealState:p,showActionsModal:h,updateGizmo:r,shareOnly:x==="share",onClose:()=>P(!1)}):e.jsx(Wi,{gizmo:s,publishedGizmo:t,promoteGizmo:u,appealGizmo:m,setAppealState:p,showActionsModal:h,updateGizmo:r,onClose:()=>P(!1),shareOnly:x==="share"})),M&&t&&e.jsx(Di,{publishedGizmo:t,sharing:Be(t)?t.gizmo.sharing:void 0,onClose:()=>_(!1),workspaceName:l?.data.name??""})]})}function ya({gizmoEditorData:s,publishedGizmo:t,revertDraft:i}){const a=ne(),n=V(),o=oe(),r=ge(),[u,m]=d.useState(!1),p=J(a,"3645668434"),{canDelete:h}=Zt(t),{canCreate:l}=Jt();return!(t||i||s?.id&&p&&s.liveVersion>0||h)?null:e.jsxs(e.Fragment,{children:[e.jsxs(Xe,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(ie,{color:"ghost",icon:xt}),children:[t!=null&&e.jsxs(te.Item,{onClick:f=>{ss(a,t,o,f)},children:[e.jsx(Ws,{className:"icon-sm"}),e.jsx(c,{...Y.copyLink})]}),i!=null&&e.jsxs(te.Item,{onClick:()=>{window.confirm(n.formatMessage(Y.revertConfirm))&&i()},children:[e.jsx(ei,{className:"icon-sm"}),e.jsx(c,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&p&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(te.Item,{onClick:()=>{r(`/g/${s.id}/view`)},children:[e.jsx(Vi,{className:"icon-sm"}),e.jsx(c,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),l&&e.jsxs(te.Item,{onClick:async()=>{const f=await Ee.copyGizmo({gizmoId:s.id});f.gizmo.id&&r(`/gpts/editor/${f.gizmo.id}`)},children:[e.jsx(Fs,{className:"icon-sm"}),e.jsx(c,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),t&&Be(t)&&t.gizmo.current_user_permission?.can_delete&&e.jsxs(te.Item,{color:"danger",onClick:()=>{m(!0)},children:[e.jsx(si,{className:"icon-sm"}),e.jsx(c,{id:"tNrOLG",defaultMessage:"Delete GPT"})]})]}),u&&e.jsx(qi,{gizmoId:s?.id||"",onSuccess:()=>Xs(r),onClose:()=>{m(!1)}})]})}const xe=Ye.div`flex items-center gap-1`;function Ma({gizmoEditorData:s}){const t=we(i=>i.currentWorkspace?.name);switch(s.sharingRecipient){case G.Private:return e.jsxs(xe,{children:[e.jsx(jt,{className:"icon-xs"}),e.jsx(c,{...Y.onlyMe})]});case G.Link:return e.jsxs(xe,{children:[e.jsx(Ws,{className:"icon-xs"}),e.jsx(c,{...Y.anyoneWithLink})]});case G.Workspace:return e.jsxs(xe,{children:[e.jsx(ai,{className:"icon-xs"}),t]});case G.Marketplace:return e.jsxs(xe,{children:[e.jsx(ii,{className:"icon-xs"}),e.jsx(c,{...Y.public})]});default:return e.jsx("div",{})}}function ba({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Bs,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"border-token-border-medium h-8 w-8 rounded-full border-2 border-dashed"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(c,{...Y.newGPT})}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:es(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"bg-token-text-tertiary h-1.5 w-1.5 rounded-full"}),e.jsx(c,{...Y.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"bg-brand-green h-1.5 w-1.5 rounded-full"}),s.sharingRecipient===G.Marketplace?e.jsx(c,{...Y.published}):e.jsx(c,{id:"gizmoEditorHeader.live",defaultMessage:"Live"}),e.jsx(c,{...Y.dotSeparator,tagName:"span"}),e.jsx(Ma,{gizmoEditorData:s})]})})]})]})}const wa=Ye.div`
  cursor-pointer
  border-b
  pb-[1px]
  pt-[2px]
  text-sm
  text-token-text-secondary
  hover:border-token-border-xheavy
  hover:text-token-text-primary
  mx-2
`;function Pa({gizmoEditorData:s,isUpsertLoading:t,isPromoteLoading:i,isUploadingProfilePic:a,isGeneratingProfilePic:n,publishedGizmo:o,updateGizmo:r,promoteGizmo:u,appealGizmo:m,setAppealState:p,revertDraft:h,draftMessage:l,className:y,hasUnpublishedChanges:f,showActionsModal:x}){const P=ge();return e.jsxs("div",{className:ce("border-token-border-medium relative flex h-14 w-full items-center justify-between gap-2 border-b px-3",y),children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("a",{className:"text-token-text-primary cursor-pointer",onClick:()=>Xs(P),children:e.jsx(Yt,{className:"icon"})}),e.jsx(ba,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&(o?.gizmo?.live_version??0)>1&&e.jsx(wa,{onClick:()=>P(`/g/${s.id}/view`),children:e.jsx(c,{id:"P0Ri/k",defaultMessage:"Last edited {date}",values:{date:e.jsx(Ot,{value:o.gizmo.updated_at,day:"numeric",month:"short",year:new Date(o.gizmo.updated_at).getFullYear()===new Date().getFullYear()?void 0:"numeric"})}})}),l,e.jsx(ya,{gizmoEditorData:s,publishedGizmo:o,revertDraft:h}),e.jsx(ja,{gizmo:s,publishedGizmo:o,isUpsertLoading:t,isPromoteLoading:i,isUploadingProfilePic:a,isGeneratingProfilePic:n,updateGizmo:r,promoteGizmo:u,appealGizmo:m,setAppealState:p,hasUnpublishedChanges:f,showActionsModal:x})]})]})}const Y=de({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"},dotSeparator:{id:"gizmo.dotSeparator",defaultMessage:"·"}}),Ta=512;function ka(){return e.jsx("div",{className:"border-token-border-medium relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed",children:e.jsx(Ze,{className:"h-1/4 w-1/4"})})}function Sa({gizmoEditorData:s,onFileChange:t,generateProfilePic:i,isGeneratingProfilePic:a,setIsGeneratingProfilePic:n}){const o=V(),r=oe(),[u,m]=d.useState(void 0),p=d.useRef(t);d.useEffect(()=>{p.current=t});async function h(f){if(f.length>0){n(!1);const x=await bt(f[0],Ta),P=Ue(x);m({tempId:P,file:x,status:D.Uploading,progress:1,fileId:null,cdnUrl:null}),p.current("uploading"),wt(P,x,o,r,Ts.ProfilePicture,{onFileCreated(M,_,C){m(w=>w!=="initial"&&w?.tempId===M&&w.status===D.Uploading?{...w,progress:10,fileId:_,cdnUrl:C}:w)},onFileUploadProgress(M,_){m(C=>C!=="initial"&&C?.tempId===M&&C.status===D.Uploading?{...C,progress:_}:C)},onFileUploaded(M,_,C){m(w=>w!=="initial"&&w?.tempId===M?(p.current(w),{...w,status:D.Ready,progress:100,fileSpec:{name:w.file.name,id:w.fileId,size:w.file.size,...C??{}}}):w)},onError(M){m(_=>{if(_!=="initial"&&_?.tempId===M){p.current(void 0);return}return _})}})}}const{open:l,getInputProps:y}=Ks({disabled:!1,noClick:!0,onDropAccepted:h,onDropRejected:f=>Qi(f,o,r,Mt.ProfilePicture),multiple:!0,maxSize:Ps,...ws(yt)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(Xe,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:a?e.jsx(ka,{}):u!=null&&u!="initial"&&u.status!=D.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(ni,{file:u.file}),u.status===D.Uploading&&u.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(oi,{percentage:u.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx(Bs,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed",children:e.jsx(ri,{className:"text-4xl"})})}),children:[e.jsx(te.Item,{onClick:l,children:e.jsx(c,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(te.Item,{onClick:i,children:e.jsx(c,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...y()})]})}function _a({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:i,updateGizmo:a}){const n=V(),o=oe(),[r,u]=d.useState(0),m=d.useRef(new Map),p=Pt(i,void 0),h=async b=>{ks.logEvent("Upload File",{client:"web",eventSource:"mouse",intent:"gizmo"});const T=await t();b.length>0&&await Promise.all(b.map(A=>{const g=Ue(A);m.current.set(g,{tempId:g,gizmoId:T,file:A,status:D.Uploading,progress:1,fileId:null,cdnUrl:null}),Tt(Ue(A),A,n,o,{kind:Ts.Gizmo,gizmoId:T},{onFileUploaded:(S,U,z,E)=>{const O=m.current.get(S);O==null||O.fileId==null||(a(F=>({...F,files:[...F.files??[],{file_id:O.fileId,name:O.file.name,size:O.file.size,type:E?.mimeType??vs(A),last_modified:O.file.lastModified,file_size_tokens:E?.fileTokenSize}]})),m.current.delete(S),u(F=>F+1))},onFileCreated:(S,U,z)=>{m.current.set(S,{tempId:S,gizmoId:T,file:A,status:D.Uploading,progress:1,...m.current.get(S),fileId:U,cdnUrl:z}),u(E=>E+1)},onFileUploadProgress:(S,U)=>{const z=m.current.get(S);z?.status===D.Uploading&&m.current.set(S,{...z,progress:U}),u(E=>E+1)},onError:S=>{m.current.delete(S)}},{usesRetrievalIndex:i!=null&&_e(i,A.type,A.name)===Ce.Retrieval})}))},{getInputProps:l,open:y}=Ks({disabled:!1,noClick:!0,onDropAccepted:h,multiple:!0,maxSize:Ps,maxFiles:10,...ws(p)}),f=s?.files??[];function x(b){return e.jsx(cs,{onRemoveFileClick:()=>{m.current.delete(b.tempId),u(T=>T+1)},file:b.file,loadingPercentage:b.status===D.Uploading?b.progress:void 0},b.tempId)}function P(b){return e.jsx(cs,{file:b.name,fileId:b.file_id,onRemoveFileClick:()=>a(T=>({...T,files:T?.files?.filter(A=>A.file_id!==b.file_id)})),gizmoId:s?.id},b.file_id)}const M=Array.from(m.current.values()).filter(b=>f.every(T=>T.file_id!==b.fileId)),[_,C]=ls(M,b=>i!=null&&_e(i,b.file.type,b.file.name)===Ce.CodeInterpreter),[w,I]=ls(f,b=>i!=null&&b.type!=null&&_e(i,b.type,b.name)===Ce.CodeInterpreter),R=d.useRef(w.length);return d.useEffect(()=>{w.length>R.current&&a(b=>b.tools?.some(T=>T.type===W.PYTHON)?b:{...b,tools:[...b.tools??[],{type:W.PYTHON}]}),R.current=w.length},[w.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-token-text-tertiary rounded-lg text-xs",children:e.jsx(c,{...Ca.knowledgeWarning})}),C.length>0||I.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[C.map(x),I.map(P)]}):null,_.length>0||w.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"text-token-text-tertiary mb-2 text-xs",children:e.jsx(c,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[_.map(x),w.map(P)]})]}):null,e.jsx("div",{children:e.jsxs(ie,{onClick:y,children:[e.jsx("input",{...l()}),e.jsx(c,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const Ca=de({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"Conversations with your GPT can potentially reveal part or all of the files uploaded."}});function Na({placeholder:s,text:t,onChange:i,onClose:a}){return e.jsxs(Qe,{testId:"modal-gizmo-editor-form",className:"max-h-[100vh]! max-w-[80vw]!",type:"success",isOpen:!0,onClose:a,primaryButton:e.jsx(ie,{onClick:a,children:e.jsx(c,{id:"FeFVdS",defaultMessage:"Close"})}),children:[e.jsx("textarea",{className:"bg-token-main-surface-primary h-[70vh] w-full resize-none rounded-lg dark:border-gray-700",value:t,onChange:n=>{i(n.target.value)},placeholder:s}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(c,{...Ds.instructionsWarning})})]})}const Ge=Ye.div`text-sm text-red-500`;function Ia({children:s,collapsed:t,initial:i}){return e.jsx(Bt,{initial:i,children:!t&&e.jsx(As.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function Ga({gizmo:s,onShowActionsEditor:t,isDisabled:i}){const a=V(),n=oe(),o=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((r,u)=>r.type!==W.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(hi,{isDisabled:i,actionTool:r,onShowActionsEditor:()=>t(r.metadata.domain)}),r.metadata.auth?.type==="oauth"&&e.jsx(xi,{label:a.formatMessage(L.callbackUrlLabel),value:`https://chat.openai.com/aip/${r.metadata.action_id}/oauth/callback`,onCopied:()=>{n.success("Copied to clipboard",{duration:3})}})]},u)),(s?.tools?.filter(r=>r.type===W.JIT_PLUGIN)??[]).length>=ds?e.jsx("div",{children:a.formatMessage(L.maxActionsReached,{number:ds})}):e.jsx(ie,{disabled:i,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(c,{...L.createActionLabel})})]});return i?e.jsx(Ke,{side:"top",label:a.formatMessage(L.disabledCustomActionsTooltip),children:o}):o}function Aa(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===W.JIT_PLUGIN)}function za({gizmoEditorData:s,updateGizmo:t,currentModelConfig:i,generateProfilePic:a,setIsUploadingProfilePic:n,isGeneratingProfilePic:o,setIsGeneratingProfilePic:r,requireGizmoId:u,onShowActionsEditor:m}){const p=s?.tools??[],[h,l]=d.useState(!1),[y,f]=d.useState(!0),x=s?.promptStarters??[],P=[...x,...x.length<li?[""]:[]],M=Pe(s),C=Je()?.isWorkspaceAccount(),w=Hs(je.WorkspaceGPTCustomActions),I=V(),{data:R}=Ve(),b=ne(),T=J(b,"1854238036");let A=["gpt-4o","o3","o4-mini","o3-pro","gpt-4-5","o4-mini-high","gpt-4-1","gpt-4-1-mini"];return $s(s?.tools??[])&&(A=["gpt-4o","gpt-4-1"]),e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(Q,{children:[e.jsx(Sa,{gizmoEditorData:s,generateProfilePic:a,isGeneratingProfilePic:o,setIsGeneratingProfilePic:r,onFileChange:async g=>{if(g!=null&&g!=="uploading"&&g.fileId!=null){const S=await De(g.fileId);S.status===He.Success&&t({profilePictureId:g.fileId!=null?g.fileId:void 0,profilePictureUrl:S.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});n(g==="uploading")}}),e.jsx(K,{label:e.jsx(c,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(c,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(Ne,{type:"text",placeholder:I.formatMessage(L.gptNamePlaceholder),value:s?.name??"",onChange:g=>{t({name:g.target.value})},onBlurCapture:()=>t(g=>({...g,name:g.name.trim()})),"data-testid":"gizmo-name-input"}),M.includes($.GizmoNameTooLong)?e.jsx(Ge,{className:"mt-1",children:e.jsx(c,{...L.nameTooLong,values:{length:ci}})}):null]}),e.jsxs(Q,{className:"mt-4",children:[e.jsx(K,{label:e.jsx(c,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(c,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(Ne,{type:"text",placeholder:I.formatMessage(L.descriptionPlaceholder),value:s?.description??"",onChange:g=>t({description:g.target.value}),onBlurCapture:()=>t(g=>({...g,description:g.description?.trim()??""})),"data-testid":"gizmo-description-input"}),M.includes($.GizmoDescriptionTooLong)?e.jsx(Ge,{className:"mt-1",children:e.jsx(c,{...L.descriptionTooLong,values:{length:di}})}):null]}),e.jsxs(Q,{children:[e.jsx(K,{label:e.jsx(c,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:I.formatMessage(L.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(ui,{className:"resize-none",rows:8,value:s?.instructions,onChange:g=>t({instructions:g.target.value}),onBlurCapture:()=>t(g=>({...g,instructions:g.instructions.trim()})),placeholder:I.formatMessage(L.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"text-token-text-tertiary absolute end-2 bottom-3",onClick:()=>l(!0),children:e.jsx(mi,{className:"icon-sm"})})]}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(c,{...Ds.instructionsWarning})}),M.includes($.GizmoInstructionsTooLong)?e.jsx(Ge,{className:"mt-1",children:e.jsx(c,{...L.instructionsTooLong,values:{length:gi}})}):null]}),e.jsxs(Q,{children:[e.jsx(K,{label:e.jsx(c,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(c,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:P.map((g,S)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ne,{className:"rounded-e-none",value:g,type:"text",maxLength:pi,onChange:U=>{const z=U.target.value;t(E=>({...E,promptStarters:$e(S>=(x.length??0)?[...x??[],z]:x.map((O,F)=>F===S?z===""?void 0:z:O))}))}}),e.jsx("button",{className:"border-token-border-medium flex h-9 w-9 items-center justify-center rounded-lg rounded-s-none border border-s-0",onClick:()=>t(U=>({...U,promptStarters:x.filter((z,E)=>E!==S)})),children:e.jsx(kt,{className:"icon-sm"})})]},S))})]}),e.jsxs(Q,{children:[e.jsx(K,{label:e.jsx(c,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:I.formatMessage(L.knowledgeExplanation)}),e.jsx(_a,{gizmoEditorData:s,requireGizmoId:u,currentModelConfig:i,updateGizmo:t})]}),T&&R&&e.jsxs(Q,{children:[e.jsx(K,{label:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[e.jsx(c,{id:"wnVs4X",defaultMessage:"Recommended Model"}),e.jsx(Ki,{description:e.jsx(c,{...L.recommendedModelExplainer})})]})}),e.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)",marginTop:"4px",marginBottom:"8px"},children:e.jsx(c,{...L.recommendedModelDescriberUnderTitle})}),e.jsxs("select",{className:"border-token-border-medium bg-token-main-surface-primary w-full rounded-lg border px-3 py-2 text-sm",value:s.defaultModel??"",onChange:g=>{St.logEvent("gizmo_recommended_model_selected",g.target.value),t({defaultModel:g.target.value===""?null:g.target.value})},children:[e.jsx("option",{value:"",children:I.formatMessage({id:"gizmoEditor.noneOption",defaultMessage:"No Recommended Model - Users will use any model they prefer"})}),[...R.models.values()].filter(g=>A.includes(g.id)).sort((g,S)=>g.title.localeCompare(S.title)).map(g=>e.jsx("option",{value:g.id,children:g.title},g.id))]})]}),e.jsxs(Q,{children:[e.jsx(K,{label:e.jsx(c,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(c,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(Yi,{enabledTools:p,onEnabledToolsChange:g=>t({tools:g})})]}),e.jsxs(Q,{children:[e.jsx(K,{label:e.jsx(c,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(c,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(Ga,{isDisabled:!!(C&&!w),gizmo:s,onShowActionsEditor:m})]}),!C&&Aa(s)&&e.jsxs(Q,{children:[e.jsx(K,{label:e.jsx(c,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!y,onClick:()=>{f(g=>!g)}}),e.jsx(Ia,{collapsed:y,initial:!1,children:e.jsx(fi,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(c,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),h&&e.jsx(Na,{text:s.instructions??"",onChange:g=>{t({instructions:g})},onClose:()=>l(!1),placeholder:I.formatMessage(L.instructionsSubtitle)})]})}const L=de({recommendedModelDescriberUnderTitle:{id:"gizmo.recommendedModelDescriberUnderTitle",defaultMessage:"Recommend a model to the user, which should be used by default for best results."},recommendedModelExplainer:{id:"gizmo.recommendedModelExplainer",defaultMessage:"When the user loads a new conversation with the GPT the recommended model will be used. If the model is not available to the user, a similar model may be automatically selected."},nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters. If you need to provide more context, you may want to attach a file or knowledge document."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function Ra(s,t){const i=Ss(s);if(!Array.isArray(s.detail))return i;const a=$e(s.detail.map(n=>{if(n.type==="value_error.any_str.max_length")switch(n.loc[1]){case"display":{switch(n.loc[2]){case"name":return t.formatMessage(L.nameTooLong,{length:n.ctx.limit_value});case"description":return t.formatMessage(L.descriptionTooLong,{length:n.ctx.limit_value})}break}case"instructions":return t.formatMessage(L.instructionsTooLong,{length:n.ctx.limit_value})}if(typeof n.msg=="string")return n.msg}));return a.length>0?a.join(`
`):i}function La({upsertDraftError:s}){const t=V(),i=Ra(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(c,{...Zs.errorSavingDraft})}),i!=null&&e.jsx(Ke,{label:i,children:e.jsx(Ct,{className:"icon-sm"})})]})}function Ua({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:i,upsertDraftError:a,className:n}){return a instanceof _t?e.jsx(La,{upsertDraftError:a}):i?e.jsxs("div",{className:ce("flex items-center gap-2",n),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(c,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(c,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"text-token-text-tertiary w-4",children:t&&e.jsx(Ze,{})})]}):null}const Zs=de({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}}),Ea=_s(()=>Cs(()=>import("./orl5qr6pdfh8qbcx.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55])).then(s=>s.CanvasFocusedViewManager));var Fa=(s=>(s.TestGizmoAction="test_gizmo_action",s))(Fa||{});const Oa=new Nt;function Ba({clientThreadId:s,gizmoHasCustomActions:t,preferredModelId:i}){const{modelLabel:a,dropdownSections:n}=ea(s,t,i),o=e.jsxs(bi,{children:[e.jsx(c,{id:"IhcP1l",defaultMessage:"Model"}),e.jsx("span",{className:"text-token-text-secondary text-xs font-medium",children:a}),e.jsx(wi,{className:"icon-sm text-token-text-tertiary"})]});return e.jsx(Xe,{size:"small",alignOffset:-4,triggerButton:o,children:e.jsx(Zi,{sections:n})})}function Wa({gizmoEditorData:s,isSavingDraft:t,showTitle:i=!0}){const[a,n]=d.useState(()=>ye());Ls(a,{kind:ae.GizmoTest,gizmo_id:s.id}),d.useEffect(()=>{qe(a,_=>{_.mode={kind:ae.GizmoTest,gizmo_id:s.id}})},[a,s.id]);const o=s.files?.map(_=>_.file_id).join();d.useEffect(()=>{It(a)!=null&&n(ye())},[s.id,s.instructions,s.tools,o,a]);const r=d.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),u=ne(),m=J(u,"1213809372"),p=J(u,"1854238036");vi(a,s.defaultModel,void 0,s.id);const h=m||p,[l,y]=d.useState(0),f=()=>{y(_=>_-360)},x=s.id,P=Da(a);d.useEffect(()=>Ns(Oa,{test_gizmo_action:({rootDomain:_,operationName:C})=>{x&&P(x,_,C)}}),[P,x]);const M=d.useCallback(()=>e.jsx("div",{className:"h-full w-full",children:e.jsx(Ji,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})}),[s]);return e.jsx(js.Provider,{value:r,children:e.jsx(ji,{clientThreadId:a,children:e.jsx("div",{className:ce("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:i&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon"}),e.jsxs("button",{onClick:()=>{f(),n(ye())},className:"flex items-center gap-2",children:[e.jsx(c,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(As.div,{className:"text-token-text-primary",animate:{rotate:l},transition:{duration:.3},children:e.jsx(yi,{className:"icon invisible group-hover:visible"})})]}),h&&e.jsx(Ba,{clientThreadId:a,gizmoHasCustomActions:!!$s(s.tools),preferredModelId:s.defaultModel??void 0})]})})}),e.jsxs("div",{className:ce("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:[e.jsx(ys,{clientThreadId:a,children:e.jsx(qs,{clientThreadId:a,hideHeader:!0,renderEmptyState:M()})}),e.jsx(Xi.Sidebars,{children:e.jsx(Ea,{clientThreadId:a,overrideWidth:0,isAutoFocusDisabled:!0})})]})]})})})})}const xs=Is.memo(Wa);function Da(s){const t=Qs(s);return d.useCallback((a,n,o)=>{t({eventSource:"url",promptMessage:Gt(`Call the ${n} API with the ${o} operation`,{jit_plugin_data:{from_client:{type:"test",operation:o,tool_name:Mi(n)}}}),completionMetadata:{conversationMode:{kind:ae.GizmoTest,gizmo_id:a}}})},[t])}const Ha=_s(()=>Cs(()=>import("./o6k40xfr6c7g0stx.js"),__vite__mapDeps([56,1,3,4,57,2,5,58,59,60,19,32,45,46,47,48,49,50,33,38,51,52,61,62,8,30,31,34,35,36,37,29,63,44,53,64,40,65,66,67])).then(s=>s.GizmoActionsEditor));var Js=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(Js||{});function Ae({value:s,label:t,testId:i}){return e.jsx(Os,{value:s,className:"text-md border-token-border-default text-token-text-tertiary hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] w-1/3 grow rounded-lg p-1.5 font-semibold transition md:w-1/2","data-testid":i,children:t})}function $a({className:s,editorTab:t,setEditorTab:i}){const a=V(),n=ne(),o=J(n,"1393076427");return e.jsxs(Es,{className:ce("bg-token-main-surface-secondary flex w-full overflow-hidden rounded-xl p-1.5 md:w-1/2",s),value:t,onValueChange:r=>{i(r)},children:[o&&e.jsx(Ae,{value:"magic",label:a.formatMessage(ze.magicMakerLabel)}),e.jsx(Ae,{value:"advanced",label:a.formatMessage(ze.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(Ae,{value:"preview",label:a.formatMessage(ze.previewLabel)})})]})}function Va(s,t){return s.length!==t.length?!1:s.every(i=>t.some(a=>a.type===i.type))}function qa(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&Va(s.tools,t.tools)&&We(s.files?.map(i=>i.file_id)??[],t.files?.map(i=>i.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const et=({gizmo:s,onNewGizmoId:t})=>{const i=Gs(),a=bs(),n=Hs(je.BrowsingAvailable),o=a?.includes(je.GizmoCanvasToggle)&&a?.includes(je.Canvas),r=ne(),u=J(r,"4148168517"),m=V(),p=oe(),h=()=>{const v=[];n&&v.push({type:W.BROWSER}),o&&v.push({type:W.CANVAS});const k={...ps,tools:[...ps.tools,...v]};return u?{...k,tools:[...k.tools.filter(N=>N.type!==W.DALLE),{type:W.IMAGE_GEN}]}:k},l=d.useRef(s!=null?ms(s):h()),y=d.useRef(s),f=d.useRef(l.current),[x,P]=d.useState(()=>l.current),[M,_]=d.useState(()=>ye()),[C]=d.useState(()=>({context_message:na(l.current),model_slug:Le.GPT_4o,enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));ma(M,f.current,C);const{data:w}=Ve(),I=w?.models.get(Ms)??(w&&Rs(w.models.values(),v=>v.tags.includes(Le.GPT_4o))),{data:R}=Ci(l.current.id),b=Ni(),{isPending:T,error:A}=b,g=Ii(),S=d.useMemo(()=>R!=null&&!qa(x,R),[x,R]),U=async()=>{const v=l.current;try{const k=await b.mutateAsync({editorData:v,gizmoId:v.id});if(y.current=k,l.current.id==null){const N=k.gizmo.id;l.current={...l.current,id:N,sharingTargets:k.gizmo.sharing_targets},P(l.current),t?.(N)}for(const N of k.tools.filter(H=>H.type===W.JIT_PLUGIN)){const H=l.current.tools.find(ee=>ee.type===W.JIT_PLUGIN&&ee.metadata.domain===N.metadata.domain);H&&H.metadata.action_id!==N.metadata.action_id&&(H.metadata={...H.metadata,action_id:N.metadata.action_id},P(l.current))}return k}catch(k){const N=Ss(k)??m.formatMessage(Zs.errorSavingDraft);throw p.warning(N,{duration:2}),k}},z=d.useRef(void 0),E=async()=>l.current.id!=null?l.current.id:(z.current==null&&(z.current=U().then(v=>v.gizmo.id).catch(v=>{throw z.current=void 0,v})),z.current),[O]=d.useState(()=>Gi(()=>U(),2e3,{trailing:!0})),F=d.useCallback((v,k=!0)=>{const N=typeof v=="function"?v(l.current):Ai(l.current,v);We(N,l.current)||(l.current=N,P(l.current),k&&O())},[O]),pe=d.useRef(void 0);d.useEffect(()=>Ns(At,{completionFinished:async v=>{const k=v.serverThreadId;if(k==null){he(!1);return}try{const N=await aa(l.current,k,p,pe.current);N!=null&&(F(N),f.current=zs(l.current))}catch(N){Re.addError(N),p.warning("Something went wrong generating your GPT",{duration:3})}finally{pe.current=le.getCurrentNode(me(k)).message.id,he(!1)}}}),[p,F]);const fe=ca(M,C),[X,q]=d.useState(void 0);d.useEffect(()=>{q(Hi(s))},[s?.gizmo.id]);const j=async(v,k)=>{const N=Pe(l.current,v.recipient,k);if(N.length>0){p.warning(`Could not save GPT:

${N.map(se=>`- ${Fe(se)}`).join(`
`)}`,{duration:3});return}const H=await U(),ee=H.gizmo.id;try{return ks.logEvent("Promote Gizmo",{gizmo_id:H.gizmo.id,sharing_recipient:v.recipient,editor_tab:Z}),await g.mutateAsync({gizmoId:H.gizmo.id,data:{sharingSubjects:v.subjects,sharingRecipient:v.recipient,categories:k==null?void 0:[k]}},{onSuccess(Se){i.setQueryData(gs(i,ee).queryKey,Se),i.invalidateQueries({queryKey:["gizmos"]}),i.invalidateQueries({queryKey:["gizmo",{gizmoId:ee}]}),i.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:ee}]})}})}catch(se){if(se instanceof zi)q({gizmoId:ee,sharingRecipient:v.recipient,moderationType:Vs.PublishBlocked,sharingTargets:se.response?.sharing_targets,showModal:ue.AppealAvailable});else{Re.addError(se);const Se=se.detail??"An unknown error occurred";p.warning("Error saving GPT - "+Se,{duration:6})}}},B=J(r,"1393076427"),[Z,ts]=d.useState(()=>{if(!B)return"advanced";const v=ns.getItem(os.GizmoEditorTab);return Object.values(Js).includes(v)?v:"magic"}),Te=zt.useState(({windowWidth:v})=>v);d.useEffect(()=>{Te!=null&&Te>=768&&Z==="preview"&&ts("magic")},[Te,Z]);const[st,tt]=d.useState(!1),[is,he]=d.useState(!1),[as,ke]=d.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(Pa,{gizmoEditorData:x,isUpsertLoading:b.isPending,isPromoteLoading:g.isPending,hasUnpublishedChanges:S,isUploadingProfilePic:st,isGeneratingProfilePic:is,publishedGizmo:R,updateGizmo:F,promoteGizmo:async(v,k)=>{const N=await j(v,k);return l.current={...l.current,sharingRecipient:v.recipient},P(l.current),ns.setItem(os.GizmoEditorTab,Z),N},appealGizmo:async(v,k)=>{X!=null&&q({...X,sharingRecipient:v,categories:k==null?void 0:[k],showModal:ue.AppealAvailable})},setAppealState:q,revertDraft:R!=null&&S?()=>{const v=i.getQueryData(gs(i,l.current.id).queryKey);if(v!=null){const k=ms(v);l.current=k,P(k),U()}}:void 0,draftMessage:e.jsx(Ua,{isPublished:R!=null&&(R.gizmo.share_recipient==="marketplace"||R.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:S,isSavingDraft:T,upsertDraftError:A,className:"text-sm"}),showActionsModal:v=>{ke(v)},className:"shrink-0"}),X&&e.jsx($i,{appealState:X,onAppealClose:()=>q({...X,showModal:ue.None}),onAppealSubmitted:()=>q({...X,showModal:ue.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:as!==void 0?e.jsx(Ha,{currentlyEditingActionDomain:as,gizmoEditorData:x,updateGizmo:F,onClose:()=>{ke(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx($a,{editorTab:Z,setEditorTab:ts,className:"mb-2 shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:Z==="magic"?e.jsx("div",{className:"h-full w-full",children:e.jsx(pa,{gizmoEditorData:x,updateGizmo:F,clientThreadId:M,gizmoEditorDataRef:l,magicMakerBehaviorOverrides:C,magicMakerConversationGizmoEditorDataRef:f,requireGizmoId:E},M)}):Z==="advanced"?e.jsx(za,{gizmoEditorData:x,updateGizmo:F,currentModelConfig:I,generateProfilePic:v=>{he(!0),fe(v,l,f,da)},setIsUploadingProfilePic:tt,isGeneratingProfilePic:is,setIsGeneratingProfilePic:he,requireGizmoId:E,onShowActionsEditor:v=>{ke(v)}}):e.jsx(xs,{gizmoEditorData:x,isSavingDraft:T,showTitle:!1})})]})})}),e.jsx("div",{className:ce("border-token-border-medium bg-token-main-surface-secondary hidden w-1/2 justify-center border-s pt-4",Z!=="preview"&&"md:flex"),children:e.jsx("div",{className:"grow",children:e.jsx(xs,{gizmoEditorData:x,isSavingDraft:T})})})]})]})};function Qa({gizmoId:s,version:t}){const{data:i}=ki({gizmoId:s,draft:!0,version:t}),a=we(Us.accountUserId),o=Si()?.id,r=_i(i)&&i!=null&&a!=null&&o!=null;return i==null||!r?null:e.jsx(et,{gizmo:i})}function Ka({onNewGizmoId:s}){return e.jsx(et,{onNewGizmoId:s})}const Ya=({gizmoId:s,remixSourceId:t,version:i})=>{const a=ge(),n=Je(),o=d.useRef(void 0);d.useEffect(()=>(us.enterGizmoEditor(),()=>{us.exitGizmoEditor()}),[]);let r=s;return s!=null&&o.current===s&&(r=void 0),Pi({resetThreadAction:()=>{a("/")}}),n?r!==void 0?e.jsx(Qa,{gizmoId:r,version:i},r):e.jsx(Ka,{remixSourceId:t,onNewGizmoId:u=>{o.current=u,window.history.replaceState(window.history.state,"",Ti(u))}}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(Ze,{})})},ze=de({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});function Xa(s){const t=ge();d.useEffect(()=>{s||t(Rt(Lt.NO_ACCESS))},[s,t])}const pn=()=>(Ri(),null),fn=Ut(function(){const t=Je(),i=!!t?.hasPlusFeatures();Xa(t==null||i);const a=Wt(),[n]=Dt(),o=ge(),r=a.slug,u=n.get("version"),m=r?Et(r):void 0,p=n.get("remixFrom");return d.useEffect(()=>{Li(!0).then(h=>{Ui.initializeAndGatherData(h),Ei.initializeAndGatherData(h)})},[]),d.useEffect(()=>{t!=null&&!i&&o("/")},[t,o,i]),d.useEffect(()=>{m&&rs(m)&&o(`/g/${r}/project`)},[m,o,r]),!i||m&&rs(m)?null:e.jsx(Ft,{children:e.jsx(Ya,{gizmoId:m,remixSourceId:p??void 0,version:u!=null?Number(u):void 0})})});export{Oa as G,Fa as a,pn as c,fn as g};
//# sourceMappingURL=c73c00t6vdraj1ez.js.map
