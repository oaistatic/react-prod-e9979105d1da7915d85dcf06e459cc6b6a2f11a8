const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/drv35vu8fh8i9zl0.js","assets/juy90og0wtbp77qa.js","assets/dc2xxjkicf2pz0mj.js","assets/root-fv49dn40.css","assets/hesgehv7nq0kfowp.js","assets/fzrn137102spawew.js","assets/ckp56qklot786ulr.js","assets/conversation-small-j9iamy23.css","assets/iq982ga1lltyy4ue.js"])))=>i.map(i=>d[i]);
import{kV as D,C as F,dO as P,dP as E,dQ as w,B as A,g as H,kW as N,ar as M,as as L,aC as $,ag as I,at as B}from"./dc2xxjkicf2pz0mj.js";import{j as e,r as x}from"./juy90og0wtbp77qa.js";import{fl as U,fm as J,fn as S,bR as K,fo as q,fp as G,fq as Q}from"./ckp56qklot786ulr.js";import{u as W,D as X}from"./hahc5hbuphmqgoh5.js";import{s as Y}from"./hesgehv7nq0kfowp.js";import"./l7m4sdxmp3n9y1x8.js";import"./ec55vn9b13i0bljf.js";function k(s){return D({attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"},child:[]}]})(s)}function y(s){return D({attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"},child:[]},{tag:"path",attr:{d:"M7 12V7H6v5h1z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"},child:[]}]})(s)}const Z=L(()=>B(()=>import("./drv35vu8fh8i9zl0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(s=>s.JsonViewer));function he({threadId:s,threadUserId:a}){return U(J.isDebugModalOpen)&&e.jsx(F,{testId:"modal-sonic-debug",isOpen:!0,onClose:()=>S.toggleDebugModalOpen(),type:"success",size:"fullscreen",noPadding:!0,rootClassName:"z-50",children:e.jsx(le,{threadId:s,threadUserId:a??void 0,onClose:()=>S.toggleDebugModalOpen()})})}const ee=(s,a)=>{const l=JSON.stringify(a,null,2),n=new Blob([l],{type:"application/json"}),r=window.URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download=s,i.click(),window.URL.revokeObjectURL(r)},z="<|im_start|>",R="<|im_sep|>",T="<|im_end|>",se="<|fim_suffix|>";function te({prompt:s}){const[a,l]=x.useState({}),n=[],r=[];let i=0;for(;;){const o=s.indexOf(z,i);if(o===-1)break;const c=s.indexOf(R,o);if(c===-1)break;let t=s.indexOf(T,c);const m=s.indexOf(se,c);if(m!==-1&&(t===-1||m<t)&&(t=m),t===-1)break;const u=s.substring(o+z.length,c),b=s.substring(c+R.length,t);r.push(o);const g=a[o];n.push(e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>l(p=>({...p,[o]:!p[o]})),children:g?e.jsx(y,{size:14}):e.jsx(k,{size:14})}),e.jsxs("span",{className:"font-semibold",children:["[",u,"]"]})]}),e.jsx("div",{className:M("whitespace-pre-wrap",g&&"line-clamp-2 truncate"),children:b})]},o)),i=t+T.length}function j(o){const c={};for(const t of r)c[t]=o;l(c)}return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"absolute end-0 top-0 flex items-center gap-2 text-xs font-semibold",children:[e.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>j(!0),children:[e.jsx(k,{size:14})," Collapse All"]}),"/",e.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>j(!1),children:[e.jsx(y,{size:14})," Expand All"]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:n})]})}const v=$.div`mb-[-5px] pb-0.5 font-semibold uppercase border-b-2 ${({$isSelected:s})=>s?"border-black dark:border-white":"border-transparent"}`;function le({threadId:s,threadUserId:a,message:l,onClose:n}){const[r,i]=x.useState(l?"message":"json"),{data:j,isLoading:o,refetch:c}=W({threadId:s,threadUserId:a,refetchOnMount:"always"}),t=j?.thread;if(x.useEffect(()=>{i(l?"message":t?.turns.length?`turn${t?.turns.length-1}`:"thread")},[t?.turns.length,l]),!o&&!t&&!l)return e.jsxs(X,{onClickRetry:()=>c(),children:["Failed to load."," "]});if(o)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."});const m=t?.turns,u=t?.turns[t.turns.length-1],b=u?.artifacts__?.model_snapshots?.default_id,g=u?.artifacts__?.settings?.model_response?.completion_model?.model,p=b??g,_=u?.artifacts__?.eval_preset,V=a&&s?q(a,s):null;return e.jsx("div",{className:"flex flex-col gap-2 font-mono text-xs break-words",children:e.jsxs(P,{orientation:"vertical",value:r,onValueChange:h=>i(h),children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs(E,{className:"flex items-center justify-start gap-3 p-2",children:[l&&e.jsx(w,{value:"message",children:e.jsx(v,{$isSelected:r==="message",children:"Message"})},"message"),t&&e.jsx(w,{value:"thread",children:e.jsx(v,{$isSelected:r==="thread",children:"Thread"})},"thread"),m?.map((h,d)=>e.jsxs(x.Fragment,{children:[e.jsx(w,{value:`turn${d}`,children:e.jsxs(v,{$isSelected:r===`turn${d}`,children:["Turn[",d,"]"]})},d),h.artifacts__?.debug_ddtrace_urls?.map(f=>e.jsx(v,{$isSelected:!1,children:e.jsxs("a",{target:"_blank",href:f,className:"text-nowrap",rel:"noreferrer",children:["Trace[",d,"] â†—"]})},f))]},d))]}),e.jsxs("div",{className:"flex items-center justify-end",children:[t&&e.jsxs(A,{size:"small",color:"secondary",onClick:()=>ee("thread.json",t),children:[e.jsx(K,{className:"icon-sm"})," thread.json"]}),e.jsx(H,{onClick:n})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[p&&e.jsxs(e.Fragment,{children:[e.jsx(C,{name:"Model",id:p,className:"shrink-0"})," ",e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),_&&_!=="production"&&e.jsxs(e.Fragment,{children:[e.jsx(C,{name:"Eval Preset",id:_,className:"shrink-0"}),e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),V&&e.jsx(e.Fragment,{children:e.jsx(C,{name:"Permalink",id:V,className:"flex-shrink-1"})})]}),m?.map((h,d)=>{const f=h.model_response?.text;return e.jsxs(N,{value:`turn${d}`,className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth",children:[e.jsxs("div",{className:M("flex flex-col gap-2 p-2",(h.index??0)%2===0&&"bg-token-main-surface-secondary"),children:[e.jsx(te,{prompt:h.artifacts__?.debug_info?.main_model_response?.prompt_string??""}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"[assistant]"}),e.jsx("div",{"data-testid":"assistant-response",className:"whitespace-pre-wrap",children:Y(f??"")??f})]})]})," "]},d)}),t&&e.jsx(N,{value:"thread",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(O,{data:t,collapsed:4,jsonFiltersKey:"thread"})}),l&&e.jsx(N,{value:"message",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(O,{data:l,collapsed:4,jsonFiltersKey:"message"})})]},t?.turns.length??"message")})}function O({data:s,collapsed:a,jsonFiltersKey:l}){const[n,r]=x.useState(a??!0);return e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("button",{onClick:()=>r(!n),className:"flex items-center gap-1",children:n?e.jsxs(e.Fragment,{children:[e.jsx(y,{size:14})," Expand all"]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{size:14})," Collapse all"]})}),e.jsx("div",{className:"w-full",children:e.jsx(Z,{jsonFiltersKey:l,json:s,jsonViewProps:{collapsed:n,shortenTextAfterLength:0}},String(n))})]})}function C({name:s,id:a,className:l}){const n=I(),r=x.useCallback(i=>{G(a,n,i)},[a,n]);return e.jsxs("div",{className:M("flex items-center gap-2 truncate",l),children:[e.jsxs("span",{className:"font-semibold text-nowrap",children:[s,":"]}),e.jsx("span",{title:a,className:"truncate text-gray-500 dark:text-white",children:a}),e.jsx(Q,{onCopy:r})]})}export{O as DebugJsonViewer,he as DebugModal,le as DebugModalContents};
//# sourceMappingURL=ogleom8c8wh8f4cc.js.map
