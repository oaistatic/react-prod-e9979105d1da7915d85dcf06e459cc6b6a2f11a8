import{ag as K,hz as B,aV as F,j0 as O,j6 as q}from"./dc2xxjkicf2pz0mj.js";import{u as L,h as N,e as y,r,j as a,ah as $,n as Q,P as U}from"./juy90og0wtbp77qa.js";import{fs as I,ft as z,b$ as G,fu as V,W as H,w as J,x as p,y as x,fv as X,c0 as Y}from"./ckp56qklot786ulr.js";import{c as Z,d as tt}from"./o6wb3ptvu0bk81yq.js";import{P as st}from"./dmfmxszxfbs8gsbx.js";import{u as et,W as rt}from"./kf8hvybx3i6ev42e.js";import{u as ot}from"./mwysfro98kbgaaol.js";import"./drv35vu8fh8i9zl0.js";import"./hesgehv7nq0kfowp.js";import"./fzrn137102spawew.js";import"./iq982ga1lltyy4ue.js";import"./l3xu29fndg9f5mv3.js";import"./mq5kqcvga15eqze5.js";import"./dq2hdjj12gdqq0p1.js";import"./jsgl3b1bt1ozctr5.js";import"./lsldnobv7eet27pa.js";import"./ibqg5gvcvb5336z5.js";import"./o46eutw3gegbydjq.js";import"./jbze7lwlszm657iq.js";import"./h0zoartyn6ddtvom.js";import"./lzfgwrifvgqibt3v.js";import"./m36qabefvxegdn1g.js";import"./f5x7owcyj5iwmbsb.js";import"./llrie03z1kvfi4vu.js";import"./pc2givv05uuq8g6l.js";import"./ezqsz68yx4uzdtqb.js";import"./mre9dehcylnm0d4q.js";import"./enyyaj5d41xdxtkn.js";import"./v62rnx2jst6ga6cm.js";import"./lptwpbjabrvjmhsj.js";import"./cfod2v11dallp8kv.js";import"./l7m4sdxmp3n9y1x8.js";import"./f5uxfkqdhg7743lt.js";function nt({taskId:s,onClose:u}){const o=L(),l=K(),i=N(),c=y(),{data:t,error:b}=I(s);z(s);const w=G(({getTurnsForTask:n})=>n(s)),m=B(),f=r.useMemo(()=>m?new st(Z()):new V,[m]),_=F(f.isEmpty$),[k,d]=r.useState([]),[P,C]=r.useState(!1),{focusedAssistantTurn:e,setFocusedAssistantTurnId:S}=et({taskId:s,task:t?.task,currentDiffTaskTurn:t?.current_diff_task_turn??null,currentUserTurn:t?.current_user_turn??null,currentAssistantTurn:t?.current_assistant_turn??null}),W=t?.task?.current_turn_id,g=!!t?.task.has_unread_turn&&W===t.current_assistant_turn?.id,h=t?.current_assistant_turn?.turn_status==="completed";r.useEffect(()=>{if(!m)return;const n=t?.task?.title;if(n){const R=document.title;return document.title=n,()=>{document.title=R}}},[m,t?.task?.title]),r.useEffect(()=>{g&&h&&H.markTurnAsRead(s).then(()=>{o.invalidateQueries({queryKey:["wham","tasks"]}),o.invalidateQueries({queryKey:["wham","task",s]})})},[g,h,s,o]),ot(),J([{key:"newTask",action:()=>c("/codex",{state:{focusComposer:!0}}),actionMessageDescriptor:i.formatMessage({id:"wham.keyboardActions.newTask",defaultMessage:"New task"}),group:x.Chat,keyboardBinding:[p.Mod,p.Shift,"o"]},{key:"closeTask",action:()=>c("/codex"),actionMessageDescriptor:i.formatMessage({id:"wham.keyboardActions.closeTask",defaultMessage:"Close task"}),group:x.Chat,keyboardBinding:[p.Escape]}]);const T=k.length>0,v=r.useCallback(({force:n=!1}={})=>{if(n||!T&&_){d([]),u();return}C(!0)},[u,T,_]),D=e?X(e.turn_status):!1,M=e?.sibling_turn_ids?.includes(t?.current_assistant_turn?.id??"")||e?.id===t?.current_assistant_turn?.id,j=t?.current_diff_task_turn?.id===e?.id||e?.sibling_turn_ids?.includes(t?.current_diff_task_turn?.id??""),A=!t?.current_diff_task_turn,E=D&&M&&(j||A);return b?(l.danger({id:"wham.task-details.error",defaultMessage:"Error loading task",description:"Error message for failed to load task details"},{id:`wham-task-details-error-${s}`,hasCloseButton:!0,duration:3,toastId:"wham_task_page_content_error"}),a.jsx($,{to:"/codex"})):a.jsx(tt.Provider,{value:f,children:a.jsx(rt,{permissions:"write",taskId:s,turnId:t?.current_assistant_turn?.id??"",lastTurnWithDiffId:t?.current_diff_task_turn?.id??"",confirmClose:P,setConfirmClose:C,task:t?.task,focusedAssistantTurn:e,pastTurns:w,clearComments:()=>d([]),setComments:d,comments:k,canFollowUp:E,handleClose:v,setFocusedAssistantTurnId:S})})}function at(){const s=y(),u=Q(),{taskId:o}=U();Y();const l=u.state??{},{backgroundLocation:i}=l,c=r.useCallback(()=>{s(i?-1:"/codex")},[i,s]);return o?a.jsx(O,{children:a.jsx(nt,{taskId:o,onClose:c})}):null}const Lt=()=>[{title:"Codex"}],Nt=q(function(){return a.jsx(at,{})});export{Nt as default,Lt as meta};
//# sourceMappingURL=jkrug3xfdbvwewks.js.map
