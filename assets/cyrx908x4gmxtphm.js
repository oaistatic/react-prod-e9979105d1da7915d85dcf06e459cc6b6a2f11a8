import{h as F,r as x,j as e,f as H,A as ee,m as T,M as G}from"./juy90og0wtbp77qa.js";import{ax as ae,bv as te,av as se,d9 as ne,aw as ie,az as oe,aA as le,ar as S,aB as re,e$ as de,B as V,g8 as ce,b4 as B,dX as U,e as ge,ae as me,bW as ue,aC as K,ak as fe,$ as xe,al as D,P as O,n as P,ag as he}from"./dc2xxjkicf2pz0mj.js";import{S as pe}from"./ibqg5gvcvb5336z5.js";import{S as Ie}from"./enyyaj5d41xdxtkn.js";import{hG as ve,dN as we,b5 as be,hH as je,b4 as E,ey as Me,hI as _e,hJ as A,bx as ye,by as q,a0 as ke,eM as Ce,hK as Ne,eA as Se,hL as Ee,bN as Q,bP as X,bR as J,hM as Ve,a1 as Ae,hN as De,fp as Oe}from"./ckp56qklot786ulr.js";import{D as Pe,a as Y,u as Te,I as L}from"./l4lawytal32metvm.js";import{u as Fe}from"./o7zrzew6ugefv8n2.js";import"./dta0gs41e2vxh1q9.js";import"./dmfmxszxfbs8gsbx.js";const Le={enter:a=>({zIndex:0,x:a===-1?"10%":"-10%",opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:a=>({zIndex:0,x:a===1?"10%":"-10%",opacity:0})},Re={enter:{opacity:0,y:"10%"},visible:{opacity:1,y:0},exit:{opacity:0,y:"10%"}},Ge=1e3,Be=1e3,z=(a,n)=>Math.abs(a)*n;function ze(a){const n=F(),o=ae(),l=te(),[m,v]=x.useState({width:0,height:0}),[g,d]=x.useState(!1),[r,u]=x.useState(a.image),[p,j]=x.useState(!1),M=m.width>0&&m.height>0,w=x.useRef(null),[y,I]=x.useState(0);x.useEffect(()=>{if(!r.url)throw new Error("ExpandableImage requires a src");const t=new Image;t.onload=()=>{v({width:t.naturalWidth,height:t.naturalHeight})},t.onerror=()=>{},t.src=r.url},[r.url]),x.useEffect(()=>{const t=w.current;if(p)return t?.addEventListener("keydown",c),()=>{t?.removeEventListener("keydown",c)};u(a.image)},[p]);function i(){u(t=>{const C=(a.images.findIndex(_=>_.url===t.url)+1)%a.images.length;return a.images[C]}),I(-1)}function f(){u(t=>{const h=a.images.findIndex(_=>_.url===t.url),C=h>0?(h-1)%a.images.length:a.images.length-1;return a.images[C]}),I(1)}function s(t){j(t),t&&a.onOpen?.(r)}function c(t){t.key==="ArrowLeft"?f():t.key==="ArrowRight"&&i()}const k=a.images.findIndex(t=>t.url===r.url);return e.jsxs(se,{onOpenChange:s,children:[e.jsx(ne,{disabled:!M,className:a.className,"aria-label":n.formatMessage(N.showImage),children:a.children}),e.jsx(ie,{container:o?.document.body,children:e.jsx(oe,{className:"radix-state-open:animate-show fixed inset-0 z-20 flex items-center justify-center bg-black/90 backdrop-blur-xl",children:e.jsxs(le,{className:S("radix-state-open:animate-contentShow relative flex h-[100dvh] w-screen justify-stretch divide-x divide-white/10 focus:outline-hidden"),ref:w,children:[e.jsx("div",{className:S("flex flex-1 transition-[flex-basis]",!g&&"md:basis-[75vw]"),children:e.jsxs("div",{className:"flex flex-1 flex-col md:p-6",children:[e.jsxs("div",{className:"flex justify-between px-6 py-2 pt-6 text-white sm:mb-4 md:mt-2 md:px-0 md:py-2",children:[e.jsx(re,{asChild:!0,children:e.jsx("button",{"aria-label":n.formatMessage(N.closeModal),children:e.jsx(de,{})})}),e.jsx("div",{children:l&&e.jsxs(e.Fragment,{children:[a.getActions?.(r)?.map((t,h)=>e.jsx(V,{color:"ghost",size:"small",onClick:t.onClick,"aria-label":t.ariaLabel,disabled:t.disabled,icon:t.icon},h)),e.jsx(V,{color:"ghost",size:"small",onClick:()=>d(t=>!t),"aria-label":n.formatMessage(N.toggleSidebar),className:"md:inline-flex",icon:ce})]})})]}),e.jsx("div",{className:"relative flex flex-1 flex-col items-center justify-center overflow-hidden",children:e.jsx(ee,{initial:!1,custom:y,children:e.jsxs(T.div,{className:"absolute grid h-full w-full grid-rows-2",custom:y,variants:Le,drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(t,{offset:h,velocity:C})=>{const _=z(h.x,C.x);_<-1e3?i():_>Ge&&f()},children:[e.jsx(T.img,{src:r.url,alt:r.alt,className:"row-span-4 mx-auto h-full object-scale-down",onPanEnd:(t,{offset:h,velocity:C})=>{const _=z(h.y,C.y);_<-1e3?d(!0):_>Be&&d(!1)}},r.url),!l&&g&&e.jsx(T.div,{className:"flex text-white",variants:Re,initial:"enter",animate:"visible",exit:"exit",transition:{y:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},children:a.metadataRenderer(r)})]},r.url)})}),a.images.length>1?e.jsxs("div",{className:"flex items-center justify-center gap-4 p-8 text-white",children:[e.jsx(V,{color:"ghost",size:"small",onClick:f,"aria-label":n.formatMessage(N.previousImage),icon:pe}),a.images.map((t,h)=>e.jsx("img",{src:t.url,alt:t.alt??"",className:S("h-12 w-12 cursor-pointer rounded-sm object-cover transition duration-300 hover:opacity-100",t.url===r.url?"ring-2 ring-white ring-offset-4 ring-offset-black":"opacity-25"),onClick:()=>{u(t),I(h<k?1:-1)},"aria-label":n.formatMessage(N.showImage),role:"button"},t.url)),e.jsx(V,{color:"ghost",size:"small",onClick:i,"aria-label":n.formatMessage(N.nextImage),icon:Ie})]}):null]})}),e.jsx("div",{className:S("hidden items-center justify-start overflow-hidden bg-gray-900 text-white transition-[flex-basis] duration-500 md:flex",g?"md:basis-[25vw]":"md:basis-0"),children:e.jsx("div",{className:"w-[25vw] min-w-[25vw]",children:a.metadataRenderer(r)})})]})})})]})}const N=H({showImage:{id:"imageViewer.showImage",defaultMessage:"Show Image"},closeModal:{id:"imageViewer.closeModal",defaultMessage:"Close Modal"},toggleSidebar:{id:"imageViewer.toggleSidebar",defaultMessage:"Toggle Sidebar"},nextImage:{id:"imageViewer.nextImage",defaultMessage:"Next Image"},previousImage:{id:"imageViewer.previousImage",defaultMessage:"Previous Image"}});function We({withLottie:a}){return e.jsxs("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full",children:[e.jsx(Pe,{animate:a,matchTextColor:!0,className:"h-6 w-6"}),e.jsx($e,{})]})}function $e(){const[n,o]=x.useState(new Date);x.useEffect(()=>{o(new Date)},[]);const l=ve(+n,25e3);return e.jsx(we,{percentage:l,thickness:1.25/23,className:"absolute start-1/2 top-1/2 h-10 w-10 -translate-x-1/2 -translate-y-1/2",backgroundStrokeClassName:"stroke-token-main-surface-tertiary",transitionDuration:`${(100-l)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}function oa({messages:a,clientThreadId:n,disableClickThru:o=!1}){const[l,m]=a,v=be(l),g=je(),d=a.some(p=>g.has(p.id));let r=null;m!=null&&B.isMultimodalTextMessage(m)&&(r=B.getImageAssetPointers(m));let u=E.Running;return r!=null?u=E.Finished:m!=null?u=E.Error:v&&(u=E.Stopped),e.jsx(Y.Provider,{value:o,children:!d&&e.jsx(Ue,{imageAssets:r??[],clientThreadId:n,toolStatus:u,toolMessage:m,messageId:l.id})})}const He="https://help.openai.com/en/articles/8932459",Ue=({imageAssets:a,clientThreadId:n,toolMessage:o,toolStatus:l,messageId:m})=>{const v=F(),g=U(n),d=Me(a,void 0,g),r=ge(),u=me(r),p=_e(n),j=x.useMemo(()=>l===E.Finished&&d.every(i=>!!i.data),[l,d]);if(o?.content.content_type===ue.SystemError)return null;const M=Z(a[0]),w=d.map(i=>i.data).filter(i=>i!=null),y=w.map(i=>({...i,alt:A(i)})),I=(i=0)=>`${m}-image-${i}`;return e.jsxs("div",{children:[e.jsxs(Xe,{$numItems:d.length,className:"my-1 transition-opacity duration-300",children:[d.length===0&&l===E.Running&&e.jsx(W,{layoutId:"loading:placeholder",shape:M,isToolRunning:!0},"loading"),d.map((i,f)=>{const{isLoading:s,data:c,error:k}=i;if(s)return e.jsx(W,{shape:M,layoutId:I(f)},f);if(k!=null||c?.url==null)return e.jsx(R,{layoutId:I(f),className:"text-token-text-tertiary text-sm",shape:M,children:e.jsx("div",{className:"flex min-h-full flex-col items-center justify-center gap-3 px-4 pb-5",children:v.formatMessage(b.imageLoadError)})},f);if(o&&c){const t={...c,alt:A(c)};return e.jsx(Ke,{image:t,allImages:y,clientThreadId:n,toolMessage:o,index:f,onOpenImageEditor:()=>{ye.setFocusedObject({type:q.Image,image:t,allImages:w,messageId:o.id})}},f)}})]}),u&&j&&e.jsx("div",{className:"text-md text-token-text-tertiary flex flex-row items-center py-2",children:e.jsx("span",{className:"me-2",children:p?e.jsx(G,{id:"xQcNUs",defaultMessage:"Made with the old version of image generation. <link>Learn more</link>",values:{link:i=>e.jsx("a",{className:"text-token-text-tertiary underline underline-offset-4",href:He,target:"_blank",rel:"noopener noreferrer",children:i})}}):e.jsx(G,{id:"pvSitT",defaultMessage:"Made with the old version of image generation. New images <link>coming soon</link>.",values:{link:i=>e.jsx("a",{className:"text-token-text-tertiary underline underline-offset-4",href:"https://openai.com/index/introducing-4o-image-generation/",target:"_blank",rel:"noopener noreferrer",children:i})}})})})]})};function Ke({toolMessage:a,clientThreadId:n,allImages:o,image:l,index:m,onOpenImageEditor:v}){const g=F(),d=U(n),r=Z(l),u=x.useContext(Y),[p,j]=x.useState({}),M=Te({clientThreadId:n});async function w(s){Ve(s,d,a.id,u)}function y(s){D.logEvent("chatgpt_dalle_image_view_full",null,{sourceOperation:s.metadata?.dalle?.edit_op??"none",hasParent:s.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),O.logEvent("chatgpt_dalle_image_view_full",{conversationId:d,messageId:a.id,generationId:s.metadata?.dalle?.gen_id,parentGenerationId:s.metadata?.dalle?.parent_gen_id,fileId:P(s.asset_pointer),sourceOperation:s.metadata?.dalle?.edit_op,model:"dalle"}),D.logEvent("chatgpt_image_view_full",null,{sourceOperation:s.metadata?.dalle?.edit_op??"none",hasParent:s.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),O.logEvent("chatgpt_image_view_full",{conversationId:d,messageId:a.id,generationId:s.metadata?.dalle?.gen_id,parentGenerationId:s.metadata?.dalle?.parent_gen_id,fileId:P(s.asset_pointer),sourceOperation:s.metadata?.dalle?.edit_op,model:"dalle"})}function I(s,c){j(t=>({...t,[s.asset_pointer]:c}));const k=u?"chatgpt_dalle_image_captioning_rating":"chatgpt_dalle_image_rating";D.logEvent(k,c?"like":"dislike",{liked:c?"true":"false",sourceOperation:s.metadata?.dalle?.edit_op??"none",hasParent:s.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),O.logEvent(k,{liked:c,conversationId:d,messageId:a.id,generationId:s.metadata?.dalle?.gen_id,parentGenerationId:s.metadata?.dalle?.parent_gen_id,fileId:P(s.asset_pointer),sourceOperation:s.metadata?.dalle?.edit_op,model:"dalle"}),D.logEvent("chatgpt_image_rating",c?"like":"dislike",{liked:c?"true":"false",sourceOperation:s.metadata?.dalle?.edit_op??"none",hasParent:s.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),O.logEvent("chatgpt_image_rating",{liked:c,conversationId:d,messageId:a.id,generationId:s.metadata?.dalle?.gen_id,parentGenerationId:s.metadata?.dalle?.parent_gen_id,fileId:P(s.asset_pointer),sourceOperation:s.metadata?.dalle?.edit_op,model:"dalle"})}function i(s){const c=p[s.asset_pointer],k={label:g.formatMessage(b.likeImage),onClick:()=>I(s,!0),disabled:c===!0,ariaLabel:g.formatMessage(b.likeImage),icon:Q},t={label:g.formatMessage(b.dislikeImage),onClick:()=>I(s,!1),disabled:c===!1,ariaLabel:g.formatMessage(b.dislikeImage),icon:X},h={label:g.formatMessage(b.downloadImage),onClick:()=>w(s),ariaLabel:g.formatMessage(b.downloadImage),icon:J};return[c!==!1&&k,c!==!0&&t,h].filter(Boolean)}let f=e.jsx(Qe,{image:l,shape:r,rating:p[l.asset_pointer],onDownload:()=>w(l),onRate:(s,c)=>I(s,c),clientThreadId:n,layoutId:void 0});return M?f=e.jsx("div",{role:"button",onClick:v,children:f}):u||(f=e.jsx(ze,{image:l,images:o,metadataRenderer:s=>e.jsx(qe,{image:s}),onOpen:y,getActions:i,children:f})),e.jsx("div",{className:"flex",children:f},m)}function W({shape:a,layoutId:n,isToolRunning:o=!1}){const{isOpen:l}=Fe();return e.jsx(R,{shape:a,layoutId:l?void 0:n,children:e.jsx("div",{className:"flex min-h-full items-center justify-center",children:e.jsx(We,{withLottie:o})})},"loading")}function qe({image:a}){const n=F(),[o,l]=x.useState(!1),m=he();function v(g){const d=A(a);l(!0),Oe(d,m,g),setTimeout(()=>{l(!1)},2e3)}return e.jsxs("div",{className:"flex flex-col items-start gap-3 p-6",children:[e.jsx("div",{className:"text-sm text-gray-300 sm:text-base",children:n.formatMessage(b.imageViewerMetadataTitle)}),e.jsx("div",{className:"max-h-32 overflow-y-auto text-sm md:max-h-[80vh] md:text-lg",children:A(a)}),e.jsx(V,{color:"primary",onClick:v,disabled:o,className:"hidden sm:block",icon:De,children:o?n.formatMessage(b.imageViewerMetadataCopyButtonCopied):n.formatMessage(b.imageViewerMetadataCopyButton)})]})}function R({children:a,shape:n,className:o,layoutId:l}){return e.jsxs(T.div,{layoutId:l,className:S("relative",o,n==="1792x1024"&&"aspect-7/4",n==="1024x1024"&&"aspect-square max-w-[400px]",n==="1024x1792"&&"aspect-4/7 max-w-xs","overflow-hidden rounded-2xl"),children:[e.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),e.jsx("div",{className:"relative h-full",children:a})]})}function Qe({image:a,shape:n,rating:o,onDownload:l,onRate:m,clientThreadId:v,layoutId:g}){const d=ke(Ae.isBusinessWorkspace),r=fe(v,i=>i?.mode),u=Ce(),p=Ne(),j=p?.type===q.Image&&p.image.asset_pointer===a.asset_pointer,{url:M,width:w,height:y}=a,I=!d&&r?.kind!==xe.GizmoMagicCreate;return e.jsxs(R,{shape:n,className:"group/dalle-image",layoutId:j?void 0:g,children:[e.jsx(Se,{alt:A(a),src:M,width:w,height:y}),e.jsx("div",{className:S("pointer-events-none absolute inset-0 rounded-2xl shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] dark:shadow-[inset_0_0_0_1px_rgba(255,255,255,0.1)]",j?"bg-black/50 group-hover/dalle-image:bg-black/70":"group-hover/dalle-image:bg-transparent")}),u?!j&&e.jsx("div",{className:"pointer-events-none invisible absolute end-3 top-3 text-white group-hover/dalle-image:visible",children:e.jsx(Ee,{})}):e.jsxs(e.Fragment,{children:[I&&e.jsxs($,{children:[o!==!1&&e.jsx(L,{icon:Q,selected:o===!0,onClick:i=>{i.stopPropagation(),m(a,!0)}}),o!==!0&&e.jsx(L,{icon:X,selected:o===!1,onClick:i=>{i.stopPropagation(),m(a,!1)}})]}),e.jsx($,{$rightAlign:!0,children:e.jsx(L,{icon:J,onClick:i=>{i.stopPropagation(),l()}})})]})]})}const $=K.div`invisible absolute top-3 flex gap-1 group-hover/dalle-image:visible z-2
${({$rightAlign:a})=>a?"end-3":"start-3"}`,Xe=K.div`grid gap-2
${({$numItems:a})=>a<=1?"grid-cols-1":"grid-cols-2"}`;function Z(a){if(!a)return"1024x1024";const{width:n,height:o}=a;return n>o?"1792x1024":n<o?"1024x1792":"1024x1024"}const b=H({creatingImages:{id:"dalleMessage.creatingImagesV2",defaultMessage:"Creating image"},stopped:{id:"dalleMessage.stoppedV3",defaultMessage:"Stopped creating image"},errorCreating:{id:"dalleMessage.errorCreatingV2",defaultMessage:"Error creating image"},imageLoadError:{id:"dalleMessage.imageLoadError",defaultMessage:"Error loading image"},imageViewerMetadataTitle:{id:"dalleMessage.imageViewerMetadataTitle",defaultMessage:"Prompt"},imageViewerMetadataCopyButton:{id:"dalleMessage.imageViewerMetadataCopyButton",defaultMessage:"Copy"},imageViewerMetadataCopyButtonCopied:{id:"dalleMessage.imageViewerMetadataCopyButtonCopied",defaultMessage:"Copied!"},imageEditButton:{id:"dalleMessage.imageEditButton",defaultMessage:"Edit"},downloadImage:{id:"imageViewer.downloadImage",defaultMessage:"Download Image"},likeImage:{id:"imageViewer.likeImage",defaultMessage:"Like Image"},dislikeImage:{id:"imageViewer.dislikeImage",defaultMessage:"Dislike Image"}});export{oa as default};
//# sourceMappingURL=cyrx908x4gmxtphm.js.map
