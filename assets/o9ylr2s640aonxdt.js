import{R as x,ag as S,e as A,a7 as k,dA as F,lg as P,f as y,lh as Q,li as G,lj as O,lk as K,ll as W,ke as w,du as N,dv as j,lm as U,iB as E,ln as z,dh as H,C as V,B as v}from"./dc2xxjkicf2pz0mj.js";import{d as C,u as _,a as M,h as R,j as t,r as b,f as L}from"./juy90og0wtbp77qa.js";import{W as J}from"./oue9h0fn7ryw3g04.js";import{d as Z,e as $,c as X}from"./nyxt3hy2zzj6sj8a.js";import{dl as Y,k4 as I}from"./ckp56qklot786ulr.js";const de=({workspaceId:e,roleId:a})=>C({queryKey:[e,"role",a],enabled:!!a,queryFn:async()=>(await x.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:e,consistency:"strong"},path:{workspace_id:e,role_id:a}}})).role,staleTime:1e3*60*5}),me=({workspaceId:e})=>C({queryKey:[e,"roles"],queryFn:()=>x.safeGet("/rbac/workspace/{workspace_id}/roles",{parameters:{query:{account_id:e,consistency:"strong"},path:{workspace_id:e}}})}),pe=({workspaceId:e,currentRoles:a})=>{const s=_(),c=S(),r=R(),{mutateAsync:o}=M({mutationFn:i=>x.safePost("/rbac/workspace/{workspace_id}/roles",{parameters:{query:{account_id:e},path:{workspace_id:e}},requestBody:{role_name:i.name,description:i.description}}),onMutate:({name:i,description:l})=>{s.cancelQueries({queryKey:[e,"roles"]});const p=a;return s.setQueryData([e,"roles"],m=>(m||(m={data:[],object:"list",has_more:!1}),{...m,data:[{id:"new",name:i,permissions:[],resource_type:"workspace",predefined_role:!1,description:l,created_at:Date.now(),updated_at:Date.now(),created_by:"system",metadata:{}},...m.data]})),{previousRoles:p}},onError:(i,l,p)=>{s.setQueryData([e,"roles"],p?.previousRoles),s.invalidateQueries({queryKey:[e,"roles"]}),i.message==="Role with this name already exists."&&c.warning(r.formatMessage({id:"Hn9Qxu",defaultMessage:"Role with this name already exists"}),{duration:1})},onSuccess:()=>{s.invalidateQueries({queryKey:[e,"roles"]})}});return{createRole:o}},ge=({workspaceId:e})=>{const a=_(),{mutateAsync:s}=M({mutationFn:async c=>await x.safeDelete("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:e},path:{workspace_id:e,role_id:c}}}),onSettled:()=>{a.invalidateQueries({queryKey:[e,"roles"]})}});return{deleteRole:s}},fe=({workspaceId:e})=>{const a=_(),s=S(),c=R(),{mutateAsync:r}=M({mutationFn:async o=>await x.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:e},path:{workspace_id:e,role_id:o.id}},requestBody:{role_name:o.name,description:o.description,permissions:o.permissions}}),onMutate:({id:o,name:i,permissions:l})=>{const p=a.getQueryData([e,"role",o]);return a.setQueryData([e,"role",o],m=>({...m,name:i,permissions:l})),{previousRoles:p}},onError:(o,i,l)=>{a.setQueryData([e,"role",i.id],l?.previousRoles),o.message==="Role with this name already exists."?s.warning(c.formatMessage({id:"EDzkz/",defaultMessage:"Role with this name already exists"}),{duration:1}):s.danger(c.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:()=>{a.invalidateQueries({queryKey:[e,"roles"]}),s.success(c.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{updateRole:r}},he=({workspaceId:e,roleId:a})=>C({queryKey:[e,a,"role-groups"],queryFn:async()=>(await x.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/principals",{parameters:{query:{account_id:e,consistency:"strong"},path:{workspace_id:e,role_id:a}}})).groups}),xe=({workspaceId:e,roleId:a})=>{const s=_(),{mutateAsync:c}=M({mutationFn:async({id:r})=>await x.safePost("/rbac/workspace/{workspace_id}/role-assignments",{parameters:{query:{account_id:e},path:{workspace_id:e}},requestBody:{role_id:a,principal_id:r,principal_type:"group"}}),onSuccess:(r,o)=>{const i=[e,a,"role-groups"];s.setQueryData(i,l=>[...l,{id:o.id,name:o.name??"",num_members:o.num_members??0,created_time:new Date().toDateString()}]),s.invalidateQueries({queryKey:i})}});return{assignGroup:c}},ye=({workspaceId:e,roleId:a})=>{const s=_(),{mutateAsync:c}=M({mutationFn:async r=>await x.safeDelete("/rbac/workspace/{workspace_id}/role-assignments",{parameters:{query:{account_id:e,role_id:a,principal_id:r,principal_type:"group"},path:{workspace_id:e}}}),onSuccess:(r,o)=>{const i=[e,a,"role-groups"];s.setQueryData(i,l=>l?l.filter(p=>p.id!==o):[]),s.invalidateQueries({queryKey:i})}});return{unassignGroup:c}},ee=()=>{const e=A(),a=k(),s=F(e),c=P(),r=a?.residencyRegion==="no_constraint"&&!s,o=y(e,"614413305"),i=y(e,"773249106"),l=y(e,"417039829"),p=y(e,"2509278897"),m=y(e,"3940160259"),u=y(e,"3507761600"),n=Q(),f=G(),d=O(),h=K(),B=W(),{enabled:T}=w(N[j.GITHUB_CONNECTOR]),q=a?.isCBP()??!1,D=U();return{isCBP:q,githubConnectorEnabled:T,isInSupportedDrRegion:c,isSharedProjectsEnabled:i,showAgentInternetAccessToggle:u,showHiveToggle:l,showDeepResearchToggle:m,isAppleIntelligenceToggleEnabled:r&&p,isAppleIntelligenceMdmToggleEnabled:o,includeFeatures:n,includeModels:f,includeBetaSettings:d,includeBetaSettingsAdvanced:h,includeGizmoPermissions:B,isMDMEnabled:D}},se=({ariaLabel:e,role:a,permissionName:s,handleSaveRole:c,disabled:r=!1})=>s==="codex_github_connector"?t.jsx(te,{}):t.jsx(E,{size:"normal","aria-label":e,checked:r?!1:a.permissions.includes(s),onCheckedChange:o=>{let i=[...a.permissions];o?i.push(s):i=i.filter(l=>l!==s),c({...a,permissions:i})},disabled:r}),te=()=>{const{enabled:e}=w(N[j.GITHUB_CONNECTOR]);return t.jsx(E,{checked:e,disabled:!0,"aria-hidden":!0})},ae="https://help.openai.com/en/articles/11750701-rbac",be=({role:e,onSave:a})=>{const s=R(),c=k(),r=ee(),{permissionsBySection:o,totalPermissionsCount:i}=b.useMemo(()=>{const n=z({isCanvasEnabled:!0,isEnterprisey:c?.isEnterprisey()??!1,...r}).map(d=>({...d,entries:d.entries.filter(h=>h.rbac)})).filter(d=>d.entries.length>0),f=n.flatMap(d=>d.entries).length;return{permissionsBySection:n,totalPermissionsCount:f}},[c,r]),[l,p]=b.useState(""),m=o.map(u=>({...u,entries:u.entries.filter(n=>{const f=typeof n.title=="string"?n.title:s.formatMessage(n.title),d=n.description?typeof n.description=="string"?n.description:s.formatMessage(n.description,n.descriptionValues):"";return n.rbac&&([f,d].join(" ").toLowerCase().includes(l.toLowerCase())||n.permissionName.toLowerCase().includes(l.toLowerCase()))})})).filter(u=>u.entries.length>0);return t.jsxs(Z,{children:[t.jsx("div",{className:"text-token-text-secondary text-sm",children:s.formatMessage(re.customRoleDescription,{link:u=>t.jsx(H,{className:"underline",target:"_blank",rel:"noreferrer",href:ae,children:u})})}),t.jsx("div",{className:"flex flex-row items-center justify-between",children:t.jsx(Y,{inputClassName:"w-[250px] rounded-full! text-sm",value:l,onChange:u=>{p(u.target.value)},placeholder:s.formatMessage({id:"hRuTvi",defaultMessage:"Search {count} permissions"},{count:i})})}),m.map(u=>t.jsx(J,{title:u.title,description:u.description,descriptionValues:u.descriptionValues,children:t.jsx($,{children:u.entries.map(n=>{const f=n.permissionName,d=typeof n.title=="string"?n.title:s.formatMessage(n.title);return t.jsx(X,{children:t.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-md",children:d}),n.description&&t.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof n.description=="string"?n.description:s.formatMessage(n.description,n.descriptionValues)})]}),t.jsx(se,{ariaLabel:d,role:e,permissionName:n.permissionName,handleSaveRole:a,disabled:n.disabled})]})},f)})})},String(u.title.defaultMessage)))]})},re=L({customRoleDescription:{id:"I9hJih",defaultMessage:"Custom role permissions override workplace-level settings. A user’s effective permissions are the sum of all their assigned custom roles. Not all settings are available as role-based permissions. <link>Learn more</link>"},discardChangesLabel:{id:"0gdhtj",defaultMessage:"Discard changes"},save:{id:"LE9GJk",defaultMessage:"Save"},searchPlaceholder:{id:"EaN6oB",defaultMessage:"Search permissions"}}),_e=({onClose:e,onSave:a,isCreate:s,defaultData:c})=>{const r=R(),[o,i]=b.useState(c?.name||""),[l,p]=b.useState(c?.description||""),[m,u]=b.useState(""),[n,f]=b.useState(!1),d=async()=>{if(!o.trim()){u(r.formatMessage(g.roleNameError));return}f(!0);try{await a({name:o,description:l}),e()}catch{}finally{f(!1)}};return t.jsx(V,{testId:"modal-upsert-role",size:"custom",className:"max-w-lg text-sm",isOpen:!0,onClose:e,showCloseButton:!0,type:"success",title:r.formatMessage(s?g.createRoleTitle:g.editRoleTitle),primaryButton:t.jsx(v,{color:"primary",onClick:()=>d(),loading:n,children:r.formatMessage(g.buttonSaveLabel)}),secondaryButton:t.jsx(v,{onClick:e,color:"secondary",children:r.formatMessage(g.buttonCancelLabel)}),children:t.jsxs("form",{className:"flex flex-col gap-6",children:[t.jsxs("label",{className:"block",children:[t.jsx("span",{className:"text-sm font-medium",children:r.formatMessage(g.roleNameLabel)}),t.jsx("input",{type:"text",className:`border-token-border-primary text-token-text-primary focus:border-token-brand focus:ring-token-brand mt-1 block w-full rounded-md border px-3 py-2 text-sm ${m?"border-token-text-status-error":""}`,placeholder:r.formatMessage(g.roleNameLabel),value:o,onChange:h=>{i(h.target.value),u("")}}),m&&t.jsx("span",{className:"text-token-text-status-error mt-1 text-xs",children:m})]}),t.jsxs("label",{className:"block",children:[t.jsx("span",{className:"text-sm font-medium",children:r.formatMessage(g.descriptionLabel)}),t.jsx("span",{className:"text-token-text-tertiary ms-1 text-sm font-medium",children:r.formatMessage(g.optionalLabel)}),t.jsx("input",{type:"text",className:"border-token-border-primary text-token-text-primary focus:border-token-brand focus:ring-token-brand mt-1 block w-full rounded-md border px-3 py-2 text-sm",placeholder:r.formatMessage(g.descriptionLabel),value:l,onChange:h=>p(h.target.value)})]}),t.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-primary mb-1 flex w-full flex-row gap-4 rounded-xl p-4",children:[t.jsx(I,{className:"icon"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium",children:r.formatMessage(g.infomationTitle)}),t.jsx("div",{className:"text-token-text-secondary",children:r.formatMessage(g.informationText)})]})]})]})})},g=L({createRoleTitle:{id:"xmlnWv",defaultMessage:"New custom role"},editRoleTitle:{id:"6A6tgB",defaultMessage:"Edit custom role"},roleNameLabel:{id:"VGBBHP",defaultMessage:"Role name"},optionalLabel:{id:"KR/EbO",defaultMessage:"(optional)"},descriptionLabel:{id:"BnuWZw",defaultMessage:"Description"},infomationTitle:{id:"L1pBDh",defaultMessage:"What's a custom role?"},informationText:{id:"DvDdnE",defaultMessage:"Roles are a great way to control which features a user can access. When assigned, the user’s permissions will be calculated as the sum of their custom roles."},buttonCancelLabel:{id:"rMxszm",defaultMessage:"Cancel"},buttonSaveLabel:{id:"JELOdt",defaultMessage:"Save"},roleNameError:{id:"iyN7K7",defaultMessage:"Role name is required"}}),ne="role-workspace-member",Me=e=>e.id.startsWith(ne)&&e.predefined_role;export{se as P,be as R,_e as U,xe as a,ye as b,de as c,ge as d,fe as e,me as f,pe as g,ee as h,Me as i,he as u};
//# sourceMappingURL=o9ylr2s640aonxdt.js.map
