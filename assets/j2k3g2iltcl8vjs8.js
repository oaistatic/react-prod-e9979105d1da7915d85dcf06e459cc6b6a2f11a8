import{g as R,j as e,r as c,h as I,m as g,A as C}from"./juy90og0wtbp77qa.js";import{dX as b,b2 as k,b3 as N,hJ as Q,aG as _,C as L,aF as W,ar as A,b4 as $,B as q}from"./dc2xxjkicf2pz0mj.js";import{W as z}from"./cfod2v11dallp8kv.js";import{j1 as G,j2 as J,ht as X,j3 as H,dJ as p,j4 as K,aX as Y,j5 as V,hU as M,bA as j,j6 as Z,j7 as ee,j8 as y,dB as te,j9 as se}from"./ckp56qklot786ulr.js";import{S as ne}from"./l3n51a2tb9b2qxpl.js";import{u as ae,g as oe}from"./njob26zxpz8xevub.js";import{u as ie}from"./mijgy9yzui4pbcrj.js";import{r as re}from"./e2fyqefjfccaah4p.js";import"./l7m4sdxmp3n9y1x8.js";import"./ktek6k3hwnufzduj.js";import"./mia7txooqhkpbw7w.js";import"./cir7oqlbi88or9cr.js";import"./hisrfv493df9w8hp.js";import"./hort3ndd4wla0a2j.js";import"./nqj34k5dky4x5suq.js";import"./kvlw7edoapaiqmyl.js";var w,D;function ce(){if(D)return w;D=1;var s=re(),t=G(),n=s(function(o,i,r){return o+(r?" ":"")+t(i)});return w=n,w}var le=ce();const de=R(le);function ue({conversationId:s}){const t=b(s),n=k.getCurrentNode(N(s))?.id,o=J();return X()?e.jsx(f,{conversationId:t??s,parentMessageId:n,status:o}):null}function f(s){const t=s?.status?.modes,[n,o]=c.useState(!1),[i,r]=c.useState(),d=c.useCallback(a=>{r(a),o(!0)},[]),l=I(),u=c.useCallback(()=>o(!1),[]);return e.jsxs(e.Fragment,{children:[e.jsx(Q,{contentAlign:"center",triggerButton:e.jsx(f.Trigger,{}),children:t?t.map(a=>c.createElement(f.Item,{...s,key:a.display_name,voiceStatusMode:a,onShowModal:d})):e.jsx("div",{role:"progressbar","aria-valuetext":l.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:e.jsx(_,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),e.jsx(f.Modal,{conversationId:s.conversationId,disabledModeMetadata:i,isOpen:n,onClose:u})]})}f.Modal=function(t){const n=t.disabledModeMetadata?.buttons??[],o=ie({buttons:n,conversationId:t.conversationId,onClick:t.onClose}),i=e.jsx(H,{children:t.disabledModeMetadata?.description_markdown});return e.jsx(L,{testId:"modal-voice-mode",title:t.disabledModeMetadata?.title,description:i,isOpen:t.isOpen,onClose:t.onClose,type:"success",primaryButton:o.primary,secondaryButton:o.secondary})};f.Trigger=c.forwardRef(function(t,n){const o=p(i=>i.voiceMode);return e.jsxs(K,{ref:n,...t,children:[de(o)??e.jsx(_,{}),e.jsx(Y,{className:"icon text-token-text-tertiary"})]})});f.Item=function({conversationId:t,parentMessageId:n,voiceStatusMode:o,onShowModal:i}){const{disabled_mode_metadata:r,mode:d}=o,{startVoiceMode:l}=ae(),u=b(t),a=c.useCallback(async()=>{r?i(r.disabled_message):l(oe({serverThreadId:u,parentMessageId:n,isAdvancedMode:d==="advanced"&&!r,eventSource:"voice_mode_picker",clientThreadId:t,gizmoId:k.getGizmoId(N(t)),skipCacheReason:"debug-button-clicked"}))},[t,r,d,i,n,u,l]);return e.jsx(W.Item,{onClick:a,children:e.jsxs("div",{children:[o.display_name,e.jsx("div",{className:"text-token-text-tertiary text-xs",children:o.description})]})})};function Be({conversationId:s}){const t=p(n=>n.voiceSessionId);return e.jsx("div",{className:"relative h-full",children:e.jsx(g.div,{className:"border-s-token-sidebar-surface-secondary bg-token-main-surface-secondary absolute hidden h-full max-w-[500px] overflow-y-hidden rounded-xl border-s pt-4 shadow-inner md:block",initial:{opacity:0,x:520,width:"0px"},animate:{opacity:1,x:0,width:"500px",left:"-520px"},exit:{opacity:0,x:520,width:"0px",left:"0px"},transition:{type:"tween"},children:e.jsx(C,{children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(ue,{conversationId:s})}),e.jsxs("div",{className:"p-4 py-2 text-sm",children:[e.jsx(x,{name:"Voice Session ID",text:t??"n/a"}),e.jsx(me,{conversationId:s})]}),e.jsxs("div",{className:"flex h-full w-full flex-col flex-nowrap gap-4",children:[e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex flex-col flex-nowrap gap-4",children:[e.jsx(xe,{}),e.jsx(fe,{})]})}),e.jsx(pe,{})]})]})})})})}function me({conversationId:s}){const t=b(s),n=t&&N(t),o=k.getTree(n),r=p(m=>m.server.messages.findLast(v=>v.type===V.ConversationUpdate))?.payload.parent_message_id,d=r?o.findNode(m=>m.message.author.role==="assistant"&&$.isMultimodalTextMessage(m.message),r):void 0,{model_definition_slug:l,model_definition_virtual_model_id:u}=d?.message.metadata?.__internal??{},a=[l,u].filter(Boolean).join(", ")??"pending model response";return e.jsx(x,{name:"Model ID",text:a,allowWrap:!0})}function xe(){const[s,t]=c.useState("timestamp"),[n,o]=c.useState("asc"),i=p(a=>a.server.messages.filter(m=>m.type===V.Performance)),r=i[i.length-1],d=c.useCallback(a=>a>=1e3?`${(a/1e3).toFixed(2)}s`:`${a.toFixed(1)}ms`,[]),l=c.useMemo(()=>r?[...r.payload.metrics].sort((a,m)=>{const v=s==="name"?a.name.localeCompare(m.name):a.ms-m.ms;return n==="asc"?v:-v}):[],[r,s,n]);if(!r)return null;const u=a=>{a===s?o(n==="asc"?"desc":"asc"):(t(a),o("asc"))};return e.jsx(O,{title:"Performance",children:e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(S,{text:"Metric"}),s==="name"?n==="asc"?e.jsx(M,{}):e.jsx(j,{}):null]}),e.jsxs("div",{className:"flex cursor-pointer flex-row items-center",onClick:()=>u("timestamp"),children:[e.jsx(S,{text:"Timestamp"}),s==="timestamp"?n==="asc"?e.jsx(M,{}):e.jsx(j,{}):null]}),l.map(a=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm",children:a.name},a.name),e.jsx("span",{className:"bg-token-main-surface-tertiary line-clamp-1 rounded-lg p-0.5 px-1 font-mono text-xs",children:d(a.ms)},a.name+a.ms)]}))]})})}function pe(){const s=p(t=>t.server.messages);return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-token-text-secondary px-4 py-2 text-lg font-semibold",children:"Messages"}),e.jsx("div",{className:"grow overflow-hidden",children:e.jsx(z,{children:e.jsx(g.ul,{className:"pointer-events-none flex w-full flex-col gap-4 pt-4 pb-24",initial:"initial",animate:"animate",exit:"exit",variants:B,transition:{delayChildren:.25,staggerChildren:.05},children:s.map((t,n)=>e.jsx(he,{index:n,message:t},n))})})})]})}function fe(){const s=p(l=>l.server.connectionState),t=p(l=>l.dev.room),[n,o]=c.useState("Unknown"),i=t?.localParticipant,r=t?.numParticipants??"Unknown",d=t?.activeSpeakers??[];return c.useEffect(()=>{if(i){const l=u=>{o(u)};return i.on("connectionQualityChanged",l),()=>{i.off("connectionQualityChanged",l)}}},[i]),e.jsxs(O,{title:"Room",open:!1,children:[e.jsx(x,{name:"Connection Quality",text:String(n)}),e.jsx(x,{name:"Connection State",text:String(s)}),e.jsx(x,{name:"Participants",text:r}),e.jsx(x,{name:"Speakers",text:d.length}),e.jsx(ve,{})]})}function ve(){const s=p(m=>m.dev.room),[t,n]=c.useState(null),[o,i]=c.useState(null),[r,d]=c.useState(null),l=s?.getActiveDevice("audioinput"),u=s?.getActiveDevice("audiooutput"),a=s?.getActiveDevice("videoinput");return c.useEffect(()=>{async function m(){const v=await y.getLocalDevices("audioinput"),U=await y.getLocalDevices("audiooutput"),T=await y.getLocalDevices("videoinput"),F=v.find(h=>h.deviceId===l),P=U.find(h=>h.deviceId===u),E=T.find(h=>h.deviceId===a);n(F?.label??"Unknown"),i(P?.label??"Unknown"),d(E?.label??null)}m()},[l,u,a]),e.jsxs(e.Fragment,{children:[e.jsx(S,{text:"Devices"}),r?e.jsx(x,{icon:Z,name:"Video Input",text:r}):null,e.jsx(x,{icon:ee,name:"Audio Input",text:t??"Unknown"}),e.jsx(x,{icon:ne,name:"Audio Output",text:o??"Unknown"})]})}function O({title:s,titleClassName:t,children:n,open:o}){const[i,r]=c.useState(o??!0);return e.jsxs("div",{children:[e.jsxs("h3",{className:A("text-token-text-secondary flex cursor-pointer items-center py-2 text-lg font-semibold",t),onClick:()=>r(!i),children:[e.jsx("span",{children:s}),e.jsx("span",{className:"ms-2",children:i?e.jsx(j,{className:"icon-sm"}):e.jsx(M,{className:"icon-sm"})})]}),e.jsx(C,{initial:!1,children:i&&e.jsx(g.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{height:"auto",opacity:1},collapsed:{height:0,opacity:0}},transition:{duration:.3,ease:"easeInOut"},layout:!0,children:n},"content")})]})}function S({text:s}){return e.jsx("h4",{className:"py-2 text-sm font-semibold",children:s})}function x(s){return e.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[e.jsx("span",{className:"opacity-85",children:s.icon?e.jsx(s.icon,{className:"h-[0.75rem] w-[0.75rem]"}):e.jsxs("span",{className:"text-sm",children:[s.name,":"]})}),s.content??e.jsx("span",{className:A(["bg-token-main-surface-tertiary rounded-lg p-0.5 px-1 font-mono text-xs",!s.allowWrap&&"line-clamp-1"]),children:s.text})]})}function he({index:s,message:t}){const[n,o]=c.useState(!1),i=I();let r=null;switch(t.source){case"remote":r=se;break;case"local":r=te;break}return e.jsx(g.div,{className:"border-token-main-surface-tertiary w-full border-t p-4",variants:B,children:e.jsxs("div",{className:"bg-token-main-surface-secondary flex w-full flex-col gap-2 rounded-lg",children:[e.jsxs("div",{className:"text-token-text-secondary font-mono text-[0.65rem] font-semibold",children:[e.jsxs("div",{className:"flex w-full flex-row flex-nowrap items-center justify-between",children:[e.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:[e.jsx(r,{className:"text-token-text-secondary h-3 w-3"}),e.jsx("span",{children:` | ${s+1} | ${i.formatDate(t.timestamp,{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:2})}`})]}),e.jsx("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:e.jsx(q,{className:"rounded-full p-0.5",color:"ghost",size:"small",onClick:()=>o(d=>!d),children:e.jsx(j,{className:`transform transition-transform ${n?"rotate-180":""}`})})})]}),e.jsx("div",{className:"mt-1 text-xs font-bold",children:t.type})]}),e.jsx(C,{children:n?e.jsx(g.pre,{initial:{opacity:0,transform:"blur(4px)"},animate:{opacity:1,transform:"blur(0px)"},exit:{opacity:0,transform:"blur(4px)"},className:"bg-token-main-surface-tertiary text-token-text-secondary overflow-x-auto rounded-md p-2 text-xs",children:JSON.stringify(t.payload,null,2)}):null})]})})}const B={hidden:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:100}};export{Be as VoiceModeDevPanel};
//# sourceMappingURL=j2k3g2iltcl8vjs8.js.map
