import{r as S,j as s}from"./juy90og0wtbp77qa.js";import{C as G}from"./oxbvaq32hx04hocl.js";import{D as q}from"./n6h2c0196v3vnzav.js";import{T as J,a as K,A as k,u as Q,i as X,C as Y,g as Z}from"./jsqa2yve28fnwvvj.js";import{C as $,b as z}from"./9k8yv4dhh02fqujo.js";import{C as V}from"./du2o33bqvziie5hn.js";import{b as tt,d as et,e as ot,f as U}from"./l7ivca7g8ik3mk13.js";import{C as rt}from"./jy1u8exw8iz2slve.js";import{g as nt,ds as st,iU as M,iV as it}from"./ckp56qklot786ulr.js";import{cl as lt}from"./dc2xxjkicf2pz0mj.js";import{u as at}from"./f5uxfkqdhg7743lt.js";import{C as ct}from"./m1q7suu3m36z180t.js";import"./gn1kkezdsm9hi3t4.js";import"./nmh9rh1es9yfc7rh.js";import"./h9ri4w2fyqo4qlva.js";import"./j2sppl86ksonjlwy.js";import"./io7lcvt8htau8h6d.js";import"./dmfmxszxfbs8gsbx.js";import"./f76gy0b8ieo4s693.js";import"./pbd6thieshvvjfa0.js";import"./nc631yunytu8n0fx.js";import"./l7m4sdxmp3n9y1x8.js";import"./e2fyqefjfccaah4p.js";function mt(t,e){const r=t.doc.lineAt(e.from);return e.from===r.from&&e.to-1===r.to}function dt(t){const e=t.dom.querySelector(".cm-gutters");return e?e.offsetWidth:0}const ut=({onAddComment:t,isSendDisabled:e=!1,isWaitingForCommentResponse:r=!1})=>{const o=tt(),f=et(),a=ot(),L=S.useCallback(i=>{const{height:c,width:m}=i,n=o();if(!f||!n)return null;const d=f.selection.asSingle();if(d.ranges.length===0)return null;const l=d.ranges[0],{empty:D,to:O}=l;let{head:p}=l;const{platform:H}=nt();p=H==="web"?p:O;const g=p===O;let C=p;if(g&&mt(f,l)&&(C-=1),D)return null;const{left:v,top:x,bottom:R}=n.contentDOM.getBoundingClientRect(),{left:w,top:N,bottom:h}=lt(n.coordsAtPos(C,g?-1:1)),E=dt(n);function A(){if(g)return Math.max(w-v+E-m,E);let u=w-v+E;return u+m>a&&(u=-(m-a)),u}function _(u){const W=c*2,j=u.contentHeight-(h-R)>W&&window.innerHeight-h>W,y=h-x+8,B=N-x-c-8;return g&&j||B<0?{top:y,aboveOrBelow:k.BELOW}:{top:B,aboveOrBelow:k.ABOVE}}const b=_(n);return{left:A(),top:b.top,aboveOrBelow:b.aboveOrBelow,toolbarSize:i}},[f,o,a]),I=S.useCallback(()=>o()?.dom??null,[o]);return s.jsx(J,{onAddComment:t,isWaitingForCommentResponse:r,isSendDisabled:e,toolbarType:K.CODE,getToolbarPosition:L,getEditorDom:I,getSelectionRange:()=>{const i=o();if(!i)return null;const{state:c}=i,m=c.selection.asSingle();if(m.ranges.length===0)return null;const n=m.ranges[0],{from:d,to:l}=n;return d==null||l==null?null:{from:d,to:l,sourceFrom:d,sourceTo:l}}})};function ft({diff:t}){return Q(t?.edits??[]),null}function pt(t,e,r){const o=r?Z():0;return t<=1e3-o?t-(e?$:0):t-(e?z:0)}const Gt=({comments:t,currentlyStreamingLineIndex:e,isPreview:r=!1,isWaitingForCommentResponse:o=!1,isSendDisabled:f=!1,readonlyReason:a,isRequestActive:L=!1,language:I,value:i,textdocDiff:c,onAcceleratorsExpandedChange:m,onAddComment:n,onAcceptComment:d,onDismissComment:l,onBlur:D,onSave:O,onChange:p,onCancelRequest:H,getStableCommentId:g=it,commentsMode:C=V.ENABLED,hideToolbar:v,hideAccelerators:x=!1,onSubmitAccelerator:R,modelCursor:w,codemirrorRef:N})=>{const h=S.useRef(null),E=st(),[{width:A},_]=at(),b=S.useRef(null),u=t.length>0,W=b.current,j=pt(A,u,X(W)??!1),y=U(({commentingOn:T})=>T),B=U(({hoveredCommentId:T})=>T),F=U(({focusedCommentId:T})=>T);S.useEffect(()=>{h.current?.UNSAFE_setValue(i||"")},[i]);const P=A-j;return s.jsx("div",{className:rt.code,ref:M(_,b),style:E&&r?{margin:"0 16px"}:{},children:s.jsxs(G,{id:"codemirror",comments:C===V.ALL_HIDDEN?void 0:t,commentingOn:y,currentlyStreamingLineIndex:e,hoveredCommentId:B,focusedCommentId:F,language:I,readonlyReason:a,onChange:p,value:i,textdocDiff:c,editorRef:M(h,N),width:j,modelCursor:w,isPreview:r,hideLineNumbers:E&&r,onBlur:D,onSave:O,children:[s.jsxs(G.EditorChildren,{children:[!v&&s.jsx(ut,{onAddComment:n,isSendDisabled:f,isWaitingForCommentResponse:o}),C!==V.ALL_HIDDEN&&s.jsx("div",{className:u?"me-4":"",children:s.jsx(Y,{getStableCommentId:g,availableWidth:P,comments:t,commentsMode:C,onAddComment:n,onAcceptComment:d,onDismissComment:l,isWaitingForCommentResponse:o,isRequestActive:L,disableBlockComments:!0})})]}),s.jsxs(G.ContextChildren,{children:[c&&s.jsx(ft,{diff:c}),!x&&s.jsx(q,{isRequestActive:L,isVisuallyHidden:f||!!a?.isStreamingFromNative||a?.isReadonly&&!a.isStreaming,onSubmit:R,onCancel:H,actions:ct,onExpandedChange:m})]})]})})};export{Gt as CodeComposer};
//# sourceMappingURL=dtfhive2hodlq0ri.js.map
