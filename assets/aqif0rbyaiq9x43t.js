import{r as C,h as y,j as n,A as R,m as T}from"./juy90og0wtbp77qa.js";import{ds as S,i4 as L,i1 as B,i0 as D,i2 as F,dw as Q,gj as N,gz as O,bW as b,kR as a,kr as q,bX as w,aC as P,ar as _,kS as U,dR as I,o as W}from"./dc2xxjkicf2pz0mj.js";import{b4 as h,eB as k,eC as Z,b5 as $,b3 as H,eD as K,eE as G,b8 as V,eF as X}from"./ckp56qklot786ulr.js";const J=e=>C.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e},C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.74709 9.4286C4.09594 9.54326 4.47122 9.35358 4.58596 9.00478C5.08292 7.49281 6.19702 6.25947 7.62893 5.60243C8.06385 6.47457 8.96218 7.07502 10.003 7.07509C11.4688 7.07509 12.6572 5.88666 12.6572 4.42079C12.6572 2.9549 11.4688 1.76649 10.003 1.76649C8.58666 1.76659 7.43205 2.87614 7.35549 4.27333C5.45427 5.04691 3.9686 6.62635 3.32326 8.58974C3.20868 8.9386 3.39823 9.31394 3.74709 9.4286ZM11.3272 4.42079C11.3272 3.68944 10.7343 3.09657 10.003 3.09657C9.27168 3.09667 8.67873 3.6895 8.67873 4.42079C8.67875 5.15207 9.2717 5.74491 10.003 5.74501C10.7343 5.74501 11.3272 5.15213 11.3272 4.42079Z"}),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.4619 7.23427C15.2394 8.2087 15.7041 9.4424 15.7041 10.786C15.7041 10.9669 15.6951 11.1459 15.6787 11.3222C14.7046 11.2611 13.734 11.7399 13.2129 12.6425C12.4802 13.9118 12.9144 15.5346 14.1836 16.2675C15.453 17.0003 17.0767 16.5651 17.8096 15.2958C18.5164 14.0711 18.1344 12.5197 16.9668 11.7538C17.0104 11.4372 17.0332 11.114 17.0332 10.786C17.0332 9.13002 16.4602 7.6065 15.502 6.40517L15.3057 6.16982L15.2071 6.07704C14.9612 5.8895 14.6094 5.89431 14.3672 6.10536C14.1251 6.31651 14.0723 6.66436 14.2246 6.93349L14.3028 7.04286L14.4619 7.23427ZM16.1729 12.8222C15.5397 12.4566 14.7299 12.6743 14.3643 13.3075C13.999 13.9406 14.2158 14.7495 14.8487 15.1151C15.4819 15.4807 16.2917 15.264 16.6572 14.6308C17.0227 13.9976 16.806 13.1877 16.1729 12.8222Z"}),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.78713 12.6425C6.05428 11.3731 4.43147 10.9379 3.16213 11.6708C1.89304 12.4036 1.45791 14.0266 2.19045 15.2958C2.89893 16.5229 4.438 16.9667 5.68654 16.3329C6.87794 17.2613 8.37572 17.8172 10.003 17.8173C10.4526 17.8173 10.8932 17.7743 11.3203 17.6933C11.6812 17.6248 11.9181 17.2767 11.8496 16.9159C11.781 16.5553 11.433 16.3182 11.0723 16.3866C10.7265 16.4522 10.3689 16.4872 10.003 16.4872C8.77108 16.4872 7.63223 16.0956 6.70022 15.4315C7.23668 14.6191 7.30697 13.5429 6.78713 12.6425ZM5.63576 13.3075C5.27019 12.6743 4.46037 12.4566 3.82717 12.8222C3.19401 13.1877 2.97733 13.9976 3.3428 14.6308C3.70838 15.264 4.51818 15.4807 5.15139 15.1151C5.78423 14.7495 6.00103 13.9406 5.63576 13.3075Z"}));function Me({messages:e,isRequestActive:t,isLastMessageInTurn:s,isRetrieval:r,isUsingGizmo:i,isUsingSnorlax:o}){const c=ge({messages:e}),d=Y(e),u=d.filter(m=>le(m,!1)&&!ie(m)),f=u[u.length-1]??void 0,l=y();if(ce(e).some(({content:m})=>m.content_type===b.SystemError))return null;let g=h.Running;const A=u.filter(m=>m.type===a.Search).length,M={count:u.length-A,domain:f?k(x(f)??""):void 0,query:f?E(f):void 0};let p=r?i?o?l.formatMessage(Z.searchingProjectFiles):l.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):l.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):l.formatMessage({id:"message.tools.browse.running",defaultMessage:"Searching the web"});return e.some($)?(g=h.Stopped,p=r?i?l.formatMessage({id:"browsingMessage.searchingKnowledgeStopped",defaultMessage:"Stopped searching knowledge"}):l.formatMessage({id:"browsingMessage.retrievalStopped",defaultMessage:"Stopped reading documents"}):l.formatMessage({id:"message.tools.browse.stopped",defaultMessage:"Search stopped"})):!s||!t?d.length>0&&d.every(m=>m.didError)?(g=h.Error,p=r?i?l.formatMessage({id:"browsingMessage.searchingKnowledgeFailed",defaultMessage:"Error searching knowledge"}):l.formatMessage({id:"browsingMessage.retrievalFailed",defaultMessage:"Error reading documents"}):l.formatMessage({id:"message.tools.browse.failed",defaultMessage:"Search failed"})):(g=h.Finished,p=r?null:M.count===0?l.formatMessage({id:"message.tools.browse.started",defaultMessage:"Searching the web..."}):l.formatMessage({id:"message.tools.browse.finished",defaultMessage:"Searched {count, plural, =0 {0 sites} one {# site} other {# sites}}"},M)):c.length>0?p=me({contextualAnswerSources:c,intl:l}):u.length>0&&(p=ne(l,M,r,i,u[u.length-1])),(u.length>0||r&&s)&&g!==h.Error?n.jsx(H,{highlightedCommand:p,showWorkUserSetting:!1,status:g,children:u.length===0?null:n.jsx(z,{commands:u})}):n.jsx(ue,{$isError:g===h.Error,children:p})}function v(e){return e.metadata?.command==="quote"||e.metadata?.command==="quote_full"||e.metadata?.command==="quote_lines"}function Y(e){return e.map((t,s)=>{if(t.author.role!==w.Tool||s>0&&v(t)&&v(e[s-1]))return null;const r=t.metadata;if(!r)return null;const{command:i,status:o}=r;return i?{type:i,status:o,didError:t.content.content_type===b.SystemError,message:t}:null}).filter(K)}function z({commands:e}){const t=y();return n.jsx("div",{className:"divide-token-border-default border-token-border-default mb-4 divide-y rounded-xl border text-sm",children:n.jsx(R,{initial:!1,children:e.map((s,r)=>{const i=ae(s);if(i==null)return null;const{icon:o,url:c,title:d,externalLink:u}=i,f=c?k(c):void 0,l=d?typeof d=="string"?d:t.formatMessage(d):null,g=c&&G(c);return n.jsx(T.div,{initial:"collapsed",animate:"open",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:n.jsxs(ee,{url:u??c,className:_("flex items-start gap-3 px-4 py-3",d?"text-token-text-secondary":"text-token-text-primary",r===0&&"rounded-t-xl",r===e.length-1&&"rounded-b-xl"),children:[o?n.jsx(o,{className:"icon-sm text-token-text-secondary mt-0.5 shrink-0"}):c?n.jsx(V,{url:c,className:"mt-1"}):null,n.jsxs("div",{children:[l&&n.jsxs("div",{className:"text-token-text-primary line-clamp-1",children:[g&&`${g} — `,l]}),n.jsx("div",{children:f})]})]})},r)})})})}function ee({url:e,children:t,className:s}){return e?n.jsxs("a",{href:e,target:"_blank",className:_(s,"group hover:bg-token-main-surface-secondary relative"),rel:"noreferrer",children:[t,n.jsx("div",{className:"from-token-main-surface-secondary invisible absolute end-3 bg-linear-to-l to-transparent ps-4 group-hover:visible",children:n.jsx(I,{className:"icon text-token-text-secondary"})})]}):n.jsx("div",{className:s,children:t})}function te(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.title:null}function E(e){return e.message.metadata?.args?.[0]}function ae(e){switch(e.type){case a.Search:{const t=e.message.metadata?.search_engine;if(t&&t!==U.Bing)return null;const s=E(e);return{icon:X,url:e.message.metadata?.message_source==="apple"?null:"bing.com",externalLink:re(e),title:s?`“${s}”`:{id:"message.tools.browse.querying",defaultMessage:"Querying",description:"Status message when issuing a query"}}}case a.Click:case a.MultiClick:case a.Lookup:case a.OpenUrl:case a.Open:case a.Quote:case a.QuoteFull:case a.QuoteLines:case a.Scroll:return{url:x(e),title:te(e)??void 0};case a.Spinner:case a.Back:return null}}function se(e){const t=new URLSearchParams({query:e.query});return`${W}/bing/redirect?${t.toString()}`}function re(e){const t=e.message.metadata?.args?.[0];return t===void 0?null:se({query:t})}function ne(e,t,s,r,i){switch(i?.type){case a.Click:case a.MultiClick:case a.Lookup:case a.OpenUrl:case a.Quote:case a.QuoteFull:case a.QuoteLines:case a.Scroll:case a.Open:case a.Back:return e.formatMessage({id:"message.tools.browse.reading",defaultMessage:"Browsing {domain}"},t);case a.Search:case void 0:return s?r?e.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):e.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):e.formatMessage({id:"message.tools.browse.searching",defaultMessage:'Searching "{query}"'},t);case a.Spinner:return null}}function oe(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type==="file"?t.name:null}function le(e,t){switch(e.type){case a.Search:return!0;case a.Click:case a.Lookup:case a.MultiClick:case a.OpenUrl:case a.Quote:case a.QuoteFull:case a.QuoteLines:return t?oe(e)!=null:x(e)!=null;case a.Open:case a.Back:case a.Scroll:case a.Spinner:return!1}}function ie(e){return e.message.metadata?.message_source==="apple"}function x(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.url:null}function ce(e){return e.filter(t=>t.author.role===w.Tool)}const ue=P.p`first:mt-0 my-1.5 h-8 flex items-center ltr:me-auto rtl:ms-auto empty:hidden
${({$isError:e})=>e?"text-token-text-error":"text-token-text-secondary"}`,j={google_drive:"Google Drive",slack:"Slack",github:"GitHub",slurm_sharepoint:"SharePoint",slurm_linear:"Linear",slurm_box:"Box",slurm_dropbox:"Dropbox",slurm_gmail:"Gmail",slurm_google_drive:"Google Drive"},de={google_drive:S,slack:O,github:N,slurm_sharepoint:Q,slurm_linear:F,slurm_box:D,slurm_dropbox:B,slurm_gmail:L,slurm_google_drive:S},ge=({messages:e})=>[...e.filter(q).reduce((r,i)=>(i.metadata?.retrieval_search_sources?.forEach(o=>{(o.product_type==="contextual_answers"||o.product_type==="slurm")&&o.source_name in j&&r.add(o.source_name)}),r),new Set)],me=({contextualAnswerSources:e,intl:t})=>{const s=e.map(o=>j[o]??o).filter(Boolean),r=e.map(o=>{const c=de[o]??J;return n.jsx(c,{className:"icon-sm"},o)}).filter(Boolean),i=e.length===1?t.formatMessage({id:"Jzt2om",defaultMessage:"Reading {source}"},{source:s[0]}):e.length===2?t.formatMessage({id:"wTM7gR",defaultMessage:"Reading {source1} and {source2}"},{source1:s[0],source2:s[1]}):t.formatMessage({id:"xnwjH1",defaultMessage:"Reading {source1}, {source2} and more"},{source1:s[0],source2:s[1]});return e.length>0?n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"flex items-center gap-1",children:r}),i]}):void 0};export{Me as BrowsingMessage,de as CA_SOURCE_TO_ICON_MAP,j as CA_SOURCE_TO_TEXT_MAP,ge as getCASources,me as getContextualAnswerDisplayText,x as getVisitedUrl};
//# sourceMappingURL=aqif0rbyaiq9x43t.js.map
