import{R,r as d,j as s,M as _,m as h,A,h as M}from"./juy90og0wtbp77qa.js";import{dg as S,e9 as I,aT as v,$ as G,b3 as B,b2 as E,kQ as w,jX as q,ar as c,gb as z,ay as H}from"./dc2xxjkicf2pz0mj.js";import{T as L}from"./hzt0out7duc1y2m3.js";import{ei as V,ej as O,ek as D,el as F}from"./ckp56qklot786ulr.js";import{C as U}from"./kd37t55r0pqrdrzh.js";import{c as W}from"./cmuryoxww53hql5u.js";import"./mohn9bb09oz621dz.js";import"./f5uxfkqdhg7743lt.js";import"./9k8yv4dhh02fqujo.js";import"./h52yy5f95o7r9b4p.js";import"./l7ivca7g8ik3mk13.js";import"./jy1u8exw8iz2slve.js";import"./f76gy0b8ieo4s693.js";import"./gy64pge8qevmvg7e.js";import"./mia7txooqhkpbw7w.js";import"./dmfmxszxfbs8gsbx.js";import"./gr34ca5bfgzamfz1.js";import"./oxbvaq32hx04hocl.js";import"./gn1kkezdsm9hi3t4.js";import"./nmh9rh1es9yfc7rh.js";import"./h9ri4w2fyqo4qlva.js";import"./j2sppl86ksonjlwy.js";import"./io7lcvt8htau8h6d.js";import"./f95fqffr5vb5pioe.js";import"./o8hspyy2fyv2o9n5.js";import"./f3gnxwjbhhemaa6w.js";import"./pc2givv05uuq8g6l.js";import"./gjz0pgmiqrjm9uho.js";import"./f5x7owcyj5iwmbsb.js";import"./llrie03z1kvfi4vu.js";import"./o6wb3ptvu0bk81yq.js";import"./jsgl3b1bt1ozctr5.js";import"./dq2hdjj12gdqq0p1.js";import"./ezqsz68yx4uzdtqb.js";import"./mre9dehcylnm0d4q.js";import"./ck00y48d3yzt8bq3.js";function $({turn:e,turnIndex:t,clientThreadId:n,hasActiveRequest:o,isFinalTurn:a}){return s.jsx(U,{turnIndex:t,clientThreadId:n,groupedMessagesToRender:e.messageGroups,allGroupedMessages:e.messageGroups,allMessages:e.messages,isUserTurn:e.role==="user",isFinalUserTurn:!1,isFinalAssistantTurn:!1,isFinalTurn:a,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,hasActiveRequest:o,onRequestCompletion:()=>{},renderingView:"share-modal"})}function K({messages:e,hasActiveRequest:t,clientThreadId:n,allowOrphanMessages:o}){const{session:a}=S(),m=d.useMemo(()=>{if(n)return null;const r=I();return v.initThread({clientThreadId:r,conversationMode:{kind:G.PrimaryAssistant},userId:a?.user?.id,accountId:a?.account?.id}),r},[]),x=n??m,l=d.useMemo(()=>{const r=B(x);if(r&&x===n){let u=[];for(const j of e){let b=j;const g=E.findNode(r,({message:T})=>j.id===T.id);!g&&!o||(g&&(b=g.message),u=w(u,b))}return u}const{allConversationMessages:i,threadResponse:p}=W(e);v.updateThreadFromServer(x,p);let f=[];for(const u of i)f=w(f,u.message);return f.filter(u=>u.role!=="root")},[e,x,n,o]);return s.jsx("div",{className:"space-y-2",children:l.map((r,i)=>s.jsx($,{turn:r,turnIndex:i,clientThreadId:x,hasActiveRequest:t,isFinalTurn:i===l.length-1},r.messages[0].id))})}const Q=R.memo(K),X=d.memo(L,(e,t)=>e.sharedTextdoc.sharedTextdocId===t.sharedTextdoc.sharedTextdocId&&e.showHeader===t.showHeader&&e.disableNetworkRequests===t.disableNetworkRequests&&e.unsafeAllowAllNetworkRequests===t.unsafeAllowAllNetworkRequests&&e.disablePermissions===t.disablePermissions);function C({children:e,className:t,fullscreen:n}){const o=d.useRef(null),[a,m]=d.useState(!1),l=H()?"#353535":"#fff";return d.useEffect(()=>{const r=o.current;if(!r)return;const i=()=>m(r.scrollHeight>r.clientHeight);i();const p=new ResizeObserver(i);return p.observe(r),()=>{p.disconnect()}},[e]),s.jsxs("div",{ref:o,className:c(!n&&"relative",t,!a&&"pb-2"),children:[e,!n&&a&&s.jsx("div",{className:"pointer-events-none absolute start-0 end-0 bottom-0 h-40",style:{background:`linear-gradient(to top, ${l}, transparent)`}})]})}function Ue(){return s.jsx("div",{className:"w-full",children:s.jsx("div",{className:"bg-token-main-surface-secondary mx-auto block h-[120px] rounded-3xl",children:s.jsx(q,{})})})}const k={deep_research:s.jsx(F,{title:"Deep Research",className:"h-[16px] w-[16px]"}),canvas:s.jsx(D,{title:"Canvas",className:"h-[16px] w-[16px]"}),image:s.jsx(O,{title:"Image",className:"h-[16px] w-[16px]"}),sora:s.jsx(V,{title:"Sora",className:"h-[16px] w-[16px]"})},J={deep_research:"Deep Research",canvas:"Canvas",image:"ImageGen",sora:"Sora"},Y=({icon:e,label:t})=>s.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-white/80 px-2 py-1 text-xs text-black backdrop-blur-xs dark:bg-black/50 dark:text-white",children:[e,s.jsx("span",{className:"font-semibold",children:t})]}),We=({tags:e,badgeLabels:t})=>{const n=e.filter(o=>!!k[o]);return n.length===0?null:s.jsx("div",{className:"absolute end-3 top-3 z-10 flex gap-2",children:n.map(o=>s.jsx(Y,{icon:k[o],label:t?.[o]??(J[o]||o)},o))})};function Z({url:e,attachment_width:t,attachment_height:n,isFullscreen:o}){return s.jsx("video",{className:c(o?"mx-auto block max-h-screen max-w-full rounded-none object-contain":"mx-auto block w-full rounded-3xl object-cover object-center"),style:{aspectRatio:t/n},src:e,playsInline:!0,autoPlay:!0,muted:!0,loop:!0})}const P=d.memo(Z);function ee({attachment:e,isFullscreen:t,isInline:n,isComposer:o}){return s.jsx("div",{className:c(t&&"flex h-screen items-center justify-center",t&&"rounded-none",n&&"rounded-3xl",o&&"mx-24 rounded-3xl"),children:e.generation_type==="video_gen"?s.jsx(P,{url:e.url,attachment_width:e.width,attachment_height:e.height,isFullscreen:t,isInline:n}):s.jsxs("div",{className:"relative",children:[s.jsx("img",{className:c(t?"mx-auto block max-h-screen max-w-full rounded-none object-contain":"mx-auto block rounded-3xl object-cover object-center"),style:{aspectRatio:e.width/e.height},src:e.url,alt:e.kind}),e.output_blocked&&s.jsxs("div",{className:"text-token-text-error absolute start-0 bottom-0 flex h-1/4 w-full items-center justify-center gap-1 bg-transparent text-xs font-medium",children:[s.jsx(z,{className:"text-red-500"}),s.jsx(_,{id:"post-tree-attachment-output-blocked",defaultMessage:"Blocked by moderation"})]})]})})}const se=d.memo(ee);function te({url:e,isFullscreen:t,isInline:n,isComposer:o,isUnfurl:a}){const m=M();return s.jsx("div",{className:c(t&&"flex h-screen items-center justify-center",t&&"rounded-none",n&&"rounded-3xl",o&&"mx-24 rounded-3xl",a&&"h-full w-full"),children:s.jsx("img",{src:e,className:c(t?"mx-auto block max-h-screen max-w-full":"mx-auto block aspect-square",t?"rounded-none object-contain":a?"h-full w-full rounded-none object-cover object-top":"rounded-3xl object-center"),alt:m.formatMessage({id:"image-share-renderer-alt",defaultMessage:"User Shared Image"})})})}const N=d.memo(te);function ne({attachment:e,isFullscreen:t,isInline:n}){const o=d.useRef(null);return s.jsx("div",{ref:o,className:c("bg-token-main-surface-primary w-full",t?"h-[100vh] rounded-none":"",n?"h-[300px] cursor-zoom-in overflow-hidden rounded-3xl":"flex-1"),children:s.jsx(X,{disablePermissions:!t,sharedTextdoc:{sharedTextdocId:e.shared_textdoc_id,title:e.shared_textdoc.name,type:e.shared_textdoc.textdoc_type,content:e.shared_textdoc.content},showHeader:!1,unsafeAllowAllNetworkRequests:!0})})}const oe=d.memo(ne);function re({attachment:e,caption:t,variant:n,coverPhotoUrl:o,hasActiveRequest:a,clientThreadId:m}){const x=e.tags?.includes("deep_research"),l=n==="fullscreen",r=n==="inline",i=n==="composer",p=n==="unfurl";switch(e.kind){case"message_slice":return e.messages.length===0?null:s.jsx(y,{caption:t,variant:n,coverPhotoUrl:o,messages:e.messages,hasActiveRequest:a,hasCaption:!x,clientThreadId:m});case"conversation_share":{const f=e.share.linear_conversation.map(u=>u.message).filter(u=>u!=null);return f.length===0?null:s.jsx(y,{hasCaption:!1,caption:t,variant:n,coverPhotoUrl:o,messages:f,hasActiveRequest:a,clientThreadId:m})}case"image_share":return s.jsx(N,{url:e.file_public_url,isFullscreen:l,isInline:r,isComposer:i,isUnfurl:p});case"media_generation":return s.jsx(N,{url:e.url,isFullscreen:l,isInline:r,isComposer:i,isUnfurl:p});case"canvas":return s.jsx(oe,{attachment:e,isFullscreen:l,isInline:r});case"sora":return s.jsx(se,{attachment:e,isFullscreen:l,isInline:r,isComposer:i});case"shared_post":return null;case"link":return s.jsx(ie,{url:e.url,ogData:e.og_data,isFullscreen:l,isInline:r,isComposer:i});case"error":return s.jsx("div",{children:s.jsx(_,{id:"post-tree-attachment-error",defaultMessage:"Error loading attachment"})});default:return null}}function ae({url:e,ogData:t,isFullscreen:n,isInline:o,isComposer:a}){return s.jsx(h.div,{layout:"position",className:c("bg-token-main-surface-primary inline-block w-full rounded-3xl dark:bg-[#353535]",n&&"h-screen overflow-auto rounded-none",a&&"shadow-[0_12px_24px_-6px_rgb(0_0_0_/_0.1),0_0_1px_rgb(0_0_0_/_0.2)] dark:shadow-[0_10px_20px_-6px_rgb(20_20_20_/_0.5),inset_0_0_1px_rgb(255_255_255_/_0.3)]"),children:s.jsx(C,{fullscreen:!o,className:c("rounded-b-3xl",n&&"relative p-4 lg:px-24 lg:py-24"),children:s.jsx("div",{className:"flex flex-col gap-2 p-4",children:s.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"text-token-main-surface-secondary break-words hover:underline",children:s.jsxs("div",{className:"items-top flex flex-row gap-4",children:[t.og_image&&s.jsx("img",{className:"h-40 w-40 object-cover",src:t.og_image,alt:t.og_title??void 0}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("div",{className:"text-token-text-primary font-medium",children:t.og_title||e}),t.og_site_name&&s.jsx("div",{className:"text-token-text-tertiary",children:t.og_site_name}),t.og_description&&s.jsx("div",{className:"text-token-text-secondary",children:t.og_description})]})]})})})})})}const ie=d.memo(ae);function y({caption:e,variant:t,coverPhotoUrl:n,messages:o,hasActiveRequest:a,hasCaption:m,clientThreadId:x}){const l=t==="fullscreen",r=t==="inline",i=t==="composer",p=t==="unfurl";return s.jsxs(h.div,{layout:"position",className:c("bg-token-main-surface-primary inline-block w-full rounded-3xl dark:bg-[#353535]",l&&"h-screen overflow-auto rounded-none",i&&"shadow-[0_12px_24px_-6px_rgb(0_0_0_/_0.1),0_0_1px_rgb(0_0_0_/_0.2)] dark:shadow-[0_10px_20px_-6px_rgb(20_20_20_/_0.5),inset_0_0_1px_rgb(255_255_255_/_0.3)]",p&&"h-full"),children:[n&&s.jsx("img",{className:c("max-h-[300px] w-full object-cover object-center",{"rounded-t-3xl":t!=="fullscreen","rounded-none":l}),src:n,alt:e??""}),s.jsx(C,{fullscreen:!r,className:c("rounded-b-3xl",l&&"relative p-4 lg:px-24 lg:py-24",r&&"max-h-[300px] overflow-hidden p-6",i&&"max-h-[300px] overflow-auto p-6",p&&"h-full overflow-hidden p-5"),children:s.jsxs(h.div,{layout:"position",transition:{type:"spring",duration:.45,bounce:.15},children:[s.jsx(A,{mode:"wait",children:m?e==null&&t==="composer"?s.jsx(h.div,{layout:"position",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:s.jsx("div",{className:"text-token-text-primary max-w-[460px] pb-8 text-2xl leading-[1.4] font-medium",children:s.jsx("span",{className:"animate-pulse opacity-30",children:s.jsx(_,{id:"placeholder.generatingTitle",defaultMessage:"Generating title..."})})})},"loading-caption"):e!==""?s.jsx(h.div,{layout:"position",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:s.jsx("div",{className:"text-token-text-primary max-w-[460px] pb-8 text-2xl leading-[1.4] font-medium",children:e})},"caption"):null:null}),s.jsx(Q,{messages:o,hasActiveRequest:a,clientThreadId:x,allowOrphanMessages:!0})]})})]})}const $e=d.memo(re);export{$e as AttachmentContent,J as BADGE_LABELS,Y as Badge,We as BadgeContainer,Ue as LoadingAttachmentContent,re as _AttachmentContent};
//# sourceMappingURL=jm2fboy2wgyq79ig.js.map
