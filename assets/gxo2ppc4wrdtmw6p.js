const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/nltpzxebhe9dq1nq.js","assets/dc2xxjkicf2pz0mj.js","assets/juy90og0wtbp77qa.js","assets/root-fv49dn40.css","assets/dmfmxszxfbs8gsbx.js","assets/ckp56qklot786ulr.js","assets/conversation-small-j9iamy23.css","assets/o6wb3ptvu0bk81yq.js","assets/iacposgqe14fuloa.js","assets/o7zrzew6ugefv8n2.js","assets/abebcwj1m9mup3z6.js","assets/nqj34k5dky4x5suq.js","assets/hort3ndd4wla0a2j.js","assets/jsgl3b1bt1ozctr5.js","assets/ck00y48d3yzt8bq3.js","assets/hczymk9ojq2shlcf.js","assets/hmjgn7ko3gx0yuxk.js","assets/kvlw7edoapaiqmyl.js","assets/o5pq53dj48f3y717.js","assets/dmc5z61nfanbjlao.js","assets/l3n51a2tb9b2qxpl.js","assets/mia7txooqhkpbw7w.js","assets/cwcmrfhs9uzogy8q.js","assets/gy64pge8qevmvg7e.js","assets/j1jics1jdjwk76ez.js","assets/m5qpa1z7i5l9dbng.js","assets/konqc7mws67zpcju.js","assets/d8drk78t30fy3sb4.js"])))=>i.map(i=>d[i]);
import{h as J,e as tt,r as c,j as e,M as H,m as z,f as Ps,H as Ca,I as Ma,aq as ts,A as As,u as Fs,R as Ia,p as wa}from"./juy90og0wtbp77qa.js";import{bD as ka,bE as Ra,bH as Ea,bJ as le,bK as Na,bL as Pa,bQ as Aa,bR as Fa,fx as Ds,a6 as Bs,qm as Da,i4 as Os,al as Ba,am as Oa,an as Ua,Z as qa,qn as Ha,qo as La,hP as Ga,qp as Va,qq as Wa,qr as za,bY as $a,qs as Ya,hK as Ka,iB as ss,c$ as Us,qt as Xa,mC as Je,lT as Qa,qu as Ja,qv as Za,qw as eo,qx as to,qy as qs,hy as so,fc as Hs,qz as xt,hA as no,qA as ns,qB as ao,jW as Ls,qC as as,qD as oo,qE as ro,qF as ze,qG as io,fV as Ce,dC as be,fS as lo,ls as co,qH as uo,qI as Gs,qJ as mo,kg as Vs,lu as go,fT as po,qK as Ws,f6 as ho,lR as fo,f8 as ce,ek as xo,k5 as vo,k6 as bo,lA as os,dy as yo,lB as So,e_ as zs,a3 as $s,fp as jo,qL as To,qM as _o,qN as Ys,qO as Co,pv as Mo,d3 as Ks,U as Xs,bM as Io,bN as wo,bO as ko,bP as Ro,qP as Eo,hN as No,qQ as Po,bp as Ao,qR as Fo,qS as Do,mN as Qs,e as Bo,a0 as Oo,a1 as Uo,hH as qo,n0 as Ho,ak as Lo,qT as Go,eX as Vo,qU as rs,qV as Wo,es as Js,qW as zo,qX as $o,hr as Yo,jx as Ko,o as Xo,bs as is,qY as Qo,qZ as Jo,q_ as Zo,q$ as er,r0 as tr,r1 as sr,r2 as nr,r3 as ar,mB as or,r4 as rr,r5 as ir,r6 as lr,r7 as cr,r8 as ls,r9 as dr,ra as ur,rb as mr,rc as gr,rd as pr,re as hr,rf as fr,jy as xr,mb as cs,rg as vr,as as br,fR as yr,rh as Sr,ri as jr,rj as Tr,eZ as _r,rk as Cr,rl as Mr,rm as Ir,rn as wr,ro as kr,ae as Rr,dB as Er,j9 as Nr}from"./ckp56qklot786ulr.js";import{ag as ke,R as Tt,by as ht,e$ as Pr,as as de,at as he,e as ne,je as ds,gP as us,gQ as ms,eG as Ar,aS as se,ap as Fr,eI as gs,eH as Dr,fa as Br,bd as Zs,bW as Me,D as Ze,cf as Or,hJ as en,aF as Ur,en as _t,aC as je,i as Re,j as Ct,e2 as Mt,aV as Qe,ak as pe,b2 as U,cx as tn,c8 as qr,c7 as sn,mu as nn,ar as q,S as re,mv as st,mw as Hr,C as Lr,aq as Gr,B as et,$ as Vr,eR as Wr,fj as ps,b3 as we,dM as N,bX as L,ay as zr,js as $r,bA as Ie,bD as It,ek as Yr,bT as an,k as wt,eP as on,A as Kr,cl as hs,P as V,ie as Se,h8 as rn,a5 as Xr,fQ as Qr,bi as ln,h2 as cn,fK as Jr,dO as Zr,dP as ei,kW as ti,dQ as si,bC as nt,mx as ni,b4 as dn,f as ye,iu as ai,ca as oi,a$ as ri,ae as ii,lY as fs,al as ve,cD as li,aG as ci,km as di,kq as ft,it as ui,bB as mi,h4 as gi,aY as pi,fM as hi,bj as un,jk as fi,jH as xi,jl as vi,jr as bi,fo as yi,ks as Si,dX as ji,aU as $e,my as Ti,cj as _i,ck as Ci,dq as Mi,eJ as Ii,gl as Ye,f_ as wi,hY as ki,kr as Ri,hH as Ei,j0 as Ni,kx as Pi,g5 as Ai,i7 as Fi,lK as Di}from"./dc2xxjkicf2pz0mj.js";import{c as Bi,u as vt}from"./o7zrzew6ugefv8n2.js";import{I as Oi}from"./cpgn1czk8eq48vzk.js";import{b as Ui,u as qi}from"./o6wb3ptvu0bk81yq.js";import{b as Hi,c as Li}from"./btouzu0b6h5eiejj.js";import"./l7m4sdxmp3n9y1x8.js";import{r as Gi}from"./dmfmxszxfbs8gsbx.js";import{a as Vi}from"./f5x7owcyj5iwmbsb.js";import{c as Wi,O as zi}from"./iacposgqe14fuloa.js";import{C as bt}from"./kd37t55r0pqrdrzh.js";import{a as mn}from"./jsgl3b1bt1ozctr5.js";import{m as $i}from"./llrie03z1kvfi4vu.js";const Yi=({image:t,onClose:n,onRequestCompletion:a,clientThreadId:s,currentModelId:o,post:r,canDelete:d,onOpenReport:l})=>{const i=J(),u=ke(),x=tt(),[p,v]=c.useState("default"),f=ka(),S=c.useRef(null),j=c.useRef(f);c.useEffect(()=>{j.current=f},[f]);const E=c.useCallback(()=>Ra(i),[i]),T=c.useCallback(()=>{t&&v("inpaint")},[t]),B=c.useCallback(()=>{v("default"),j.current.clearAllDrawings()},[]),I=c.useCallback(()=>{t&&Ea({url:t.url,fileName:E()})},[t,E]),A=c.useCallback(()=>S.current?.getImageData(),[]),w=c.useCallback(async()=>{if(window.confirm(i.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await Tt.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:r.id}}}),x("/",{replace:!0})}catch{u.danger({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post",description:"Error message for deleting a post"},{toastId:"post_receiver_modal.delete_post_error"})}},[r.id,i,u,x]),k=p==="inpaint"?i.formatMessage({id:"TjVqYb",defaultMessage:"Edit Selection"}):r.text??i.formatMessage({id:"htGxHc",defaultMessage:"Image"}),g=c.useCallback(b=>{b.key==="Escape"&&(n(),b.preventDefault())},[n]);return c.useEffect(()=>(document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)),[g]),e.jsx(ht.Root,{isOpen:!0,onClose:n,testId:"modal-lightbox-post-share",shouldIgnoreClickOutside:p==="inpaint",children:e.jsx(ht.Overlay,{children:e.jsxs(ht.Content,{size:"fullscreen",removePopoverStyling:!0,className:"grid min-h-0 grid-rows-[auto_minmax(0,1fr)] overflow-hidden",children:[e.jsxs("header",{className:"flex h-14 w-full items-center justify-between gap-2 px-2 md:px-4",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[e.jsx(le,{icon:Pr,onClick:n,"aria-label":i.formatMessage({id:"EYLKSm",defaultMessage:"Close"})}),e.jsx("h2",{className:"line-clamp-1 text-base font-medium",children:k})]}),e.jsx("div",{className:"flex items-center gap-2",children:p==="inpaint"?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"aspect-square",icon:Na,onClick:f.undoDrawing,disabled:!f.canUndoDrawing,"aria-label":i.formatMessage({id:"OmaTPx",defaultMessage:"Undo"})}),e.jsx(le,{className:"aspect-square",icon:Pa,onClick:f.redoDrawing,disabled:!f.canRedoDrawing,"aria-label":i.formatMessage({id:"ZUr4oh",defaultMessage:"Redo"})}),e.jsx(le,{className:"w-auto px-3",onClick:B,children:i.formatMessage({id:"D9xvar",defaultMessage:"Cancel"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"aspect-square",icon:Aa,onClick:T,"aria-label":i.formatMessage({id:"pRGwlp",defaultMessage:"Edit image"})}),e.jsx(le,{className:"aspect-square",icon:Fa,onClick:I,"aria-label":i.formatMessage({id:"9DNHka",defaultMessage:"Download image"})}),e.jsx(le,{className:"aspect-square",icon:Ds,onClick:l,"aria-label":i.formatMessage({id:"2gNXdX",defaultMessage:"Report content"})}),d&&e.jsx(le,{className:"aspect-square",icon:Bs,onClick:w,"aria-label":i.formatMessage({id:"rzlDpj",defaultMessage:"Delete post"})})]})})]}),e.jsxs("div",{className:"grid h-full w-full grid-rows-[1fr_auto] items-center overflow-y-auto overscroll-contain",children:[e.jsx("div",{className:"flex h-full w-full items-center justify-center px-4 pb-4",children:t&&e.jsxs("div",{className:"relative inline-block max-h-full rounded bg-neutral-100",children:[e.jsx("img",{src:t.url,alt:k,className:"h-full max-h-[70vh] w-auto max-w-full rounded object-contain",fetchPriority:"high"}),p==="inpaint"&&e.jsx(Da,{image:t,drawingState:f,drawingCanvasRef:S})]})}),e.jsx("div",{className:"flex w-full justify-center px-4 pb-8",children:e.jsx("div",{className:"w-full max-w-[768px]",children:e.jsx(Oi,{clientThreadId:s,currentModelId:o,onRequestCompletion:a,onClose:n,activeImage:t,inpainting:p==="inpaint"&&f.currentDrawnShape!=null,currentDrawnShape:f.currentDrawnShape,getImageData:A,onCancelInpaint:B})})})]})]})})})},Ki=de(()=>he(()=>import("./nltpzxebhe9dq1nq.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])).then(t=>t.ImageGenNewEditor));function ic({postWithProfile:t,clientThreadId:n,onClose:a}){return t.post.attachments[0]?.kind==="media_generation"?e.jsx(Xi,{postWithProfile:t,clientThreadId:n,onClose:a}):t.post.attachments[0]?.kind==="message_slice"?e.jsx(Qi,{postWithProfile:t,onClose:a}):null}function Xi({postWithProfile:t,clientThreadId:n,onClose:a}){const s=c.useRef(null),[o,r]=c.useState(!1),d=tt(),{post:l}=t,i=l.attachments[l.attachments.length-1],u={url:i.url,content_type:ms.ImageAssetPointer,asset_pointer:i.asset_pointer??us(i.id),size_bytes:0,width:i.width,height:i.height},x=J(),p=Ar(),v=se(n),f=ke(),S=c.useCallback(h=>p.getState().files.find(C=>C.tempId===h),[p]),j=i.url,E=c.useCallback(async h=>{if(s.current){const C=await s.current,y=C?S(C?.tempId):null;if(y)return y}return s.current=fetch(h).then(C=>C.blob()).then(C=>{const y=new File([C],"image.png",{type:"image/png"}),P=Fr(y);return gs.uploadFile(p,P,y,Dr.Multimodal,[y.type],x,f).then(()=>{const M=S(P);return M&&M.status===Br.Ready&&M.fileId?M:null})}),s.current},[p,x,f,S]),{onRequestCompletion:T,currentModelId:B}=Ui(),{isUnauthenticated:I}=Zs(),A=c.useCallback(async h=>{if(!(!h.promptMessage||I))try{const C=await E(j);if(!C||!C.fileId||!C.fileSpec)return;const y=[{content_type:ms.ImageAssetPointer,asset_pointer:us(C.fileId),size_bytes:C.fileSpec.size,width:i.width,height:i.height},...h.promptMessage.content.content_type===Me.MultimodalText||h.promptMessage.content.content_type===Me.Text?h.promptMessage.content.parts:[]],P={...h,promptMessage:{...h.promptMessage,content:{content_type:Me.MultimodalText,parts:y}},extraStreamParams:{...h.extraStreamParams??{},continueFromSharedPostId:l.id}};T(P),gs.reset(p)}catch(C){Ze.addError(new Error("post_receiver_handle_request_failed",{cause:C})),f.danger({id:"postReceiverModal.editImageError",defaultMessage:"Failed to edit the image",description:"Error message for editing an image"},{toastId:"post_receiver_modal.edit_image_error"})}},[i.height,i.width,E,T,p,j,I,f,l.id]),w=ne(),k=Or(w).checkGate("2780352974"),g={id:l.id,archived:!1,transformationId:null,url:u.url,assetPointer:u.asset_pointer,thumbnail:null,width:u.width,height:u.height,title:null,conversationId:v,messageId:l.id},b=c.useCallback(()=>{a(),d("/",{replace:!0})},[a,d]);if(k)return e.jsxs(e.Fragment,{children:[e.jsx(Yi,{image:g,onClose:b,onRequestCompletion:A,clientThreadId:n,currentModelId:B,post:l,canDelete:!!l.permissions.can_delete,onOpenReport:()=>r(!0)}),o&&e.jsx(yt,{post:l,onClose:()=>r(!1)})]});const _=e.jsx(gn,{post:l,setIsReportModalOpen:r,onClose:a,additionalButtons:e.jsx(La,{imageAsset:u,serverThreadId:v})});return e.jsxs("div",{className:"bg-token-bg-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(qa,{children:e.jsx(Ki,{image:u,isLoadingNewImage:!1,clientThreadId:n,onClose:()=>{a(),d("/",{replace:!0})},onRequestCompletion:A,editorControls:_,messageId:l.id})}),o&&e.jsx(yt,{post:l,onClose:()=>r(!1)})]})}function Qi({postWithProfile:t,onClose:n}){const[a,s]=c.useState(!1),{post:o}=t;return e.jsxs("div",{className:"bg-token-bg-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(gn,{post:o,setIsReportModalOpen:s,onClose:n}),e.jsx(Ha,{attachments:o.attachments,variant:"fullscreen"}),a&&e.jsx(yt,{post:o,onClose:()=>s(!1)})]})}function gn({post:t,setIsReportModalOpen:n,onClose:a,additionalButtons:s}){const o=tt(),r=J(),d=ke(),l=c.useCallback(async()=>{if(window.confirm(r.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await Tt.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:t.id}}}),o("/",{replace:!0})}catch{d.danger({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post",description:"Error message for deleting a post"},{toastId:"post_receiver_modal.delete_post_error"})}},[t.id,r,d,o]);return e.jsx(e.Fragment,{children:e.jsxs(z.div,{className:"flex h-16 w-full px-2 sm:px-4",...Ga,children:[e.jsx("div",{className:"flex items-center justify-self-start text-start",children:e.jsx(Va,{onClose:()=>{a(),o("/",{replace:!0})}})}),e.jsx("div",{className:"flex w-full flex-1 flex-col items-center justify-center justify-self-stretch",children:e.jsx(Wa,{areButtonsFullWidth:!0,post:t,setIsReportModalOpen:n})}),e.jsxs("div",{className:"flex items-center justify-self-end text-end",children:[t.permissions.can_delete&&e.jsx(za,{tooltip:r.formatMessage({id:"postReceiverModal.deletePost",defaultMessage:"Delete"}),onClick:l,children:e.jsx(Bs,{})}),s]})]})})}function yt({post:t,onClose:n}){const a=ne(),{data:s}=Ba(a,ds.Post),o=J(),r=Oa(a,o,t.id,ds.Post);if(s==null)return null;const d=`Report ${t.text??"Post"}`;return e.jsx(Ua,{reasons:s.reasons,submitReport:r,title:d,onClose:n,header:s.header,subHeader:s.header_explanation})}function Ji(){const t=c.useContext(Os),n=t?.postWithProfile?.post,a=t?.setIsReportModalOpen;return!n||!a?null:e.jsxs("div",{className:"outline-token-border-default mx-4 flex items-center justify-between gap-2.5 rounded-2xl py-1 ps-4 pe-0.5 outline-1 outline-offset-[-1px]",children:[e.jsx("span",{className:"text-token-text-secondary justify-center text-sm leading-tight",children:e.jsx(H,{id:"e2L5bY",defaultMessage:"Content created using ChatGPT"})}),e.jsx(en,{size:"default",contentAlign:"end",sideOffset:4,triggerButton:e.jsx($a,{className:"rounded-full",label:"",icon:e.jsx(_t,{className:"icon-sm"})}),children:e.jsx(Ur.Item,{icon:Ds,onClick:()=>a(!0),children:e.jsx(H,{id:"jHHbcM",defaultMessage:"Flag content as unsafe"})})})]})}function lc(){const t=c.useContext(Os),n=t?.postWithProfile?.post,a=t?.setIsReportModalOpen;return!n||!a?null:e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(H,{id:"iRpGVT",defaultMessage:"Content created using ChatGPT. <reportButton>Report</reportButton> if unsafe.",values:{reportButton:s=>e.jsx("button",{className:"text-token-text-primary decoration-token-text-primary underline",onClick:()=>{a(!0)},children:s})}})})}function Zi(){return{minHeight:`calc(100dvh - ${qs}px - 120px - ${st()}px)`}}function el(){const[t,n]=Re(o=>[Ct(o),Mt(o)]),a=Ya(),s=Ka();return t&&!n&&!a&&!s}function tl({clientThreadId:t,children:n}){const a=ne(),s=J(),o=Qe(()=>ss()),[r,d,l,i,u]=pe(t,g=>[U.getUserMessages(g),U.getSuperWidgetMessages(g),g?.scrollToMessageId,g?.title,g?.is_do_not_remember]),x=c.useContext(tn),p=Us(a,t),v=Qe(()=>p.asyncStatus$()?.value),f=c.useMemo(()=>Hi({clientThreadId:t,conversationTitle:i,conversationAsyncStatus:v,isDoNotRemember:u}),[t,i,v,u]),S=Qe(()=>Xa()),j=qr.useStore(),E=sn(),T=c.useRef({answer:null,web:null,images:null,videos:null}),B=c.useRef(null);if(!nn(x))return n;function I(g){return e.jsxs("div",{className:"pt-[var(--mini-tab-height)]",children:[e.jsx("div",{className:o==="answer"?"block":"hidden",children:n}),e.jsx(Je,{children:o!=="answer"&&e.jsx(nl,{userMessages:r,superWidgetMessageContents:g,tab:o,scrollToMessageId:l},o)})]})}function A({disabled:g}){return e.jsx("button",{className:"text-token-text-tertiary hover:text-token-text-primary flex items-center justify-center transition-colors","aria-label":s.formatMessage({id:"idEcXk",defaultMessage:"Open conversation options"}),disabled:g,children:e.jsx(_t,{className:"icon"})})}function w(g){if(ss.set(g),g!=="answer"){const b=j.getActiveSystemHintType();b&&b!==re.Search&&E(null)}}const k=()=>{const g=B.current,b=T.current[o];if(!g||!b)return{left:0,width:0};const _=g.getBoundingClientRect(),h=b.getBoundingClientRect();return{left:h.left-_.left,width:h.width}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-token-bg-primary fixed start-0 end-0 top-0 z-10",style:{width:`calc(100% - ${S}px)`},children:e.jsx(Je,{className:"flex h-[var(--mini-tab-height)] flex-col justify-end",children:e.jsxs("div",{className:q("relative flex gap-6","mx-2 w-[calc(100%-1rem)] md:mx-0 md:w-full","border-token-border-default border-b-[0.5px]"),ref:B,children:[e.jsx(Ke,{ref:g=>{T.current.answer=g},$selected:o==="answer",onClick:()=>w("answer"),children:e.jsx(H,{...Xe.chatTab})}),e.jsx(Ke,{ref:g=>{T.current.web=g},$selected:o==="web",onClick:()=>w("web"),children:e.jsx(H,{...Xe.linksTab})}),e.jsx(Ke,{ref:g=>{T.current.images=g},$selected:o==="images",onClick:()=>w("images"),children:e.jsx(H,{...Xe.imagesTab})}),e.jsx(Ke,{ref:g=>{T.current.videos=g},$selected:o==="videos",onClick:()=>w("videos"),children:e.jsx(H,{...Xe.videosTab})}),e.jsx(z.div,{className:"absolute bottom-0 -mb-[0.5px] h-0.5 bg-black dark:bg-white",initial:!1,animate:k(),transition:{type:"spring",duration:.3,bounce:.12}}),e.jsx("div",{className:"ms-auto",children:f?e.jsx(Li,{conversation:f,inMainScreen:!0,isActiveConversation:!0,inChatWindow:!1,inOrla:!0,children:A({disabled:!1})}):A({disabled:!0})})]})})}),I(d.map(g=>g.content))]})}const Ke=je.button`
  px-1 pb-2 text-sm -mb-[0.5px]
  ${({$selected:t})=>t?"text-token-text-primary":"text-token-text-tertiary hover:text-token-text-secondary"}
`,sl={answer:()=>null,web:eo,images:Za,videos:()=>e.jsx(to,{children:"Work in Progress"})};function nl({userMessages:t,superWidgetMessageContents:n,tab:a,scrollToMessageId:s}){const o=c.useRef({});function r(l,i="smooth"){const u=o.current[l];u&&(u.style.scrollMarginTop=`${st()+40}px`,u.scrollIntoView({behavior:i,block:"start"}))}c.useEffect(()=>{requestAnimationFrame(()=>{if(t.length>0){const l=t[t.length-1];l&&r(l.id,"instant")}})},[]),c.useEffect(()=>{setTimeout(()=>{s&&r(s)},50)},[s]);const d=sl[a];return e.jsx("div",{className:"flex w-full flex-col gap-12",children:Qa(t.length,l=>e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"flex justify-end py-[var(--mini-thread-turn-vertical-spacing)] text-sm",children:e.jsxs(Ja,{containsImagesOrAttachments:!1,children:[e.jsx("div",{ref:i=>{o.current[t[l].id]=i}}),t[l]?.content.content_type===Me.Text?t[l].content.parts[0]:""]})}),n[l]?e.jsx(d,{content:n[l],turnIndex:l}):e.jsx("div",{style:Zi(),children:e.jsx("div",{className:"result-streaming pulse",children:e.jsx("span",{})})})]},l))})}const Xe=Ps({chatTab:{id:"CSsJbp",defaultMessage:"Chat"},linksTab:{id:"U43uU/",defaultMessage:"Links"},imagesTab:{id:"ZY9oIP",defaultMessage:"Images"},videosTab:{id:"C8mH8+",defaultMessage:"Videos"}}),al="Continue",ol=({clientThreadId:t,messages:n})=>{const a=ne(),s=c.useMemo(()=>n.some(l=>l.metadata?.stop_reason===Hr.RiskyDomainNotWatching),[n]),o=Vi(t),[r,d]=c.useState(!1);return e.jsx(Lr,{testId:"modal-watch-mode-stopped",isOpen:s&&!r,type:"success",size:"normal",onClose:Gr,className:"p-1",title:e.jsx("div",{className:"font-semibold",children:e.jsx(H,{id:"8FmSDC",defaultMessage:"Task paused while you were away"})}),primaryButton:e.jsx(et,{onClick:()=>{Gi({ctx:a,clientThreadId:t,eventSource:"mouse",promptMessage:Wr(al,{system_hints:[ps]}),completionMetadata:{systemHints:[ps],conversationMode:{kind:Vr.PrimaryAssistant}}})},children:e.jsx(H,{id:"4rrYz9",defaultMessage:"Resume"})}),secondaryButton:e.jsx(et,{color:"secondary",onClick:()=>d(!0),children:e.jsx(H,{id:"yg+V5e",defaultMessage:"Stay paused"})}),children:e.jsx(H,{id:"Wdb/cy",defaultMessage:"ChatGPT is working with {riskyDomain}, which contains sensitive data. To resume, keep your browser's tab open and monitor actions.",values:{riskyDomain:e.jsx("span",{className:"font-medium",children:o})}})})},xs=de(()=>he(()=>import("./hmjgn7ko3gx0yuxk.js"),__vite__mapDeps([16,1,2,3,5,6,17,18])).then(t=>t.MemoryActionResult));function vs(t,n,a){Ie(t,s=>{It.updateTree(s,o=>{o.updateNodeMetadata(n,{inlineComparisonRating:a})})})}const bs=({messages:t})=>{for(const{metadata:n}of t){const{paragen_display_label:a}=n??{};if(a)return a;const{augmented_paragen_prompt_label:s}=n??{};if(s)return s}};function rl(t){const n=c.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=c.useRef({left:null,right:null});return t.variantIds.length<2?e.jsx(pn,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(il,{...t,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a})}function il(t){const{clientThreadId:n,variantIds:a,turnIndex:s,firstVisibleTokenTimestampsRef:o}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const r=kt(),d=Ls(),l=zr(),[i,u]=a,x=c.useMemo(()=>$r(i+u)()>=.5,[i,u]),[p,v]=x?[u,i]:[i,u],[f,S,j]=pe(n,w=>{const k=hs(w).tree.getLeafFromNode(p).id,g=hs(w).tree.getLeafFromNode(v).id,b=U.getConversationTurns(w,k),_=U.getConversationTurns(w,g),h=s<b.length?b[s]:null,C=s<_.length?_[s]:null;return h||Ze.addError(`Paragen Left turn index ${s} out of bounds`,{turnIndex:s,turnCount:b.length,lastTurnRole:N(b)?.role,lastMessageAuthor:N(N(b)?.messages)?.author,lastMessageContentType:N(N(b)?.messages)?.content.content_type,lastMessageMetadata:N(N(b)?.messages)?.metadata,altTurnCount:_.length,altLastTurnRole:N(_)?.role,altLastMessageRole:N(N(_)?.messages)?.author.role}),C||Ze.addError(`Paragen Right turn index ${s} out of bounds`,{turnIndex:s,turnCount:_.length,lastTurnRole:N(_)?.role,lastMessageAuthor:N(N(_)?.messages)?.author,lastMessageContentType:N(N(_)?.messages)?.content.content_type,lastMessageMetadata:N(N(_)?.messages)?.metadata,altTurnCount:b.length,altLastTurnRole:N(b)?.role,altLastMessageRole:N(N(b)?.messages)?.author.role}),[k,h,C]}),[E,T]=x?[j,S]:[S,j],B=r?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";c.useEffect(()=>(as.setState({displayingSideBySideFeedback:!0}),()=>{as.setState({displayingSideBySideFeedback:!1})}),[]);const I=c.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),A=c.useCallback((w,{shouldSubmitParagenFeedback:k=!0}={})=>{if(!S||!j||!E||!T)throw new Error("Expected both turns to exist");Ie(n,R=>{It.setCurrentBranch(R,w)});const g=w===p,b=w===i;E.messages.length>0&&vs(n,E.messages[E.messages.length-1].id,b?"original":"new"),T.messages.length>0&&vs(n,T.messages[T.messages.length-1].id,b?"original":"new");const _=se(n),h=[S,j].map((R,$)=>({messageId:R.messages[R.messages.length-1].id,loadFirstTokenTime:$===0?o.current.left:o.current.right,loadEndTime:N(R.messages)?.clientMetadata?.completionSampleFinishTime})),C=g?h[0].messageId:h[1].messageId,y=U.getParentPromptNode(we(n),f);if(!y)throw new Error("Expected prompt for side by side feedback");const P={},M=y.message.clientMetadata?.variantsInStreamInfo==null&&y.message.metadata?.paragen_variants_info!=null;for(const R of h)P[R.messageId]=M?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:R.loadFirstTokenTime,load_end_time:R.loadEndTime};k&&Cs({params:{conversation_id:_,displayed_message_ids:h.map(R=>R.messageId),message_metadatas:P,rating:"selected",selected_message_id:C,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:y.message.id}})},[n,p,i,E,T,S,j,f,o,t.conversationTurnMountTime,r]);return c.useEffect(()=>Yr(an,{requestCompletion:w=>{const k=se(n),g=U.getParentPromptNode(we(n),f);if(!g)throw new Error("Expected prompt for side by side feedback");if(!S||!j)throw new Error("Expected both turns to exist");const b=[S,j].map((y,P)=>({messageId:y.messages[y.messages.length-1].id,loadFirstTokenTime:P===0?o.current.left:o.current.right,loadEndTime:N(y.messages)?.clientMetadata?.completionSampleFinishTime})),_={},h=g.message.clientMetadata?.variantsInStreamInfo==null&&g.message.metadata?.paragen_variants_info!=null;for(const y of b)_[y.messageId]=h?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:y.loadFirstTokenTime,load_end_time:y.loadEndTime};const C=w.isForSkippingParagen;Cs({params:{conversation_id:k,displayed_message_ids:b.map(y=>y.messageId),message_metadatas:_,rating:C?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:C?3:r?2:1,user_prompt_message_id:g.message.id}}),C&&A(p,{shouldSubmitParagenFeedback:!1})}}),[S,j,f,n,t.conversationTurnMountTime,B,E?.messages,T?.messages,l,r,o,A,p]),e.jsx(pn,{...t,setPreferredFeedback:A,leftVariantId:p,rightVariantId:v,leftTurn:S,rightTurn:j,hasActiveRequest:d,originalTurn:E,visibilityStateRef:I})}function pn({setPreferredFeedback:t,leftVariantId:n,rightVariantId:a,leftTurn:s,rightTurn:o,hasActiveRequest:r,originalTurn:d,visibilityStateRef:l,...i}){const u=(s&&bs(s))??null,x=(o&&bs(o))??null,p=c.useMemo(()=>s?.messages??[],[s?.messages]),v=c.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:f,firstVisibleTokenTimestampsRef:S}=i,j=c.useMemo(()=>s?.messageGroups??[],[s?.messageGroups]),E=c.useMemo(()=>o?.messageGroups??[],[o?.messageGroups]),T=so(),B=we(i.clientThreadId),I=N(s?.messages),A=N(o?.messages),w=Hs(U.getRequestId(B,I?.id??A?.id)),k=w&&!I?.end_turn,g=w&&!A?.end_turn,b=I!=null&&xt(I),_=A!=null&&xt(A),h=b??_,C=s?.role===L.User,y=o?.role===L.User,P=c.useRef(null),M=c.useRef(null),R=c.useRef(null),$=s!=null,K=o!=null;!$&&S.current.left==null&&(S.current.left=Date.now()),!K&&S.current.right==null&&(S.current.right=Date.now()),c.useEffect(()=>{if(P.current&&M.current&&R.current){const Te=Array(11).fill(0).map((fe,G)=>G/10),ue=new IntersectionObserver(fe=>fe.forEach(G=>{G.target===M.current?(l.current.left_visibility_initial==null&&(l.current.left_visibility_initial=G.intersectionRatio),l.current.left_visibility_max=Math.max(l.current.left_visibility_max??0,G.intersectionRatio)):G.target===R.current&&(l.current.right_visibility_initial==null&&(l.current.right_visibility_initial=G.intersectionRatio),l.current.right_visibility_max=Math.max(l.current.right_visibility_max??0,G.intersectionRatio))}),{root:P.current,threshold:Te});return ue.observe(M.current),ue.observe(R.current),()=>ue.disconnect()}},[l]);const{data:Y}=no(void 0,!1,T),X=kt(),ie=e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(H,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})});return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:q("bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty",X?"md:top-header-height":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(H,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."}),X?ie:null]}),X?null:ie,e.jsx("div",{className:q(ao,"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:P,children:e.jsxs("div",{className:q("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start",X&&"divide-token-border-medium dark:divide-token-border-heavy divide-x",!X&&"gap-4 sm:gap-6"),children:[e.jsxs(ys,{horizontalScrollContainerRef:P,rootElementRef:M,onClick:()=>{t(n)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:$,isImageGenInProgress:h,children:[e.jsxs(Ts,{children:[e.jsx(ns,{messages:p,isUserTurn:C,avatarClassName:f}),e.jsx(js,{children:e.jsx(H,{...Ms.responseNumber,values:{responseIndex:1,display_label:u}})})]}),X&&$?e.jsx(Ss,{}):e.jsxs(e.Fragment,{children:[Y!=null&&!C&&e.jsx(xs,{clientThreadId:i.clientThreadId,messages:p,isParagen:!0}),e.jsx(bt,{...i,allMessages:p,groupedMessagesToRender:j,allGroupedMessages:j,isUserTurn:C,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isCompletionRequestInProgress:k,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(_s,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:s,originalTurn:d})]})]}),e.jsxs(ys,{horizontalScrollContainerRef:P,rootElementRef:R,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:K,isImageGenInProgress:h,children:[e.jsxs(Ts,{children:[e.jsx(ns,{messages:v,isUserTurn:y,avatarClassName:f}),e.jsx(js,{children:e.jsx(H,{...Ms.responseNumber,values:{responseIndex:2,display_label:x}})})]}),X&&K?e.jsx(Ss,{}):e.jsxs(e.Fragment,{children:[Y!=null&&!y&&e.jsx(xs,{clientThreadId:i.clientThreadId,messages:v,isParagen:!0}),e.jsx(bt,{...i,allMessages:v,groupedMessagesToRender:E,allGroupedMessages:E,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isUserTurn:y,isCompletionRequestInProgress:g,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(_s,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:o,originalTurn:d})]})]})]})})]})}function ys({horizontalScrollContainerRef:t,rootElementRef:n,onClick:a,children:s,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r,isImageGenInProgress:d}){const l=kt(),{scrollX:i}=Ca({layoutEffect:!1,container:t,target:n}),u=oo(),x=ro(),p=c.useRef(null),v=c.useRef(null),f=c.useRef(null),[S,j]=c.useState(!1),[E,T]=c.useState(!1),[B,I]=c.useState(!1),[A,w]=c.useState(0);c.useEffect(()=>{if(!l)return;const y=new IntersectionObserver(P=>{for(const M of P)M.target===p.current?j(M.isIntersecting):M.target===f.current?I(M.isIntersecting):M.target===v.current&&T(M.isIntersecting)},{root:u?.current});return p.current&&v.current&&f.current&&(y.observe(p.current),y.observe(v.current),y.observe(f.current)),()=>{y.disconnect()}},[A,l,u]);const k=!B&&(E||S),g=Ma(i,y=>k?-1*y:0),b=ts(0);c.useEffect(()=>{if(!l)return;const y=new ResizeObserver(P=>{ze(P.length===1,"entryList.length === 1");const M=P[0];ze(M.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),b.set(M.contentBoxSize[0].inlineSize)});return n.current&&y.observe(n.current),()=>{y.disconnect()}},[l,b,n]);const _=ts(0);c.useEffect(()=>{if(!l)return;const y=new ResizeObserver(P=>{ze(P.length===1,"entryList.length === 1");const M=P[0];ze(M.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),_.set(M.contentBoxSize[0].blockSize+16),w(M.contentBoxSize[0].blockSize)});return x.current&&y.observe(x.current),()=>{y.disconnect()}},[l,_,x]);const h=e.jsx(et,{className:l?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(H,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),C=r||d;return e.jsx("div",{"data-paragen-root":!0,className:q("@container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 text-start",l?"min-h-60":"border-token-border-tertiary rounded-xl border shadow-lg shadow-black/3"),ref:n,children:e.jsxs("div",{className:q(io,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:q("absolute top-48 right-0! left-0! h-px","invisible"),ref:p}),e.jsx("div",{className:q("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:v}),e.jsx("div",{className:q("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:f}),s,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:C?null:e.jsx(z.div,{style:{translateX:g,width:b,bottom:_},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:q({fixed:k,"z-20 flex w-full justify-center":!0}),children:h})}):o||d?null:h]})})}function Ss(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pt-3 pb-5",children:[e.jsx(ge,{className:"h-4 w-[75%]"}),e.jsx(ge,{className:"h-4 w-[50%]"}),e.jsx(ge,{className:"h-4 w-[80%]"}),e.jsx(ge,{className:"h-4 w-[55%]"}),e.jsx(ge,{className:"h-4 w-[66%]"}),e.jsx(ge,{className:"h-4 w-[64%]"}),e.jsx(ge,{className:"h-4 w-[48%]"})]})}function kt(){const t=ne();return wt(t,"3119715334").get("should-enable-hojicha",!1)}const js=je.div`text-sm text-token-text-secondary font-semibold`,Ts=je.div`flex gap-4 items-center mb-1`,ge=je.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function _s({clientThreadId:t,conversationTurnMountTime:n,turn:a,originalTurn:s}){const o=on();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===s?"ORIGINAL":"NEW";const d=a.messages[a.messages.length-1],l=d?.metadata?.__internal,i=d?.metadata?.paragen_display_label;if(l){const{model_id:p,model_definition_slug:v,model_definition_virtual_model_id:f,alternative_model_selection_rule:S,augmented_paragen_prompt_group_id:j,augmented_paragen_prompt_id:E,augmented_paragen_prompt:T}=l;p&&(r+=`
Model ID: ${p}`),v&&(r+=`
Model Slug: ${v}`),f&&(r+=`
Virtual Model ID: ${f}`),S&&(r+=`
Alternative Model Rule: ${S}`),j&&(r+=`
Prompt Group ID: ${j}`),E&&(r+=`
Prompt ID: ${E}`),T&&(r+=`
Prompt: ${T}`),i&&(r+=`
Display Label: ${i}`)}r+=`
Message ID: ${d.id}`;const u=U.getParentPromptNode(we(t),a.messages[0].id);if(!u)throw new Error("Expected prompt for side by side feedback");const x=u.message.clientMetadata?.variantsInStreamInfo==null&&u.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${u.message.id}`,r+=`
Is Persisted Paragen? ${x}`,r+=`
Completion Sample Finish Time: ${x?`${n} (persisted)`:N(a.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:r})}async function Cs({params:t}){await Tt.safePost("/paragen_submission",{requestBody:t,authOption:Kr.SendIfAvailable})}const Ms=Ps({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}});function hn({followups:t,analyticsMetadata:n}){const a=c.useRef(!1),s=mn();return c.useEffect(()=>{a.current||(a.current=!0,t.forEach((o,r)=>{V.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Se(n),action:"show",position:(r+1).toString(),followup_text:Ce(o)})}))},[t,n]),e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex w-full flex-col",children:t.slice(0,4).map((o,r)=>e.jsx(z.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:r*.03},exit:{opacity:0,translateY:4},children:e.jsx(ll,{followUp:o,onSelectingSuggestedReply:s,analyticsMetadata:n,position:r})},r))})}const fn=je.div`
  h-[1px] opacity-45
  ${({$isSelected:t})=>t?"mx-2 bg-token-main-surface-secondary":"bg-token-border-default"}
`;function ll({followUp:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s}){return e.jsxs(z.button,{whileHover:"hover",className:q("bg-token-main-surface-primary hover:bg-token-main-surface-secondary flex w-full cursor-pointer items-start justify-start gap-2 rounded-lg px-0 py-3 text-start"),onClick:o=>{n(o,t,[],0),V.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Se(a),action:"click",position:(s+1).toString(),followup_text:Ce(t)})},onMouseEnter:()=>{V.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Se(a),action:"hover",position:(s+1).toString(),followup_text:Ce(t)})},children:[e.jsx(z.div,{className:"flex items-center justify-center pt-0.25 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(be,{className:"text-token-text-secondary icon"})}),e.jsx("div",{className:"text-token-text-secondary pe-2 text-start text-sm",children:Ce(t)})]})}const cl=()=>e.jsx(rn,{size:"lg",lines:3,width:35,widthVariance:10,className:"w-full"}),dl=t=>({[re.Search]:"Web Search",[re.Research]:"Research",[re.PictureV2]:"Draw Image",[re.Think]:"Think Harder"})[t]??"Title",St=(t,n,a,s,o)=>{V.logEventWithStatsig("Capabilities Suggestion Action","chatgpt_capabilities_suggestion_action",{...Se(a),categoryId:n.categoryId,suggestionId:n.id,position:s,action:t,numSuggestions:String(o)})},ul=(t,n)=>{const a=c.useRef(!1);c.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{St("show",s,n,o+1,t.length)}))},[t,n])},xn=({suggestions:t,analyticsMetadata:n,style:a="default"})=>{const s=mn();return ul(t,n),e.jsx(e.Fragment,{children:t.map((o,r)=>e.jsxs(z.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:r*.03},className:q("w-full flex-1",a==="compact"&&"flex-col"),children:[a==="compact"&&r>0&&e.jsx(fn,{$isSelected:!1}),e.jsx(ml,{suggestion:o,onSelectingSuggestedReply:s,position:r+1,numSuggestions:t.length,analyticsMetadata:n,style:a})]},o.prompt))})},ml=({suggestion:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s,numSuggestions:o,style:r="default"})=>{const{setThreadSystemHintMode:d}=lo(),l=Xr(),i=tt();return e.jsx(z.button,{onClick:u=>{if(St("click",t,a,s,o),t.categoryId===re.Research)if(l?.isFree()){Qr(i,"Suggested Capabilities Upsell");return}else d(t.categoryId,!0,a);n(u,t,[],0)},onMouseEnter:()=>{St("hover",t,a,s,o)},className:q("hover:bg-token-main-surface-secondary flex w-full flex-1 items-start rounded-xl text-start transition-colors duration-300 ease-in-out",r==="default"&&"gap-4 p-2"),children:r==="compact"?e.jsx(gl,{suggestion:t}):e.jsx(pl,{suggestion:t})})},gl=({suggestion:t})=>{const{systemHints:n}=ln(),a=c.useMemo(()=>t.categoryId==="ask"?void 0:n?.find(s=>s.systemHint===t.categoryId),[n,t.categoryId]);return e.jsxs("div",{className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-5deg] group-hover:opacity-100",children:t.categoryId==="ask"?e.jsx(be,{className:"text-token-text-secondary group-hover:text-token-text-primary icon"}):e.jsx(cn,{svgString:a?.logo??"",className:"text-token-text-secondary icon group-hover:text-token-interactive-label-accent-default"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:Ce(t)})]})},pl=({suggestion:{categoryId:t,imageUrl:n,description:a,title:s,ctaLabel:o,prompt:r}})=>{const{systemHints:d}=ln(),l=c.useMemo(()=>t==="ask"?void 0:d?.find(i=>i.systemHint===t),[d,t]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-token-border-default bg-primary relative h-16 w-14 flex-shrink-0 rounded-lg border drop-shadow-xs transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-2deg]",children:[t===re.PictureV2?e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-lg bg-cover",style:{backgroundImage:`url(${n})`},children:e.jsx(co,{className:"icon-xl mb-2 text-white"})}):e.jsxs("div",{className:"flex flex-col gap-1.5 p-2",children:[e.jsx("div",{className:"text-token-text-primary text-[5px] leading-tight font-semibold tracking-tighter",children:s??dl(t)}),e.jsx("div",{className:"flex flex-col gap-0.5",children:Array.from({length:10}).map((i,u)=>e.jsx("div",{className:"bg-token-border-heavy h-[1px] w-full rounded-full"},u))})]}),e.jsx("div",{className:"absolute -end-2 -bottom-2",children:e.jsx(uo,{isBadge:!0,className:"opacity-100",logo:e.jsx(cn,{svgString:l?.logo??"",className:"icon"})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-primary flex-grow",children:a??r}),o&&e.jsxs("div",{className:"text-token-text-secondary flex items-center font-medium",children:[o,e.jsx(z.div,{variants:{hover:{x:2}},initial:{x:0},transition:{duration:.1},children:e.jsx(Jr,{className:"icon-sm"})})]})]})]})},jt=(t,n,a,s)=>{V.logEventWithStatsig("Capabilities Tab Action","chatgpt_capabilities_tab_action",{...Se(a),tabId:n,position:s,action:t})},hl=(t,n)=>{const a=c.useRef(!1);c.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{jt("show",s.value,n,o+1)}))},[t,n])},fl=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s,style:o="default"})=>{const r=n.map(({category_id:i,title:u,suggestions:x})=>({value:i,message:u,suggestions:x?.map(Gs)??[]})),[d,l]=c.useState(r[0].value);return hl(r,s),e.jsxs(Zr,{value:d,onValueChange:l,orientation:"horizontal",className:"flex w-full flex-col",children:[e.jsx(ei,{className:"border-token-border-default relative flex w-full flex-row gap-6 border-b",children:r.map((i,u)=>e.jsx(vl,{value:i.value,message:i.message,isActive:d===i.value,analyticsMetadata:s,position:u+1},i.value))}),r.map(i=>e.jsx(ti,{value:i.value,children:e.jsx(xl,{initialSuggestions:i.suggestions,clientThreadId:t,categoryId:i.value,isActive:d===i.value,lastMessageId:a,analyticsMetadata:s,style:o})},i.value))]})},xl=({initialSuggestions:t,clientThreadId:n,categoryId:a,isActive:s,lastMessageId:o,analyticsMetadata:r,style:d="default"})=>{const l=se(n),i=s&&t.length===0,{suggestions:u,isLoading:x}=mo({categoryId:a,shouldFetch:i,serverThreadId:l,lastMessageId:o}),p=i?u:t;return a==="ask"?x?e.jsx(cl,{}):e.jsx(hn,{followups:p.map(v=>({type:Vs.Reply,text:v.prompt})),analyticsMetadata:r}):e.jsx("div",{className:"flex w-full flex-col gap-y-4 py-3 md:flex-row md:gap-x-4",children:x?e.jsxs(e.Fragment,{children:[e.jsx(Is,{}),e.jsx(Is,{})]}):e.jsx(xn,{suggestions:p,analyticsMetadata:r,style:d})})},vl=({value:t,message:n,isActive:a,analyticsMetadata:s,position:o})=>e.jsxs(si,{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-active:text-token-text-primary relative flex min-w-10 justify-center py-4 text-sm font-medium",value:t,onClick:()=>{jt("click",t,s,o)},onMouseEnter:()=>{jt("hover",t,s,o)},children:[e.jsx("div",{className:"truncate",children:n}),e.jsx(As,{children:a&&e.jsx(z.div,{layoutId:"tab-underline",className:"bg-token-text-primary absolute start-0 end-0 bottom-0 h-0.5",transition:{type:"spring",stiffness:500,damping:30}})})]}),Is=()=>e.jsxs("div",{className:"flex flex-1 items-center gap-4 rounded-xl p-2",children:[e.jsx("div",{className:"bg-token-sidebar-surface-secondary dark:bg-token-border-default h-16 w-14 flex-shrink-0 rounded-lg"}),e.jsx("div",{className:"w-full flex-grow",children:e.jsx(rn,{lines:3,size:"sm"})})]}),bl=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s})=>{if(!n||n.length===0)return null;const o=n.length===1,r=n[0],d=r.suggestions.length>0?r.suggestions:void 0;return o&&d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-1 text-sm font-semibold",children:e.jsx(H,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx(xn,{suggestions:d.map(Gs),analyticsMetadata:s,style:r.style})]}):e.jsx(fl,{clientThreadId:t,categorySuggestions:n??[],lastMessageId:a,analyticsMetadata:s})},yl=(t,n,a,s,o)=>{V.logEventWithStatsig("Agent Suggestion Action","chatgpt_agent_suggestion_action",{...Se(a),capability:n.capability,position:s,action:t,numSuggestions:o})},Sl=(t,n)=>{const a=c.useRef(!1);c.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{yl("show",s,n,o+1,t.length)}))},[t,n])},jl=({agentSuggestions:t,analyticsMetadata:n})=>(Sl(t,n),e.jsx(e.Fragment,{children:t.map((a,s)=>e.jsxs(z.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:s*.03},className:q("w-full flex-1","flex-col"),children:[s>0&&e.jsx(fn,{$isSelected:!1}),e.jsx(Tl,{agentSuggestion:a,analyticsMetadata:n})]},a.prompt))})),Tl=({agentSuggestion:t})=>{const n=qi(),a=_l(t.capability),s=sn(),o=()=>{n.setText(t.prompt),s("agent"),n.focus()};return e.jsxs("div",{onClick:o,className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:opacity-100",children:e.jsx(a,{className:"text-token-text-secondary group-hover:text-token-text-primary icon"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:t.title})]})},ws={action:go,research:be,spreadsheet:be,presentation:be,default:be},_l=t=>ws[t]??ws.default;function Cl({clientThreadId:t,followups:n,categorySuggestions:a,actionSuggestions:s,lastMessageId:o,analyticsMetadata:r,isTatertotFollowupsEnabled:d}){const l=Re(Ct),i=po.useIsEnabled(t)&&!l,{capabilitySuggestionsEnabled:u}=Ws(d),x=a&&a.length>0;return s&&s.length>0?e.jsx(jl,{agentSuggestions:s,analyticsMetadata:r}):e.jsx(e.Fragment,{children:i&&(u?x&&e.jsx(bl,{clientThreadId:t,lastMessageId:o,categorySuggestions:a,analyticsMetadata:r}):n.length>0&&e.jsx(Ml,{followups:n,analyticsMetadata:r}))})}function Ml({followups:t,analyticsMetadata:n}){return e.jsxs("div",{className:"group",children:[e.jsx("hr",{className:"bg-token-bg-tertiary mt-5 mb-5 opacity-70"}),e.jsx(hn,{followups:t,analyticsMetadata:n})]})}async function Il(t,n,a,{unprocessed:s=!1}={}){const o=[],r=[],d={};for(const l of t.messages){if(vn(l)){const i=l.metadata?.content_references,u=nt(l);if(s)o.push(u);else{const x=$i(u,i);x["text/plain"]&&o.push(x["text/plain"]),x["text/html"]&&r.push(x["text/html"])}}if(ni(l)){const i=dn.getImageAssetPointers(l);if(i.length>0){const u=i[0];try{const x=se(a),{url:p}=await ho.fetch(n,{asset:u,conversationId:x??void 0}),f=await(await fetch(p)).blob();["image/png","image/jpeg","image/webp"].includes(f.type)&&(d[f.type]=f)}catch{return Promise.reject()}}}}return o.length>0&&(d["text/plain"]=o.join(`

`)),r.length>0&&(d["text/html"]=r.join(`

`)),d}function vn(t){return!t.clientMetadata?.err&&(t.author.role===L.Assistant||t.author.role===L.User)&&(t.author.role===L.User||t.recipient==="all")&&!t.metadata?.reasoning_status}const bn=({turn:t})=>{const n=fo(),a=J(),s=ne(),o=ye(s,"1894790777");function r(){vo.logButtonClick(bo.EDIT_IN_CANVAS_MESSAGE);const d=wl(t);n&&os.removeTempTextdoc(n.textdocId);const l=os.createTempTextdoc(d,a.formatMessage({id:"9e0Zzr",defaultMessage:"New document"}),yo.MESSAGE);requestAnimationFrame(()=>{So(l)})}return e.jsx(ce,{icon:xo,onClick:r,label:a.formatMessage({id:"EditInCanvas.tooltip",defaultMessage:"Edit in canvas"}),asMenuItem:o})};function wl(t){return t.messages.filter(n=>vn(n)&&n.author.role===L.Assistant).map(n=>nt(n,{shouldGetTextFromContentReferences:!0,shouldGetVisibleText:!1})).filter(Boolean).join(`

`)}const yn=de(()=>he(()=>import("./dmc5z61nfanbjlao.js"),__vite__mapDeps([19,2,1,3,20,21,5,6,22,23])).then(t=>t.VoicePlayButton));function kl({showPlayButton:t,showCanvasButton:n,showJujutsuButton:a,clientThreadId:s,messages:o,lastMessage:r,imageGenMessageId:d,turn:l,turnIndex:i,requestId:u}){const p=J().formatMessage({id:"e/27r7",defaultMessage:"More actions"});return e.jsx(en,{triggerButton:e.jsx("button",{className:"text-token-text-secondary hover:bg-token-bg-secondary touch:w-10 flex h-8 w-8 items-center justify-center rounded-lg",onMouseOver:()=>{yn.prefetch()},"aria-label":p,children:e.jsx(_t,{className:"icon"})}),size:"auto",contentAlign:"start",alignOffset:-7,side:"top",sideOffset:4,tooltip:p,children:e.jsx(Rl,{showPlayButton:t,showCanvasButton:n,showJujutsuButton:a,clientThreadId:s,messages:o,lastMessage:r,imageGenMessageId:d,turn:l,turnIndex:i,requestId:u})})}function Rl({showPlayButton:t,showCanvasButton:n,showJujutsuButton:a,clientThreadId:s,messages:o,lastMessage:r,imageGenMessageId:d,turn:l,requestId:i}){const u=J();return e.jsxs(e.Fragment,{children:[t&&r&&e.jsx(yn,{conversationId:s,message:r}),n&&e.jsx(bn,{turn:l}),!1,e.jsx(zs,{children:({openScheduleModal:x,isScheduled:p,isSchedulable:v})=>!p&&v?e.jsx(ce,{icon:$s,label:u.formatMessage({id:"l12ujd",defaultMessage:"Schedule"}),onClick:x,trailing:e.jsx(H,{id:"Vn8LDj",defaultMessage:"Internal"}),asMenuItem:!0}):null}),!1,!1,!1]})}const Sn=async(t,n,a,s,o,r="mouse",d)=>{const i=U.getConversationTurns(we(n))[a];if(!i)return Promise.reject();const{messages:u}=i,x=o,p=u[0]?.author.role===L.User,v=x.metaKey||x.altKey,f=await Il(i,d,n,{unprocessed:v||p});await jo(f,s,o);const S=se(n);S&&To(t,{messageId:u[0].id,type:"copy",serverThreadId:S,selectedText:nt(u[0]),source:r,location:"message"})},El=de(()=>he(()=>import("./dmc5z61nfanbjlao.js"),__vite__mapDeps([19,2,1,3,20,21,5,6,22,23])).then(t=>t.VoicePlayButton)),Nl=de(async()=>()=>null),Pl=({alwaysShow:t,isUserTurn:n,children:a})=>{const s=c.useRef(null);return c.useEffect(()=>{const o=s.current;o&&(t?requestAnimationFrame(()=>{o&&(o.style.maskPosition=t?"0% 0%":"")}):o.style.maskPosition="")},[t]),e.jsx("div",{className:q("flex",!t&&"absolute start-0 end-0 flex",n?"justify-end":"min-h-[46px] justify-start"),children:e.jsx("div",{ref:s,className:q("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex flex-wrap items-center gap-y-4 p-1 select-none",!n&&"touch:w-[calc(100%+--spacing(3.5))] -mt-1 w-[calc(100%+--spacing(2.5))]",t&&!n&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(t||n)&&"duration-500 group-hover/turn-messages:delay-300",!n&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-size:300%_100%] [mask-position:100%_0%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],n&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"]),children:a})})},Al=({activeVariantIndex:t,clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,numVariants:r,onChangeIndex:d,onRate:l,showCanvasButton:i,showCopyButton:u,showPagination:x,showPlayButton:p,showRatingButtons:v,showRegenerateButton:f,turn:S,turnIndex:j,parentPrompt:E})=>{const T=ne(),B=J(),I=ke(),A=Fs(),w=Re(ai),k=ye(T,"1894790777"),g=s?.clientMetadata?.rating,b=s?.clientMetadata?.requestId,{imageGenMessages:_,canvasMessage:h,enableImageGenPostSharing:C,enableMessageSliceSharing:y,hasErrorInTurn:P,isIncomplete:M}=Co(o),R=Mo.useSelectedIndex(),$=o.filter(oi).filter(Z=>Z.recipient==="all"),K=_.length>0,Y=h!=null,X=ri(),ie=se(n),Te=ii(T),ue=K&&$.length===0&&_.some(fs),fe=o.some(Z=>Z.metadata?.n7jupd_message),G=ie!=null&&!P&&!M&&!fe&&Te;let _e=null;return G&&(C||y?_e=e.jsx(Bl,{clientThreadId:n,imageGenMessageId:_[R]?.id,messages:o}):X&&wt(T,"1547743984").get("show_share_button_inline",!1)&&(_e=e.jsx(ce,{onClick:()=>{ie&&Xs.openSharingModal(ie)},label:B.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Ks}))),s&&xt(s)&&!fs(s)?null:e.jsxs(e.Fragment,{children:[x&&e.jsx(Ys,{currentPage:t,onChangeIndex:d,length:r}),u&&!ue&&!w&&e.jsx(jn,{onClick:Z=>{Sn(T,n,j,I,Z,"mouse",A)}}),v&&!K&&e.jsxs(e.Fragment,{children:[g!=="thumbsDown"&&e.jsx(ce,{onClick:()=>l("thumbsUp"),disabled:g==="thumbsUp",icon:g==="thumbsUp"?Io:wo,label:B.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),g!=="thumbsUp"&&e.jsx(ce,{onClick:()=>l("thumbsDown"),disabled:g==="thumbsDown",icon:g==="thumbsDown"?ko:Ro,label:B.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),p&&s&&$.length>0&&!k&&e.jsx(El,{conversationId:n,message:s,iconClassName:"icon",className:"text-token-text-tertiary hover:text-token-text-primary gap-1.5 rounded-md p-1 text-xs"}),i&&!K&&!Y&&!k&&!w&&e.jsx(bn,{turn:S}),_e,!1,f&&s&&!w&&e.jsx(Dl,{clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,hasImageGenMessage:K,parentPrompt:E}),k&&!w&&e.jsx(kl,{showPlayButton:!!(p&&s&&$.length>0),showCanvasButton:!K&&i,showJujutsuButton:G&&ye(T,"3096078201"),turnIndex:j,clientThreadId:n,messages:o,imageGenMessageId:_[R]?.id,lastMessage:s,turn:S,requestId:b}),!k&&e.jsx(zs,{children:({openScheduleModal:Z,isScheduled:Ee,isSchedulable:Ne})=>!Ee&&Ne?e.jsx(ce,{icon:$s,label:B.formatMessage({id:"l12ujd",defaultMessage:"Schedule"}),onClick:Z}):null}),!1,!1,null]})},Fl=({activeVariantIndex:t,clientThreadId:n,numVariants:a,onAnticipateEdit:s,onChangeIndex:o,onEnterEdit:r,showCopyButton:d,showEditMessageButton:l,showPagination:i,turnIndex:u})=>{const x=ne(),p=ke(),v=Fs();return e.jsxs(e.Fragment,{children:[d&&e.jsx(jn,{onClick:f=>{Sn(x,n,u,p,f,"mouse",v)}}),l&&e.jsx(_o,{onAnticipateEdit:s,onEnterEdit:r}),i&&e.jsx(Ys,{currentPage:t,onChangeIndex:o,length:a})]})},Dl=({clientThreadId:t,conversationMode:n,messages:a,hasImageGenMessage:s,lastMessage:o,parentPrompt:r})=>{const d=Ao({clientThreadId:t,conversationMode:n}),l=Fo(t,o),i=c.useCallback(({sourceEvent:u,requestedModelId:x,appendMessages:p,extraStreamParams:v})=>{o&&d({sourceEvent:u,nodeId:o.id,requestedModelId:x,appendMessages:p,extraStreamParams:v})},[o,d]);return s?e.jsx(Nl,{messages:a,onModelSelect:i}):e.jsx(Do,{className:"text-token-text-secondary hover:bg-token-bg-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:t,message:o,onModelSelect:i,canRegenerateResponse:l,parentPrompt:r})},jn=({onClick:t})=>{const[n,a]=c.useState(!1),s=Eo(),o=J(),r=c.useCallback(d=>{d.stopPropagation(),V.logEvent("ChatGPT Turn Action Copy Clicked"),t(d),a(!0),setTimeout(()=>{s()&&a(!1)},2e3),ve.logEvent("chatgpt_turn_action_copy")},[s,t]);return e.jsx(ce,{icon:n?li:No,onClick:r,label:o.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})};function Bl({clientThreadId:t,imageGenMessageId:n,messages:a}){const[s,o]=c.useState(!1),r=J(),d=c.useMemo(()=>n?"media_generation":"message_slice",[n]),l=a?.map(u=>u.id)??void 0,i=Po({clientThreadId:t,imageGenMessageId:n,messageSliceIds:l});return c.useEffect(()=>{V.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"turn_action",attachment_type:d})},[d]),e.jsx(ce,{onClick:async()=>{o(!0);try{await i()}finally{o(!1)}V.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"turn_action",attachment_type:d})},label:r.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:s?ci:Ks,disabled:s})}const Ol=de(()=>he(()=>import("./hmjgn7ko3gx0yuxk.js"),__vite__mapDeps([16,1,2,3,5,6,17,18])).then(t=>t.MemoryActionResult)),Ul=de(()=>he(()=>import("./j1jics1jdjwk76ez.js"),__vite__mapDeps([24,2,1,3,5,6,25])).then(t=>t.AutomationSourceHeader)),ks=de(()=>he(()=>import("./konqc7mws67zpcju.js"),__vite__mapDeps([26,2,1,3,5,6,27])).then(t=>t.TextMessageEditor)),Rs=80,ql=16;function Es(){return{minHeight:`calc(100dvh - ${qs}px - 120px - ${st()}px)`}}function Hl(t){const{turnIndex:n,isFinalTurn:a,clientThreadId:s,onRequestCompletion:o,currentModelId:r,scrollToMessageId:d,dateHeaderType:l,hideUserActions:i}=t,u=ne(),x=Us(u,s),p=Qs(u),v=Bo(),f=c.useContext(tn),[S,j]=Re(m=>[Ct(m),Mt(m)]),E=!!v&&di(v),T=Oo(Uo.isBusinessWorkspace),B=fr(),[I,A,w]=pe(s,m=>{const F=U.getConversationTurnAtIndex(m,n),O=n>0?U.getConversationTurnAtIndex(m,n-1):null,D=O?.role===L.User&&O.messages.some(Q=>Q.metadata?.visually_hide_response_from_conversation);return[F,D,O]}),{messages:k,messageGroups:g}=I,b=qo(m=>m.size===0?-1:g.findIndex(F=>F.type===ft?F.groups.some(O=>O.messages.some(D=>m.has(D?.id))):F.messages.some(O=>m.has(O?.id)))),_=k[0],h=N(k),C=g.some(m=>m.type===ui.SearchGPTQuery),[y,P]=c.useState(!1),M=c.useMemo(()=>k.some(m=>m.metadata?.n7jupd_message),[k]),{messages:R,visibleMessages:$,messageGroups:K,lastMessageToRender:Y}=c.useMemo(()=>{const m=b!==-1&&b+1<g.length,F=m?g.slice(0,b+1):g,O=m?F.flatMap(D=>D.type===ft?D.groups.flatMap(Q=>Q.messages):D.messages):k;return{messages:O,visibleMessages:O.filter(mi),messageGroups:F,lastMessageToRender:N(O)}},[k,g,b]),X=b!==-1,ie=ye(u,"1887864177"),Te=Bi(),ue=pe(s,m=>U.getLastMessageSystemHints(m)),fe=gi(),G=ue?.includes(re.Tatertot)&&ye(u,"28816792")&&fe,{capabilitySuggestionsEnabled:_e}=Ws(G),Z=c.useMemo(()=>({clientThreadId:s,turnIndex:n,messageId:h?.id}),[s,n,h?.id]),[Ee,Ne]=c.useState(!1),[Rt,Tn]=c.useState(!1),_n=c.useContext(Ho)!=null,W=I.role===L.User,Et=pi(),Pe=hi(s),Nt=Lo(I.gizmoId??Pe).data,at=un(s),Cn=fi(s),Pt=xi(at),Mn=vi(at,Cn),At=bi(),[ot,In,wn,Ft,Ae,rt,kn,Dt,Rn,Bt,En,ae,Fe,De,Nn,Pn]=pe(s,m=>{const F=U.getParentPromptNode(m,_.id),O=F?.message.clientMetadata?.variantsInStreamInfo??(F?.message.metadata?.paragen_variant_choice?void 0:F?.message.metadata?.paragen_variants_info),D=U.getVariantIds(m,_.id),Q=U.getCurrentVariantId(m,_.id),pt=Q?D.indexOf(Q):0,_a=O&&m?.tree!=null&&D.some(oe=>{const{errType:es}=m.tree.getLeafFromNode(oe).message.clientMetadata??{};return es!=null&&es!=="info"}),We=U.getConversationTurns(m);return[F,U.isMessageTurnEnded(m,h?.id),_a,xr(m?.mode,Nt?.gizmo.id),m?.continuingFromSharedConversationId!=null,We.findIndex(oe=>oe.role===L.User)===n,cs(We,oe=>oe.role===L.User)===n,We.findIndex(oe=>oe.role===L.Assistant)===n,cs(We,oe=>oe.role===L.Assistant)===n,U.getRequestId(m,h?.id),O,D,pt,!!m?.continuingFromSharedPostId,m?.currentLeafId,U.getSuperWidgetMessages(m,n)[0]]}),Be=Qe(()=>{const m=x.asyncStatus$();return m?.value===$e.STREAMING||m?.value===$e.REALTIME}),An=R.some(m=>m.content.content_type===Me.MultimodalText),Fn=wt(u,"3119715334").get("should-enable-skip",!1),{isUnauthenticated:Ot}=Zs(),Ut=I.messages.map(m=>m.id),ee=c.useRef(null),qt=!p&&(d?.length??0)>2&&d!=="finalAgentTurn"&&a&&B,Oe=W?N($):void 0,it=Oe?.id,Dn=c.useCallback(()=>{it&&(V.logEvent("Edit Prompt",{id:it,threadId:se(s)}),yi(u,"chatgpt_edit_prompt"),Ne(!0))},[u,it,s]),Bn=c.useCallback(()=>{Ne(!1)},[]),Ht=Si()??!1,{onChangeRating:On}=Go({clientThreadId:s,currentModelConfig:at}),Un=m=>{if(!h)return;On({nodeId:h.id,messageId:h.id,rating:m});const F=Ht&&g.some(O=>O.type!==ft&&O.messages?.some(Ri));V.logEventWithStatsig(m==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:h.id,threadId:se(s),model:r,rating:m,...Ht?{isCATriggered:F}:{}}),Tn(!0)},[qn]=c.useState(()=>Date.now()),Hn=ji(s),Lt=Vo(s)?.value,Ln=Lt===$e.STREAMING,Gn=Lt===$e.REALTIME,Vn=Bt!=null,Wn=Hs(Bt),zn=rs.useState(m=>rs.isReplayInProgress(m,Nn)),te=!In&&Wn||X||Gn||zn&&a,Gt=Ls(),Vt=c.useRef(!1),$n=Ti({clientThreadId:s}),Yn=Wo(s,h)&&!$n,[,Kn]=wa(),{isOpen:lt}=vt(),Wt=Js();c.useEffect(()=>{const F=new URLSearchParams(window.location.search).get("message");!(F!=null&&Ut.includes(F))||!ee.current||(ee.current.scrollIntoView({behavior:"instant"}),Kn(D=>(D.delete("message"),D),{replace:!0,preventScrollReset:!0}))},[]),c.useEffect(()=>{if(p)return;const O=new URLSearchParams(window.location.search).get("message")!=null;if(Vt.current||O||d===void 0||!ee.current||Wt){d==="finalAgentTurn"&&a&&Ie(s,D=>{D.scrollToMessageId=void 0});return}(Ut.includes(d)||d==="finalAgentTurn"&&a)&&(Vt.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(ee.current)if(d==="finalAgentTurn"&&a)ee.current.scrollIntoView({behavior:"instant",block:"end"}),Ie(s,D=>{D.scrollToMessageId=void 0});else{const D=ee.current.offsetHeight;let Q=0;lt?Q=-8:S?Q=0:D>Rs&&(Q=Rs-D);const pt=S?st():ql;ee.current.style.scrollMarginTop=`${Q+pt}px`,ee.current.scrollIntoView({behavior:"smooth"})}})}))},[d,ee.current,lt,Wt]);const{showDebugConversationTurns:Xn}=on(),Qn=zo(s),Jn=!Ae&&!De&&!Et&&!W,Zn=Y?.author.role===L.Assistant?Y:null,ea=Y?.metadata?.system_hints?.includes(re.Research);$o({isCompletionRequestInProgress:te,isUserTurn:W,message:Zn});const{isOpen:ta}=vt(),sa=Yo(),Ue=Ko(Ft),qe=!Ue&&Jn&&a&&En?.num_variants_in_stream===2&&ae.length<=2&&!h?.clientMetadata?.inlineComparisonRating&&!wn,na=Xo(m=>m.voiceFeedbackThread),zt=Hn===na,aa=h?.metadata?.async_source,He=a&&Vn,xe=Be||te||Ln,ct=!Ee&&!Ae&&!De&&!Ue&&!ta&&!j&&I.role!==L.Developer&&!(I.role===L.User&&i)&&!(a&&zt&&xe)&&!(He&&xe)&&!(a&&Be&&aa)&&!(xe&&M)&&!h?.metadata?.is_auto_proceed_message&&!h?.metadata?.is_takeover_ended_message,oa=!ct&&!(He&&xe)&&(Ae||De),ra=R.some(m=>_i(m)===Ci.l1239dk1),dt=pe(s,m=>{const F=new Set;return U.getParentPromptNode(m,_.id)?.message.metadata?.attachments?.forEach(D=>{D.mime_type?.startsWith("image/")||F.add(D.context_connector_info?.context_connector??"file")}),F}),ut=Mi(),mt=Ii(u,"110789670");let me;ut.isLoading?me=void 0:ut.canUpgradeGDrive&&dt.has(Ye.GDRIVE)&&mt.get("enabled",!1)?me=Ye.GDRIVE:ut.canUpgradeSharepoint&&dt.has(Ye.O365_BUSINESS)&&mt.get("enabled",!1)?me=Ye.O365_BUSINESS:dt.has("file")&&mt.get("enabled",!1)&&(me="general");const ia=He&&!te&&!j&&!Ae&&!De&&!ra&&(ie||Te||_e||G||!!me),Le=h!=null&&(!T||Mn||E||At)&&!Ue&&!Ot&&!Et&&!h.metadata?.b1de6e2_s,$t=(!T||At)&&Le&&(He||a&&zt)&&!Be&&!te&&!j&&!lt&&!M,Yt=!((te||Be)&&a)&&ae.length>1&&!qe,Kt=W&&R.some(m=>is(m)?.shouldHideContent),la=W&&Oe!=null&&!Ue&&!An&&!Kt&&!Ot&&!ea,ca=h!=null&&(h.clientMetadata?.disclaimers??[]).length===0,Xt=N(w?.messages.filter(wi)),da=nn(f)&&Dt,Qt=c.useCallback(m=>{Ie(s,F=>{It.setCurrentBranch(F,ae[m])}),V.logEvent("Change Active Node",{intent:"toggle_between"}),ye(u,"4126691920")&&Qo({parent_prompt_id:ot?.id??"",prev_branch_id:ae[Fe],next_branch_id:ae[m]},se(s))},[s,ae,Fe,ot?.id,u]),ua=Jo(I,R,Xn),{toggleThreadSidebar:Jt}=ki(),Ge=h?.id,ma=c.useCallback(()=>{Ge&&Jt({type:"retrievalResults",clientThreadId:s,turnIndex:n,messageId:Ge})},[Ge,Jt,s,n]),ga=c.useMemo(()=>Zo(I,Pt,!!Pe),[Pt,Pe,I]),pa=c.useMemo(()=>R.some(m=>is(m)?.canRetry===!1),[R]),ha=h?.metadata?.n7jupd_button_type,fa=M&&h!=null&&h.id!=null&&!ha,xa=M&&a&&xe,va=M&&a;if(!ua&&!qe)return qt?e.jsx("div",{style:Es()}):null;if(A)return null;const ba=Y?.metadata?.followup_prompts?Y.metadata.followup_prompts.map(m=>({text:m,type:Vs.Reply})):[],ya=Y?.metadata?.category_suggestions,Sa=Y?.metadata?.action_suggestions,ja=!R.some(m=>dn.getAudioAssetPointers(m).length>0)&&!Pe&&!pa,Ta=!te&&R.some(m=>m.author.role===L.Assistant&&m.metadata?.onboarding?.main_usages),gt=R.find(m=>!!m.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Zt=!Kt&&(!a||!te);if(Qn&&!a&&$.length===0&&!M)return null;let Ve="none";return W&&rt&&(Ve="first"),W&&!rt&&(Ve="large"),a&&(Ve="last"),e.jsx(er.Provider,{value:Dt,children:e.jsxs(tr,{children:[e.jsx(sr,{dateHeaderType:l,turn:I}),e.jsxs("article",{className:q("text-token-text-primary w-full",!p&&d==="finalAgentTurn"&&B?"opacity-0":"",{hidden:_n&&rt}),style:qt?Es():void 0,ref:ee,dir:"auto","data-testid":`conversation-turn-${n}`,"data-scroll-anchor":!p&&a,children:[e.jsx(nr,{role:I.role}),e.jsx(ar,{role:I.role,children:e.jsxs(or,{horizontalPadding:qe?"none":"standard",verticalPadding:Ve,children:[qe?e.jsxs(e.Fragment,{children:[e.jsx(rl,{isFeedbackEnabled:Le,variantIds:ae,conversationTurnMountTime:qn,...t}),Fn&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(et,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{an.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(rr,{className:"text-token-text-secondary me-1"}),e.jsx(H,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsxs(Je,{tabIndex:-1,className:q("group/turn-messages focus-visible:outline-hidden",y&&"super-widget-visible",W&&!ct&&!j&&"mb-10",pr({isUserTurn:W})),children:[da&&e.jsx(ir,{clientThreadId:s,threadContent:Pn?.content??null,query:Xt?nt(Xt):null,triggeredSearch:C,onNavLinksWidgetDidShow:m=>{m&&P(!0)}}),!W&&e.jsx(Ol,{messages:R,clientThreadId:s,gizmoId:Nt?.gizmo.id}),sa&&W&&e.jsx(Ul,{clientThreadId:s,messages:R}),Ee&&Oe?e.jsx(ks,{message:Oe,clientThreadId:s,onRequestCompletion:o,onExitEdit:Bn,disabled:Gt}):e.jsx(bt,{allMessages:k,groupedMessagesToRender:K,allGroupedMessages:g,...t,isUserTurn:W,isFinalUserTurn:kn,isFinalAssistantTurn:Rn,isCompletionRequestInProgress:te,isFeedbackEnabled:Le,isFinalTurn:a,hasActiveRequest:Gt,hasN7JUPD:M}),ga&&e.jsx(lr,{handleShowRetrievalResults:ma,clientThreadId:s,turnIndex:n,responseComplete:!xe}),fa&&e.jsx(cr,{message:h,clientThreadId:s,turnIndex:n,referenceMessageId:h.id,responseComplete:!a||!te}),Ta&&e.jsx(Wi,{clientThreadId:s}),gt&&gt.length>0&&!te&&e.jsx(zi,{clientThreadId:s,examples:gt}),ct&&e.jsx("div",{className:"mx-[var(--mini-thread-content-inset)]",children:e.jsx(Pl,{isUserTurn:W,alwaysShow:!0,children:W?S?null:e.jsx(Fl,{activeVariantIndex:Fe,clientThreadId:s,numVariants:ae.length,onAnticipateEdit:ks.prefetch,onChangeIndex:Qt,onEnterEdit:Dn,showCopyButton:Zt,showEditMessageButton:la,showPagination:Yt,turnIndex:n}):e.jsxs(e.Fragment,{children:[e.jsx(Al,{activeVariantIndex:Fe,clientThreadId:s,conversationMode:Ft,lastMessage:h,messages:R,numVariants:ae.length,onChangeIndex:Qt,onRate:Un,showCanvasButton:Yn,showCopyButton:Zt,showPagination:Yt,showPlayButton:ca,showRatingButtons:Le,showRegenerateButton:ja,turn:I,turnIndex:n,parentPrompt:ot}),e.jsx(ls,{clientThreadId:s,message:h,turnIndex:n}),$t&&e.jsx(dr,{canShowInlineMessageFeedback:Rt,clientThreadId:s,messageForRating:h})]})})}),xa&&e.jsx(ur,{clientThreadId:s}),va&&e.jsx(ol,{clientThreadId:s,messages:R}),oa&&e.jsx(ls,{clientThreadId:s,message:h,turnIndex:n}),$t&&e.jsx(mr,{canShowInlineMessageFeedback:Rt,clientThreadId:s,messageForRating:h,allGroupedMessages:g,currentModelId:r}),ia&&(me?e.jsx(gr,{clientThreadId:s,connectorToUpsell:me,analyticsMetadata:Z}):e.jsx(Cl,{followups:ba,actionSuggestions:Sa,categorySuggestions:ya,clientThreadId:s,lastMessageId:Ge,analyticsMetadata:Z,isTatertotFollowupsEnabled:G}))]}),e.jsx(hr,{clientThreadId:s,turn:I,isFinalTurn:a})]})})]})]})})}const Ll=Ia.memo(Hl);function cc(t){const{prefetchNavlink:n,clearPrefetchNavlink:a,clientThreadId:s,pageLoadSearchQuery:o}=t,r=ne(),d=Qs(r),l=vr(s),i=br(),u=yr(),{isOpen:x}=vt(),p=u.store.useContentAreaDimensions(Sr.Header,f=>f?.height?f.height:void 0);let v=e.jsx(Gl,{isNewScrollEnabled:d,...t});return el()&&(v=e.jsx(tl,{clientThreadId:s,children:v})),v=e.jsx(_r,{clientThreadId:s,children:v}),e.jsxs("div",{onCopy:l,className:q("@thread-xl/thread:pt-header-height flex flex-col text-sm",i&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",p?null:!d&&(x?"max-sm:pb-25":"pb-25")),style:{paddingBottom:p},children:[o&&e.jsx("div",{children:e.jsx(jr,{query:o})}),n?e.jsx(Ei,{name:"prefetch-navlink",onError:f=>{Ze.addError("Error with prefetch navlink",{error:f}),a()},children:e.jsx(c.Suspense,{fallback:null,children:e.jsx(Tr,{clientThreadId:s,prefetchNavlink:n,clearPrefetchNavlink:a})})}):null,e.jsx(Ni,{children:v})]})}function Gl({onRequestCompletion:t,clientThreadId:n,scrollContainerRef:a,isNewScrollEnabled:s}){const[o,r,d]=pe(n,g=>[U.getConversationTurnIds(g),g?.conversationOrigin===Pi.APPLE,g?.scrollToMessageId]),l=Ai(),i=Js(),u=Fi(),x=Cr(),[p]=Mr(),v=Ir(),[f]=wr(),S=un(n);c.useEffect(()=>{l&&(ve.logEvent("chatgpt_continue_conversation_page_loaded"),V.logEvent("Continue Conversation: Page Loaded"),ve.logEvent("chatgpt_conversation_share_page_loaded"),V.logEvent("Share Public Chat: Shared Conversation Loaded"))},[l]);const j=c.useCallback(()=>{s||x({behavior:"smooth"})},[s,x]),E=Re(Mt),[T,B]=c.useState(!1),I=(T||!1)&&!E,A=c.useRef(null),w=kr(n),k=i&&!u;return e.jsxs(e.Fragment,{children:[k&&e.jsx(Ji,{}),l&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(H,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary mb-5 text-center text-xs font-semibold",children:e.jsx("button",{onClick:()=>{Xs.openModal(Rr.ReportConversation),ve.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),V.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(H,{id:"thread.reportSharedConversation",defaultMessage:"Report conversation"})})})]}),o.map((g,b)=>e.jsx(Ll,{isFinalTurn:b===o.length-1,turnIndex:b,clientThreadId:n,onRequestCompletion:t,currentModelId:S.id,scrollToBottom:s?void 0:j,scrollToMessageId:s?void 0:d,dateHeaderType:w(b),hideUserActions:E},g)),!s&&e.jsxs(e.Fragment,{children:[a?.current&&e.jsx(Di,{setIsScrolledToEdge:g=>{B(g)},options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:A}),r&&p&&!f&&e.jsx(Ns,{className:q("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{ve.logEvent("chatgpt_thread_scroll_to_top"),v({behavior:"smooth"})},children:e.jsx(Er,{className:"icon text-token-text-primary"})}),e.jsx(As,{children:I&&e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(Ns,{className:q("bottom-[calc(var(--composer-overlap-px)+--spacing(6))]"),onClick:()=>{ve.logEvent("chatgpt_thread_scroll_to_bottom"),A.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(Nr,{className:"icon text-token-text-primary"})})})})]})]})}const Ns=je.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-default end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;export{ic as P,lc as S,cc as T,yt as a};
//# sourceMappingURL=gxo2ppc4wrdtmw6p.js.map
