import{il as f,bl as p,im as _,ik as w,a5 as h,km as g,b as l,L as u,ak as y,b2 as S,q as c,F as d,kn as b,R as F,at as V}from"./dc2xxjkicf2pz0mj.js";import{ba as E,e as x}from"./ckp56qklot786ulr.js";import{d as m,r as i}from"./juy90og0wtbp77qa.js";function v(){const t=x(),e=h();return e&&t&&!g(t)&&e.isEnterprisey()}function H(){return f(p.ChartSerialization)}function R(t,e){const a=t==="chart"?l.HasSeenAdaInteractiveChart:l.HasSeenAdaInteractiveTable,[s,r]=i.useState(u.getItem(a,{userId:e})??!1),n=i.useCallback(()=>{r(!0),u.setItem(a,!0,{userId:e})},[a,e]);return[s,n]}function D(t){const[e,a]=i.useState([]),s=y(t,S.getBranch);return i.useEffect(()=>{const r=I(s);r.length!==e.length&&a(r)},[e.length,t,s]),e}function z(t){const e=t.metadata?.aggregate_result?.messages.filter(E)??[];let a=0;const s=(t.metadata?.ada_visualizations??[]).map(n=>{let o=n;return n.type=="chart"&&(o={...n,fallback_image:e[a++]}),o}),r=(t.metadata?.attachments??[]).filter(n=>_(n.name)).map(n=>({type:"table",file_id:n.id??"",title:w(n),file_name:n.name,context_connector_info:n.context_connector_info}));return[...s,...r]}function I(t){return t.filter(a=>a.message?.author.role==="tool"&&a.message?.author.name==="python"||(a.message?.metadata?.attachments??[]).length>0).flatMap(a=>z(a.message))}async function T(t,e,a){const s=await t.text(),{parse:r}=await V(async()=>{const{parse:o}=await import("./oeujip5i1ptrxie5.js");return{parse:o}},[]),n=r(s);return{content:{columnNames:n.shift(),columnTypes:n[0].map(()=>"string"),rows:n},file_name:e,download_url:a}}function k(t){const e=t[0].values.length,a=[];for(let s=0;s<e;s++){const r=t.map(n=>n.values[s]);a.push(r)}return a}function L(t){return m({queryKey:["ada-visualization","chart",t.file_id],queryFn:async()=>{const e=await c(t.file_id);if(e.status===d.Success){const a=await fetch(e.download_url);if(a.status!==200)throw new Error("Failed to download chart json from interpreter");const s=await a.json();return{content:{chart_type:s.type,title:s.title,labels:s.labels,datasets:s.datasets,x_label:s.x_label,y_label:s.y_label},file_name:e.file_name??"",download_url:e.download_url}}else throw new Error("Failed to download chart json from interpreter")}})}function N(t){return m({queryKey:["ada-visualization","table",t.file_id],queryFn:async()=>{if(t.file_name&&b(t.file_name)){const e=await F.safeGet("/ada/parse_xls/{file_id}",{parameters:{path:{file_id:t.file_id}}});return{content:e.sheets.map(a=>({name:a.name,columnNames:a.columns.map(s=>s.name),columnTypes:a.columns.map(()=>"string"),rows:k(a.columns)})),download_url:e.download_url,file_name:t.file_name}}else{const e=await c(t.file_id);if(e.status===d.Success){const a=await fetch(e.download_url);return T(a,e.file_name??"",e.download_url)}else throw new Error("Failed to download from interpreter")}},throwOnError:!1})}export{D as a,N as b,L as c,v as d,R as e,z as g,H as u};
//# sourceMappingURL=ec9s4r12axh2q1y0.js.map
