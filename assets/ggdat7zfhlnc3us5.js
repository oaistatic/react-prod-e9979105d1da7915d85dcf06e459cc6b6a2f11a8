import{mM as G,mN as ye,ar as k,B as A,am as w,bR as Y,lr as De,mO as Ne,mP as ie,mQ as P,ej as q,mR as ve,C as Ee,mS as I,mT as ee,mU as ae,P as h,R as D,mV as le,ls as te,mW as de,mX as Ae,mY as Ie,mZ as Me,dG as Ge,g8 as Oe,eW as Re,aG as ne,dR as be,r as ze,iD as We,m_ as Pe,e as qe,f as Be,aC as Fe,fr as He,j6 as Ke}from"./dc2xxjkicf2pz0mj.js";import{j as e,m as ke,h as $,r as u,M as c,f as O,d as B,g as $e}from"./juy90og0wtbp77qa.js";import{fd as Qe,eV as Ve,a0 as Ye,pQ as Ze,hF as U,eU as we,bA as Xe,d as Je,eF as ea,s0 as aa,a5 as H,iG as ta}from"./ckp56qklot786ulr.js";import{r as sa}from"./o48v7yn30haojvdm.js";import{S as oa}from"./fkdark0ezkwwm12s.js";import{f as j,d as ra,V as na,u as ia,O as Z}from"./csftoicutoaoo69v.js";import{L as la}from"./gjz0pgmiqrjm9uho.js";import{S as da}from"./bcuewx2asswh85ed.js";import{S as ca}from"./ec55vn9b13i0bljf.js";import{c as ua,a as ga,u as ma,h as pa}from"./nun3xvf89dudjv6n.js";import"./iq982ga1lltyy4ue.js";import"./fj1zlpb3ugj147t8.js";import"./galyil7vygq0i5a6.js";import"./icu9d2zdwlcy45kn.js";import"./btouzu0b6h5eiejj.js";import"./o6wb3ptvu0bk81yq.js";import"./dmfmxszxfbs8gsbx.js";import"./iacposgqe14fuloa.js";import"./o7zrzew6ugefv8n2.js";import"./abebcwj1m9mup3z6.js";import"./nqj34k5dky4x5suq.js";import"./hort3ndd4wla0a2j.js";import"./jsgl3b1bt1ozctr5.js";import"./ck00y48d3yzt8bq3.js";import"./hczymk9ojq2shlcf.js";import"./hisrfv493df9w8hp.js";import"./g8shiwm7jpd74xmd.js";import"./iiyyoj0wgh5vo89i.js";import"./chyo79tmbp42x8r3.js";import"./ctoge6bibgzva9ta.js";import"./m36qabefvxegdn1g.js";function je(){return" "}const L=G(ye(new Date,1)),E=new Date;function se({onLeft:a,leftDisabled:t,onRight:s,rightDisabled:o,children:r,className:l,borderLess:n=!1,surpressChildrenWrapper:i=!1}){return e.jsxs("div",{className:k("flex items-stretch",l),children:[e.jsx(A,{className:k("disabled:text-token-text-quaternary pe-1",!n&&"border-token-border-medium rounded-e-none border-e-0 disabled:opacity-100"),color:n?"ghost":"secondary",size:"small",onClick:a,disabled:t,icon:Qe}),i?r:e.jsx("span",{className:k("flex grow items-center justify-center px-1 text-sm",!n&&"border-token-border-medium border-t border-b"),children:r}),e.jsx(A,{className:k("disabled:text-token-text-quaternary ps-1",!n&&"border-token-border-medium rounded-s-none border-s-0 disabled:opacity-100"),color:n?"ghost":"secondary",size:"small",onClick:s,disabled:o,icon:Ve})]})}const ha=sa(12);function _e({referenceDate:a,setReferenceDate:t,earliestValidDate:s,latestValidDate:o,motionLayoutId:r}){return e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>t(ye(a,1),"subYear"),onRight:()=>t(De(a,1),"addYear"),leftDisabled:Y(new Date)>=Y(a)+1,rightDisabled:Y(new Date)<=Y(a),children:w(a,"y")}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:ha.map(l=>{const n=G(Ne(a,l)),i=ie(n,a),d=P(n,s)||q(n,o);return e.jsxs("button",{disabled:d,onClick:()=>t(n,"select"),className:k("relative h-8 w-full rounded-md",!d&&"hover:bg-token-surface-hover"),children:[i&&e.jsx(ke.div,{layoutId:r,className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-md",transition:{duration:.15}}),e.jsx("span",{className:k("relative z-10 transition-colors duration-75",i&&"text-token-main-surface-primary delay-75",!i&&"text-token-text-primary delay-0",d&&"text-token-text-quaternary"),children:w(n,"MMM")})]},l)})})]})}function xa({currentWorkspaceId:a,currentTab:t,onClose:s}){const o=$(),[r,l]=u.useState(!1),[n,i]=u.useState(t==="gptsTab"?"gpt":"user"),[d,p]=u.useState("thisMonth"),[g,M]=u.useState(),_=Ye(m=>m.currentWorkspace?.name)??a,v=new Date,f=ve(new Date,1);return e.jsxs(Ee,{testId:"modal-export",isOpen:!0,onClose:()=>{s(),h.logEvent("Workspace Usage: Export Modal Closed Without Generation")},type:"success",title:e.jsx(c,{...x.title}),showCloseButton:!0,primaryButton:e.jsx(A,{loading:r,onClick:async()=>{l(!0);try{const m=d==="customRange"?{period:g?.period??K.period,period_start:j(g?.referenceDate??K.referenceDate)}:va(d);h.logEvent("Workspace Usage: Export Generate CSV Clicked",{reportType:n,dateRangeType:d,period:m.period,periodStart:m.period_start});const N=await D.safeGet("/accounts/{account_id}/reporting",{parameters:{path:{account_id:a},query:{...m,report_type:n}}});ra({data:N.csv_content,mimeType:"text/csv",filename:o.formatMessage(x.filename,{workspaceName:_,period:m.period,reportType:n,date:m.period_start})})}finally{l(!1)}s()},children:e.jsx(c,{...x.generateCsvButton})}),children:[e.jsxs(la,{className:"font-medium",children:[e.jsx(c,{...x.dataTypeDropdownLabel}),e.jsx(Ze,{triggerClassName:"flex mt-2 border border-token-border-default text-base focus-visible:border-token-border-default w-full justify-between",value:n,onValueChange:m=>i(m),options:[{label:o.formatMessage(x.dataTypeDropdownUsers),value:"user"},{label:o.formatMessage(x.dataTypeDropdownGpts),value:"gpt"}]})]}),e.jsx("div",{className:"mt-6 mb-2 font-medium",children:e.jsx(c,{...x.dateRangeLabel})}),e.jsxs(U.Root,{className:"flex flex-col gap-3",value:d,onValueChange:m=>{p(m),h.logEvent("Workspace Usage: Export Date Range Type Changed",{dateRangeType:m})},children:[e.jsx(U.Item,{value:"thisMonth",label:e.jsx(c,{...x.thisMonthLabel,values:{date:w(v,"MMMM y")}}),children:e.jsx(U.Indicator,{})}),e.jsx(U.Item,{value:"lastMonth",label:e.jsx(c,{...x.lastMonthLabel,values:{date:w(I(v,1),"MMMM y")}}),children:e.jsx(U.Indicator,{})}),e.jsx(U.Item,{value:"thisWeek",label:e.jsx(c,{...x.thisWeekLabel,values:{date:`${w(ee(v),"MMM d")} – ${w(ae(v),"MMM d")}`}}),children:e.jsx(U.Indicator,{})}),e.jsx(U.Item,{value:"lastWeek",label:e.jsx(c,{...x.lastWeekLabel,values:{date:`${w(ee(f),"MMM d")} – ${w(ae(f),"MMM d")}`}}),children:e.jsx(U.Indicator,{})}),e.jsx(U.Item,{value:"customRange",label:e.jsx(fa,{customRange:g,setCustomRange:M,onClick:()=>p("customRange")}),children:e.jsx(U.Indicator,{})})]})]})}const K={period:"monthly",referenceDate:new Date};function fa({customRange:a,setCustomRange:t,onClick:s}){const o=(a??K).period,r=(a??K).referenceDate,l=o==="monthly"?le(r):ae(r),n=({period:i,referenceDate:d})=>t((p=K)=>{const g=i??p.period,M=d??p.referenceDate,_=g==="monthly"?G:ee,v=q(M,E)?E:P(M,L)?L:M;return{period:g,referenceDate:_(v)}});return e.jsx(we,{className:"z-50",alignAgainstAnchor:"start",triggerButton:e.jsxs(A,{size:"small",color:"secondary",contentsFullWidth:!0,onClick:s,children:[a?e.jsx(c,{...x.customRangeDisplay,values:{start:de(a.referenceDate),end:de(l)}}):e.jsx(c,{...x.chooseMonthOrWeekButton}),e.jsx("div",{className:"grow"}),e.jsx(Xe,{})]}),children:e.jsxs("div",{className:"w-[210px] p-1 text-xs",children:[e.jsx(oa,{className:"mb-4 rounded-md",value:o,onChange:i=>{n({period:i}),h.logEvent("Workspace Usage: Export Custom Period Changed",{period:i})},ariaLabel:x.customRangePeriodToggleAria,leftItem:{className:"rounded-md",ariaLabel:x.chooseDateMonthlyLabel,label:x.chooseDateMonthlyLabel,value:"monthly"},rightItem:{className:"rounded-md",ariaLabel:x.chooseDateWeeklyLabel,label:x.chooseDateWeeklyLabel,value:"weekly"}}),o==="monthly"?e.jsx(_e,{referenceDate:r,setReferenceDate:(i,d)=>{n({referenceDate:i}),h.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"monthly",change:d})},earliestValidDate:L,latestValidDate:E,motionLayoutId:"workspaceUsage.exportModal.customRange.monthHighlight"}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>{n({referenceDate:I(r,1)}),h.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"subMonth"})},onRight:()=>{n({referenceDate:te(r,1)}),h.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"addMonth"})},leftDisabled:P(I(r,1),L),rightDisabled:q(te(r,1),E),children:w(r,"MMMM y")}),e.jsx(ya,{referenceDate:r,setReferenceDate:i=>n({referenceDate:i})})]})]})})}const ya=({referenceDate:a,setReferenceDate:t})=>{const s=G(a),o=Ae({start:s,end:le(a)});return e.jsx("div",{className:"flex flex-col gap-1",children:o.map(r=>{const l=Ie(r,a),n=P(r,L)||q(r,new Date);return e.jsxs("button",{disabled:n,onClick:()=>{t(r),h.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"select"})},className:k("relative h-8 w-full rounded-full",!n&&"hover:bg-token-surface-hover"),children:[l&&e.jsx(ke.div,{layoutId:`workspaceUsage.exportModal.customRange.weekHighlight.${s.toISOString()}`,className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-full",transition:{duration:.15}}),e.jsx("div",{className:k("relative z-10 flex w-full justify-around transition-colors duration-75",l&&"text-token-main-surface-primary delay-75",!l&&"text-token-text-primary delay-0"),children:Me({start:r,end:ae(r)}).map(i=>e.jsx("div",{className:k("w-0 grow",{"text-token-text-quaternary":!ie(i,a)||q(i,new Date)||P(i,L)}),children:w(i,"d")},i.toISOString()))})]},r.toISOString())})})};function va(a){const t=new Date;return a==="thisWeek"||a==="lastWeek"?{period:"weekly",period_start:j(ee(a==="thisWeek"?t:ve(t,1)))}:{period:"monthly",period_start:j(G(a==="thisMonth"?t:I(t,1)))}}const x=O({title:{id:"workspaceUsage.exportModal.title",defaultMessage:"Export data"},dataTypeDropdownLabel:{id:"workspaceUsage.exportModal.dataTypeDropdownLabel",defaultMessage:"Data type"},dataTypeDropdownUsers:{id:"workspaceUsage.exportModal.dataTypeDropdownUsers",defaultMessage:"Users"},dataTypeDropdownGpts:{id:"workspaceUsage.exportModal.dataTypeDropdownGpts",defaultMessage:"GPTs"},dateRangeLabel:{id:"workspaceUsage.exportModal.dateRangeLabel",defaultMessage:"Date range"},thisMonthLabel:{id:"workspaceUsage.exportModal.thisMonthLabel",defaultMessage:"This month ({date})"},lastMonthLabel:{id:"workspaceUsage.exportModal.lastMonthLabel",defaultMessage:"Last month ({date})"},thisWeekLabel:{id:"workspaceUsage.exportModal.thisWeekLabel",defaultMessage:"This week ({date})"},lastWeekLabel:{id:"workspaceUsage.exportModal.lastWeekLabel",defaultMessage:"Last week ({date})"},chooseMonthOrWeekButton:{id:"workspaceUsage.exportModal.chooseMonthOrWeekButton",defaultMessage:"Choose month or week"},customRangeDisplay:{id:"workspaceUsage.exportModal.customRangeDisplay",defaultMessage:"{start} – {end}"},generateCsvButton:{id:"workspaceUsage.exportModal.generateCsvButton",defaultMessage:"Generate CSV"},customRangePeriodToggleAria:{id:"workspaceUsage.exportModal.customRangePeriodToggleAria",defaultMessage:"Date range period choice"},chooseDateMonthlyLabel:{id:"workspaceUsage.exportModal.chooseDateMonthlyLabel",defaultMessage:"Monthly"},chooseDateWeeklyLabel:{id:"workspaceUsage.exportModal.chooseDateWeeklyLabel",defaultMessage:"Weekly"},filename:{id:"workspaceUsage.exportModal.filename",defaultMessage:"{workspaceName} {period} {reportType} report {date}.csv"}});function Ue({startDate:a,statsSpec:t,data:s,previousData:o}){return e.jsx("div",{className:"border-token-border-default my-6 flex min-h-[80px] w-full rounded-lg border px-2 py-4",children:t.map(({dataKey:r,label:l,helpText:n})=>{const i=s==null?"loading":s[r],d=o==null?"loading":o[r];return e.jsxs("div",{className:"border-token-border-default flex w-0 grow flex-col justify-between border-e px-4 last:me-0 last:border-e-0",children:[e.jsxs("div",{className:"text-token-text-secondary text-sm",children:[e.jsx(c,{...l}),e.jsx(je,{}),n&&e.jsx(Ge,{label:e.jsx("span",{className:"text-token-main-surface-primary font-normal",children:e.jsx(c,{...n})}),side:"top",customBackgroundColorClassName:"bg-token-main-surface-primary-inverse",children:e.jsx(Oe,{className:"icon-sm inline"})})]}),e.jsx(na,{value:i,previousValue:d,hideTrend:ie(a,new Date),className:"h-[28px]"})]},r)})})}function Te({handleSearch:a,clientEventSource:t,className:s}){const r=$().formatMessage(Ma.filterListInputLabel),l=u.useCallback(Je(n=>{a(n),h.logEvent("Workspace Usage: Filter Searched",{queryLength:n.length,trigger:"debouncedTyping",source:t})},250),[]);return e.jsx(Re,{className:k("max-w-[300px]",s),ariaLabel:r,placeholder:r,type:"text",name:"search",icon:ea,iconPosition:"left",saveOnBlur:!0,value:"",onChange:n=>l(n.target.value.trim()),onPressEnter:n=>{const i=n?.trim()??"";a(i),h.logEvent("Workspace Usage: Filter Searched",{queryLength:i.length,trigger:"enterKey",source:t})}})}const Ma=O({filterListInputLabel:{id:"workspaceUsage.filterListInputLabel",defaultMessage:"Search"}}),ce=20,ue=[{cursor:void 0,queryId:void 0}];function Le({getQueryKey:a,loader:t,initialSortDirection:s,spec:o,getData:r,clientEventSource:l}){const[n,i]=u.useState(s),[d,p]=u.useState(ue),[g,M]=u.useState(0),[_,v]=u.useState(),f=B({queryKey:a({order_by_field:n.metric,order_by_direction:n.direction,cursor:d[g]?.cursor,query_id:d[g]?.queryId,page_size:ce}),queryFn:({queryKey:y})=>t(y)}),m=f.data?r(f.data):"loading",N=aa(m),S=m==="loading"&&N.current!=="loading",oe=S?N.current:m;u.useEffect(()=>{f.data?.next_cursor&&f.data?.query_id&&d.length===g+1&&p(y=>[...y,{cursor:f.data?.next_cursor,queryId:f.data?.query_id}])},[f.data,d,g]),u.useEffect(()=>{_==null&&f.data&&(f.data.total_count!=null?v(Math.ceil(f.data.total_count/ce)):v(1))},[f.data,d,_]);const Ce=n.direction==="ASC"?ca:da;return e.jsxs("div",{className:"mt-4",children:[e.jsxs(H.Root,{className:"border-token-border-medium mb-4 border-b-[0.5px]",children:[e.jsx(H.Header,{children:o.map(({metric:y,label:C,defaultSortDirection:Q="ASC"})=>e.jsxs(H.HeaderCell,{className:"text-[13px] font-medium text-nowrap",onClick:()=>{M(0),p(ue),i(V=>{let F;return y===V.metric?F=V.direction==="ASC"?"DESC":"ASC":F=Q,h.logEvent("Workspace Usage: Table Sort Clicked",{metric:y,direction:F,source:l}),{direction:F,metric:y}})},children:[C,n.metric===y&&e.jsx(Ce,{className:"icon text-token-icon-secondary ms-1 inline"})]},y))}),e.jsx(H.Body,{children:oe&&oe!=="loading"&&oe.map((y,C)=>e.jsx(H.Row,{children:o.map(({metric:Q,render:V},F)=>e.jsx(H.Cell,{className:k(S&&"pt-0 pb-0 [&]:border-0"),divClassName:k("items-center",F>0&&"text-token-text-secondary",!S&&"min-h-[40px]",S&&"h-0 overflow-hidden"),children:V(y[Q],y)},Q))},C))})]}),m==="loading"&&e.jsx("div",{className:"flex h-[860px] items-center justify-center",children:e.jsx(ne,{})}),m!=="loading"&&m.length===0&&e.jsx("div",{className:"flex h-[100px] items-center justify-center",children:e.jsx(c,{...ba.zeroStateMessage})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(se,{onLeft:()=>{M(y=>{const C=y-1;return h.logEvent("Workspace Usage: Pagination Clicked",{direction:"left",pageIndex:C,source:l}),C})},leftDisabled:g<=0,onRight:()=>{M(y=>{const C=y+1;return h.logEvent("Workspace Usage: Pagination Clicked",{direction:"right",pageIndex:C,source:l}),C})},rightDisabled:d[g+1]==null,children:[g+1,"/",_??e.jsx(ne,{})]})})]})}const ba=O({zeroStateMessage:{id:"workspaceUsage.table.zeroStateMessage",defaultMessage:"No results found"}}),R=(a,{toastId:t="chatgpt.usageAnalytics.defaultErrorToastId",message:s}={})=>ia(a,{toastId:t,message:s});function ge(a,t){return B({queryKey:["workspace-analytics-gizmo-stats",{workspaceId:a,startDate:t}],queryFn:R(({queryKey:[s,o]})=>D.safeGet("/accounts/{account_id}/analytics/gizmo_stats",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}async function ka([a,{workspaceId:t,...s}]){return D.safeGet("/accounts/{account_id}/analytics/gizmo_list",{parameters:{path:{account_id:t},query:s}})}const wa={direction:"DESC",metric:"active_users"};function ja({currentWorkspaceId:a,startDate:t}){const[s,o]=u.useState(""),r=j(t),l=u.useCallback(g=>["workspace-analytics-gizmos-list",{workspaceId:a,start_date:r,filter_query:s,...g}],[r,s,a]),n=ge(a,r),i=j(I(t,1)),d=ge(a,i),p=R(ka);return e.jsxs("div",{className:"mb-8",children:[e.jsx(Ue,{startDate:t,data:n.data,previousData:d.data,statsSpec:_a}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Te,{className:"grow",handleSearch:o,clientEventSource:"gizmoList"}),e.jsx(A,{as:"link",to:"/admin/gpts",size:"small",color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(c,{...T.manageGPTs}),e.jsx(be,{className:"icon-sm"})]})})]}),e.jsx(Le,{getQueryKey:l,loader:p,getData:g=>g.gizmos,spec:Ta,initialSortDirection:wa,clientEventSource:"gizmoList"},`${a}.${r}.${s}`)]})}const T=O({totalGpts:{id:"workspaceUsage.gizmoList.stats.totalGpts",defaultMessage:"Total GPTs"},gptsCreatedThisMonth:{id:"workspaceUsage.gizmoList.stats.gptsCreatedThisMonth",defaultMessage:"GPTs Created This Month"},gptsActive:{id:"workspaceUsage.gizmoList.stats.gptsActive",defaultMessage:"GPTs active"},gptsActiveHelpText:{id:"workspaceUsage.gizmoList.stats.gptsActiveHelpText",defaultMessage:"GPTs that have sent at lease one message during this month"},nameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.name",defaultMessage:"Name"},messagesColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.messages",defaultMessage:"Total Messages"},creatorNameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.creatorName",defaultMessage:"Creator Name"},creatorEmailColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.creatorEmail",defaultMessage:"Creator Email"},activeUsersColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.activeUsersColumnLabel",defaultMessage:"Active Users"},draftFlag:{id:"workspaceUsage.gizmoList.draftFlag",defaultMessage:"Draft"},manageGPTs:{id:"workspaceUsage.gizmoList.manageGPTs",defaultMessage:"Manage GPTs"}}),_a=[{dataKey:"total_gpt_count",label:T.totalGpts},{dataKey:"gpt_created",label:T.gptsCreatedThisMonth},{dataKey:"active_gpt_count",label:T.gptsActive,helpText:T.gptsActiveHelpText}],Ua=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function me(a){return typeof a=="number"?Ua.format(a):null}const Ta=[{metric:"gpt_name",label:e.jsx(c,{...T.nameColumnLabel}),render:(a,{config_type:t})=>e.jsxs("div",{className:"flex grow items-center justify-between",children:[e.jsx("span",{children:a}),t==="draft"&&e.jsx("span",{className:"text-token-text-secondary text-xs",children:e.jsx(c,{...T.draftFlag})})]})},{label:e.jsx(c,{...T.creatorNameColumnLabel}),metric:"creator_name",render:a=>a},{metric:"messages",label:e.jsx(c,{...T.messagesColumnLabel}),render:me,defaultSortDirection:"DESC"},{metric:"active_users",label:e.jsx(c,{...T.activeUsersColumnLabel}),render:me,defaultSortDirection:"DESC"}];function La({startDate:a,setStartDate:t}){return e.jsx(se,{onLeft:()=>{t(s=>{const o=I(s,1);return h.logEvent("Workspace Usage: Month Changed",{direction:"left",startDate:j(o)}),o})},leftDisabled:P(I(a,1),L),onRight:()=>{t(s=>{const o=te(s,1);return h.logEvent("Workspace Usage: Month Changed",{direction:"right",startDate:j(o)}),o})},rightDisabled:q(te(a,1),E),surpressChildrenWrapper:!0,children:e.jsx(Sa,{startDate:a,setStartDate:t})})}function Sa({startDate:a,setStartDate:t}){return e.jsx(we,{triggerButton:e.jsx(A,{size:"small",color:"secondary",className:"rounded-none border-x-0 border-e-0 px-1",children:w(a,"MMM y")}),children:e.jsx("div",{className:"w-[210px] p-1 text-xs",children:e.jsx(_e,{referenceDate:a,setReferenceDate:(s,o)=>{const r=G(q(s,E)?E:P(s,L)?L:s);t(r),h.logEvent("Workspace Usage: Month Changed",{direction:o,startDate:j(r)})},earliestValidDate:L,latestValidDate:E,motionLayoutId:"workspaceUsage.monthSelector.monthHighlight"})})})}var re,pe;function Ca(){if(pe)return re;pe=1;var a=ze(),t=We(),s=t(function(o,r,l){a(o,l,r)});return re=s,re}var Da=Ca();const Na=$e(Da);async function Ea({queryKey:[a,{workspaceId:t,startDate:s}]}){return D.safeGet("/accounts/{account_id}/analytics/overview",{parameters:{path:{account_id:t},query:{start_date:s}}})}function Aa(a,t){return B({queryKey:["workspace-analytics-overview",{workspaceId:a,startDate:t}],queryFn:R(Ea)})}async function Ia({queryKey:[a,{workspaceId:t,startDate:s}]}){return D.safeGet("/accounts/{account_id}/analytics/gizmo_overview",{parameters:{path:{account_id:t},query:{start_date:s}}})}function Ga(a,t){return B({queryKey:["workspace-analytics-gizmo-overview",{workspaceId:a,startDate:t}],queryFn:R(Ia)})}function Oa(a,t){return B({queryKey:["workspace-analytics-tool-overview",{workspaceId:a,startDate:t}],queryFn:R(({queryKey:[s,o]})=>D.safeGet("/accounts/{account_id}/analytics/tool_overview",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}function X(a,t,s){return u.useMemo(()=>{if(!t)return;const o=Na(t,"date");return Me({start:a,end:le(a)}).map(r=>{const l=j(r),n=o[l];return n&&n.total>0?{date:n.date,total:n.total,values:n[s]??{}}:{date:l,blank:0}})},[a,t,s])}function Ra(a,t){const s=j(t),o=Aa(a,s),r=u.useMemo(()=>o.data?.active_user_data?.daily_data.map(({date:N,active_users:S})=>({date:N,total:S,values:{active_users:S}})),[o.data?.active_user_data?.daily_data]),l=X(t,r,"values"),n=X(t,o.data?.messages_data?.daily_data,"messages_by_model"),i=Ga(a,s),d=X(t,i.data?.daily_gizmo_messages_data,"messages_by_gpt"),p=Oa(a,s),g=X(t,p.data?.daily_tool_messages_data,"messages_by_tool"),M=$(),_=u.useMemo(()=>l&&o.data?.active_user_data?{data:l,metrics:{active_users:{displayName:M.formatMessage(za.activeUsers)}},monthOverMonth:o.data.active_user_data.month_to_month_data}:"loading",[l,M,o.data?.active_user_data]),v=u.useMemo(()=>n&&o.data?.messages_data?{data:n,metrics:he(o.data.messages_data.models),monthOverMonth:o.data.messages_data.month_to_month_data}:"loading",[n,o.data?.messages_data]),f=u.useMemo(()=>d&&i.data?.metrics&&i.data?.month_to_month_data?{data:d,metrics:Object.fromEntries(Object.entries(i.data.metrics).map(([N,S])=>[N,{displayName:S}])),monthOverMonth:i.data.month_to_month_data}:"loading",[d,i.data?.metrics,i.data?.month_to_month_data]),m=u.useMemo(()=>g&&p.data?.tool_list&&p.data?.month_to_month_data?{data:g,metrics:he(p.data.tool_list),monthOverMonth:p.data.month_to_month_data}:"loading",[g,p.data?.month_to_month_data,p.data?.tool_list]);return{dailyActiveUsers:_,dailyMessages:v,dailyGizmoMessages:f,dailyToolMessages:m}}function he(a){return Object.entries(a).sort(([,t],[,s])=>t-s).reduce((t,[s,o])=>(o>0&&(t[s]={displayName:s,total:o}),t),{})}const za=O({activeUsers:{id:"workspaceUsage.activeUsersMetric",defaultMessage:"Active users"}});function Wa({currentWorkspaceId:a,startDate:t}){const s=$(),o=Ra(a,t),r=!Pe(t,G(new Date));return e.jsxs("div",{className:"mt-10",children:[e.jsx(Z,{title:z.activeUsersChartTitle,data:o.dailyActiveUsers,displayMoM:r,clientEventSource:"activeUsers",hideLegend:!0}),e.jsx(Z,{title:z.messagesChartTitle,data:o.dailyMessages,otherGroupLabel:s.formatMessage(z.otherModels),displayMoM:r,clientEventSource:"totalMessages"}),e.jsx(Z,{title:z.gptMessagesChartTitle,data:o.dailyGizmoMessages,otherGroupLabel:s.formatMessage(z.otherGizmos),displayMoM:r,clientEventSource:"gizmoMessages"}),e.jsx(Z,{title:z.toolMessagesChartTitle,data:o.dailyToolMessages,otherGroupLabel:s.formatMessage(z.otherTools),displayMoM:r,clientEventSource:"toolMessages"})]})}const z=O({activeUsersChartTitle:{id:"workspaceUsage.overview.activeUsersChartTitle",defaultMessage:"Unique active users"},messagesChartTitle:{id:"workspaceUsage.overview.messagesChartTitle",defaultMessage:"Total messages sent"},gptMessagesChartTitle:{id:"workspaceUsage.overview.gptMessagesChartTitle",defaultMessage:"GPT messages sent"},toolMessagesChartTitle:{id:"workspaceUsage.overview.toolMessagesChartTitle",defaultMessage:"Tool messages received"},otherModels:{id:"workspaceUsage.overview.otherModels",defaultMessage:"Other models"},otherGizmos:{id:"workspaceUsage.overview.otherGizmos",defaultMessage:"Other GPTs"},otherTools:{id:"workspaceUsage.overview.otherTools",defaultMessage:"Other Tools"}});function xe(a,t){return B({queryKey:["workspace-analytics-user-stats",{workspaceId:a,startDate:t}],queryFn:R(({queryKey:[s,o]})=>D.safeGet("/accounts/{account_id}/analytics/user_stats",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}async function Pa([a,{workspaceId:t,...s}]){return D.safeGet("/accounts/{account_id}/analytics/user_list",{parameters:{path:{account_id:t},query:s}})}const qa={direction:"DESC",metric:"messages"};function Ba({currentWorkspaceId:a,startDate:t}){const[s,o]=u.useState(""),r=qe(),l=Be(r,"2861925050"),n=u.useMemo(()=>l?[...fe,{label:e.jsx(c,{...b.creditsUsedColumnLabel}),metric:"credits_used",render:J,defaultSortDirection:"DESC"}]:fe,[l]),i=j(t),d=u.useCallback(v=>["workspace-analytics-users-list",{workspaceId:a,start_date:i,filter_query:s,...v}],[i,s,a]),p=xe(a,i),g=j(I(t,1)),M=xe(a,g),_=R(Pa);return e.jsxs("div",{className:"mb-8",children:[e.jsx(Ue,{startDate:t,data:p.data,previousData:M.data,statsSpec:Fa}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Te,{className:"grow",handleSearch:o,clientEventSource:"userList"}),e.jsx(A,{as:"link",to:"/admin",size:"small",color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(c,{...b.manageUsersLink}),e.jsx(be,{className:"icon-sm"})]})})]}),e.jsx(Le,{getQueryKey:d,loader:_,getData:v=>v.users,spec:n,initialSortDirection:qa,clientEventSource:"userList"},`${a}.${i}.${s}`)]})}const b=O({purchasedSeats:{id:"workspaceUsage.userList.stats.purchasedSeats",defaultMessage:"Seats purchased"},claimedSeats:{id:"workspaceUsage.userList.stats.claimedSeats",defaultMessage:"Seats enabled"},claimedSeatsHelpText:{id:"workspaceUsage.userList.stats.claimedSeatsHelpText",defaultMessage:"Users who have accepted their invite and logged in"},activeUsers:{id:"workspaceUsage.userList.stats.activeUsers",defaultMessage:"Active users"},activeUsersHelpText:{id:"workspaceUsage.userList.stats.activeUsersHelpText",defaultMessage:"Users who have sent at least one message during this time period"},pendingInvites:{id:"workspaceUsage.userList.stats.pendingInvites",defaultMessage:"Pending invites"},nameColumnLabel:{id:"workspaceUsage.userList.tableHeader.name",defaultMessage:"Name"},emailColumnLabel:{id:"workspaceUsage.userList.tableHeader.email",defaultMessage:"Email"},messagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.messages",defaultMessage:"Total Messages"},gptMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.gptMessages",defaultMessage:"GPT Messages"},toolMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.toolMessages",defaultMessage:"Tool Messages"},creditsUsedColumnLabel:{id:"workspaceUsage.userList.tableHeader.creditsUsed",defaultMessage:"Credits Used"},manageUsersLink:{id:"workspaceUsage.userList.tableHeader.manageUsersLink",defaultMessage:"Manage users"}}),Fa=[{dataKey:"purchased_seats",label:b.purchasedSeats},{dataKey:"claimed_seat",label:b.claimedSeats,helpText:b.claimedSeatsHelpText},{dataKey:"active_users",label:b.activeUsers,helpText:b.activeUsersHelpText},{dataKey:"pending_invites",label:b.pendingInvites}],Ha=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function J(a){return typeof a=="number"?Ha.format(a):null}const fe=[{metric:"name",label:e.jsx(c,{...b.nameColumnLabel}),render:a=>a},{metric:"email",label:e.jsx(c,{...b.emailColumnLabel}),render:a=>a},{metric:"messages",label:e.jsx(c,{...b.messagesColumnLabel}),render:J,defaultSortDirection:"DESC"},{label:e.jsx(c,{...b.gptMessagesColumnLabel}),metric:"gpt_messages",render:J,defaultSortDirection:"DESC"},{label:e.jsx(c,{...b.toolMessagesColumnLabel}),metric:"tool_messages",render:J,defaultSortDirection:"DESC"}];function Ka(a){return Object.keys(a)}const $a=Fe.div`flex space-x-4`,Se={overviewTab:Wa,usersTab:Ba,gptsTab:ja};function Qa(a){return B({queryKey:["workspace-analytics-last-updated",{workspaceId:a}],queryFn:R(({queryKey:[t,s]})=>D.safeGet("/accounts/{account_id}/analytics/last_updated_time",{parameters:{path:{account_id:s.workspaceId}}}))})}const Va=Ka(Se);function Ya({currentWorkspaceId:a,startDate:t,setStartDate:s,currentTab:o,setTab:r}){const l=Qa(a),[n,i]=u.useState(!1);return e.jsx(ga,{title:e.jsx(c,{...W.title}),actions:e.jsxs(e.Fragment,{children:[e.jsx(La,{startDate:t,setStartDate:s}),e.jsx(A,{className:"ms-2",color:"secondary",size:"small",onClick:()=>{i(!0),h.logEvent("Workspace Usage: Export Modal Opened")},children:e.jsx(c,{...W.exportButton})}),n&&e.jsx(xa,{currentWorkspaceId:a,currentTab:o,onClose:()=>i(!1)})]}),tabsHeader:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($a,{children:Va.map(d=>e.jsx("a",{className:k("pb-2",o===d?"border-token-text-secondary text-token-text-primary border-b font-medium":"text-token-text-tertiary cursor-pointer font-normal"),onClick:()=>{r(d),h.logEvent("Workspace Usage: Tab Clicked",{tab:d})},children:e.jsx(c,{...W[d]})},d))}),e.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-1 text-xs",children:[l.data?e.jsxs("span",{children:[e.jsx(c,{...W.dataLastUpdatedLabel}),e.jsx(je,{}),l.data.last_updated_time?w(new Date(l.data.last_updated_time),"MMM d, yyyy"):e.jsx(c,{...W.dataLastUpdatedUnknown})]}):e.jsx(ne,{}),"·",e.jsx(He,{href:"https://help.openai.com/en/articles/10875114-user-analytics-for-chatgpt-enterprise",className:"hover:text-token-link-hover underline",children:e.jsx(c,{...W.helpCenterLinkText})})]})]})})}function Za({currentWorkspaceId:a}){const t=$(),[s,o]=u.useState("overviewTab"),[r,l]=u.useState(G(new Date)),n=Se[s];return u.useEffect(()=>{h.logPageView(),h.logEvent("Workspace Usage: Page Viewed")},[]),e.jsxs(e.Fragment,{children:[e.jsx(ta,{children:e.jsx("title",{children:t.formatMessage(W.title)})}),e.jsx(Ya,{currentWorkspaceId:a,startDate:r,setStartDate:l,currentTab:s,setTab:o}),e.jsx(ua,{children:e.jsx(n,{currentWorkspaceId:a,startDate:r})})]})}const W=O({title:{id:"workspaceUsage.title",defaultMessage:"User Analytics"},overviewTab:{id:"workspaceUsage.overviewTab",defaultMessage:"Overview"},usersTab:{id:"workspaceUsage.usersTab",defaultMessage:"Users"},gptsTab:{id:"workspaceUsage.gptsTab",defaultMessage:"GPTs"},creditsTab:{id:"workspaceUsage.creditsTab",defaultMessage:"Credits"},exportButton:{id:"workspaceUsage.exportButton",defaultMessage:"Export..."},dataLastUpdatedLabel:{id:"workspaceUsage.dataLastUpdatedLabel",defaultMessage:"Data updated"},dataLastUpdatedUnknown:{id:"workspaceUsage.dataLastUpdatedUnknown",defaultMessage:"Unknown"},helpCenterLinkText:{id:"workspaceUsage.helpCenterLinkText",defaultMessage:"Learn more about analytics"}}),St=Ke(function(){const t=ma();return pa(),e.jsx(Za,{...t})});export{St as default};
//# sourceMappingURL=ggdat7zfhlnc3us5.js.map
