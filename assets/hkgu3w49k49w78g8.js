import{j as e,M as L,r as x}from"./juy90og0wtbp77qa.js";import{i as $,ar as o,iu as z,B,aU as R,aS as S,dM as F,bC as G,hY as H,P as W,b2 as Y,b3 as K,ak as O}from"./dc2xxjkicf2pz0mj.js";import{hG as Q,iY as X,iZ as Z,eX as q,i_ as J,i$ as U,j0 as N}from"./ckp56qklot786ulr.js";function V({message:t,simulatedDuration:r=8*60*1e3,maxFill:s=100}){t?.metadata?.model_slug!=="o1-pro"&&(r=20*60*1e3);const n=t?.create_time?new Date(t.create_time*1e3):Date.now(),i=Q(+n,r);return e.jsx(X,{percentage:Math.min(i,s),className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:`${(100-i)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:8})}function I({title:t,content:r,buttons:s,time:n,icon:i,size:l="default",progressBar:c,disabled:a=!1,onClick:u}){const f=l==="small"?`w-full flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] ps-[20px] pt-[13px] pb-[10px] ${a?"":"gap-4"}`:"w-full gap-4 px-[22px] pb-[22px] pt-[18px]",v=u?"cursor-pointer":"",p=l==="small"?"text-[15px]":"",g=$(z);return e.jsxs("div",{className:o("relative inline-flex flex-col items-start justify-start rounded-2xl border","bg-token-bg-primary border-token-border-default box-content rounded-2xl border bg-clip-padding px-5 py-4",!g&&"mx-[calc(--spacing(-2)-1px)] -my-[1px] @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4",f,v,p),onClick:u,children:[e.jsxs("div",{className:o("flex flex-col items-start justify-start self-stretch",l!=="small"&&"gap-1.5"),children:[e.jsxs("div",{className:o("inline-flex items-start justify-start self-stretch",l!=="small"&&"gap-2"),children:[e.jsx("div",{className:o("shrink grow basis-0 leading-normal font-medium","text-token-text-secondary hover:text-token-text-primary"),children:t}),e.jsx("div",{className:"relative h-6 w-6"}),!a&&(i||e.jsx(Z,{className:"relative h-6 w-6"}))]}),e.jsx("div",{className:o("flex w-full flex-col items-start justify-start",l==="small"&&"mt-[-2px]"),children:e.jsx("div",{className:o("inline-flex w-full items-start justify-start self-stretch rounded-sm",l==="small"?"gap-1":"gap-2.5 py-1"),children:e.jsx("div",{className:o("w-full leading-relaxed font-normal",a?"text-token-text-tertiary":"text-token-text-secondary"),children:r})})})]}),c?e.jsxs("div",{className:o("mb-2 inline-flex items-center justify-between self-stretch",s?.length&&"mt-[-10px]"),children:[c,s]}):e.jsxs("div",{className:"inline-flex items-center justify-end self-stretch",children:[n&&e.jsx("div",{className:"text-token-text-tertiary shrink grow basis-0 text-[15px] leading-normal font-normal",children:n}),e.jsx("div",{className:"flex gap-2",children:s})]})]})}function ee({errorNotice:t,onOpenSidebarSummarizer:r,isReceivingUpdates:s,lastMessage:n,latestTitle:i,summarizationHeadline:l}){return e.jsxs("div",{className:"flex pb-2",children:[e.jsx(I,{buttons:s?[e.jsx(B,{onClick:c=>{c.stopPropagation(),r()},color:"secondary",className:"text-token-text-secondary h-[38px]! text-[15px] font-normal",children:e.jsx("div",{className:"px-1",children:e.jsx(L,{id:"wQcuK8",defaultMessage:"Details"})})},"Details")]:[],time:null,title:l,icon:s?e.jsx("div",{className:""}):null,content:s?`${i}...`:n?.metadata?.finished_text??"",size:"small",disabled:!s,onClick:r,progressBar:s?e.jsx(V,{message:n}):null}),t]})}const te=/\*\*(.*?)(?:\*\*|\n|$)/g,se=t=>{let r=null,s;for(;(s=te.exec(t))!=null;)r=s[1].trim();return r},ae=()=>null;function ie({messages:t,isStreaming:r,isCompletionRequestInProgress:s,hasActiveRequest:n,isLastMessage:i,isFinalTurn:l,isFeedbackEnabled:c,clientThreadId:a,currentGroupedMessageIndex:u,turnIndex:f}){const[v,p]=x.useState(""),[g,w]=x.useState(!1),C=q(a)?.value===R.STREAMING,k=J(S(a)),d=F(t),M=d?.id,y=d?.metadata?.initial_text,T=d?.metadata?.summarization_headline,h=t.map(m=>G(m)).join(`

`),{toggleThreadSidebar:b}=H(),_=x.useCallback(()=>{b({type:"summarizer",clientThreadId:a,currentGroupedMessageIndex:u,turnIndex:f})},[b,a,u,f]);x.useEffect(()=>{const m=se(h);m?p(m):y!=null&&p(y)},[h,y]),x.useEffect(()=>{h.length>0&&w(!0)},[h]),x.useEffect(()=>{g&&W.logEvent("Tool: Received a8km123 message",{client_thread_id:a,message_id:M,conversationId:S(a)})},[g]);const E=l&&i&&(C||r),P=ae()!=null,A=Y.isLastActorMessage(K(a),t[0].id),D=!!O(a,m=>m?.sharedConversationMetadata),j=U(t[0],A,P,s||n,D);return!k&&d?.metadata?.finish_details?.type==="interrupted"&&d?.metadata?.finish_details?.reason!=="server_timeout"||d?.clientMetadata?.err?e.jsx("div",{children:j&&e.jsx(N,{errorState:j,nodeId:t[0].id,isFeedbackEnabled:c,clientThreadId:a,isUserTurn:!1})}):e.jsx(ee,{errorNotice:j&&e.jsx(N,{errorState:j,nodeId:t[0].id,isFeedbackEnabled:c,clientThreadId:a,isUserTurn:!1}),onOpenSidebarSummarizer:_,isReceivingUpdates:E,lastMessage:d,latestTitle:v,summarizationHeadline:T})}export{ie as default};
//# sourceMappingURL=hkgu3w49k49w78g8.js.map
