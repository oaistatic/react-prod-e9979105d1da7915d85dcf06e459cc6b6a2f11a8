import{cK as s,j6 as S,jS as I,ag as N,jT as w,R as P,cJ as a,du as M,dv as y,de as U,bx as i,jU as b,bw as k,jV as C,P as O,d as L}from"./dc2xxjkicf2pz0mj.js";import{h as H,e as j,r as d,j as T,ad as E}from"./juy90og0wtbp77qa.js";import{g as D}from"./hofzvq2xu48y7oax.js";import{C as x}from"./jbze7lwlszm657iq.js";const F={OAUTH_SCOPES_MISMATCH:s.OAUTH_FAILED_SCOPE_MISMATCH,EMAIL_DOMAIN_CLAIMED_BY_ANOTHER_WORKSPACE:s.OAUTH_FAILED_EMAIL_DOMAIN_ENFORCEMENT},K=S(function(){const u=H(),r=j(),_=I(),f=N(),l=d.useRef(!1),{mutateAsync:A}=w();return d.useEffect(()=>{if(l.current===!0)return;l.current=!0;async function g(){const h=D()==="popup"||_,m=window.location.href;try{const t=await P.safeGet("/aip/connectors/links/oauth/callback",{parameters:{query:{full_redirect_url:m}}});if(!t?.post_auth_url){r(a(s.OAUTH_FAILED_GENERIC));return}const n=t?.link?.connector_id===M[y.GITHUB_CONNECTOR],e=new URL(t.post_auth_url,location.origin),p=U(e.hash)===i.Connectors;if(!p){const o=b[t.link.connector_id];o&&e.searchParams.set("add_source",o)}let c;if(p){const o=new URLSearchParams;o.set("connector",t.link.connector_id),n&&o.set("show_github_repo_modal","true");const R={...e,search:"",hash:k(i.Connectors).hash+`?${o.toString()}`};c=E(R)}else n&&e.searchParams.set("show_github_repo_modal","true"),c=E({pathname:e.pathname,search:e.search,hash:e.hash});if(h){C({success:!0,connectorId:t.link.connector_id,linkId:t.link.id}),window.close();return}O.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_success",{success:!0,type:t.link.connector_id}),r(a(s.CUSTOM_MSG,c,u.formatMessage({id:"Og/gZO",defaultMessage:"{connector} is now connected"},{connector:t.link.name})))}catch(t){const n=t instanceof L?F[t.detail?.error_code]??s.OAUTH_FAILED_GENERIC:s.OAUTH_FAILED_GENERIC;if(h){C({success:!1,connectorId:"",errorType:n}),window.close();return}O.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_error",{errorType:n,success:!1,type:"unknown"}),r(a(n,`#settings/${i.Connectors}`))}}g()},[_,u,r,f,A]),T.jsx("div",{className:"flex h-screen w-screen items-center justify-center",children:T.jsx(x,{size:36})})});export{K as default};
//# sourceMappingURL=ha9e2ecsdrt3a5wt.js.map
