import{ag as Y,R as K,ec as he,ar as q,B as xe,iB as ve,j6 as we}from"./dc2xxjkicf2pz0mj.js";import{d as be,u as X,a as J,w as ye,h as Z,r as a,j as t,f as Me,M as W}from"./juy90og0wtbp77qa.js";import{iG as Ie}from"./ckp56qklot786ulr.js";import{a as je,c as Ce,u as Pe,d as Se}from"./nun3xvf89dudjv6n.js";import{W as G}from"./oue9h0fn7ryw3g04.js";import"./icu9d2zdwlcy45kn.js";import"./btouzu0b6h5eiejj.js";import"./o6wb3ptvu0bk81yq.js";import"./dmfmxszxfbs8gsbx.js";import"./iacposgqe14fuloa.js";import"./o7zrzew6ugefv8n2.js";import"./abebcwj1m9mup3z6.js";import"./nqj34k5dky4x5suq.js";import"./hort3ndd4wla0a2j.js";import"./jsgl3b1bt1ozctr5.js";import"./ck00y48d3yzt8bq3.js";import"./hczymk9ojq2shlcf.js";import"./hisrfv493df9w8hp.js";import"./g8shiwm7jpd74xmd.js";import"./iiyyoj0wgh5vo89i.js";import"./chyo79tmbp42x8r3.js";import"./ctoge6bibgzva9ta.js";import"./m36qabefvxegdn1g.js";import"./nyxt3hy2zzj6sj8a.js";function ke(o){return be({queryKey:["workspace-ip-allowlist",o],queryFn:o?()=>K.safeGet("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:o}}}):ye})}function Ae(o){const i=X(),l=Y();return J({mutationFn:s=>K.safePost("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:o}},requestBody:s}),onSuccess:()=>{i.invalidateQueries({queryKey:["workspace-ip-allowlist",o]})},onError:s=>{l.danger(s.message,{toastId:"ip_allowlist_create",loggingTitle:s.message,loggingDescription:"Failed to update IP allowlist"})}})}function Ne(o){const i=X(),l=Y();return J({mutationFn:s=>K.safePatch("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:o}},requestBody:s}),onSuccess:()=>{i.invalidateQueries({queryKey:["workspace-ip-allowlist",o]})},onError:s=>{l.danger(s.message,{toastId:"ip_allowlist_toggle",loggingTitle:s.message,loggingDescription:"Failed to toggle IP allowlist"})}})}const U={md:{font:14,h:18,gap:6},lg:{font:14,h:20,gap:6},xl:{font:14,h:24,gap:6},"2xl":{font:16,h:24,gap:8},"3xl":{font:16,h:32,gap:8}};function De({value:o,defaultValue:i=[],onChange:l,validator:s,placeholder:h="",disabled:r=!1,size:u="xl",rows:c=1,maxTags:v,delimiters:w=[","," "],autoFocus:y=!1,showCount:k}){const A=Z(),E=o!==void 0,[M,F]=a.useState(i),d=o??M,j=a.useRef(null),I=a.useRef(null),f=a.useRef(null),[N,H]=a.useState(y),[x,C]=a.useState(""),[P,b]=a.useState(null),[ee,V]=a.useState(new Set),[te,se]=a.useState(16),D=!v||d.length<v,T=d.length===0,ne=a.useMemo(()=>{const e=U[u];return c*e.h+(c+1)*e.gap},[c,u]),$=a.useMemo(()=>new Set(d.map(e=>e.value)),[d]),R=a.useCallback(e=>{l?.(e),E||F(e)},[l,E]),z=a.useCallback(e=>s?s(e):!0,[s]),_=a.useCallback(e=>{const n=e.trim();if(!n)return;if($.has(n)){V(g=>new Set(g).add(n)),window.setTimeout(()=>{V(g=>{const S=new Set(g);return S.delete(n),S})},500);return}const p=[...d,{value:n,valid:z(n)}];R(p)},[d,$,z,R]),O=a.useCallback(e=>{const n=[...d];n.splice(e,1),R(n),b(null)},[d,R]),Q=()=>{const e=j.current;return!e||e.selectionStart===0&&e.selectionEnd===0},ae=e=>{if(D)if(e.key==="ArrowLeft"||e.key==="ArrowUp")Q()&&(e.preventDefault(),b(n=>n==null?d.length-1:Math.max(0,n-1)));else if(e.key==="ArrowRight"||e.key==="ArrowDown"){if(P!=null){e.preventDefault();const n=P+1;b(n>=d.length?null:n)}}else e.key==="Backspace"&&(P!=null?(e.preventDefault(),O(P)):Q()&&d.length&&(e.preventDefault(),b(d.length-1)))},le=e=>{e.key==="Enter"||w.includes(e.key)?(e.preventDefault(),x&&(_(x),C(""))):e.key==="Tab"&&x&&(e.preventDefault(),_(x),C(""))},ie=e=>{let p=[e.clipboardData.getData("text")];for(const g of w){const S=[];for(const me of p)S.push(...me.split(g));p=S}if(p=p.flatMap(g=>g.split(/\r?\n/)).map(g=>g.trim()).filter(Boolean),p.length>1){e.preventDefault();for(const g of p)_(g);C("")}},oe=()=>H(!0),re=e=>{I.current&&e.relatedTarget instanceof Node&&I.current.contains(e.relatedTarget)||(H(!1),b(null),x.trim()&&(_(x),C("")))},ue=e=>{if(r)return;const n=e.target instanceof Element?e.target.closest("[data-tag]"):null;if(n){const p=Number(n.getAttribute("data-index"));b(isNaN(p)?null:p);return}e.preventDefault(),j.current?.focus(),b(null)};he(()=>{if(!D)return;const e=f.current,n=I.current;if(!e||!n)return;e.textContent=x||(T?h:"")||"";const p=e.getBoundingClientRect().width,g=n.getBoundingClientRect().width-32;se(Math.max(16,Math.min(p+4,g)))},[x,h,D,T]);const B=U[u],ce={"--input-font-size":`${B.font}px`,"--input-height":`${B.h}px`,"--input-tag-spacing":`${B.gap}px`,minHeight:`${ne}px`},de="flex items-center rounded px-[6px] py-[4px] text-[var(--input-font-size)] leading-none transition-colors select-none",pe="bg-green-50 text-green-800 hover:bg-green-100",ge="bg-red-50 text-red-800 hover:bg-red-100",fe="font-bold";return t.jsxs(t.Fragment,{children:[t.jsx("div",{ref:I,className:q("relative mb-[8px] cursor-text overflow-x-hidden overflow-y-auto rounded-xl border-2 px-4 py-2",r?"cursor-not-allowed border-neutral-200 bg-neutral-50 opacity-60":"border-neutral-300 bg-white hover:border-neutral-400"),style:ce,"data-size":u,"data-focused":N?"":void 0,"data-empty":T?"":void 0,"data-disabled":r?"":void 0,onKeyDown:ae,onMouseDown:ue,onFocus:oe,onBlur:re,tabIndex:-1,children:t.jsxs("div",{className:"flex flex-wrap items-start gap-x-[var(--input-tag-spacing)] gap-y-[var(--input-tag-spacing)]",children:[d.map((e,n)=>{const p=P===n,g=ee.has(e.value);return t.jsxs("div",{"data-tag":e.value,"data-index":n,className:q(de,e.valid?pe:ge,p&&fe,g&&"animate-pulse"),children:[t.jsx("span",{title:e.value,children:e.value}),!r&&t.jsx("button",{type:"button","aria-label":A.formatMessage({id:"4LMrjM",defaultMessage:"Remove"}),onClick:()=>O(n),className:"ms-[2px] inline-flex h-3.5 w-3.5 items-center justify-center rounded text-xs text-neutral-500 hover:text-neutral-900",children:A.formatMessage({id:"3pDUsa",defaultMessage:"x"})})]},e.value)}),D&&t.jsxs("div",{className:"inline-flex items-center",children:[t.jsx("span",{ref:f,className:"invisible absolute -z-10 whitespace-pre text-[var(--input-font-size)]"}),t.jsx("input",{ref:j,type:"text",value:x,placeholder:T?h:void 0,disabled:r,onChange:e=>C(e.currentTarget.value),onKeyDown:le,onPaste:ie,className:q("m-0 border-none bg-transparent p-0","leading-[1.4] text-[var(--input-font-size)] caret-current","outline-none focus:outline-none focus-visible:outline-none","ring-0 focus:ring-0 focus-visible:ring-0","placeholder:text-neutral-400"),style:{width:te},autoFocus:y})]})]})}),(v||k)&&t.jsxs("div",{className:"mt-1 w-full text-end font-mono text-[12px] tracking-widest text-neutral-500",children:[d.length,v?`/${v}`:null]})]})}const L=o=>{const i=o.trim();if(!i)return!1;const l=i.split("/");if(l.length>2)return!1;const[s,h]=l;if(h==="")return!1;let r;return h!==void 0&&(r=parseInt(h,10),isNaN(r))?!1:s.includes(":")?!(!Te(s)||r!==void 0&&(r<0||r>128)):!(!/^(\d{1,3}\.){3}\d{1,3}$/.test(s)||r!==void 0&&(r<0||r>32))},Te=o=>{const i=o.split("::");if(i.length>2)return!1;const l=i[0]?i[0].split(":"):[],s=i.length===2&&i[1]?i[1].split(":"):[],h=/^[0-9a-fA-F]{1,4}$/;return l.some(r=>!h.test(r))||s.some(r=>!h.test(r))?!1:i.length===1?l.length===8:l.length+s.length<8},m=Me({title:{id:"sId/vw",defaultMessage:"IP allowlist"},sectionTitle:{id:"SbypLe",defaultMessage:"Configure IP Allowlist"},toggleSectionTitle:{id:"EQaYRJ",defaultMessage:"Activate IP Allowlist"},toggleSectionSubhead:{id:"7G4FjX",defaultMessage:"Enable or disable IP allowlisting across your workspace."},toggleLabel:{id:"eIKgW3",defaultMessage:"Enable IP allowlist"},helperText:{id:"NbRjB9",defaultMessage:"IP allowlisting restricts API access to only the IP addresses or ranges you specify. This will only apply to requests via API keys (i.e. admin keys and dashboard access will not be restricted). Changes to allowed IP addresses may take up to 15 minutes to take effect."},noIpConfigured:{id:"jnqmPO",defaultMessage:"No IP Addresses Configured"},noIpConfiguredHelp:{id:"LB8hmH",defaultMessage:"If the allowlist is enabled, all public traffic will be blocked."},emptyMessage:{id:"ynbWU8",defaultMessage:"Add IP address or CIDR rangeâ€¦"},saveButton:{id:"8c8mEa",defaultMessage:"Save"},invalidNotice:{id:"vwaoU9",defaultMessage:"One or more IP / CIDR entries are invalid."},emptyWarning:{id:"8GqXoq",defaultMessage:"You are enabling an IP allowlist with no entries. This will block traffic. Continue?"}});function Re({currentWorkspaceId:o,readonly:i=!1}){const l=Z(),{data:s,isLoading:h,isFetching:r}=ke(o),u=a.useMemo(()=>{if(s)return{allowed_ips:Array.isArray(s.allowed_ips)?s.allowed_ips:[],enabled:!!s.enabled}},[s]),[c,v]=a.useState(u?.allowed_ips??[]);a.useEffect(()=>{u&&v(u.allowed_ips)},[u]);const w=Ae(o),y=Ne(o),k=a.useMemo(()=>new Set(u?.allowed_ips??[]),[u?.allowed_ips]),A=a.useMemo(()=>{if(!u)return c.length>0;if(u.allowed_ips.length!==c.length)return!0;for(const f of c)if(!k.has(f))return!0;return!1},[u,c,k]),M=a.useMemo(()=>c.filter(f=>!L(f)),[c]).length===0,F=a.useMemo(()=>c.map(f=>({value:f,valid:L(f)})),[c]),d=a.useCallback(f=>{v(f.map(N=>N.value))},[]),j=a.useCallback(()=>{M&&w.mutate({allowed_ips:c})},[c,M,w]),I=a.useCallback(f=>{f&&c.length===0&&!window.confirm(l.formatMessage(m.emptyWarning))||y.mutate({enabled:f})},[y,c,l]);return t.jsxs(t.Fragment,{children:[t.jsx(Ie,{children:t.jsx("title",{children:l.formatMessage(m.title)})}),t.jsx(je,{title:l.formatMessage(m.title)}),t.jsx(Ce,{showSpinner:h,children:u?t.jsxs("div",{className:"pt-6",children:[t.jsx(G,{title:m.sectionTitle,children:t.jsxs("div",{className:"max-w-4xl space-y-6 pb-6",children:[t.jsx("p",{className:"text-sm text-neutral-500",children:l.formatMessage(m.helperText)}),t.jsx(De,{value:F,onChange:d,validator:L,placeholder:l.formatMessage(m.emptyMessage),disabled:i||w.isPending,size:"xl",rows:3}),t.jsxs("div",{className:"mt-2 flex w-full items-center",children:[!M&&t.jsx("div",{className:"text-sm text-red-600",role:"alert",children:l.formatMessage(m.invalidNotice)}),t.jsx(xe,{className:"ms-auto",onClick:j,disabled:i||!A||!M||w.isPending||r,children:t.jsx(W,{...m.saveButton})})]})]})}),t.jsx(G,{title:m.toggleSectionTitle,children:t.jsxs("div",{className:"max-w-4xl space-y-4",children:[t.jsx("p",{className:"text-sm text-neutral-500",children:l.formatMessage(m.toggleSectionSubhead)}),c.length===0&&t.jsxs("div",{className:"rounded-md border border-dashed border-neutral-300 bg-neutral-50 p-4 text-sm text-neutral-600",children:[t.jsx("div",{className:"font-medium",children:l.formatMessage(m.noIpConfigured)}),t.jsx("div",{children:l.formatMessage(m.noIpConfiguredHelp)})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ve,{checked:u.enabled,disabled:i||y.isPending,onCheckedChange:I,"aria-label":l.formatMessage(m.toggleLabel)}),t.jsx("span",{className:"text-sm text-neutral-600",children:u.enabled?t.jsx(W,{id:"0eFOl8",defaultMessage:"Allowlist is active."}):t.jsx(W,{id:"OpY4Fi",defaultMessage:"Allowlist is inactive."})})]})]})})]}):null})]})}const _e=a.memo(Re),lt=we(function(){const i=Pe();return Se(),t.jsx(_e,{...i})});export{lt as default};
//# sourceMappingURL=kjvsoujyr2nctmzd.js.map
